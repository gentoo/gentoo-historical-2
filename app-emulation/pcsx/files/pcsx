#!/bin/sh

if [ ! -f ~/.pcsx/config ]; then
	echo You are running PCSX for the first time.
	echo Setting up your PCSX environment... Please wait...
	
	mkdir -p $HOME/.pcsx
	cd $HOME/.pcsx
	mkdir memcards bios cfg plugins

	ln -s /usr/bin/pcsx.bin pcsx
	ln -s /usr/lib/psemu/plugins/* plugins/

	cd bios
	if [ -f /usr/lib/psemu/bios/scph1001.bin ]; then
		ln -s /usr/lib/psemu/bios/scph1001.bin .
		biosname=scph1001.bin
	else
		biosname=HLE
	fi

	cat >$HOME/.pcsx/config <<EOF
Bios = $biosname
Gpu = $(basename $(echo plugins/libgpu* | cut -f1 -d\ ) )
Spu = $(basename $(echo plugins/libspu* | cut -f1 -d\ ) )
Cdr = $(basename $(echo plugins/libcdr* | cut -f1 -d\ ) )
Pad1 = $(basename $(echo plugins/libpadXwin-* | cut -f1 -d\ ) )
Pad2 = $(basename $(echo plugins/libpadXwin-* | cut -f1 -d\ ) )
Mcd1 = $HOME/.pcsx/memcards/Mcd001.mcr
Mcd2 = $HOME/.pcsx/memcards/Mcd002.mcr
PluginsDir = $HOME/.pcsx/plugins/
BiosDir = $HOME/.pcsx/bios/
Xa = 0
Sio = 0
Mdec = 0
PsxAuto = 1
PsxType = 0
Cdda = 0
Cpu = 0
PsxOut = 0
SpuIrq = 0
CdTiming = 0
EOF
	unset biosname
fi

cd $HOME/.pcsx/

ln -s /usr/lib/psemu/cfg/* cfg/ &>/dev/null
ln -s /usr/lib/psemu/plugins/* plugins/ &>/dev/null

./pcsx -cfg $HOME/.pcsx/config

