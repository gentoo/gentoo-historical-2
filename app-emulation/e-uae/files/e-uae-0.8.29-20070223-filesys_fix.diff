Index: src/main.c
===================================================================
RCS file: /cvsroot/uaedev/uae/src/main.c,v
retrieving revision 1.51
diff -u -r1.51 main.c
--- src/main.c	23 Feb 2007 02:07:58 -0000	1.51
+++ src/main.c	25 Feb 2007 19:26:10 -0000
@@ -912,9 +912,11 @@
 
 	    set_inhibit_frame (IHF_QUIT_PROGRAM);
 
-	    if (uae_target_state == UAE_STATE_COLD_START || uae_target_state == UAE_STATE_WARM_START) {
-		filesys_prepare_reset ();
-	    }
+#ifdef FILESYS
+	    /* Ensure any cached changes to virtual filesystem are flushed before
+	     * resetting or exitting. */
+	    filesys_prepare_reset ();
+#endif
 
 	} /* while (!QUITTING && !STOPPED) */
 
