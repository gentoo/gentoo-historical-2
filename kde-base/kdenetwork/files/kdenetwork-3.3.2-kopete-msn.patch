diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/Makefile.am kdenetwork-3.3.2/kopete/protocols/msn/Makefile.am
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/Makefile.am	2004-06-25 11:10:14.000000000 +0200
+++ kdenetwork-3.3.2/kopete/protocols/msn/Makefile.am	2005-05-22 19:35:27.000000000 +0200
@@ -1,3 +1,4 @@
+KDE_OPTIONS = nofinal 
 METASOURCES = AUTO
 SUBDIRS = ui . icons config
 AM_CPPFLAGS = -I$(srcdir)/ui \
@@ -11,8 +12,8 @@
 CLEANFILES = dummy.cpp
 
 libkopete_msn_shared_la_SOURCES = msnprotocol.cpp msnaccount.cpp msnaddcontactpage.cpp msncontact.cpp \
-	msnsocket.cpp msnmessagemanager.cpp msndebugrawcmddlg.cpp \
-	msnnotifysocket.cpp msnswitchboardsocket.cpp msnfiletransfersocket.cpp msninvitation.cpp msnp2p.cpp sha1.cpp
+	msnsocket.cpp msnmessagemanager.cpp msndebugrawcmddlg.cpp sslloginhandler.cpp \
+	msnnotifysocket.cpp msnswitchboardsocket.cpp msnfiletransfersocket.cpp msninvitation.cpp msnp2p.cpp sha1.cpp 
 
 libkopete_msn_shared_la_LIBADD  = ./ui/libkopetemsnui.la ../../libkopete/libkopete.la $(LIB_KIO)
 libkopete_msn_shared_la_LDFLAGS = -version-info 0:0:0 -no-undefined $(all_libraries)
diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/Makefile.in kdenetwork-3.3.2/kopete/protocols/msn/Makefile.in
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/Makefile.in	2004-11-29 16:24:54.000000000 +0100
+++ kdenetwork-3.3.2/kopete/protocols/msn/Makefile.in	2005-05-22 19:57:41.000000000 +0200
@@ -1,9 +1,9 @@
-# Makefile.in generated by automake 1.9.1 from Makefile.am.
+# Makefile.in generated by automake 1.7.9 from Makefile.am.
 # KDE tags expanded automatically by am_edit - $Revision: 1.1 $ 
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004  Free Software Foundation, Inc.
+# Copyright 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003
+# Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,9 +15,6 @@
 
 @SET_MAKE@
 
-
-SOURCES = $(kopete_msn_la_SOURCES) $(libkopete_msn_shared_la_SOURCES)
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
@@ -25,6 +22,7 @@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 top_builddir = ../../..
+
 am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
 install_sh_DATA = $(install_sh) -c -m 644
@@ -41,97 +39,6 @@
 build_triplet = @build@
 host_triplet = @host@
 target_triplet = @target@
-subdir = kopete/protocols/msn
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in TODO
-ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
-am__aclocal_m4_deps = $(top_srcdir)/acinclude.m4 \
-	$(top_srcdir)/configure.in
-am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
-	$(ACLOCAL_M4)
-mkinstalldirs = $(SHELL) $(top_srcdir)/admin/mkinstalldirs
-CONFIG_HEADER = $(top_builddir)/config.h
-CONFIG_CLEAN_FILES =
-am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
-am__vpath_adj = case $$p in \
-    $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
-    *) f=$$p;; \
-  esac;
-am__strip_dir = `echo $$p | sed -e 's|^.*/||'`;
-am__installdirs = "$(DESTDIR)$(kde_moduledir)" "$(DESTDIR)$(libdir)" \
-	"$(DESTDIR)$(mydatadir)" "$(DESTDIR)$(servicedir)"
-kde_moduleLTLIBRARIES_INSTALL = $(INSTALL)
-libLTLIBRARIES_INSTALL = $(INSTALL)
-LTLIBRARIES = $(kde_module_LTLIBRARIES) $(lib_LTLIBRARIES)
-kopete_msn_la_DEPENDENCIES = libkopete_msn_shared.la
-am_kopete_msn_la_OBJECTS = dummy.lo
-#>- kopete_msn_la_OBJECTS = $(am_kopete_msn_la_OBJECTS)
-#>+ 1
-kopete_msn_la_OBJECTS = dummy.lo
-am__DEPENDENCIES_1 =
-libkopete_msn_shared_la_DEPENDENCIES = ./ui/libkopetemsnui.la \
-	../../libkopete/libkopete.la $(am__DEPENDENCIES_1)
-am_libkopete_msn_shared_la_OBJECTS = msnprotocol.lo msnaccount.lo \
-	msnaddcontactpage.lo msncontact.lo msnsocket.lo \
-	msnmessagemanager.lo msndebugrawcmddlg.lo msnnotifysocket.lo \
-	msnswitchboardsocket.lo msnfiletransfersocket.lo \
-	msninvitation.lo msnp2p.lo sha1.lo
-#>- libkopete_msn_shared_la_OBJECTS =  \
-#>- 	$(am_libkopete_msn_shared_la_OBJECTS)
-#>+ 8
-libkopete_msn_shared_la_final_OBJECTS = libkopete_msn_shared_la.all_cpp.lo 
-libkopete_msn_shared_la_nofinal_OBJECTS = msnprotocol.lo msnaccount.lo \
-	msnaddcontactpage.lo msncontact.lo msnsocket.lo \
-	msnmessagemanager.lo msndebugrawcmddlg.lo msnnotifysocket.lo \
-	msnswitchboardsocket.lo msnfiletransfersocket.lo \
-	msninvitation.lo msnp2p.lo sha1.lo
-@KDE_USE_FINAL_FALSE@libkopete_msn_shared_la_OBJECTS = $(libkopete_msn_shared_la_nofinal_OBJECTS)
-@KDE_USE_FINAL_TRUE@libkopete_msn_shared_la_OBJECTS = $(libkopete_msn_shared_la_final_OBJECTS)
-DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)
-depcomp = $(SHELL) $(top_srcdir)/admin/depcomp
-am__depfiles_maybe = depfiles
-#>- CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
-#>- 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
-#>+ 2
-CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
-	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
-#>- LTCXXCOMPILE = $(LIBTOOL) --mode=compile --tag=CXX $(CXX) $(DEFS) \
-#>- 	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
-#>- 	$(AM_CXXFLAGS) $(CXXFLAGS)
-#>+ 3
-LTCXXCOMPILE = $(LIBTOOL) --mode=compile --tag=CXX $(CXX) $(DEFS) \
-	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
-	$(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
-CXXLD = $(CXX)
-#>- CXXLINK = $(LIBTOOL) --mode=link --tag=CXX $(CXXLD) $(AM_CXXFLAGS) \
-#>- 	$(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
-#>+ 2
-CXXLINK = $(LIBTOOL) --mode=link --tag=CXX $(CXXLD) $(AM_CXXFLAGS) \
-	$(CXXFLAGS) $(KDE_CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
-SOURCES = $(kopete_msn_la_SOURCES) $(libkopete_msn_shared_la_SOURCES)
-DIST_SOURCES = $(kopete_msn_la_SOURCES) \
-	$(libkopete_msn_shared_la_SOURCES)
-#>- RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
-#>- 	html-recursive info-recursive install-data-recursive \
-#>- 	install-exec-recursive install-info-recursive \
-#>- 	install-recursive installcheck-recursive installdirs-recursive \
-#>- 	pdf-recursive ps-recursive uninstall-info-recursive \
-#>- 	uninstall-recursive
-#>+ 6
-RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
-	html-recursive info-recursive install-data-recursive \
-	install-exec-recursive install-info-recursive \
-	install-recursive installcheck-recursive installdirs-recursive \
-	pdf-recursive ps-recursive uninstall-info-recursive \
-	uninstall-recursive nmcheck-recursive bcheck-recursive
-mydataDATA_INSTALL = $(INSTALL_DATA)
-serviceDATA_INSTALL = $(INSTALL_DATA)
-DATA = $(mydata_DATA) $(service_DATA)
-ETAGS = etags
-CTAGS = ctags
-DIST_SUBDIRS = $(SUBDIRS)
-#>- DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
-#>+ 1
-DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST) $(KDE_DIST)
 ACLOCAL = @ACLOCAL@
 AMDEP_FALSE = @AMDEP_FALSE@
 AMDEP_TRUE = @AMDEP_TRUE@
@@ -320,8 +227,6 @@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
-am__tar = @am__tar@
-am__untar = @am__untar@
 bindir = @bindir@
 build = @build@
 build_alias = @build_alias@
@@ -407,7 +312,6 @@
 librss_SUBDIR_included_TRUE = @librss_SUBDIR_included_TRUE@
 localstatedir = @localstatedir@
 mandir = @mandir@
-mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
 prefix = @prefix@
 program_transform_name = @program_transform_name@
@@ -428,6 +332,7 @@
 xdg_appsdir = @xdg_appsdir@
 xdg_directorydir = @xdg_directorydir@
 xdg_menudir = @xdg_menudir@
+KDE_OPTIONS = nofinal 
 #>- METASOURCES = AUTO
 SUBDIRS = ui . icons config
 AM_CPPFLAGS = -I$(srcdir)/ui \
@@ -435,125 +340,197 @@
 	$(KOPETE_INCLUDES) \
 	$(all_includes)
 
+
 kde_module_LTLIBRARIES = kopete_msn.la
 lib_LTLIBRARIES = libkopete_msn_shared.la
+
 CLEANFILES = dummy.cpp
+
 libkopete_msn_shared_la_SOURCES = msnprotocol.cpp msnaccount.cpp msnaddcontactpage.cpp msncontact.cpp \
-	msnsocket.cpp msnmessagemanager.cpp msndebugrawcmddlg.cpp \
-	msnnotifysocket.cpp msnswitchboardsocket.cpp msnfiletransfersocket.cpp msninvitation.cpp msnp2p.cpp sha1.cpp
+	msnsocket.cpp msnmessagemanager.cpp msndebugrawcmddlg.cpp sslloginhandler.cpp \
+	msnnotifysocket.cpp msnswitchboardsocket.cpp msnfiletransfersocket.cpp msninvitation.cpp msnp2p.cpp sha1.cpp 
+
 
 libkopete_msn_shared_la_LIBADD = ./ui/libkopetemsnui.la ../../libkopete/libkopete.la $(LIB_KIO)
 #>- libkopete_msn_shared_la_LDFLAGS = -version-info 0:0:0 -no-undefined $(all_libraries)
 #>+ 1
 libkopete_msn_shared_la_LDFLAGS = -version-info 0:0:0 -no-undefined $(KDE_NO_UNDEFINED) $(all_libraries)
+
 kopete_msn_la_SOURCES = dummy.cpp
 kopete_msn_la_LIBADD = libkopete_msn_shared.la
+
 #>- kopete_msn_la_LDFLAGS = -no-undefined -module $(KDE_PLUGIN) $(all_libraries)
 #>+ 1
 kopete_msn_la_LDFLAGS = -no-undefined $(KDE_NO_UNDEFINED) -module $(KDE_PLUGIN) $(all_libraries)
+
 service_DATA = kopete_msn.desktop
 servicedir = $(kde_servicesdir)
+
 mydatadir = $(kde_datadir)/kopete_msn
 mydata_DATA = msnchatui.rc
+subdir = kopete/protocols/msn
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+mkinstalldirs = $(SHELL) $(top_srcdir)/admin/mkinstalldirs
+CONFIG_HEADER = $(top_builddir)/config.h
+CONFIG_CLEAN_FILES =
+LTLIBRARIES = $(kde_module_LTLIBRARIES) $(lib_LTLIBRARIES)
+
+kopete_msn_la_DEPENDENCIES = libkopete_msn_shared.la
+am_kopete_msn_la_OBJECTS = dummy.lo
+#>- kopete_msn_la_OBJECTS = $(am_kopete_msn_la_OBJECTS)
+#>+ 1
+kopete_msn_la_OBJECTS = dummy.lo
+libkopete_msn_shared_la_DEPENDENCIES = ./ui/libkopetemsnui.la \
+	../../libkopete/libkopete.la
+am_libkopete_msn_shared_la_OBJECTS = msnprotocol.lo msnaccount.lo \
+	msnaddcontactpage.lo msncontact.lo msnsocket.lo \
+	msnmessagemanager.lo msndebugrawcmddlg.lo sslloginhandler.lo \
+	msnnotifysocket.lo msnswitchboardsocket.lo \
+	msnfiletransfersocket.lo msninvitation.lo msnp2p.lo sha1.lo
+#>- libkopete_msn_shared_la_OBJECTS = $(am_libkopete_msn_shared_la_OBJECTS)
+#>+ 5
+libkopete_msn_shared_la_OBJECTS = msnprotocol.lo msnaccount.lo \
+	msnaddcontactpage.lo msncontact.lo msnsocket.lo \
+	msnmessagemanager.lo msndebugrawcmddlg.lo sslloginhandler.lo \
+	msnnotifysocket.lo msnswitchboardsocket.lo \
+	msnfiletransfersocket.lo msninvitation.lo msnp2p.lo sha1.lo
+
+DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
+depcomp = $(SHELL) $(top_srcdir)/admin/depcomp
+am__depfiles_maybe = depfiles
+#>- @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/dummy.Plo ./$(DEPDIR)/msnaccount.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnaddcontactpage.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msncontact.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msndebugrawcmddlg.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnfiletransfersocket.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msninvitation.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnmessagemanager.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnnotifysocket.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnp2p.Plo ./$(DEPDIR)/msnprotocol.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnsocket.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/msnswitchboardsocket.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/sha1.Plo \
+#>- @AMDEP_TRUE@	./$(DEPDIR)/sslloginhandler.Plo
+#>+ 13
+@AMDEP_TRUE@DEP_FILES =  ./$(DEPDIR)/dummy.Plo ./$(DEPDIR)/msnaccount.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnaddcontactpage.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msncontact.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msndebugrawcmddlg.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnfiletransfersocket.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msninvitation.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnmessagemanager.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnnotifysocket.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnp2p.Plo ./$(DEPDIR)/msnprotocol.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnsocket.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/msnswitchboardsocket.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/sha1.Plo \
+@AMDEP_TRUE@	@AMDEP_TRUE@	./$(DEPDIR)/sslloginhandler.Plo
+#>- CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
+#>- 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
+#>+ 2
+CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
+	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
+#>- LTCXXCOMPILE = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) \
+#>- 	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+#>- 	$(AM_CXXFLAGS) $(CXXFLAGS)
+#>+ 3
+LTCXXCOMPILE = $(LIBTOOL) --mode=compile --tag=CXX $(CXX) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+	$(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
+CXXLD = $(CXX)
+#>- CXXLINK = $(LIBTOOL) --mode=link $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) \
+#>- 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+#>+ 2
+CXXLINK = $(LIBTOOL) --mode=link --tag=CXX $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS) \
+	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+DIST_SOURCES = $(kopete_msn_la_SOURCES) \
+	$(libkopete_msn_shared_la_SOURCES)
+DATA = $(mydata_DATA) $(service_DATA)
+
+
+#>- RECURSIVE_TARGETS = info-recursive dvi-recursive pdf-recursive \
+#>- 	ps-recursive install-info-recursive uninstall-info-recursive \
+#>- 	all-recursive install-data-recursive install-exec-recursive \
+#>- 	installdirs-recursive install-recursive uninstall-recursive \
+#>- 	check-recursive installcheck-recursive
+#>+ 5
+RECURSIVE_TARGETS = info-recursive dvi-recursive pdf-recursive \
+	ps-recursive install-info-recursive uninstall-info-recursive \
+	all-recursive install-data-recursive install-exec-recursive \
+	installdirs-recursive install-recursive uninstall-recursive \
+	check-recursive installcheck-recursive nmcheck-recursive bcheck-recursive
+DIST_COMMON = $(srcdir)/Makefile.in Makefile.am TODO
+DIST_SUBDIRS = $(SUBDIRS)
+SOURCES = $(kopete_msn_la_SOURCES) $(libkopete_msn_shared_la_SOURCES)
+
 #>- all: all-recursive
 #>+ 1
 all: docs-am  all-recursive
 
 .SUFFIXES:
 .SUFFIXES: .cpp .lo .o .obj
-$(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
-#>- 	@for dep in $?; do \
-#>- 	  case '$(am__configure_deps)' in \
-#>- 	    *$$dep*) \
-#>- 	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
-#>- 		&& exit 0; \
-#>- 	      exit 1;; \
-#>- 	  esac; \
-#>- 	done; \
-#>- 	echo ' cd $(top_srcdir) && $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile'; \
+$(srcdir)/Makefile.in:  Makefile.am  $(top_srcdir)/configure.in $(ACLOCAL_M4)
 #>- 	cd $(top_srcdir) && \
-#>- 	  $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile
-#>+ 12
-	@for dep in $?; do \
-	  case '$(am__configure_deps)' in \
-	    *$$dep*) \
-	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
-		&& exit 0; \
-	      exit 1;; \
-	  esac; \
-	done; \
-	echo ' cd $(top_srcdir) && $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile'; \
+#>- 	  $(AUTOMAKE) --gnu  kopete/protocols/msn/Makefile
+#>+ 3
 	cd $(top_srcdir) && \
-	  $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile
+	  $(AUTOMAKE) --gnu  kopete/protocols/msn/Makefile
 	cd $(top_srcdir) && perl admin/am_edit kopete/protocols/msn/Makefile.in
-.PRECIOUS: Makefile
-Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
-	@case '$?' in \
-	  *config.status*) \
-	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
-	  *) \
-	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
-	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
-	esac;
-
-$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
-	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-
-$(top_srcdir)/configure:  $(am__configure_deps)
-	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
-$(ACLOCAL_M4):  $(am__aclocal_m4_deps)
-	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+Makefile:  $(srcdir)/Makefile.in  $(top_builddir)/config.status
+	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)
+kde_moduleLTLIBRARIES_INSTALL = $(INSTALL)
 install-kde_moduleLTLIBRARIES: $(kde_module_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(kde_moduledir)" || $(mkdir_p) "$(DESTDIR)$(kde_moduledir)"
+	$(mkinstalldirs) $(DESTDIR)$(kde_moduledir)
 	@list='$(kde_module_LTLIBRARIES)'; for p in $$list; do \
 	  if test -f $$p; then \
-	    f=$(am__strip_dir) \
-	    echo " $(LIBTOOL) --mode=install $(kde_moduleLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) '$$p' '$(DESTDIR)$(kde_moduledir)/$$f'"; \
-	    $(LIBTOOL) --mode=install $(kde_moduleLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) "$$p" "$(DESTDIR)$(kde_moduledir)/$$f"; \
+	    f="`echo $$p | sed -e 's|^.*/||'`"; \
+	    echo " $(LIBTOOL) --mode=install $(kde_moduleLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(kde_moduledir)/$$f"; \
+	    $(LIBTOOL) --mode=install $(kde_moduleLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(kde_moduledir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-kde_moduleLTLIBRARIES:
 	@$(NORMAL_UNINSTALL)
-	@set -x; list='$(kde_module_LTLIBRARIES)'; for p in $$list; do \
-	  p=$(am__strip_dir) \
-	  echo " $(LIBTOOL) --mode=uninstall rm -f '$(DESTDIR)$(kde_moduledir)/$$p'"; \
-	  $(LIBTOOL) --mode=uninstall rm -f "$(DESTDIR)$(kde_moduledir)/$$p"; \
+	@list='$(kde_module_LTLIBRARIES)'; for p in $$list; do \
+	    p="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(kde_moduledir)/$$p"; \
+	  $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(kde_moduledir)/$$p; \
 	done
 
 clean-kde_moduleLTLIBRARIES:
 	-test -z "$(kde_module_LTLIBRARIES)" || rm -f $(kde_module_LTLIBRARIES)
 	@list='$(kde_module_LTLIBRARIES)'; for p in $$list; do \
 	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
+	  test "$$dir" = "$$p" && dir=.; \
 	  echo "rm -f \"$${dir}/so_locations\""; \
 	  rm -f "$${dir}/so_locations"; \
 	done
+libLTLIBRARIES_INSTALL = $(INSTALL)
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(mkdir_p) "$(DESTDIR)$(libdir)"
+	$(mkinstalldirs) $(DESTDIR)$(libdir)
 	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
 	  if test -f $$p; then \
-	    f=$(am__strip_dir) \
-	    echo " $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) '$$p' '$(DESTDIR)$(libdir)/$$f'"; \
-	    $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) "$$p" "$(DESTDIR)$(libdir)/$$f"; \
+	    f="`echo $$p | sed -e 's|^.*/||'`"; \
+	    echo " $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(libdir)/$$f"; \
+	    $(LIBTOOL) --mode=install $(libLTLIBRARIES_INSTALL) $(INSTALL_STRIP_FLAG) $$p $(DESTDIR)$(libdir)/$$f; \
 	  else :; fi; \
 	done
 
 uninstall-libLTLIBRARIES:
 	@$(NORMAL_UNINSTALL)
-	@set -x; list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  p=$(am__strip_dir) \
-	  echo " $(LIBTOOL) --mode=uninstall rm -f '$(DESTDIR)$(libdir)/$$p'"; \
-	  $(LIBTOOL) --mode=uninstall rm -f "$(DESTDIR)$(libdir)/$$p"; \
+	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
+	    p="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(libdir)/$$p"; \
+	  $(LIBTOOL) --mode=uninstall rm -f $(DESTDIR)$(libdir)/$$p; \
 	done
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
 	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
 	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
+	  test "$$dir" = "$$p" && dir=.; \
 	  echo "rm -f \"$${dir}/so_locations\""; \
 	  rm -f "$${dir}/so_locations"; \
 	done
@@ -569,7 +546,7 @@
 	$(CXXLINK) -rpath $(libdir) $(libkopete_msn_shared_la_LDFLAGS) $(libkopete_msn_shared_la_OBJECTS) $(libkopete_msn_shared_la_LIBADD) $(LIBS)
 
 mostlyclean-compile:
-	-rm -f *.$(OBJEXT)
+	-rm -f *.$(OBJEXT) core *.core
 
 distclean-compile:
 	-rm -f *.tab.c
@@ -588,27 +565,40 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/msnsocket.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/msnswitchboardsocket.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sha1.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sslloginhandler.Plo@am__quote@
 
 .cpp.o:
-@am__fastdepCXX_TRUE@	if $(CXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
-@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCXX_TRUE@	if $(CXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" \
+@am__fastdepCXX_TRUE@	  -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<; \
+@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; \
+@am__fastdepCXX_TRUE@	else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; \
+@am__fastdepCXX_TRUE@	fi
 @AMDEP_TRUE@@am__fastdepCXX_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCXX_FALSE@	$(CXXCOMPILE) -c -o $@ $<
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(CXXCOMPILE) -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<
 
 .cpp.obj:
-@am__fastdepCXX_TRUE@	if $(CXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
-@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCXX_TRUE@	if $(CXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" \
+@am__fastdepCXX_TRUE@	  -c -o $@ `if test -f '$<'; then $(CYGPATH_W) '$<'; else $(CYGPATH_W) '$(srcdir)/$<'; fi`; \
+@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; \
+@am__fastdepCXX_TRUE@	else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; \
+@am__fastdepCXX_TRUE@	fi
 @AMDEP_TRUE@@am__fastdepCXX_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCXX_FALSE@	$(CXXCOMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(CXXCOMPILE) -c -o $@ `if test -f '$<'; then $(CYGPATH_W) '$<'; else $(CYGPATH_W) '$(srcdir)/$<'; fi`
 
 .cpp.lo:
-@am__fastdepCXX_TRUE@	if $(LTCXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
-@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Plo"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCXX_TRUE@	if $(LTCXXCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" \
+@am__fastdepCXX_TRUE@	  -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<; \
+@am__fastdepCXX_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Plo"; \
+@am__fastdepCXX_TRUE@	else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; \
+@am__fastdepCXX_TRUE@	fi
 @AMDEP_TRUE@@am__fastdepCXX_FALSE@	source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCXX_FALSE@	$(LTCXXCOMPILE) -c -o $@ $<
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	depfile='$(DEPDIR)/$*.Plo' tmpdepfile='$(DEPDIR)/$*.TPlo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(LTCXXCOMPILE) -c -o $@ `test -f '$<' || echo '$(srcdir)/'`$<
 
 mostlyclean-libtool:
 	-rm -f *.lo
@@ -619,39 +609,41 @@
 distclean-libtool:
 	-rm -f libtool
 uninstall-info-am:
+mydataDATA_INSTALL = $(INSTALL_DATA)
 install-mydataDATA: $(mydata_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(mydatadir)" || $(mkdir_p) "$(DESTDIR)$(mydatadir)"
+	$(mkinstalldirs) $(DESTDIR)$(mydatadir)
 	@list='$(mydata_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
-	  f=$(am__strip_dir) \
-	  echo " $(mydataDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(mydatadir)/$$f'"; \
-	  $(mydataDATA_INSTALL) "$$d$$p" "$(DESTDIR)$(mydatadir)/$$f"; \
+	  f="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " $(mydataDATA_INSTALL) $$d$$p $(DESTDIR)$(mydatadir)/$$f"; \
+	  $(mydataDATA_INSTALL) $$d$$p $(DESTDIR)$(mydatadir)/$$f; \
 	done
 
 uninstall-mydataDATA:
 	@$(NORMAL_UNINSTALL)
 	@list='$(mydata_DATA)'; for p in $$list; do \
-	  f=$(am__strip_dir) \
-	  echo " rm -f '$(DESTDIR)$(mydatadir)/$$f'"; \
-	  rm -f "$(DESTDIR)$(mydatadir)/$$f"; \
+	  f="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " rm -f $(DESTDIR)$(mydatadir)/$$f"; \
+	  rm -f $(DESTDIR)$(mydatadir)/$$f; \
 	done
+serviceDATA_INSTALL = $(INSTALL_DATA)
 install-serviceDATA: $(service_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(servicedir)" || $(mkdir_p) "$(DESTDIR)$(servicedir)"
+	$(mkinstalldirs) $(DESTDIR)$(servicedir)
 	@list='$(service_DATA)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
-	  f=$(am__strip_dir) \
-	  echo " $(serviceDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(servicedir)/$$f'"; \
-	  $(serviceDATA_INSTALL) "$$d$$p" "$(DESTDIR)$(servicedir)/$$f"; \
+	  f="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " $(serviceDATA_INSTALL) $$d$$p $(DESTDIR)$(servicedir)/$$f"; \
+	  $(serviceDATA_INSTALL) $$d$$p $(DESTDIR)$(servicedir)/$$f; \
 	done
 
 uninstall-serviceDATA:
 	@$(NORMAL_UNINSTALL)
 	@list='$(service_DATA)'; for p in $$list; do \
-	  f=$(am__strip_dir) \
-	  echo " rm -f '$(DESTDIR)$(servicedir)/$$f'"; \
-	  rm -f "$(DESTDIR)$(servicedir)/$$f"; \
+	  f="`echo $$p | sed -e 's|^.*/||'`"; \
+	  echo " rm -f $(DESTDIR)$(servicedir)/$$f"; \
+	  rm -f $(DESTDIR)$(servicedir)/$$f; \
 	done
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -713,6 +705,14 @@
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
 
+ETAGS = etags
+ETAGSFLAGS =
+
+CTAGS = ctags
+CTAGSFLAGS =
+
+tags: TAGS
+
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
@@ -721,22 +721,19 @@
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
 	mkid -fID $$unique
-tags: TAGS
 
 TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	if ($(ETAGS) --etags-include --version) >/dev/null 2>&1; then \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
 	  include_option=--etags-include; \
-	  empty_fix=.; \
 	else \
 	  include_option=--include; \
-	  empty_fix=; \
 	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test ! -f $$subdir/TAGS || \
+	    test -f $$subdir/TAGS && \
 	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
 	  fi; \
 	done; \
@@ -746,11 +743,10 @@
 	  done | \
 	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	if test -z "$(ETAGS_ARGS)$$tags$$unique"; then :; else \
-	  test -n "$$unique" || unique=$$empty_fix; \
-	  $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
-	    $$tags $$unique; \
-	fi
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+
 ctags: CTAGS
 CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
@@ -773,6 +769,12 @@
 
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+#>- DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+#>+ 1
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST) $(KDE_DIST)
+
+top_distdir = ../../..
+distdir = $(top_distdir)/$(PACKAGE)-$(VERSION)
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
@@ -786,7 +788,7 @@
 	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
 	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
 	    dir="/$$dir"; \
-	    $(mkdir_p) "$(distdir)$$dir"; \
+	    $(mkinstalldirs) "$(distdir)$$dir"; \
 	  else \
 	    dir=''; \
 	  fi; \
@@ -801,17 +803,15 @@
 	    || exit 1; \
 	  fi; \
 	done
-	list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(mkdir_p) "$(distdir)/$$subdir" \
+	    test -d $(distdir)/$$subdir \
+	    || mkdir $(distdir)/$$subdir \
 	    || exit 1; \
-	    distdir=`$(am__cd) $(distdir) && pwd`; \
-	    top_distdir=`$(am__cd) $(top_distdir) && pwd`; \
 	    (cd $$subdir && \
 	      $(MAKE) $(AM_MAKEFLAGS) \
-	        top_distdir="$$top_distdir" \
-	        distdir="$$distdir/$$subdir" \
+	        top_distdir="$(top_distdir)" \
+	        distdir=../$(distdir)/$$subdir \
 	        distdir) \
 	      || exit 1; \
 	  fi; \
@@ -821,9 +821,8 @@
 all-am: Makefile $(LTLIBRARIES) $(DATA)
 installdirs: installdirs-recursive
 installdirs-am:
-	for dir in "$(DESTDIR)$(kde_moduledir)" "$(DESTDIR)$(libdir)" "$(DESTDIR)$(mydatadir)" "$(DESTDIR)$(servicedir)"; do \
-	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
-	done
+	$(mkinstalldirs) $(DESTDIR)$(kde_moduledir) $(DESTDIR)$(libdir) $(DESTDIR)$(mydatadir) $(DESTDIR)$(servicedir)
+
 install: install-recursive
 install-exec: install-exec-recursive
 install-data: install-data-recursive
@@ -844,7 +843,7 @@
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
@@ -853,11 +852,11 @@
 #>+ 1
 clean: kde-rpo-clean  clean-recursive
 
-#>- clean-am: clean-generic clean-kde_moduleLTLIBRARIES \
-#>- 	clean-libLTLIBRARIES clean-libtool mostlyclean-am
+#>- clean-am: clean-generic clean-kde_moduleLTLIBRARIES clean-libLTLIBRARIES \
+#>- 	clean-libtool mostlyclean-am
 #>+ 2
-clean-am: clean-metasources clean-closures clean-bcheck clean-final  clean-generic clean-kde_moduleLTLIBRARIES \
-	clean-libLTLIBRARIES clean-libtool mostlyclean-am
+clean-am: clean-metasources clean-closures clean-bcheck  clean-generic clean-kde_moduleLTLIBRARIES clean-libLTLIBRARIES \
+	clean-libtool mostlyclean-am
 
 distclean: distclean-recursive
 	-rm -rf ./$(DEPDIR)
@@ -869,8 +868,6 @@
 
 dvi-am:
 
-html: html-recursive
-
 info: info-recursive
 
 info-am:
@@ -915,23 +912,27 @@
 
 uninstall-info: uninstall-info-recursive
 
-.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
-	clean clean-generic clean-kde_moduleLTLIBRARIES \
-	clean-libLTLIBRARIES clean-libtool clean-recursive ctags \
-	ctags-recursive distclean distclean-compile distclean-generic \
-	distclean-libtool distclean-recursive distclean-tags distdir \
-	dvi dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-exec install-exec-am \
-	install-info install-info-am install-kde_moduleLTLIBRARIES \
-	install-libLTLIBRARIES install-man install-mydataDATA \
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am clean \
+	clean-generic clean-kde_moduleLTLIBRARIES clean-libLTLIBRARIES \
+	clean-libtool clean-recursive ctags ctags-recursive distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-recursive distclean-tags distdir dvi dvi-am \
+	dvi-recursive info info-am info-recursive install install-am \
+	install-data install-data-am install-data-recursive \
+	install-exec install-exec-am install-exec-recursive \
+	install-info install-info-am install-info-recursive \
+	install-kde_moduleLTLIBRARIES install-libLTLIBRARIES \
+	install-man install-mydataDATA install-recursive \
 	install-serviceDATA install-strip installcheck installcheck-am \
-	installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic maintainer-clean-recursive \
-	mostlyclean mostlyclean-compile mostlyclean-generic \
-	mostlyclean-libtool mostlyclean-recursive pdf pdf-am ps ps-am \
-	tags tags-recursive uninstall uninstall-am uninstall-info-am \
-	uninstall-kde_moduleLTLIBRARIES uninstall-libLTLIBRARIES \
-	uninstall-mydataDATA uninstall-serviceDATA
+	installdirs installdirs-am installdirs-recursive \
+	maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-compile \
+	mostlyclean-generic mostlyclean-libtool mostlyclean-recursive \
+	pdf pdf-am pdf-recursive ps ps-am ps-recursive tags \
+	tags-recursive uninstall uninstall-am uninstall-info-am \
+	uninstall-info-recursive uninstall-kde_moduleLTLIBRARIES \
+	uninstall-libLTLIBRARIES uninstall-mydataDATA \
+	uninstall-recursive uninstall-serviceDATA
 
 
 dummy.cpp: $(srcdir)/Makefile.am
@@ -965,18 +966,18 @@
 mocs: msnmessagemanager.moc
 
 #>+ 3
-msnfiletransfersocket.moc: $(srcdir)/msnfiletransfersocket.h
-	$(MOC) $(srcdir)/msnfiletransfersocket.h -o msnfiletransfersocket.moc
+msncontact.moc: $(srcdir)/msncontact.h
+	$(MOC) $(srcdir)/msncontact.h -o msncontact.moc
 
 #>+ 2
-mocs: msnfiletransfersocket.moc
+mocs: msncontact.moc
 
 #>+ 3
-msncontact.moc: $(srcdir)/msncontact.h
-	$(MOC) $(srcdir)/msncontact.h -o msncontact.moc
+msnfiletransfersocket.moc: $(srcdir)/msnfiletransfersocket.h
+	$(MOC) $(srcdir)/msnfiletransfersocket.h -o msnfiletransfersocket.moc
 
 #>+ 2
-mocs: msncontact.moc
+mocs: msnfiletransfersocket.moc
 
 #>+ 3
 msnprotocol.moc: $(srcdir)/msnprotocol.h
@@ -986,6 +987,13 @@
 mocs: msnprotocol.moc
 
 #>+ 3
+sslloginhandler.moc: $(srcdir)/sslloginhandler.h
+	$(MOC) $(srcdir)/sslloginhandler.h -o sslloginhandler.moc
+
+#>+ 2
+mocs: sslloginhandler.moc
+
+#>+ 3
 msnaccount.moc: $(srcdir)/msnaccount.h
 	$(MOC) $(srcdir)/msnaccount.h -o msnaccount.moc
 
@@ -1000,18 +1008,18 @@
 mocs: msnsocket.moc
 
 #>+ 3
-msnnotifysocket.moc: $(srcdir)/msnnotifysocket.h
-	$(MOC) $(srcdir)/msnnotifysocket.h -o msnnotifysocket.moc
+msnswitchboardsocket.moc: $(srcdir)/msnswitchboardsocket.h
+	$(MOC) $(srcdir)/msnswitchboardsocket.h -o msnswitchboardsocket.moc
 
 #>+ 2
-mocs: msnnotifysocket.moc
+mocs: msnswitchboardsocket.moc
 
 #>+ 3
-msnswitchboardsocket.moc: $(srcdir)/msnswitchboardsocket.h
-	$(MOC) $(srcdir)/msnswitchboardsocket.h -o msnswitchboardsocket.moc
+msnnotifysocket.moc: $(srcdir)/msnnotifysocket.h
+	$(MOC) $(srcdir)/msnnotifysocket.h -o msnnotifysocket.moc
 
 #>+ 2
-mocs: msnswitchboardsocket.moc
+mocs: msnnotifysocket.moc
 
 #>+ 3
 msnp2p.moc: $(srcdir)/msnp2p.h
@@ -1038,10 +1046,10 @@
 
 #>+ 3
 clean-metasources:
-	-rm -f  msndebugrawcmddlg.moc msnmessagemanager.moc msnfiletransfersocket.moc msncontact.moc msnprotocol.moc msnaccount.moc msnsocket.moc msnnotifysocket.moc msnswitchboardsocket.moc msnp2p.moc msnaddcontactpage.moc
+	-rm -f  msndebugrawcmddlg.moc msnmessagemanager.moc msncontact.moc msnfiletransfersocket.moc msnprotocol.moc sslloginhandler.moc msnaccount.moc msnsocket.moc msnswitchboardsocket.moc msnnotifysocket.moc msnp2p.moc msnaddcontactpage.moc
 
 #>+ 2
-KDE_DIST=kopete_msn.desktop msncontact.h msnp2p.h msnmessagemanager.h msnchatui.rc Changelog msnsocket.h ReleaseNotes msndebugrawcmddlg.h msnaccount.h msnfiletransfersocket.h sha1.h msninvitation.h Makefile.in msnswitchboardsocket.h msnprotocol.h msnnotifysocket.h msnaddcontactpage.h Makefile.am 
+KDE_DIST=kopete_msn.desktop msncontact.h msnp2p.h msnmessagemanager.h msnchatui.rc Changelog msnsocket.h ReleaseNotes msndebugrawcmddlg.h msnaccount.h msnfiletransfersocket.h sha1.h sslloginhandler.h msninvitation.h Makefile.in msnswitchboardsocket.h msnprotocol.h msnnotifysocket.h msnaddcontactpage.h 
 
 #>+ 3
 clean-closures:
@@ -1050,19 +1058,10 @@
 #>+ 2
 docs-am:
 
-#>+ 15
+#>+ 6
 force-reedit:
-		@for dep in $?; do \
-	  case '$(am__configure_deps)' in \
-	    *$$dep*) \
-	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
-		&& exit 0; \
-	      exit 1;; \
-	  esac; \
-	done; \
-	echo ' cd $(top_srcdir) && $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile'; \
-	cd $(top_srcdir) && \
-	  $(AUTOMAKE) --foreign  kopete/protocols/msn/Makefile
+		cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  kopete/protocols/msn/Makefile
 	cd $(top_srcdir) && perl admin/am_edit kopete/protocols/msn/Makefile.in
 
 
@@ -1088,37 +1087,21 @@
 	done
 
 
-#>+ 11
-libkopete_msn_shared_la.all_cpp.cpp: $(srcdir)/Makefile.in $(srcdir)/msnprotocol.cpp $(srcdir)/msnaccount.cpp $(srcdir)/msnaddcontactpage.cpp $(srcdir)/msncontact.cpp $(srcdir)/msnsocket.cpp $(srcdir)/msnmessagemanager.cpp $(srcdir)/msndebugrawcmddlg.cpp $(srcdir)/msnnotifysocket.cpp $(srcdir)/msnswitchboardsocket.cpp $(srcdir)/msnfiletransfersocket.cpp $(srcdir)/msninvitation.cpp $(srcdir)/msnp2p.cpp $(srcdir)/sha1.cpp  msndebugrawcmddlg.moc msncontact.moc msnfiletransfersocket.moc msnmessagemanager.moc msnprotocol.moc msnaccount.moc msnsocket.moc msnnotifysocket.moc msnswitchboardsocket.moc msnp2p.moc msnaddcontactpage.moc
-	@echo 'creating libkopete_msn_shared_la.all_cpp.cpp ...'; \
-	rm -f libkopete_msn_shared_la.all_cpp.files libkopete_msn_shared_la.all_cpp.final; \
-	echo "#define KDE_USE_FINAL 1" >> libkopete_msn_shared_la.all_cpp.final; \
-	for file in msnprotocol.cpp msnaccount.cpp msnaddcontactpage.cpp msncontact.cpp msnsocket.cpp msnmessagemanager.cpp msndebugrawcmddlg.cpp msnnotifysocket.cpp msnswitchboardsocket.cpp msnfiletransfersocket.cpp msninvitation.cpp msnp2p.cpp sha1.cpp ; do \
-	  echo "#include \"$$file\"" >> libkopete_msn_shared_la.all_cpp.files; \
-	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> libkopete_msn_shared_la.all_cpp.final; \
-	done; \
-	cat libkopete_msn_shared_la.all_cpp.final libkopete_msn_shared_la.all_cpp.files > libkopete_msn_shared_la.all_cpp.cpp; \
-	rm -f libkopete_msn_shared_la.all_cpp.final libkopete_msn_shared_la.all_cpp.files
-
-#>+ 3
-clean-final:
-	-rm -f libkopete_msn_shared_la.all_cpp.cpp
-
 #>+ 3
 final:
-	$(MAKE) libkopete_msn_shared_la_OBJECTS="$(libkopete_msn_shared_la_final_OBJECTS)" all-am
+	$(MAKE) all-am
 
 #>+ 3
 final-install:
-	$(MAKE) libkopete_msn_shared_la_OBJECTS="$(libkopete_msn_shared_la_final_OBJECTS)" install-am
+	$(MAKE) install-am
 
 #>+ 3
 no-final:
-	$(MAKE) libkopete_msn_shared_la_OBJECTS="$(libkopete_msn_shared_la_nofinal_OBJECTS)" all-am
+	$(MAKE) all-am
 
 #>+ 3
 no-final-install:
-	$(MAKE) libkopete_msn_shared_la_OBJECTS="$(libkopete_msn_shared_la_nofinal_OBJECTS)" install-am
+	$(MAKE) install-am
 
 #>+ 3
 cvs-clean:
@@ -1128,7 +1111,7 @@
 kde-rpo-clean:
 	-rm -f *.rpo
 
-#>+ 25
+#>+ 27
 msnnotifysocket.lo: msnnotifysocket.moc 
 msnprotocol.lo: msnprotocol.moc 
 msncontact.o: msncontact.moc 
@@ -1139,17 +1122,19 @@
 msnmessagemanager.lo: msnmessagemanager.moc 
 msndebugrawcmddlg.o: msndebugrawcmddlg.moc 
 msnsocket.lo: msnsocket.moc 
+sslloginhandler.lo: sslloginhandler.moc 
 msndebugrawcmddlg.lo: msndebugrawcmddlg.moc 
 msncontact.lo: msncontact.moc 
 nmcheck: 
 msnaddcontactpage.o: msnaddcontactpage.moc 
-msnsocket.o: msnsocket.moc 
 msnnotifysocket.o: msnnotifysocket.moc 
+msnsocket.o: msnsocket.moc 
 nmcheck-am: nmcheck
 msnswitchboardsocket.lo: msnswitchboardsocket.moc 
+sslloginhandler.o: sslloginhandler.moc 
 msnprotocol.o: msnprotocol.moc 
-msnmessagemanager.o: msnmessagemanager.moc 
 msnswitchboardsocket.o: msnswitchboardsocket.moc 
+msnmessagemanager.o: msnmessagemanager.moc 
 msnaddcontactpage.lo: msnaddcontactpage.moc 
 msnp2p.o: msnp2p.moc 
 msnfiletransfersocket.lo: msnfiletransfersocket.moc 
diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/msnnotifysocket.cpp kdenetwork-3.3.2/kopete/protocols/msn/msnnotifysocket.cpp
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/msnnotifysocket.cpp	2004-08-05 21:26:24.000000000 +0200
+++ kdenetwork-3.3.2/kopete/protocols/msn/msnnotifysocket.cpp	2005-05-22 19:35:27.000000000 +0200
@@ -23,6 +23,7 @@
 #include "msnnotifysocket.h"
 #include "msncontact.h"
 #include "msnaccount.h"
+#include "sslloginhandler.h"
 
 #include <qregexp.h>
 
@@ -47,6 +48,7 @@
 : MSNSocket( account )
 {
 	m_newstatus = MSNProtocol::protocol()->NLN;
+	m_sslLoginHandler=0l;
 	
 	m_isHotmailAccount=false;
 	m_ping=false;
@@ -67,6 +69,7 @@
 MSNNotifySocket::~MSNNotifySocket()
 {
 	delete m_tmpMailFile;
+	delete m_sslLoginHandler;
 	kdDebug(14140) << k_funcinfo << endl;
 }
 
@@ -246,7 +249,7 @@
 	
 	if ( cmd == "VER" )
 	{
-		sendCommand( "CVR", "0x0409 winnt 5.1 i386 MSNMSGR 6.0.0602 MSMSGS " + m_account->accountId() );
+		sendCommand( "CVR", "0x0409 winnt 5.1 i386 MSNMSGR 6.2.0205 MSMSGS " + m_account->accountId() );
 /*
 		struct utsname utsBuf;
 		uname ( &utsBuf );
@@ -264,27 +267,16 @@
 	{
 		if( data.section( ' ', 1, 1 ) == "S" )
 		{
-			m_authData=data.section( ' ' , 2 , 2 );
-			m_kv=QString::null;
+			m_sslLoginHandler = new SslLoginHandler();
+			QObject::connect( m_sslLoginHandler, SIGNAL(       loginFailed()        ),
+					 this,            SLOT  (    sslLoginFailed()        ) );
+			QObject::connect( m_sslLoginHandler, SIGNAL(    loginIncorrect()        ),
+					 this,            SLOT  ( sslLoginIncorrect()        ) );
+			QObject::connect( m_sslLoginHandler, SIGNAL(    loginSucceeded(QString) ),
+					 this,            SLOT  ( sslLoginSucceeded(QString) ) );
 
-			if( m_account->accountId().contains("@hotmail.com") )
-				m_sid="loginnet.passport.com";
-			else if( m_account->accountId().contains("@msn.com") ||  m_account->accountId().contains("@compaq.net") ||  m_account->accountId().contains("@webtv.net") )
-				m_sid="msnialogin.passport.com";
-			else
-				m_sid="login.passport.com";
-
-			QString authURL="https://"+m_sid+"/login.srf?" + m_authData;
-			authURL.replace("," , "&" ) ;
-
-			kdDebug(14140) << k_funcinfo << "downlaod URL: " << authURL << endl;
-
-			KIO::Job *job = KIO::get( KURL( authURL ), true, false );
-			job->addMetaData("cookies", "manual");
-			// This should force kio to download the page even is we are in the konqueror offline mode.  [see bug #68483]
-			job->addMetaData("cache", "reload");
-			QObject::connect( job, SIGNAL(result( KIO::Job *)), this, SLOT(slotAuthJobDone( KIO::Job *)) );
-		}
+			m_sslLoginHandler->login( data.section( ' ' , 2 , 2 ), m_account->accountId() , m_password );
+  		}
 		else
 		{
 			// Successful auth
@@ -569,77 +561,22 @@
 	}
 }
 
-
-void MSNNotifySocket::slotAuthJobDataReceived ( KIO::Job */*job*/,const  QByteArray &data)
+void MSNNotifySocket::sslLoginFailed()
 {
-	m_authData += QCString( data, data.size()+1 );
-//	kdDebug(14140) << "MSNNotifySocket::slotAuthJobDataReceived: " << data << endl;
+	disconnect();
 }
 
-void MSNNotifySocket::slotAuthJobDone ( KIO::Job *job)
+void MSNNotifySocket::sslLoginIncorrect()
 {
-//	kdDebug(14140) << "MSNNotifySocket::slotAuthJobDone: "<< m_authData << endl;
-
-	if(job->error())
-	{
-		//FIXME: Shouldn't we say that we are the MSN plugin?
-		job->showErrorDialog();
-		disconnect();
-		return;
-	}
-
-	if(m_kv.isNull())
-	{
-		QStringList cookielist=QStringList::split("\n", job->queryMetaData("setcookies") );
-		QString cookies="Cookie: ";
-		for ( QStringList::Iterator it = cookielist.begin(); it != cookielist.end(); ++it )
-		{
-			QRegExp rx("Set-Cookie: ([^;]*)");
-			rx.search(*it);
-			cookies+=rx.cap(1)+";";
-		}
-
-		//QRegExp rx("lc=([1-9]*),id=([1-9]*),tw=([1-9]*),fs=[1-9]*,ru=[1-9a-zA-Z%]*,ct=[1-9]*,kpp=[1-9]*,kv=([1-9]*),");
-		QRegExp rx("lc=([0-9]*),id=([0-9]*),tw=([0-9]*),.*kv=([0-9]*),");
-		rx.search(m_authData);
-
-		QString authURL = "https://" + m_sid + "/ppsecure/post.srf?lc=" + rx.cap( 1 ) + "&id=" +
-			rx.cap( 2 ) + "&tw=" + rx.cap( 3 ) + "&cbid=" + rx.cap( 2 ) + "&da=passport.com&login=" +
-			KURL::encode_string( m_account->accountId()) + "&domain=passport.com&passwd=";
-
-		kdDebug( 14140 ) << k_funcinfo << "Download URL: " << authURL << "(*******)" << endl;
-
-		m_authData = QString::null;
-		m_kv=rx.cap(4);
-		if(m_kv.isNull()) m_kv="";
-
-		authURL += KURL::encode_string( m_password ) ;
-		job = KIO::get( KURL( authURL ), false, false );
-		job->addMetaData("cookies", "manual");
-		job->addMetaData("setcookies", cookies);
-		job->addMetaData("cache", "reload");
-
-		QObject::connect( job, SIGNAL(data( KIO::Job *,const QByteArray&)), this, SLOT(slotAuthJobDataReceived( KIO::Job *,const QByteArray&)) );
-		QObject::connect( job, SIGNAL(result( KIO::Job *)), this, SLOT(slotAuthJobDone( KIO::Job *)) );
-	}
-	else
-	{
-		if(m_authData.contains("CookiesDisabled"))
-		{
-			// FIXME: is this still possible now we add our meta data? - Martijn
-			disconnect();
-			KMessageBox::queuedMessageBox( Kopete::UI::Global::mainWidget(), KMessageBox::Error,
-				i18n( "Unable to connect to the MSN Network.\nYour Web browser options are currently set to disable cookies.\n"
-				"To use .NET Passport, you must enable cookies at least for the passport.com domain" ), i18n( "MSN Plugin" ) );
-			return;
-		}
-
-		QRegExp rx(/*URL=http://memberservices.passport.net/memberservice.srf*/"\\?did=[0-9]*&(t=[0-9A-Za-z!$*]*&p=[0-9A-Za-z!$*]*)\"");
-		rx.search(m_authData);
+	m_badPassword = true;
+	disconnect();
+}
 
-		m_badPassword=true;  //if this disconnect, that mean the password was bad
-		sendCommand("USR" , "TWN S " + rx.cap(1));
-	}
+void MSNNotifySocket::sslLoginSucceeded(QString a)
+{
+	sendCommand("USR" , "TWN S " + a);
+	m_sslLoginHandler->deleteLater();
+	m_sslLoginHandler=0;
 }
 
 
diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/msnnotifysocket.h kdenetwork-3.3.2/kopete/protocols/msn/msnnotifysocket.h
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/msnnotifysocket.h	2004-06-25 11:10:14.000000000 +0200
+++ kdenetwork-3.3.2/kopete/protocols/msn/msnnotifysocket.h	2005-05-22 19:35:27.000000000 +0200
@@ -29,6 +29,7 @@
 class MSNDispatchSocket;
 class MSNAccount;
 class KTempFile;
+class SslLoginHandler;
 
 #include <kio/job.h>
 
@@ -137,9 +138,9 @@
 	void slotResetKeepAlive();
 
 
-
-	void slotAuthJobDataReceived ( KIO::Job *, const QByteArray &data);
-	void slotAuthJobDone ( KIO::Job *);
+	void sslLoginFailed();
+	void sslLoginIncorrect();
+	void sslLoginSucceeded(QString);
 
 
 private:
@@ -171,7 +172,7 @@
 	QString m_kv;
 	QString m_sid;
 	QString m_loginTime;
-	QString m_authData;
+	SslLoginHandler *m_sslLoginHandler;
 
 	QTimer *m_keepaliveTimer;
 
diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/sslloginhandler.cpp kdenetwork-3.3.2/kopete/protocols/msn/sslloginhandler.cpp
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/sslloginhandler.cpp	1970-01-01 01:00:00.000000000 +0100
+++ kdenetwork-3.3.2/kopete/protocols/msn/sslloginhandler.cpp	2005-05-22 19:35:27.000000000 +0200
@@ -0,0 +1,453 @@
+//Imported from KMess (2005-05-19)
+
+/***************************************************************************
+                          sslloginhandler.cpp  -  description
+                             -------------------
+    begin                : Sat Jun 28 2003
+    copyright            : (C) 2003 by Mike K. Bennett
+    email                : mkb137b@hotmail.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#include "sslloginhandler.h"
+
+#include <qstringlist.h>
+#include <qregexp.h>
+#include <qsocket.h>
+#include <qurl.h>
+
+#include <kdebug.h>
+#include <kextsock.h>
+#include <kssl.h>
+#include <kurl.h>
+
+#if 0
+#include "../kmessdebug.h"
+#include "mimemessage.h"
+#else
+//i didn't want to import the whole MimeMessage from Kmess for Kopete so i
+// reimplemented the base here  -Olivier
+
+class MimeMessage
+{
+	public:
+		MimeMessage(const QString &msg) : message(msg) {}
+
+		QString getValue(const QString &key)
+		{
+			QRegExp rx(key+": (.*)\n");
+			rx.search(message);
+			return rx.cap(1);
+		}
+	private:
+		QString message;
+};
+
+#include "sslloginhandler.moc"
+#endif
+//there is nothing modified from here.  this is exactly the kmerlin code
+
+
+
+/*
+ * Great documentation about this can be found at
+ * http://siebe.bot2k3.net/docs/
+ */
+
+
+// The constructor
+SslLoginHandler::SslLoginHandler()
+ : mode_(NONE)
+{
+  // Create the SSL handler
+  ssl_ = new KSSL( true );
+
+  // Create and set up the socket.
+  socket_ = new KExtendedSocket( );
+
+  //socket_->setSocketFlags( 0x00 | 0x600000 ); // 0x00 = anySocket | 0x600000 = bufferedSocket
+  socket_->setSocketFlags( 0x00 ); // 0x00 = anySocket | 0x600000 = bufferedSocket
+  socket_->setTimeout( 30   );
+  socket_->enableRead( true );
+  connect( socket_, SIGNAL(         readyRead()    ),
+           this,    SLOT  (      dataReceived()    ) );
+  connect( socket_, SIGNAL(  connectionFailed(int) ),
+           this,    SLOT  (       socketError(int) ) );
+}
+
+
+
+// The destructor
+SslLoginHandler::~SslLoginHandler()
+{
+  delete ssl_;
+  delete socket_;
+}
+
+
+
+// Data was received over the socket
+void SslLoginHandler::dataReceived()
+{
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - ******************** Data received ********************" << endl;
+  kdDebug() << "SslLoginHandler - " << socket_->bytesAvailable() << " bytes available." << endl;
+  kdDebug() << "SslLoginHandler - SSL says " << ssl_->pending() << " bytes available." << endl;
+#endif
+
+  QString   data;
+  int       breakOut = 0;
+  const int maxIterations = 1000;
+  while ( ( !data.contains( QRegExp("\r\n") ) ) && ( breakOut < maxIterations ) )
+  {
+    // Read data via SSL
+    data = readSslData();
+    breakOut ++;
+  }
+
+  // Output the data for debugging
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - ********************   Contents    ********************" << endl;
+  kdDebug() << data << endl;
+  kdDebug() << "SslLoginHandler - ********************  End of data  ********************" << endl;
+#endif
+
+  // Warn if timed out
+  if ( breakOut >= maxIterations )
+  {
+    kdDebug() << "WARNING - SSL read timed out." << endl;
+    emit loginFailed();
+    return;
+  }
+
+  if ( data.length() > 0 )
+  {
+    parseHttpResponse(data);
+  }
+  else
+  {
+    kdDebug() << "WARNING - Available data wasn't read from the SSL socket." << endl;
+    emit loginFailed();
+  }
+}
+
+
+
+// Start the login process
+void SslLoginHandler::login( QString parameters, QString handle, QString password )
+{
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Starting login with parameters " << parameters << "." << endl;
+#endif
+
+  // Store the given data
+  authenticationParameters_ = parameters;
+  handle_                   = handle;
+  password_                 = password;
+
+  // Get the login server
+  sendLoginServerRequest("nexus.passport.com");
+  dataReceived();
+}
+
+
+
+// Get the authentication data from a string
+void SslLoginHandler::parseAuthenticationData( QString data )
+{
+  QString twnData;
+
+  // Pull TWN data out of the message
+  twnData = data.right( data.length() - data.find(QRegExp("from-PP='")) - 9 );
+  twnData = twnData.left( twnData.find(QRegExp("',")) );
+
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - data for TWN is " << twnData << "." << endl;
+#endif
+
+  // Notify the MsnNotificationConnection
+  emit loginSucceeded(twnData);
+}
+
+
+
+// Parse the HTTP response from the server
+void SslLoginHandler::parseHttpResponse(QString data)
+{
+  KURL    location;
+  int     headerEnd;
+  QString header;
+  int     headerCode;
+  QString headerText;
+
+  // Parse the HTTP status header
+  QRegExp re("HTTP/\\d+\\.\\d+ (\\d+) ([^\r\n]+)");
+  headerEnd  = data.find("\r\n");
+  header     = data.left( (headerEnd == -1) ? 20 : headerEnd );
+
+  re.search(header);
+  headerCode = re.cap(1).toUInt();
+  headerText = re.cap(2);
+
+  // Create a MimeMessage, removing the HTTP status header
+  MimeMessage message( data.section( ",", 1 ) );
+
+
+  switch(mode_)
+  {
+    case GETLOGINSERVER:
+    {
+      // Step 1. This data describes the login server to use.
+      if(headerCode == 302)
+      {
+        // HTTP Redirect
+        location = KURL( message.getValue( "Location" ) );
+        sendLoginServerRequest(location.host());
+      }
+      else
+      {
+        // Parse the data
+        QString loginServer;
+        QString page;
+        parseLoginServerData( loginServer, page, message.getValue("PassportURLs") );
+
+        // Send the authentication request
+        sendAuthenticationRequest( loginServer, page );
+      }
+      break;
+    }
+    case GETAUTHENTICATIONDATA:
+    {
+      // Step 2. Get the authentication data
+      if(headerCode == 200)
+      {
+        // Login success
+        parseAuthenticationData(message.getValue("Authentication-Info"));
+      }
+      else if(headerCode == 302)
+      {
+        // HTTP Redirect
+        location = KURL( message.getValue( "Location" ) );
+        sendAuthenticationRequest(location.host(), location.path());
+      }
+      else if(headerCode == 401)
+      {
+        // Got a HTTP "401 Unauthorized"; Login failed
+        emit loginIncorrect();
+      }
+      else
+      {
+        kdDebug() << "SslLoginHandler::parseHttpResponse: WARNING "
+                  << "- Unhandled response code " << headerCode << " " << headerText << endl;
+        emit loginFailed();
+      }
+      break;
+    }
+    default:
+    {
+      kdDebug() << "SslLoginHandler::parseHttpResponse: WARNING - Entered illegal state" << endl;
+      emit loginFailed();
+    }
+  }
+}
+
+
+// Get login server data from a string
+void SslLoginHandler::parseLoginServerData( QString &host, QString &page, QString serverData )
+{
+  int slashIndex;
+
+  // Get everything between "DLLogin=" and to the comma.
+  serverData = serverData.right( serverData.length() - serverData.find( "DALogin=" ) - 8 );
+  serverData = serverData.left( serverData.find( "," ) );
+
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - host/page=" << serverData << endl;
+#endif
+
+  // Separate the "host/page" string.
+  slashIndex = serverData.find( "/" );
+  host = serverData.left( slashIndex );
+  page = serverData.right( serverData.length() - slashIndex );
+
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - host=" << host << " page=" << page << endl;
+#endif
+}
+
+
+
+// Read data from the socket via SSL
+QString SslLoginHandler::readSslData()
+{
+  char       rawblock[1024];
+  QCString   block;
+  QString    data        = "";
+  int        noBytesRead = 1;
+
+  // Read data from the SSL socket.
+  if ( ssl_ != 0 )
+  {
+//    while( ( ssl_->pending() > 0 ) && ( noBytesRead > 0 ) )
+//    while( ( socket_->bytesAvailable() > 0 ) && ( noBytesRead > 0 ) )
+    while(noBytesRead > 0)
+    {
+      noBytesRead = ssl_->read( rawblock, 1024 );
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+      kdDebug() << "SslLoginHandler - " << noBytesRead << " bytes read." << endl;
+#endif
+      block = rawblock;
+      block = block.left( noBytesRead );
+      data += QString::fromUtf8( block );
+    }
+  }
+
+  return data;
+}
+
+
+
+// Send the authenticationn request
+void SslLoginHandler::sendAuthenticationRequest( QString loginServer, QString page )
+{
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Step 2. Requesting authentication data." << endl;
+#endif
+
+  QString request;
+  QString encodedHandle   = handle_;
+  QString encodedPassword = password_;
+
+  QUrl::encode(encodedHandle);
+  QUrl::encode(encodedPassword);
+
+  request = "GET " + page + " HTTP/1.1\r\n"
+            "Authorization: Passport1.4"
+              " OrgVerb=GET"
+              ",OrgURL=http%3A%2F%2Fmessenger%2Emsn%2Ecom"
+              ",sign-in=" + encodedHandle +
+              ",pwd="     + encodedPassword +
+              ","         + authenticationParameters_ + "\r\n"
+            "User-Agent: MSMSGS\r\n"     // Make sure the server won't discriminate
+            "Host: " + loginServer + "\r\n"
+            "Connection: Keep-Alive\r\n"
+            "Cache-Control: no-cache\r\n\r\n";
+
+  // Step 2. Send the authorisation request
+  mode_ = GETAUTHENTICATIONDATA;
+  sendHttpRequest( request, loginServer, 443 );
+}
+
+
+
+// Send a HTTP request to the server
+void SslLoginHandler::sendHttpRequest( QString request, QString host, int port )
+{
+  QString response;
+  QString responseBody;
+
+  if ( socket_ == 0 )
+  {
+    kdDebug() << "SslLoginHandler::sendHttpRequest - WARNING "
+              << "- Trying to login using a null socket." << endl;
+    return;
+  }
+
+  // Configure the socket
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Close and reset the socket." << endl;
+#endif
+  ssl_->setAutoReconfig( true );
+  ssl_->reInitialize();
+  socket_->closeNow();
+  socket_->reset();
+
+  // Try to connect
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Connecting to " << host << ":" << port << "." << endl;
+#endif
+  socket_->setAddress( host, port );
+  socket_->lookup();
+  int connectionSuccess = socket_->connect();
+  if ( connectionSuccess != 0 )
+  {
+    kdDebug() << "SslLoginHandler::sendHttpRequest - WARNING "
+              << "- Connection failed, giving " << connectionSuccess << endl;
+    return;
+  }
+
+  // Try to wrap the SSL handler
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Connection success, binding SSL to socket fd " << socket_->fd() << endl;
+#endif
+  int sslConnectionSuccess = ssl_->connect( socket_->fd() );
+  if ( sslConnectionSuccess != 1 )
+  {
+    kdDebug() << "SslLoginHandler::sendHttpRequest - WARNING "
+              << "- SSL Connection failed, giving " << sslConnectionSuccess << endl;
+    return;
+  }
+
+  // Send the request
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - SSL connected OK, sending the request." << endl;
+  kdDebug() << request;
+#endif
+  writeSslData( request );
+}
+
+
+
+// Request the name of the login server
+void SslLoginHandler::sendLoginServerRequest(QString hostname)
+{
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+  kdDebug() << "SslLoginHandler - Step 1. Requesting the login server." << endl;
+#endif
+
+  // Step 1. Send the login server request
+  // The server will respond with the location of the main SSL server.
+  mode_ = GETLOGINSERVER;
+  sendHttpRequest( "GET /rdr/pprdr.asp\r\n\r\n", hostname, 443 );
+}
+
+
+
+// Detect a socket error
+void SslLoginHandler::socketError(int error)
+{
+  kdDebug() << "SslLoginHandler : WARNING - Received error " << error << " from the socket." << endl;
+}
+
+
+
+// Write data to the socket via SSL
+void SslLoginHandler::writeSslData( QString data )
+{
+  int noBytesWritten;
+
+  if(socket_ != 0 && ssl_ != 0)
+  {
+    noBytesWritten = ssl_->write( data.latin1(), data.length() );
+    if(noBytesWritten != (int)data.length())
+    {
+      kdDebug() << "WARNING - Wanted to write " << data.length() << " to the socket, "
+                << " wrote " << noBytesWritten << "." << endl;
+    }
+#ifdef KMESSDEBUG_SSLLOGINHANDLER
+    else
+    {
+      kdDebug() << "SslLoginHandler - Sent " << noBytesWritten << " bytes via SSL." << endl;
+    }
+#endif
+  }
+}
+
diff -Nur kdenetwork-3.3.2.orig/kopete/protocols/msn/sslloginhandler.h kdenetwork-3.3.2/kopete/protocols/msn/sslloginhandler.h
--- kdenetwork-3.3.2.orig/kopete/protocols/msn/sslloginhandler.h	1970-01-01 01:00:00.000000000 +0100
+++ kdenetwork-3.3.2/kopete/protocols/msn/sslloginhandler.h	2005-05-22 19:35:27.000000000 +0200
@@ -0,0 +1,96 @@
+//Imported from KMess  - 2005-05-19
+
+/***************************************************************************
+                          sslloginhandler.h  -  description
+                             -------------------
+    begin                : Sat Jun 28 2003
+    copyright            : (C) 2003 by Mike K. Bennett
+    email                : mkb137b@hotmail.com
+ ***************************************************************************/
+
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ ***************************************************************************/
+
+#ifndef SSLLOGINHANDLER_H
+#define SSLLOGINHANDLER_H
+
+#include <qobject.h>
+#include <qstringlist.h>
+
+// Forward declarations
+class KExtendedSocket;
+class KSSL;
+class MimeMessage;
+
+/**This class handles the SSL portion of the login.
+  *@author Mike K. Bennett
+  */
+
+class SslLoginHandler : public QObject
+{
+   Q_OBJECT
+
+  public:
+    // The constructor
+                         SslLoginHandler();
+    // The destructor
+                        ~SslLoginHandler();
+    // Start the login process
+    void                 login( QString parameters, QString handle, QString password );
+
+  private : // Private methods
+    // Get the authentication data from a string
+    void                 parseAuthenticationData( QString data );
+    // Parse the HTTP response from the server
+    void                 parseHttpResponse(QString data);
+    // Get login server data from a string
+    void                 parseLoginServerData( QString &host, QString &page, QString serverData );
+    // Read data from the socket via SSL
+    QString              readSslData();
+    // Send the authenticationn request
+    void                 sendAuthenticationRequest( QString loginServer, QString page );
+    // Send a HTTP request to the server
+    void                 sendHttpRequest( QString request, QString host, int port );
+    // Request the name of the login server
+    void                 sendLoginServerRequest(QString hostname);
+    // Write data to the socket via SSL
+    void                 writeSslData( QString data );
+
+  private slots : // Private slots
+    // Data was received over the socket
+    void                 dataReceived();
+    // Detect a socket error
+    void                 socketError(int error);
+
+  private : // Private attributes
+    // The mode of the transfer.
+    enum Mode          { NONE = 0, GETLOGINSERVER = 1, GETAUTHENTICATIONDATA = 2 } mode_;
+    // The list of parameters sent by the notification server
+    QString              authenticationParameters_;
+    // The cookies we received from the server
+    QStringList          cookies_;
+    // The user's handle
+    QString              handle_;
+    // The user's password
+    QString              password_;
+    // The socket over which the SSL data is written and read
+    KExtendedSocket     *socket_;
+    // The SSL handler
+    KSSL                *ssl_;
+
+  signals : // Public signals
+    // Signal that the login was aborted because an internal error occured
+    void                 loginFailed();
+    // Signal that the login failed, username/password was incorrect
+    void                 loginIncorrect();
+    // Signal that the login succeeded
+    void                 loginSucceeded( QString authentication );
+};
+
+#endif
