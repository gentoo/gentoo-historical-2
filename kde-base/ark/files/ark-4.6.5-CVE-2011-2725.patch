From: Raphael Kubo da Costa <rakuco@FreeBSD.org>
Date: Mon, 17 Oct 2011 22:28:27 +0000
Subject: Fix directory traversal issue (CVE-2011-2725).
X-Git-Url: http://quickgit.kde.org/?p=ark.git&amp;a=commitdiff&amp;h=ccb5448eb2aedd150313ea0af431a9b754176975
---
Fix directory traversal issue (CVE-2011-2725).

Tim Brown from Nth Dimension noticed a possible traversal issue where
the previewer dialog would show (and then remove) the wrong file when
a maliciously crafted archive had a file previewed.

We now do the same thing as infozip and filter out "../" from the
paths being previewed.
---


--- a/ark/part/part.cpp
+++ b/ark/part/part.cpp
@@ -558,8 +558,15 @@ void Part::slotPreviewExtracted(KJob *jo
     if (!job->error()) {
         const ArchiveEntry& entry =
             m_model->entryForIndex(m_view->selectionModel()->currentIndex());
-        const QString fullName =
-            m_previewDir->name() + QLatin1Char( '/' ) + entry[ FileName ].toString();
+
+        QString fullName =
+            m_previewDir->name() + QLatin1Char('/') + entry[FileName].toString();
+
+        // Make sure a maliciously crafted archive with parent folders named ".." do
+        // not cause the previewed file path to be located outside the temporary
+        // directory, resulting in a directory traversal issue.
+        fullName.remove(QLatin1String("../"));
+
         ArkViewer::view(fullName, widget());
     } else {
         KMessageBox::error(widget(), job->errorString());
