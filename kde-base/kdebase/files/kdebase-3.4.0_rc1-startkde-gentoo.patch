diff -Nur kdebase-3.4.0.orig/startkde kdebase-3.4.0/startkde
--- kdebase-3.4.0.orig/startkde	2005-02-23 12:24:24.000000000 +0100
+++ kdebase-3.4.0/startkde	2005-02-26 21:53:58.587008144 +0100
@@ -1,8 +1,46 @@
 #!/bin/sh
 #
-#  DEFAULT KDE STARTUP SCRIPT ( KDE-3.4 )
+#  GENTOO CUSTOMIZED STARTUP SCRIPT ( KDE-3.4 )
 #
 
+# Gentoo part:
+export PATH="/usr/kde/3.4/bin:${PATH}"
+
+# handle ~/.kde* dirs - separate ones for separate KDEs
+cd ${HOME}
+if [ -e .kde ]; then
+	if [ ! -L .kde ]; then
+		mv -f .kde .kde.backup
+	else
+		rm -f .kde
+	fi
+fi
+if [ ! -e .kde3.4 ]; then
+	if [ -e .kde3.3 ]; then
+		# migrate old config files
+		cp -r .kde3.3 .kde3.4
+		for file in share/apps/kdevdocumentation/search/htdig.conf \
+			    share/apps/kalarmd/clients \
+			    share/config/kdevdocumentationrc \
+			    share/config/katesyntaxhighlightingrc \
+			    share/config/ksysguardrc \
+			    share/config/kresources/calendar/stdrc \
+			    share/config/ksmserverrc \
+			    share/config/kcalrc; do
+			if [ -e ".kde3.4/${file}" ]; then
+				sed -i -e "s:$HOME/\.kde3\.3:$HOME/\.kde3\.4:g" \
+				       -e 's:$HOME/\.kde3\.3:$HOME/\.kde3\.4:g' \
+					".kde3.4/${file}"
+			fi
+		done
+	else
+		mkdir .kde3.4
+	fi
+fi
+ln -sf .kde3.4 .kde
+
+# Gentoo part ends
+
 # When the X server dies we get a HUP signal from xinit. We must ignore it
 # because we still need to do some cleanup.
 trap 'echo GOT SIGHUP' HUP
