--- kdebase-workspace-4.2.1-orig/plasma/applets/quicklaunch/quicklaunchApplet.cpp	2009-02-26 15:17:02.000000000 +0100
+++ kdebase-workspace-4.2.1/plasma/applets/quicklaunch/quicklaunchApplet.cpp	2009-03-08 13:53:49.000000000 +0100
@@ -44,6 +44,8 @@
 
 QuicklaunchApplet::QuicklaunchApplet(QObject *parent, const QVariantList &args)
   : Plasma::Applet(parent, args),
+    m_layout(0),
+    m_innerLayout(0),
     m_visibleIcons(6),
     m_rowCount(2),
     m_dialogRowCount(2),
@@ -53,9 +55,7 @@
     m_addDialog(0),
     m_rightClickedIcon(0),
     m_addAction(0),
-    m_removeAction(0),
-    m_layout(0),
-    m_innerLayout(0)
+    m_removeAction(0)
 {
     setHasConfigurationInterface(true);
     setAcceptDrops(true);
@@ -141,16 +141,11 @@
         if (!m_innerLayout) {
             return sizeHint;
         }
+        qreal newWidth = m_innerLayout->columnCount() * sizeHint.height() / qMax(1, m_innerLayout->rowCount());
         if (m_icons.size() > m_visibleIcons) {
-            qreal factor = m_innerLayout->rowCount() * m_innerLayout->columnCount() + size().height();
-            if (factor) {
-                sizeHint.setWidth(sizeHint.height() / factor);
-            }
+            sizeHint.setWidth(newWidth + sizeHint.height());
         } else {
-            qreal factor = m_innerLayout->rowCount() * m_innerLayout->columnCount();
-            if (factor) {
-                sizeHint.setWidth(sizeHint.height() / factor);
-            }
+            sizeHint.setWidth(newWidth);
         }
         return sizeHint;
     }
