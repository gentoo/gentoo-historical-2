--- src/http/ngx_http_postpone_filter_module.c	Mon May 16 15:47:40 2005
+++ src/http/ngx_http_postpone_filter_module.c	Thu May 26 18:33:47 2005
@@ -45,6 +45,7 @@
 {
     ngx_int_t                      rc;
     ngx_chain_t                   *out;
+    ngx_http_request_t            *mr;
     ngx_http_postponed_request_t  *pr, **ppr;
 
     if (r->connection->write->error) {
@@ -98,14 +99,16 @@
         out = in;
     }
 
-    if (out == NULL && r->out == NULL && !r->connection->buffered) {
+    mr = r->main ? r->main : r;
+
+    if (out == NULL && mr->out == NULL && !mr->connection->buffered) {
         return NGX_OK;
     }
 
     ngx_log_debug1(NGX_LOG_DEBUG_HTTP, r->connection->log, 0,
                    "http postpone filter out \"%V\"", &r->uri);
 
-    rc = ngx_http_next_filter(r->main ? r->main : r, out);
+    rc = ngx_http_next_filter(mr, out);
 
     if (rc == NGX_ERROR) {
         /* NGX_ERROR may be returned by any filter */
