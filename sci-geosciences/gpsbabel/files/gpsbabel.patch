--- ./gpsbabel-1.3.1/configure.in	2006-09-03 01:41:01.000000000 +0200
+++ ./gpsbabel-1.3.1-r4/configure.in	2006-09-30 12:29:50.000000000 +0200
@@ -227,9 +227,26 @@
 AC_CHECK_LIB([expat], [XML_ParserCreate], 
   AC_DEFINE(HAVE_LIBEXPAT, 1, [Defined if you have libexpat])
   AC_SUBST(EXPAT_LIB)
-#  [EXPAT_LIB="$LDFLAGS -lexpat"]
 )
 
+AC_MSG_CHECKING(for efence)
+AC_ARG_ENABLE(efence,
+  [  --enable-efence=[yes|(no)]],
+  [ if test "$enable_efence" != "no" ; then
+  	EFENCE_LIB=-lefence
+	GPSBABEL_DEBUG=gpsbabel-debug
+	INSTALL_DEBUG=install-debug
+    fi])
+AC_SUBST(EFENCE_LIB)
+AC_SUBST(GPSBABEL_DEBUG)
+AC_SUBST(INSTALL_DEBUG)
+AC_MSG_RESULT($EFENCE_LIB)
+
+AC_MSG_CHECKING(for docdir)
+AC_ARG_WITH(doc,[  --with-doc=DIR        Path where the documentation will be stored.],
+             DOCDIR="$withval", DOCDIR="../babelweb/")
+AC_SUBST(DOCDIR)
+
 # Checks for header files.
 # AC_HEADER_STDC
 
@@ -256,5 +273,5 @@
 # AC_CHECK_FUNCS([atexit floor localtime_r memmove memset pow select sqrt strchr strcspn strdup strerror strncasecmp strrchr strspn strstr strtol strtoul])
 AC_CHECK_FUNCS([nanosleep sleep])
 
-AC_CONFIG_FILES([Makefile win32/gpsbabel.rc coldsync/Makefile jeeps/Makefile shapelib/Makefile zlib/empty])
+AC_CONFIG_FILES([Makefile xmldoc/makedoc tools/mkcapabilities win32/gpsbabel.rc coldsync/Makefile jeeps/Makefile shapelib/Makefile zlib/empty])
 AC_OUTPUT
--- ./gpsbabel-1.3.1/Makefile.in	2006-09-03 01:41:01.000000000 +0200
+++ ./gpsbabel-1.3.1-r4/Makefile.in	2006-09-30 12:52:13.000000000 +0200
@@ -36,7 +36,8 @@
 GBCFLAGS=$(EXTRA_CFLAGS) $(DEBUGGING) -I. -I@srcdir@/coldsync \
 	$(OPTIMIZATION) @CFLAGS@
 LDFLAGS=$(EXTRA_LDFLAGS) @LDFLAGS@
-INSTALL_TARGETDIR=/usr/local/
+PREFIX=@prefix@
+INSTALL_DIR=$(DESTDIR)/$(PREFIX)
 
 # OTHER_ROOT=/opt/local	# For DarwinPorts on OSX
 # OTHER_ROOT=/sw		# Uncomment For Fink on OS X.
@@ -93,14 +94,17 @@
 
 
 # Directory of local web doc.  Traditionally a sibling to the GPSBabel tree.
-WEB=../babelweb/
+WEB=@DOCDIR@
 
 
 all: gpsbabel$(EXEEXT)
 
-gpsbabel$(EXEEXT): $(OBJS)
+gpsbabel$(EXEEXT): $(OBJS) @GPSBABEL_DEBUG@
 	$(CC)  $(CFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ @EXPAT_LIB@ @USB_LIBS@ $(OUTPUT_SWITCH)$@
 
+gpsbabel-debug: $(OBJS)
+	$(CC)  $(CFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ @EFENCE_LIB@ @EXPAT_LIB@ @USB_LIBS@ $(OUTPUT_SWITCH)$@
+
 Makefile: Makefile.in config.status
 	CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status 
 
@@ -132,8 +136,13 @@
 #
 # This will only work on UNIX-like substances.
 #
-install:
-	install gpsbabel  $(INSTALL_TARGETDIR)/bin
+install: @INSTALL_DEBUG@
+	@mkdir -p $(INSTALL_DIR)/bin
+	install gpsbabel  $(INSTALL_DIR)/bin
+
+install-debug:
+	@mkdir -p $(INSTALL_DIR)/bin
+	install gpsbabel-debug  $(INSTALL_DIR)/bin
 
 # Nerdy release stuff that needs to work only on Linux.
 
@@ -157,6 +166,7 @@
 	 --stringparam root.filename "readme" \
 	 xmldoc/babelmain.xsl \
 	 xmldoc/readme.xml
+	chmod 755 tools/mkcapabilities
 	tools/mkcapabilities
 
 gpsbabel.html: FORCE
--- ./gpsbabel-1.3.1/xmldoc/chapters/build.xml	2006-09-03 00:51:54.000000000 +0200
+++ ./gpsbabel-1.3.1-r4/xmldoc/chapters/build.xml	2006-09-30 12:29:50.000000000 +0200
@@ -44,6 +44,12 @@
   <option>--disable-filters</option> Excludes all filter support.
 </para>
 <para>
+  <option>--enable-efence</option> Activate debugging mode for gpsbabel-debug.
+</para>
+<para>
+  <option>--with-doc=dir</option> Specify that the doc should be created and installed in <option>dir</option>.
+</para>
+<para>
   <option>--without-libusb</option> Disables use of libusb, even it's it's available.
 </para>
 <para>
--- ./gpsbabel-1.3.1/tools/mkcapabilities.in	2006-09-17 19:49:34.000000000 +0200
+++ ./gpsbabel-1.3.1-r4/tools/mkcapabilities.in	2006-09-30 12:29:50.000000000 +0200
@@ -28,4 +28,4 @@
 }
 
 getcap($1, $2, $3, $5)
-' > ../babelweb/capabilities.inc > ../babelweb/capabilities.inc
+' > @DOCDIR@capabilities.inc > @DOCDIR@capabilities.inc
--- ./gpsbabel-1.3.1/xmldoc/makedoc.in	2006-09-17 19:48:31.000000000 +0200
+++ ./gpsbabel-1.3.1-r4/xmldoc/makedoc.in	2006-09-30 12:29:50.000000000 +0200
@@ -64,6 +64,7 @@
 
 
 
+@dir=`mkdir -p @DOCDIR@`;
 $dir = $0;
 $dir =~ s:/.*$::;
 
