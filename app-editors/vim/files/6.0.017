To: vim-dev@vim.org
Subject: Patch 6.0.017
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.0.017
Problem:    When 'ttybuiltin' is set and a builtin termcap entry defines t_Co
            and the external one doesn't, it gets reset to empty. (David
            Harrison)
Solution:   Only set t_Co when it wasn't set yet.
Files:      src/term.c


*** ../vim60.16/src/term.c	Thu Sep 20 21:31:38 2001
--- src/term.c	Fri Oct 19 19:38:08 2001
***************
*** 1665,1673 ****
  		    width = tgetnum("co");
  
  		/*
! 		 * Get number of colors.
  		 */
! 		set_color_count(tgetnum("Co"));
  
  # ifndef hpux
  		BC = (char *)TGETSTR("bc", &tp);
--- 1665,1675 ----
  		    width = tgetnum("co");
  
  		/*
! 		 * Get number of colors (if not done already).
  		 */
! 		if (term_str(KS_CCO) == NULL
! 			|| term_str(KS_CCO) == empty_option)
! 		    set_color_count(tgetnum("Co"));
  
  # ifndef hpux
  		BC = (char *)TGETSTR("bc", &tp);
*** ../vim60.16/src/version.c	Fri Oct 19 19:36:36 2001
--- src/version.c	Fri Oct 19 19:35:14 2001
***************
*** 608,609 ****
--- 608,611 ----
  {   /* Add new patch number below this line */
+ /**/
+     17,
  /**/

-- 
hundred-and-one symptoms of being an internet addict:
106. When told to "go to your room" you inform your parents that you
     can't...because you were kicked out and banned.

 ///  Bram Moolenaar -- Bram@moolenaar.net -- http://www.moolenaar.net  \\\
(((   Creator of Vim -- http://vim.sf.net -- ftp://ftp.vim.org/pub/vim   )))
 \\\  Help me helping AIDS orphans in Uganda - http://iccf-holland.org  ///
