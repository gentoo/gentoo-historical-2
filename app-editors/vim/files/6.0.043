To: vim-dev@vim.org
Subject: Patch 6.0.043
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.0.043
Problem:    Patch 6.0.041 was wrong.
Solution:   Use mch_getenv() instead of vim_getenv().
Files:	    src/ex_cmds2.c


*** ../vim60.42/src/ex_cmds2.c	Tue Oct 30 20:43:43 2001
--- src/ex_cmds2.c	Wed Oct 31 10:10:45 2001
***************
*** 4667,4685 ****
  #ifndef LC_MESSAGES
  	if (what == VIM_LC_MESSAGES)
  	{
! 	    p = vim_getenv("LC_ALL");
  	    if (p == NULL || *p == NUL)
  	    {
! 		p = vim_getenv("LC_MESSAGES");
  		if (p == NULL || *p == NUL)
! 		    p = vim_getenv("LANG");
  	    }
  	}
  	else
  #endif
! 	    p = setlocale(what, NULL);
  	if (p == NULL || *p == NUL)
! 	    p = "Unknown";
  	smsg((char_u *)_("Current %slanguage: \"%s\""), whatstr, p);
      }
      else
--- 4667,4685 ----
  #ifndef LC_MESSAGES
  	if (what == VIM_LC_MESSAGES)
  	{
! 	    p = mch_getenv((char_u *)"LC_ALL");
  	    if (p == NULL || *p == NUL)
  	    {
! 		p = mch_getenv((char_u *)"LC_MESSAGES");
  		if (p == NULL || *p == NUL)
! 		    p = mch_getenv((char_u *)"LANG");
  	    }
  	}
  	else
  #endif
! 	    p = (char_u *)setlocale(what, NULL);
  	if (p == NULL || *p == NUL)
! 	    p = (char_u *)"Unknown";
  	smsg((char_u *)_("Current %slanguage: \"%s\""), whatstr, p);
      }
      else
*** ../vim60.42/src/version.c	Tue Oct 30 21:18:36 2001
--- src/version.c	Wed Oct 31 10:08:33 2001
***************
*** 608,609 ****
--- 608,611 ----
  {   /* Add new patch number below this line */
+ /**/
+     43,
  /**/

-- 
It is illegal for anyone to give lighted cigars to dogs, cats, and other
domesticated animal kept as pets.
		[real standing law in Illinois, United States of America]

 ///  Bram Moolenaar -- Bram@moolenaar.net -- http://www.moolenaar.net  \\\
(((   Creator of Vim -- http://vim.sf.net -- ftp://ftp.vim.org/pub/vim   )))
 \\\  Help me helping AIDS orphans in Uganda - http://iccf-holland.org  ///
