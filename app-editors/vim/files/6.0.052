To: vim-dev@vim.org
Subject: Patch 6.0.052
Fcc: outbox
From: Bram Moolenaar <Bram@moolenaar.net>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
------------

Patch 6.0.052
Problem:    The check for rlim_t in patch 6.0.046 does not work on some
	    systems. (Zdenek Sekera)
Solution:   Also look in sys/resource.h for rlim_t.
Files:	    src/auto/configure, src/configure.in


*** ../vim60.51/src/auto/configure	Wed Oct 31 14:21:02 2001
--- src/auto/configure	Wed Oct 31 21:57:52 2001
***************
*** 5145,5163 ****
  
  fi
  
  echo $ac_n "checking for rlim_t""... $ac_c" 1>&6
! echo "configure:5150: checking for rlim_t" >&5
  if eval "test \"`echo '$''{'ac_cv_type_rlim_t'+set}'`\" = set"; then
!   echo $ac_n "(cached) $ac_c" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 5155 "configure"
  #include "confdefs.h"
  #include <sys/types.h>
  #if STDC_HEADERS
  #include <stdlib.h>
  #include <stddef.h>
  #endif
  EOF
  if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
    egrep "(^|[^a-zA-Z_0-9])rlim_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
--- 5145,5169 ----
  
  fi
  
+ 
  echo $ac_n "checking for rlim_t""... $ac_c" 1>&6
! echo "configure:5151: checking for rlim_t" >&5
  if eval "test \"`echo '$''{'ac_cv_type_rlim_t'+set}'`\" = set"; then
!   echo "$ac_t""(cached) $ac_cv_type_rlim_t" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 5156 "configure"
  #include "confdefs.h"
+ 
  #include <sys/types.h>
  #if STDC_HEADERS
  #include <stdlib.h>
  #include <stddef.h>
  #endif
+ #ifdef HAVE_SYS_RESOURCE_H
+ #include <sys/resource.h>
+ #endif
+ 	  
  EOF
  if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
    egrep "(^|[^a-zA-Z_0-9])rlim_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
***************
*** 5169,5194 ****
  fi
  rm -f conftest*
  
  fi
- echo "$ac_t""$ac_cv_type_rlim_t" 1>&6
  if test $ac_cv_type_rlim_t = no; then
    cat >> confdefs.h <<\EOF
  #define rlim_t unsigned long
  EOF
- 
  fi
  
- 
  echo $ac_n "checking for stack_t""... $ac_c" 1>&6
! echo "configure:5184: checking for stack_t" >&5
  if eval "test \"`echo '$''{'ac_cv_type_stack_t'+set}'`\" = set"; then
    echo "$ac_t""(cached) $ac_cv_type_stack_t" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 5189 "configure"
  #include "confdefs.h"
  
- #include "confdefs.h"
  #include <sys/types.h>
  #if STDC_HEADERS
  #include <stdlib.h>
--- 5175,5197 ----
  fi
  rm -f conftest*
  
+ 	  echo "$ac_t""$ac_cv_type_rlim_t" 1>&6
  fi
  if test $ac_cv_type_rlim_t = no; then
    cat >> confdefs.h <<\EOF
  #define rlim_t unsigned long
  EOF
  fi
  
  echo $ac_n "checking for stack_t""... $ac_c" 1>&6
! echo "configure:5188: checking for stack_t" >&5
  if eval "test \"`echo '$''{'ac_cv_type_stack_t'+set}'`\" = set"; then
    echo "$ac_t""(cached) $ac_cv_type_stack_t" 1>&6
  else
    cat > conftest.$ac_ext <<EOF
! #line 5193 "configure"
  #include "confdefs.h"
  
  #include <sys/types.h>
  #if STDC_HEADERS
  #include <stdlib.h>
*** ../vim60.51/src/configure.in	Wed Oct 31 14:21:02 2001
--- src/configure.in	Wed Oct 31 21:57:50 2001
***************
*** 1405,1411 ****
  AC_HEADER_TIME
  AC_CHECK_TYPE(ino_t, long)
  AC_CHECK_TYPE(dev_t, unsigned)
! AC_CHECK_TYPE(rlim_t, unsigned long)
  
  AC_MSG_CHECKING(for stack_t)
  if eval "test \"`echo '$''{'ac_cv_type_stack_t'+set}'`\" = set"; then
--- 1405,1436 ----
  AC_HEADER_TIME
  AC_CHECK_TYPE(ino_t, long)
  AC_CHECK_TYPE(dev_t, unsigned)
! 
! AC_MSG_CHECKING(for rlim_t)
! if eval "test \"`echo '$''{'ac_cv_type_rlim_t'+set}'`\" = set"; then
!   AC_MSG_RESULT([(cached) $ac_cv_type_rlim_t])
! else
!   AC_EGREP_CPP(dnl
! changequote(<<,>>)dnl
! <<(^|[^a-zA-Z_0-9])rlim_t[^a-zA-Z_0-9]>>dnl
! changequote([,]),
!   [
! #include <sys/types.h>
! #if STDC_HEADERS
! #include <stdlib.h>
! #include <stddef.h>
! #endif
! #ifdef HAVE_SYS_RESOURCE_H
! #include <sys/resource.h>
! #endif
! 	  ], ac_cv_type_rlim_t=yes, ac_cv_type_rlim_t=no)
! 	  AC_MSG_RESULT($ac_cv_type_rlim_t)
! fi
! if test $ac_cv_type_rlim_t = no; then
!   cat >> confdefs.h <<\EOF
! #define rlim_t unsigned long
! EOF
! fi
  
  AC_MSG_CHECKING(for stack_t)
  if eval "test \"`echo '$''{'ac_cv_type_stack_t'+set}'`\" = set"; then
***************
*** 1413,1419 ****
  else
    AC_EGREP_CPP(stack_t,
    [
- #include "confdefs.h"
  #include <sys/types.h>
  #if STDC_HEADERS
  #include <stdlib.h>
--- 1438,1443 ----
*** ../vim60.51/src/version.c	Wed Oct 31 20:51:33 2001
--- src/version.c	Thu Nov  1 12:02:13 2001
***************
*** 608,609 ****
--- 608,611 ----
  {   /* Add new patch number below this line */
+ /**/
+     52,
  /**/

-- 
Mushrooms always grow in damp places and so they look like umbrellas.

 ///  Bram Moolenaar -- Bram@moolenaar.net -- http://www.moolenaar.net  \\\
(((   Creator of Vim -- http://vim.sf.net -- ftp://ftp.vim.org/pub/vim   )))
 \\\  Help me helping AIDS orphans in Uganda - http://iccf-holland.org  ///
