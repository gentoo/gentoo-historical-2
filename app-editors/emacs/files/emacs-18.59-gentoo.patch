Prereq: 2004-03-08
diff -Nur emacs-18.59-orig/src/ChangeLog emacs-18.59/src/ChangeLog
--- emacs-18.59-orig/src/ChangeLog	2004-03-08 09:38:50.000000000 +0100
+++ emacs-18.59/src/ChangeLog	2004-03-09 08:36:49.000000000 +0100
@@ -1,3 +1,9 @@
+2004-03-09  Ulrich Mueller  <ulm@kph.uni-mainz.de>
+
+	* malloc.c (DONT_DEFINE_SIGNAL): Defined.
+
+	* s-linux.h (TERMINFO): Moved here from ymakefile.
+
 2004-03-08  Ulrich Mueller  <ulm@kph.uni-mainz.de>
 
 	* unexelf.c: Replaced with version from Emacs 21.3.
diff -Nur emacs-18.59-orig/src/malloc.c emacs-18.59/src/malloc.c
--- emacs-18.59-orig/src/malloc.c	1992-03-23 05:09:07.000000000 +0100
+++ emacs-18.59/src/malloc.c	2004-03-09 08:33:12.000000000 +0100
@@ -59,6 +59,9 @@
  */
 
 #ifdef emacs
+/* Inhibit macro definition of "signal" in m-*.h */
+#define DONT_DEFINE_SIGNAL
+
 /* config.h specifies which kind of system this is.  */
 #include "config.h"
 
diff -Nur emacs-18.59-orig/src/s-linux.h emacs-18.59/src/s-linux.h
--- emacs-18.59-orig/src/s-linux.h	1999-11-05 09:17:23.000000000 +0100
+++ emacs-18.59/src/s-linux.h	2004-03-09 08:34:05.000000000 +0100
@@ -164,6 +164,9 @@
 #define POSIX			/* affects only getpagesize.h */
 #define POSIX_SIGNALS		/* uses sigaction from sys_signal */
 
+/* Use terminfo instead of termcap. */
+#define TERMINFO
+
 #ifdef HAVE_PTMX
 
 /* This change means that we don't loop through allocate_pty too many
@@ -250,7 +253,7 @@
 
 #define C_COMPILER gcc
 #define C_DEBUG_SWITCH -g
-#define C_OPTIMIZE_SWITCH -O3 -malign-loops=2 -malign-jumps=2 -malign-functions=2
+#define C_OPTIMIZE_SWITCH -O2 -malign-loops=2 -malign-jumps=2 -malign-functions=2
 #define OLDXMENU_OPTIONS CFLAGS=-O2 EXTRA=insque.o
 #define START_FILES pre-crt0.o /usr/lib/crt1.o /usr/lib/crti.o
 #define LIBS_DEBUG		/* override in config.h to include -lg */
diff -Nur emacs-18.59-orig/src/ymakefile emacs-18.59/src/ymakefile
--- emacs-18.59-orig/src/ymakefile	1999-11-05 09:19:47.000000000 +0100
+++ emacs-18.59/src/ymakefile	2003-11-13 08:35:38.000000000 +0100
@@ -191,7 +191,7 @@
 SHORT= shortnames
 #endif /* SHORTNAMES */
 
-CFLAGS= C_DEBUG_SWITCH C_OPTIMIZE_SWITCH -Demacs $(MYCPPFLAG) C_SWITCH_MACHINE C_SWITCH_SYSTEM C_SWITCH_X_MACHINE C_SWITCH_X_SYSTEM
+CFLAGS= C_OPTIMIZE_SWITCH -Demacs $(MYCPPFLAG) C_SWITCH_MACHINE C_SWITCH_SYSTEM C_SWITCH_X_MACHINE C_SWITCH_X_SYSTEM
 /* DO NOT use -R.  There is a special hack described in lastfile.c
    which is used instead.  Some initialized data areas are modified
    at initial startup, then labeled as part of the text area when
@@ -284,7 +284,6 @@
 	process.o callproc.o $(environobj) \
 	doprnt.o
 
-#define TERMINFO
 #ifdef TERMINFO
 /* Used to be -ltermcap here.  If your machine needs that,
    define LIBS_TERMCAP in the m- file.  */
diff -Nur emacs-18.59-orig/lisp/ChangeLog emacs-18.59/lisp/ChangeLog
--- emacs-18.59-orig/lisp/ChangeLog	1992-10-31 01:32:00.000000000 +0100
+++ emacs-18.59/lisp/ChangeLog	2004-03-08 09:37:21.000000000 +0100
@@ -1,3 +1,9 @@
+2004-03-08  Ulrich Mueller  <ulm@kph.uni-mainz.de>
+
+	* term/linux.el: New file.
+
+	* term/xterm.el: Load vt200.el.
+
 Fri Oct 30 19:36:38 1992  Richard Stallman  (rms@mole.gnu.ai.mit.edu)
 
 	* Version 18.59 released.
diff -Nur emacs-18.59-orig/lisp/term/linux.el emacs-18.59/lisp/term/linux.el
--- emacs-18.59-orig/lisp/term/linux.el	1970-01-01 01:00:00.000000000 +0100
+++ emacs-18.59/lisp/term/linux.el	2003-11-29 21:37:15.000000000 +0100
@@ -0,0 +1,2 @@
+(load (concat term-file-prefix "vt200") nil t)
+(enable-arrow-keys)
diff -Nur emacs-18.59-orig/lisp/term/xterm.el emacs-18.59/lisp/term/xterm.el
--- emacs-18.59-orig/lisp/term/xterm.el	1989-04-27 03:52:39.000000000 +0200
+++ emacs-18.59/lisp/term/xterm.el	2003-11-29 21:37:15.000000000 +0100
@@ -1,2 +1,2 @@
-;; Don't send the `ti' string when screen is cleared.
-(setq reset-terminal-on-clear nil)
+(load (concat term-file-prefix "vt200") nil t)
+(enable-arrow-keys)
