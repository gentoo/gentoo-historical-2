--- configure.ac.old	2007-08-31 02:12:32.000000000 +0200
+++ configure.ac	2007-08-31 02:17:50.000000000 +0200
@@ -19,6 +19,8 @@
 AC_ARG_ENABLE(sndfile, [  --enable-sndfile        use libsndfile for decoding audio files [default=yes]], , enable_sndfile=yes)
 AC_ARG_ENABLE(vorbis, [  --enable-vorbis         enable ogg/vorbis music playback [default=yes]], , enable_vorbis=yes)
 AC_ARG_ENABLE(lua, [ --enable-lua           use built-in Lua scripting [default=yes]], , enable_lua=yes)
+AC_ARG_ENABLE(speex, , , enable_speex=yes)
+AC_ARG_ENABLE(smpeg, , , enable_smpeg=yes)
 
 dnl Checks for programs.
 AC_PROG_CC
@@ -87,6 +88,7 @@
 AC_CHECK_HEADER([boost/function.hpp], , [AC_MSG_ERROR([You need boost/function.hpp from the boost library to run Aleph One])])
 AC_LANG_POP(C++)
 
+if [[ "x$enable_smpeg" = "xyes" ]]; then
 dnl Check for SMPEG
 AC_CHECK_HEADERS([smpeg/smpeg.h], [
   AC_CHECK_LIB(smpeg, SMPEG_new, [
@@ -94,6 +96,7 @@
     AC_DEFINE(HAVE_SMPEG, 1, [SMPEG movie playback is enabled])
   ])
 ])	    
+fi
 
 if [[ "x$enable_mad" = "xyes" ]]; then
 dnl Check for libmad
@@ -128,13 +129,16 @@
 AC_DEFINE(HAVE_LUA, 1, [Lua support is enabled])
 fi
 
+if [[ "x$enable_speex" = "xyes" ]]; then
 dnl Check for Speex
+CPPFLAGS="$CPPFLAGS -I/usr/include/speex"
 AC_CHECK_HEADERS(speex/speex.h, [
   AC_CHECK_LIB(speex, speex_decoder_init, [
     LIBS="-lspeex $LIBS"
     AC_DEFINE(SPEEX, 1, [Speex support is enabled])
   ])
 ])
+fi
 
 dnl Check for ALSA
 AC_CHECK_HEADERS([alsa/asoundlib.h], [
