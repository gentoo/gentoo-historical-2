diff -urN xmcd-3.2.1.old/cdda_d/Imakefile xmcd-3.2.1/cdda_d/Imakefile
--- xmcd-3.2.1.old/cdda_d/Imakefile	2003-08-02 21:24:35.000000000 -0500
+++ xmcd-3.2.1/cdda_d/Imakefile	2003-12-20 02:13:36.000000000 -0600
@@ -114,7 +114,7 @@
 alsalib_incl+=	$(wildcard /usr/local/include/alsa/asoundlib.h)
 
 ifneq "$(strip $(alsalib_incl))" ""
-DEFINES+= -DHAS_ALSA
+DEFINES+= -DHAS_ALSA -DALSA_PCM_OLD_HW_PARAMS_API
 endif
 #endif
 
diff -urN xmcd-3.2.1.old/install.sh xmcd-3.2.1/install.sh
--- xmcd-3.2.1.old/install.sh	2003-08-02 21:24:33.000000000 -0500
+++ xmcd-3.2.1/install.sh	2003-12-20 02:37:16.000000000 -0600
@@ -513,7 +513,7 @@
 then
 	OS_MACH=mips
 else
-	OS_MACH=`(uname -m) 2>/dev/null`
+	OS_MACH=`(uname -m) 2>/dev/null | sed -e 's/i[0-9]86/i686/'`
 fi
 
 if [ -z "$OS_SYS" ]
@@ -714,30 +714,6 @@
 $ECHO "CDDB(tm) Disc Recognition Service.  See the CDDB file"
 $ECHO "for information."
 
-# Check privilege
-(id | fgrep 'uid=0(root)') >/dev/null 2>&1
-if [ $? != 0 ]
-then
-	$ECHO "\n\nYou should be the super user to install xmcd."
-
-	YNDEF=n
-	if [ -z "$BATCH" ] && get_yn "\n  Proceed with installation anyway"
-	then
-		$ECHO "\nWARNING: Without super-user privilege, some files may"
-		$ECHO "not be properly installed, or they may be installed"
-		$ECHO "with incorrect permissions."
-
-		XBINPERM=711
-		XBINOWNER=_default_
-		OWNER=_default_
-		GROUP=_default_
-	else
-		log_err -p "Not super user: installation aborted by user."
-		do_exit 1
-	fi
-fi
-
-
 # Check existence of binaries
 
 MISSING=
@@ -1049,78 +1025,6 @@
 fi
 
 
-# Remove old xmcd components
-
-$ECHO "\n\nChecking for old xmcd components..."
-
-# Old binaries
-dirs=`echo "$OPATH" | $AWK -F: '{ for (i = 1; i <= NF; i++) print $i }'`
-for i in $BINTRYDIRS
-do
-	dirs=`$ECHO "$dirs\n$i"`
-done
-dirs=`($ECHO "$dirs" | \
-       sed -e 's/^[ 	]*//' -e '/^$/d' | \
-       sort | uniq) 2>/dev/null`
-
-if [ -n "$dirs" ]
-then
-	for i in $dirs
-	do
-	    if [ "$i" = "$BINDIR" -o "$i" = "." ]
-	    then
-		    continue
-	    fi
-
-	    for j in xmcd cda cddbcmd wm2xmcd dp2xmcd $STARTUP_SCRIPT
-	    do
-		tryfile=${i}/${j}
-		if [ -f $tryfile -a -x $tryfile ]
-		then
-		    if [ -z "$BATCH" ]
-		    then
-			YNDEF=y
-			if get_yn "Remove old executable $tryfile"
-			then
-			    rm -f $tryfile
-			    if [ $? -ne 0 ]
-			    then
-				$ECHO "Cannot remove $tryfile."
-			    fi
-			fi
-		    else
-			rm -f $tryfile
-		    fi
-		fi
-	    done
-	done
-fi
-
-# Old xmcd app-defaults files
-dirs=`for i in $LIBTRYDIRS $LIBDIR; do echo "$i"; done | sort | uniq`
-for i in $dirs
-do
-	tryfile=${i}/app-defaults/XMcd
-	if [ -f "$tryfile" ]
-	then
-		if [ -z "$BATCH" ]
-		then
-		    YNDEF=y
-		    if get_yn "Remove old xmcd resource file $tryfile"
-		    then
-			rm -f $tryfile
-			if [ $? -ne 0 ]
-			then
-			    $ECHO "Cannot remove ${tryfile}."
-			fi
-		    fi
-		else
-		    rm -f $tryfile
-		fi
-	fi
-done
-
-
 # Set architecture-specific binary and library directory
 ARCHBIN="${XMCDLIB}/bin-${OS_SYS_T}-${OS_MACH_T}"
 ARCHLIB="${XMCDLIB}/lib-${OS_SYS_T}-${OS_MACH_T}"
@@ -1160,7 +1064,7 @@
 
 if [ "$DISCOGDIR" != "$XMCDLIB/discog" ]
 then
-	do_link "$DISCOGDIR" "$XMCDLIB/discog"
+	do_link "../../../../../var/lib/xmcd/discog" "$XMCDLIB/discog"
 	$ECHO "\t$XMCDLIB/discog"
 fi
 
diff -urN xmcd-3.2.1.old/libdi_d/common.cfg xmcd-3.2.1/libdi_d/common.cfg
--- xmcd-3.2.1.old/libdi_d/common.cfg	2003-08-02 21:24:40.000000000 -0500
+++ xmcd-3.2.1/libdi_d/common.cfg	2003-12-20 02:34:06.000000000 -0600
@@ -78,7 +78,7 @@
 ! /dev/rdsk/m187_c0d3s7		(UNIX SVR4.0/88k, m187 controller 0, SCSI ID 3)
 ! DKA500:			(Digital OpenVMS)
 ! 
-device:			/dev/rcd0
+device:			/dev/cdrom
 
 ! For CDDA playback mode, this selects the audio output port(s).  The
 ! value is the sum of the following:
diff -urN xmcd-3.2.1.old/libdi_d/config.sh xmcd-3.2.1/libdi_d/config.sh
--- xmcd-3.2.1.old/libdi_d/config.sh	2003-08-02 21:24:40.000000000 -0500
+++ xmcd-3.2.1/libdi_d/config.sh	2003-12-20 02:20:38.000000000 -0600
@@ -31,9 +31,9 @@
 VER=3.2.1
 
 # Change the following directory to fit your local configuration
-BINDIR=/usr/bin/X11
-XMCDLIB=/usr/lib/X11/xmcd
-DISCOGDIR=/usr/lib/X11/xmcd/discog
+BINDIR=/usr/X11R6/bin
+XMCDLIB=/usr/X11R6/lib/X11/xmcd
+DISCOGDIR=/var/lib/xmcd/discog
 XMCD_URL=http://www.amb.org/xmcd/
 
 ERRFILE=/tmp/xmcd.err
@@ -2506,7 +2506,7 @@
 # Get platform information
 OS_SYS=`(uname -s) 2>/dev/null`
 OS_REL=`(uname -r) 2>/dev/null`
-OS_MACH=`(uname -m) 2>/dev/null`
+OS_MACH=`(uname -m) 2>/dev/null | sed -e 's/i[0-9]86/i686/'`
 OS_NODE=`(uname -n) 2>/dev/null`
 
 if [ -z "$OS_SYS" ]
diff -urN xmcd-3.2.1.old/libdi_d/os_linux.h xmcd-3.2.1/libdi_d/os_linux.h
--- xmcd-3.2.1.old/libdi_d/os_linux.h	2003-08-02 21:24:42.000000000 -0500
+++ xmcd-3.2.1/libdi_d/os_linux.h	2003-12-20 02:35:00.000000000 -0600
@@ -101,7 +101,6 @@
 
 
 #define OS_MODULE	/* Indicate that this is compiled on a supported OS */
-#define SETUID_ROOT	/* Setuid root privilege is required */
 
 
 /* Public function prototypes */
diff -urN xmcd-3.2.1.old/misc_d/discog.htm xmcd-3.2.1/misc_d/discog.htm
--- xmcd-3.2.1.old/misc_d/discog.htm	2003-08-02 21:25:02.000000000 -0500
+++ xmcd-3.2.1/misc_d/discog.htm	2003-12-20 02:21:27.000000000 -0600
@@ -34,7 +34,7 @@
 <H2>Directory Organization</H2>
 <DIR>
 <P>
-The top-level Local Discography directory is <B>$DISCOGDIR</B>
+The top-level Local Discography directory is <B>/var/lib/xmcd/discog</B>
 on your system.  This was created when xmcd was installed.
 Under this directory there are hierarchy of directories of music genres
 (i.e., <I>Rock, Classical, Jazz,</I> etc.).  These genres match those
diff -urN xmcd-3.2.1.old/misc_d/genidx.sh xmcd-3.2.1/misc_d/genidx.sh
--- xmcd-3.2.1.old/misc_d/genidx.sh	2003-08-02 21:25:02.000000000 -0500
+++ xmcd-3.2.1/misc_d/genidx.sh	2003-12-20 02:22:41.000000000 -0600
@@ -30,8 +30,8 @@
 PATH=/bin:/usr/bin:/usr/local/bin; export PATH
 
 # Modify these to suit your local configuration
-XMCDLIB=/usr/lib/X11/xmcd
-DISCOGDIR=$XMCDLIB/discog
+XMCDLIB=/usr/X11R6/lib/X11/xmcd
+DISCOGDIR=/var/lib/xmcd/discog
 FILE_MODE=666
 DIR_MODE=777
 
diff -urN xmcd-3.2.1.old/misc_d/start.sh xmcd-3.2.1/misc_d/start.sh
--- xmcd-3.2.1.old/misc_d/start.sh	2003-08-02 21:25:03.000000000 -0500
+++ xmcd-3.2.1/misc_d/start.sh	2003-12-20 02:33:16.000000000 -0600
@@ -26,7 +26,7 @@
 #    along with this program; if not, write to the Free Software
 #    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 #
-PATH=${PATH}:/sbin:/usr/sbin:/bin:/usr/bin:/etc
+PATH=${PATH}:/sbin:/usr/sbin:/bin:/usr/bin:/etc:/usr/X11R6/bin
 export PATH
 
 
@@ -34,10 +34,28 @@
 {
 	if [ -z "$XMCD_LIBDIR" ]
 	then
-		XMCD_LIBDIR=/usr/lib/X11/xmcd
+		XMCD_LIBDIR=/usr/X11R6/lib/X11/xmcd
 		export XMCD_LIBDIR
 	fi
 
+	if [ "$0" = "/usr/X11R6/bin/xmcd" -o "$0" = "/usr/X11R6/bin/cda" ] & [ ! -f $XMCD_LIBDIR/config/common.cfg-`uname -n` ]; then
+		echo
+		echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
+		echo "The default configuration is probably unsuitable for your CD drive."
+		echo "Run /etc/xmcd/config.sh to configure your CD.                      "
+		echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
+		echo
+	fi
+
+	echo
+	echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
+	echo "For security reasons xmcd is not installed setuid.  You need to be "
+	echo "the owner of the cdrom device or the following files should have   "
+	echo "the setuid bit set:                                                "
+	echo "             /usr/X11R6/lib/X11/xmcd/bin-*/{xmcd,cda}.             "
+	echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
+	echo
+
 	SYS_T="$SYS"
 	MACH_T="$MACH"
 	REL_T="$REL"
@@ -128,7 +146,7 @@
 	MACH=mips
 else
 	MACH=`(uname -m) 2>/dev/null | \
-		sed -e 's/\//_/g' -e 's/-/_/g' -e 's/[ 	]/_/g'`
+		sed -e 's/i[0-9]86/i686/' -e 's/\//_/g' -e 's/-/_/g' -e 's/[    ]/_/g'`
 fi
 REL=`(uname -r) 2>/dev/null | sed -e 's/\//_/g' -e 's/-/_/g' -e 's/[ 	]/_/g'`
 
diff -urN xmcd-3.2.1.old/util_d/Imakefile xmcd-3.2.1/util_d/Imakefile
--- xmcd-3.2.1.old/util_d/Imakefile	2003-08-02 21:25:02.000000000 -0500
+++ xmcd-3.2.1/util_d/Imakefile	2003-12-20 02:13:36.000000000 -0600
@@ -39,10 +39,9 @@
  *
  */
 
-/*
- * #include "Motif.tmpl"
- * #include "Motif.rules"
- */
+#include "Motif.tmpl"
+#include "Motif.rules"
+
 LOCAL_LIBRARIES= XmClientLibs
 
 
diff -urN xmcd-3.2.1.old/xmcd_d/Imakefile xmcd-3.2.1/xmcd_d/Imakefile
--- xmcd-3.2.1.old/xmcd_d/Imakefile	2003-08-02 21:24:47.000000000 -0500
+++ xmcd-3.2.1/xmcd_d/Imakefile	2003-12-20 02:13:36.000000000 -0600
@@ -39,10 +39,8 @@
  *
  */
 
-/*
- * #include "Motif.tmpl"
- * #include "Motif.rules"
- */
+#include "Motif.tmpl"
+#include "Motif.rules"
 
 CDDBLIB= -L../cddb_d -lcddb
 LOCAL_LIBDIR= -L/usr/freeware/lib32 -L/usr/local/lib
