--- rhythmbox-0.4.0/shell/main.c.orig	2002-12-04 20:20:42.000000000 +0200
+++ rhythmbox-0.4.0/shell/main.c	2002-12-04 20:23:48.000000000 +0200
@@ -74,8 +74,6 @@
 				      GNOME_PARAM_APP_DATADIR, DATADIR,
 				      NULL);
 
-	gdk_threads_init ();
-
 #ifdef ENABLE_NLS
 	/* initialize i18n */
 	bindtextdomain (GETTEXT_PACKAGE, GNOMELOCALEDIR);
@@ -86,22 +84,33 @@
 	/* workaround for non utf8 LC_COLLATE */
 	old_collate = g_strdup_printf ("LC_COLLATE=%s",
 				       g_getenv ("LC_COLLATE"));
-	if (strstr (old_collate, "UTF-8") == NULL)
-	{
-		char *lang = NULL, *new_collate;
+ 	if (old_collate == NULL || strstr (old_collate, "UTF-8") == NULL)
+
+ 	{
+   		char *lang = NULL, *new_collate;
+		
+ 		const char *env;
+		
+   		env = g_getenv ("LANG");
+  		if (env == NULL)
+  		{
+  			env = "C";
+   		}
 		
-		if (strlen (g_getenv ("LANG")) >=5)
+  		if (strlen (env) >=5)
 			lang = g_strndup (g_getenv ("LANG"), 5);
-		else 
-			lang = g_strdup ("en_US");
-
-		new_collate = g_strdup_printf("LC_COLLATE=%s.UTF-8", 
-					      lang);
-		putenv (new_collate);
+ 		else
+ 			lang = g_strdup ("en_US");
+		
+ 		new_collate = g_strdup_printf ("LC_COLLATE=%s.UTF-8",
+            					       lang);
+ 		putenv (new_collate);
+		
+   		g_free (lang);
+  		g_free (new_collate);
+   	}
 
-		g_free (lang);
-		g_free (new_collate);
-	}
+	gdk_threads_init ();
 	
 	CORBA_exception_init (&ev);
 
