--- gst/gstcpu.c	2004/04/25 16:20:36	1.1
+++ gst/gstcpu.c	2004/04/25 16:21:05
@@ -76,7 +76,7 @@
       "=o" (regs[1]),
       "=o" (regs[2]), "=o" (regs[3])
 :    "a" (x)
-:    "ebx", "ecx", "edx");
+:    "ecx", "edx");
 
   *eax = regs[0];
   *ebx = regs[1];
--- gst/gsttrashstack.h	2004/04/25 16:30:19	1.1
+++ gst/gsttrashstack.h	2004/04/25 16:40:43
@@ -101,6 +101,7 @@
    * inlikely that we manage to grab the wrong head->next value.
    */
   __asm__ __volatile__ (
+    "  pushl %%ebx;             \n\t"
     "  testl %%eax, %%eax;      \n\t"	/* if (head == NULL) return */
     "  jz 20f;                  \n\t"
     "10:                        \n\t"
@@ -110,12 +111,13 @@
     SMP_LOCK "cmpxchg8b %1;     \n\t"	/* if eax:edx == *stack, move ebx:ecx to *stack,
 					 * else *stack is moved into eax:edx again... */
     "  jnz 10b;                 \n\t"	/* ... and we retry */
-    "20:                        \n"
+    "20:                        \n\t"
+    "  popl %%ebx               \n"
       : "=a" (head)
       :  "m" (*stack),
          "a" (stack->head),
          "d" (stack->count)
-      :  "ecx", "ebx"
+      :  "ecx"
   );
 
   return head;
