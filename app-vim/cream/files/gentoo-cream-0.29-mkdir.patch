--- cream-0.29-orig/creamrc	2004-04-15 02:11:15.000000000 +0200
+++ cream-0.29/creamrc	2004-04-27 12:39:45.000000000 +0200
@@ -36,6 +36,31 @@
 " paths determined manually (not by Vim) need to be reversed.
 set shellslash
 
+function! Cream_checkdir(dir)
+
+	" if directory doesn't exist, try to make it
+	if isdirectory(a:dir) != 1
+
+		" system call prep
+		if has("win32")
+			" remove trailing slash (Win95)
+			let tmp = substitute(a:dir, '\(\\\|/\)$', '', 'g')
+
+			" convert slashes to backslashes
+			let tmp = substitute(tmp, '/', '\', 'g')
+		else
+			let tmp = a:dir
+		endif
+
+		" mkdir (quote, regardless of spaces)
+		set noshellslash
+		call system("mkdir " . '"' . tmp . '"')
+		set shellslash
+
+	endif
+
+endfunction
+
 " path initializations
 " Cream_init() ($CREAM)   $VIMRUNTIME/cream {{{1
 function! Cream_init()
@@ -151,21 +176,7 @@
 		let mydir = mydir . '/.cream/'
 
 		" if directory doesn't exist, try to make it
-		if isdirectory(mydir) != 1
-
-			" system call prep
-			" remove trailing slash (Win95)
-			let tmp = substitute(mydir, '\(\\\|/\)$', '', 'g')
-
-			" convert slashes to backslashes
-			let tmp = substitute(tmp, '/', '\', 'g')
-
-			" mkdir (quote, regardless of spaces)
-			set noshellslash
-			call system("mkdir " . '"' . tmp . '"')
-			set shellslash
-
-		endif
+		call Cream_checkdir(mydir)
 
 		" use if directory, writable
 		if filewritable(mydir) == 2
@@ -184,9 +195,7 @@
 		let mydir = $HOME . "/.cream/"
 
 		" if doesn't exist, try to make it
-		if isdirectory(mydir) != 1
-			call system("mkdir " . mydir)
-		endif
+		call Cream_checkdir(mydir)
 
 		" use if directory, writable
 		if filewritable(mydir) == 2
@@ -217,21 +226,7 @@
 		" (remember, g:cream_user is simplified and escaped)
 		let mydir = g:cream_user . "views"
 
-		" if doesn't exist, attempt to make it
-		if isdirectory(mydir) != 1
-
-			if has("win32")
-				let quote = '"'
-			else
-				let quote = ''
-			endif
-			set noshellslash
-			" change slashes to backslashes for system call
-			let tmpdir = substitute(mydir, '/', '\', 'g')
-			call system("mkdir " . quote . tmpdir . quote)
-			set shellslash
-
-		endif
+		call Cream_checkdir(mydir)
 
 		if filewritable(mydir) == 2
 			" we set a script global, only so viminfo (following) can
@@ -280,20 +275,7 @@
 	let mydir = g:cream_user . "spelldicts"
 
 	" if doesn't exist, attempt to make it
-	if isdirectory(mydir) != 1
-
-		if has("win32")
-			let quote = '"'
-		else
-			let quote = ''
-		endif
-		set noshellslash
-		" change slashes to backslashes for system call
-		let tmpdir = substitute(mydir, '/', '\', 'g')
-		call system("mkdir " . quote . tmpdir . quote)
-		set shellslash
-
-	endif
+	call Cream_checkdir(mydir)
 
 	if filewritable(mydir) != 2
 		return -1
@@ -320,20 +302,7 @@
 		let mydir = g:cream_user . "tmp"
 
 		" if doesn't exist, attempt to make it
-		if isdirectory(mydir) != 1
-
-			if has("win32")
-				let quote = '"'
-			else
-				let quote = ''
-			endif
-			set noshellslash
-			" change slashes to backslashes for system call
-			let tmpdir = substitute(mydir, '/', '\', 'g')
-			call system("mkdir " . quote . tmpdir . quote)
-			set shellslash
-
-		endif
+		call Cream_checkdir(mydir)
 
 		if filewritable(mydir) != 2
 			return -1
