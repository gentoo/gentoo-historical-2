qt-bugs@ issue : 25022
applied: no
author: Lubos Lunak <l.lunak@kde.org>

Fixes mouse focus policies in kwin_iii. Already in official Qt.

--- src/kernel/qapplication_x11.cpp.sav	2003-06-20 13:23:03.000000000 +0200
+++ src/kernel/qapplication_x11.cpp	2003-06-20 15:14:23.000000000 +0200
@@ -3667,9 +3667,12 @@ int QApplication::x11ProcessEvent( XEven
 	QWidget* enter = 0;
 	XEvent ev;
 	while ( XCheckMaskEvent( widget->x11Display(), EnterWindowMask | LeaveWindowMask , &ev )
-		&& !qt_x11EventFilter( &ev ) && !widget->x11Event( &ev ) ) {
+		&& !qt_x11EventFilter( &ev )) {
+            QWidget* event_widget = QWidget::find( ev.xcrossing.window );
+            if( event_widget && event_widget->x11Event( &ev ) )
+                break;
 	    if ( ev.type == LeaveNotify && ev.xcrossing.mode == NotifyNormal ){
-		enter = QWidget::find( ev.xcrossing.window );
+		enter = event_widget;
 		XPutBackEvent( widget->x11Display(), &ev );
 		break;
 	    }
@@ -3677,7 +3680,7 @@ int QApplication::x11ProcessEvent( XEven
 		  ev.xcrossing.detail == NotifyVirtual  ||
 		  ev.xcrossing.detail == NotifyNonlinearVirtual )
 		continue;
-	    enter = QWidget::find( ev.xcrossing.window );
+	    enter = event_widget;
 	    if ( ev.xcrossing.focus &&
 		 enter && !enter->isDesktop() && !enter->isActiveWindow() ) {
 		if ( qt_focus_model == FocusModel_Unknown ) // check focus model
