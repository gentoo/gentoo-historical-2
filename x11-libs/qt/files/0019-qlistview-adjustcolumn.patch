qt-bugs@ issue : 25102
applied: no
author: Pascal LÃ©tourneau <pletourn@globetrotter.net>

Don't paint more items than necessary.
adjustColumn() should consider only visible items.

Index: src/widgets/qlistview.cpp
===================================================================
RCS file: /home/kde/qt-copy/src/widgets/qlistview.cpp,v
retrieving revision 1.60
diff -u -3 -p -r1.60 qlistview.cpp
--- src/widgets/qlistview.cpp	23 Jun 2003 11:48:55 -0000	1.60
+++ src/widgets/qlistview.cpp	1 Jul 2003 17:45:34 -0000
@@ -2840,7 +2840,7 @@ void QListView::drawContentsOffset( QPai
 	int cs;
 
 	// need to paint current?
-	if ( ih > 0 && current->y < cy+ch && current->y+ih >= cy ) {
+	if ( ih > 0 && current->y < cy+ch && current->y+ih > cy ) {
 	    if ( fx < 0 ) {
 		// find first interesting column, once
 		x = 0;
@@ -8033,15 +8033,14 @@ void QListView::adjustColumn( int col )
 	w += d->h->iconSet( col )->pixmap().width();
     w = QMAX( w, 20 );
     QFontMetrics fm( fontMetrics() );
-    QListViewItemIterator it( this );
+    QListViewItem* item = firstChild();
     int rootDepth = rootIsDecorated() ? treeStepSize() : 0;
-    while ( it.current() ) {
-	QListViewItem *item = it.current();
-	++it;
+    while ( item ) {
 	int iw = item->width( fm, this, col );
 	if ( 0 == col )
 	    iw += itemMargin() + rootDepth + item->depth()*treeStepSize() - 1;
 	w = QMAX( w, iw );
+	item = item->itemBelow();
     }
     w = QMAX( w, QApplication::globalStrut().width() );
     setColumnWidth( col, w );
