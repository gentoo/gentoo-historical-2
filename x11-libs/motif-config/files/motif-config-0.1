#!/bin/bash
# Copyright 1999-2004 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# based on gcc-config by Martin Schlemmer <azarah@gentoo.org
# Author:  Heinrich Wendel <lanius@gentoo.org>

source /etc/init.d/functions.sh || {
    echo "$0: Could not source /etc/init.d/functions.sh!"
    exit 1
}
umask 022

PROFILE_PATH=/usr/$(get_libdir)/motif
CONFIG_FILE=${PROFILE_PATH}/current

usage() {
cat << "USAGE_END"
Usage: motif-config [option] [profile]
Change the current motif profile, or give info about profiles.

Options:

  -c, --get-current-profile  Print current used motif profile.
  
  -l, --list-profiles        Print a list of available profiles.

  -L, --get-lib-path         Print path where libraries of the given/current
                             profile are located.

  -I, --get-inc-path         Print path where includes of the given/current
                             profile are located.

      --libs                 Print link flags for the given/current
                             profile.

      --cflags               Print compilation flags for the given/current
                             profile.

      --install              Install the given profile.

      --uninstall            Uninstall the given profile.

USAGE_END
    exit $1
}
[[ $# -lt 1 ]] && usage 1
[[ $# -gt 2 ]] && usage 1

switch_profile() {
	exit 0
}

get_current_profile() {
	cat ${CONFIG_FILE} 2> /dev/null
}

list_profiles() {
	i=1
	for x in `ls ${PROFILE_PATH}`; do
		current=`ls -l --full-time ${CONFIG_FILE} 2> /dev/null | awk '{ print $11 }' | sed -e "s:${PROFILE_PATH}/::"`
		if [ "${x}" != "current" ]; then
			output=`cat ${PROFILE_PATH}/${x}`;
			output="[${i}] $output";
			if [ "${x}" = "${current}" ]; then
				output="${output} *"
			fi
			echo "$output"
			i=$((i + 1))
		fi
	done
}

get_lib_path() {
	exit 0
}

get_inc_path() {
	exit 0
}

get_cflags() {
	exit 0
}

get_ldflags() {
	exit 0
}

install_profile() {
	if [[ "$(id -u)" -ne 0 ]] ; then
		eerror "$0: Must be root."
		exit 1
	fi

	# create profile
	echo ${1} > ${PROFILE_PATH}/${1}

	# make it default if no profile is activated
	switch_profile
}

uninstall_profile() {
	if [[ "$(id -u)" -ne 0 ]] ; then
		eerror "$0: Must be root."
		exit 1
	fi

	# remove profile
	rm -f ${PROFILE_PATH}/${1} 2> /dev/null

	# activate next profile if non is activated
	switch_profile
}

for x in "$@"; do
	case "${x}" in
		-c|--get-current-profile)
			[[ $# -ne 1 ]] && usage 1
			get_current_profile
		;;

		-l|--list-profiles)
			[[ $# -ne 1 ]] && usage 1
			list_profiles
		;;

		-L|--get-lib-path)
		;;

		-I|--get-inc-path)
		;;

		--clfags)
		;;

		--ldflags)
		;;

		--install)
			[[ $# -ne 2 ]] && usage 1
			install_profile $2
		;;

		--uninstall)
			[[ $# -ne 2 ]] && usage 1
			uninstall_profile $2
		;;

		-h|--help)
			usage 0
			exit 0
		;;

		-v|--version)
			echo "motif-config-0.1"
			exit 0
		;;

		-*)
			eerror "$0: Invalid switch! Run $0 without parameters for help."
			exit 1
		;;


		*)
			# switch profile 
		;;
	esac
done
