--- scanelf.c	28 Jan 2006 19:47:47 -0000	1.117
+++ scanelf.c	3 Feb 2006 00:10:05 -0000	1.118
@@ -198,7 +198,7 @@ static char *scanelf_file_phdr(elfobj *e
 		Elf ## B ## _Shdr *shdr = SHDR ## B (elf->shdr); \
 		Elf ## B ## _Shdr *strtbl = shdr + EGET(ehdr->e_shstrndx); \
 		char *str; \
-		if ((void*)strtbl > (void*)(elf->data + sizeof(*strtbl))) \
+		if ((void*)strtbl > (void*)elf->data_end) \
 			goto skip_this_shdr##B; \
 		check_flags = SHF_WRITE|SHF_EXECINSTR; \
 		for (i = 0; i < EGET(ehdr->e_shnum); ++i) { \
