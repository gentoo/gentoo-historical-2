--- /home/mat/tmp/ulex-0.2/Makefile	2003-09-23 00:59:22.000000000 +0200
+++ Makefile	2003-09-28 21:39:51.000000000 +0200
@@ -5,18 +5,25 @@
 
 
 install: all
-	ocamlfind install ulex META $(wildcard *.cmi) $(wildcard *.a) $(wildcard *.cma) $(wildcard *.cmxa)
+	ocamlfind install ulex META $(wildcard *.cmi) $(wildcard *.a) $(wildcard *.cma) $(wildcard *.cmxa) $(wildcard *.mli)
 
 uninstall:
 	ocamlfind remove ulex
 
-ULEXING = utf8.mli utf8.ml ulexing.mli ulexing.ml
+ULEXING = utf8.ml ulexing.ml
 ULEX = cset.ml ulex.mli ulex.ml pa_ulex.ml
 
-ulexing.cma: $(ULEXING)
-	ocamlc -a -o ulexing.cma $(ULEXING)
-ulexing.cmxa: $(ULEXING)
-	ocamlopt -a -o ulexing.cmxa $(ULEXING)
+%.cmo: %.mli %.ml
+	ocamlc -c -o $@ $+
+
+%.cmx: %.mli %.ml
+	ocamlopt -c -o $@ $+
+
+ulexing.cma: $(ULEXING:.ml=.cmo)
+	ocamlc -linkall -a -o ulexing.cma $+
+
+ulexing.cmxa: $(ULEXING:.ml=.cmx)
+	ocamlopt -linkall -a -o ulexing.cmxa $+
 
 pa_ulex.cma: $(ULEX)
 	ocamlc -a -o pa_ulex.cma -pp 'camlp4o pa_extend.cmo q_MLast.cmo' -I +camlp4 $(ULEX)
