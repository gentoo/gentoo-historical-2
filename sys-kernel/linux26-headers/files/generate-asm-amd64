#!/bin/sh -e
#
# $Header: /var/cvsroot/gentoo-x86/sys-kernel/linux26-headers/files/generate-asm-amd64,v 1.1 2005/01/11 02:57:57 eradicator Exp $
#
# This script generates the files in /usr/include/asm for sparc systems
# during installation of sys-kernel/linux-headers.
# Will no longer be needed when full 64 bit support is used on sparc64
# systems.
#
# Shamefully ripped from Debian
# ----------------------------------------------------------------------

# Idea borrowed from RedHat's kernel package

if [ -n "$1" ]; then
	if [ ! -d "$1" ]; then
		echo "$1" does not exist, or is not a directory
		exit 1
	fi
	cd $1
else
	cd /usr/include
fi

if [ ! -d asm-i386 -o ! -d asm-x86_64 ] ; then
	echo E: asm-i386 and asm-x86_64 must exist, or you will have problems
	exit 1
fi

rm -rf asm
mkdir asm

for h in `( ls asm-i386; ls asm-x86_64 ) | grep '\.h$' | sort -u`; do
	name=`echo $h | tr a-z. A-Z_`
	# common header
	cat > asm/$h << EOF
/* All asm/ files are generated and point to the corresponding
 * file in asm-i386 or asm-x86_64. To regenerate, run "generate-asm"
 */

#ifndef __ASM_STUB__${name}__
#define __ASM_STUB__${name}__

EOF

	# common for sparc and sparc64
	if [ -f asm-i386/$h -a -f asm-x86_64/$h ]; then
		cat >> asm/$h <<EOF
#ifdef __x86_64__
#include <asm-x86_64/$h>
#else
#include <asm-i386/$h>
#endif
EOF

	# sparc only
	elif [ -f asm-i386/$h ]; then
		cat >> asm/$h <<EOF
#ifndef __x86_64__
#include <asm-i386/$h>
#endif
EOF
	# sparc64 only
	else
		cat >> asm/$h <<EOF
#ifdef __x86_64__
#include <asm-x86_64/$h>
#endif
EOF
	fi

	# common footer
	cat >> asm/$h <<EOF

#endif /* !__SPARCSTUB__${name}__ */
EOF

done

exit 0
