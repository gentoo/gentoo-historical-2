--- XFS-20011214.patch.orig	Mon Dec 24 13:26:19 2001
+++ XFS-20011214.patch	Mon Dec 24 13:26:15 2001
@@ -4,7 +4,7 @@
 @@ -54,6 +54,7 @@
  o  util-linux             2.10o                   # fdformat --version
  o  modutils               2.4.2                   # insmod -V
- o  e2fsprogs              1.19                    # tune2fs
+ o  e2fsprogs              1.25                    # tune2fs
 +o  xfsprogs               1.2.0                   # xfs_db -V
  o  reiserfsprogs          3.x.0j                  # reiserfsck 2>&1|grep reiserfsprogs
  o  pcmcia-cs              3.1.21                  # cardmgr -V
@@ -1458,7 +1458,7 @@
 @@ -1,7 +1,7 @@
  VERSION = 2
  PATCHLEVEL = 4
- SUBLEVEL = 16
+ SUBLEVEL = 17
 -EXTRAVERSION =
 +EXTRAVERSION =-xfs
  
@@ -13461,11 +13461,7 @@
 diff --exclude CVS -urN linux-orig/arch/sparc64/defconfig linux/arch/sparc64/defconfig
 --- linux-orig/arch/sparc64/defconfig	Tue Nov 13 10:16:05 2001
 +++ linux/arch/sparc64/defconfig	Fri Nov 16 15:21:00 2001
-@@ -862,3 +862,12 @@
- # Kernel hacking
- #
- # CONFIG_MAGIC_SYSRQ is not set
-+
+@@ -861,3 +861,12 @@
 +#
 +# XFS addons
 +#
@@ -13474,6 +13470,10 @@
 +CONFIG_XFS_FS=y
 +# CONFIG_XFS_RT is not set
 +CONFIG_XFS_DMAPI=y
++
+ #
+ # Kernel hacking
+ #
 diff --exclude CVS -urN linux-orig/drivers/block/ll_rw_blk.c linux/drivers/block/ll_rw_blk.c
 --- linux-orig/drivers/block/ll_rw_blk.c	Mon Oct 29 13:11:17 2001
 +++ linux/drivers/block/ll_rw_blk.c	Tue Oct 30 08:53:18 2001
@@ -158824,14 +158824,14 @@
  };
  
  /*
-@@ -905,6 +949,7 @@
+@@ -951,6 +951,7 @@
  	 */
  	struct dentry * (*fh_to_dentry)(struct super_block *sb, __u32 *fh, int len, int fhtype, int parent);
  	int (*dentry_to_fh)(struct dentry *, __u32 *fh, int *lenp, int need_parent);
 +	int (*dmapi_mount_event) (struct super_block *, char *);
+ 	int (*show_options)(struct seq_file *, struct vfsmount *);
  };
  
- /* Inode state bits.. */
 @@ -914,6 +959,7 @@
  #define I_LOCK			8
  #define I_FREEING		16
@@ -162182,19 +162182,21 @@
  		if (!strncmp(line,"init=",5)) {
  			line += 5;
  			execute_command = line;
-@@ -591,6 +623,12 @@
- #endif
- 	mem_init();
- 	kmem_cache_sizes_init();
+@@ -630,7 +630,13 @@
+ 	pgtable_cache_init();
+ 
+ 	mempages = num_physpages;
+-
 +#if defined(CONFIG_KDB)
 +	kdb_init();
 +	if (KDB_FLAG(EARLYKDB)) {
 +		KDB_ENTER();
 +	}
 +#endif
- 	mempages = num_physpages;
- 
++		
  	fork_init(mempages);
+ 	proc_caches_init();
+ 	vfs_caches_init(mempages);
 diff --exclude CVS -urN linux-orig/kdb/ChangeLog linux/kdb/ChangeLog
 --- linux-orig/kdb/ChangeLog	Wed Dec 31 17:00:00 1969
 +++ linux/kdb/ChangeLog	Mon Dec  3 23:32:43 2001
@@ -169322,14 +169324,6 @@
 diff --exclude CVS -urN linux-orig/mm/vmalloc.c linux/mm/vmalloc.c
 --- linux-orig/mm/vmalloc.c	Mon Sep 17 14:16:31 2001
 +++ linux/mm/vmalloc.c	Fri Sep 21 10:28:50 2001
-@@ -6,6 +6,7 @@
-  *  SMP-safe vmalloc/vfree/ioremap, Tigran Aivazian <tigran@veritas.com>, May 2000
-  */
- 
-+#include <linux/config.h>
- #include <linux/slab.h>
- #include <linux/vmalloc.h>
- #include <linux/spinlock.h>
 @@ -18,6 +19,53 @@
  rwlock_t vmlist_lock = RW_LOCK_UNLOCKED;
  struct vm_struct * vmlist;
