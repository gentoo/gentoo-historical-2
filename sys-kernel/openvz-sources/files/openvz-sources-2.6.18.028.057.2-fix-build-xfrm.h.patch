http://bugzilla.openvz.org/show_bug.cgi?id=963

--- linux-2.6.18-ovz-057.6/include/net/icmp.h~route	2008-08-18 14:19:23.000000000 +0400
+++ linux-2.6.18-ovz-057.6/include/net/icmp.h	2008-08-18 14:20:10.000000000 +0400
@@ -79,7 +79,4 @@ extern int sysctl_icmp_errors_use_inboun
 extern int sysctl_icmp_ratelimit;
 extern int sysctl_icmp_ratemask;
 
-extern void xfrm4_decode_session_reverse(struct sk_buff *skb, struct flowi *fl);
-extern int xfrm4_icmp_check(struct sk_buff *skb);
-
 #endif	/* _ICMP_H */
--- linux-2.6.18-ovz-057.6/include/net/xfrm.h~route	2008-08-18 14:19:37.000000000 +0400
+++ linux-2.6.18-ovz-057.6/include/net/xfrm.h	2008-08-18 14:20:29.000000000 +0400
@@ -794,6 +794,7 @@ static inline int xfrm6_policy_check_rev
 extern int xfrm_decode_session(struct sk_buff *skb, struct flowi *fl, unsigned short family);
 extern void xfrm4_decode_session_reverse(struct sk_buff *skb, struct flowi *fl);
 extern void xfrm6_decode_session_reverse(struct sk_buff *skb, struct flowi *fl);
+extern int xfrm4_icmp_check(struct sk_buff *skb);
 
 extern int __xfrm_route_forward(struct sk_buff *skb, unsigned short family);
 
@@ -875,6 +876,11 @@ static inline int xfrm6_policy_check_rev
 {
 	return 1;
 }
+
+static inline int xfrm4_icmp_check(struct sk_buff *skb)
+{
+	return 1;
+}
 #endif
 
 static __inline__
--- linux-2.6.18-ovz-057.6/net/ipv4/icmp.c~route	2008-08-18 14:21:18.000000000 +0400
+++ linux-2.6.18-ovz-057.6/net/ipv4/icmp.c	2008-08-18 14:21:35.000000000 +0400
@@ -93,6 +93,7 @@
 #include <asm/uaccess.h>
 #include <net/checksum.h>
 #include <linux/xfrm.h>
+#include <net/xfrm.h>
 
 /*
  *	Build xmit assembly blocks
