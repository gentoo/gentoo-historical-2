--- cli/input.cc.orig	2006-08-15 16:17:37.000000000 +0200
+++ cli/input.cc	2006-08-15 16:18:21.000000000 +0200
@@ -259,7 +259,9 @@
   if( !g_thread_supported() )
   {
     g_thread_init(NULL);
+#ifdef HAVE_GUI
     gdk_threads_init();
+#endif
   }
 
 #endif
@@ -771,7 +773,7 @@
 }
 
 
-#ifdef HAVE_GUI
+//#ifdef HAVE_GUI
 
 //============================================================================ 
 //
@@ -790,7 +792,7 @@
 
   return TRUE;
 }
-#endif
+//#endif
 
 //============================================================================
 //
@@ -840,9 +842,12 @@
 
 #ifdef HAVE_READLINE
   rl_callback_handler_remove();
+#ifdef HAVEGUI
   g_io_channel_unref(channel);
 #endif
 
+#endif
+
   CSimulationContext::GetContext()->GetContext()->Clear();
   stop_server();
 
@@ -899,8 +904,10 @@
   win32_fd_to_raw(fileno(stdin));
 #endif
 
+#if defined HAVE_READLINE && defined HAVE_GUI
   rl_getc_function = gpsim_rl_getc;
   channel = g_io_channel_unix_new (fileno(stdin));
+#endif
 
 #ifdef _WIN32
   /* set console to raw mode */ 
@@ -913,7 +920,9 @@
     g_io_add_watch (channel, G_IO_IN, keypressed, NULL);
   }
 #else
- g_io_add_watch (channel, G_IO_IN, keypressed, NULL);
+  #if defined HAVE_READLINE && defined HAVE_GUI
+    g_io_add_watch (channel, G_IO_IN, keypressed, NULL);
+  #endif
 #endif
   rl_callback_handler_install (prompt, have_line);
 
