Respect host build env

--- matrixssl/src/Makefile
+++ matrixssl/src/Makefile
@@ -51,5 +51,6 @@
 else
 #DFLAGS	= -Os
-DFLAGS	= -O3
+DFLAGS	:= $(CFLAGS)
+STRIP	= test
 endif
 
@@ -62,6 +63,6 @@
 #	Override variables for compilation on x86-64 (AMD64, Nacona, etc)
 #
-ifeq ($(shell uname -m),x86_64)
-DFLAGS  += -march=k8 -fPIC -DFP_64BIT -DTFM_X86_64 -DRDTSC
+ifeq ($(findstring x86_64-,$(CHOST)),x86_64-)
+DFLAGS  += -fPIC -DFP_64BIT -DTFM_X86_64 -DRDTSC
 endif
 
@@ -69,17 +70,17 @@
 #	Compile options
 #
-SHARED	= -shared
+SHARED	= -shared -Wl,-soname=$(LIBRARY)
 CFLAGS  = $(DFLAGS) -DLINUX -I./
-LDFLAGS = -lc -lpthread
+LDFLAGS += -lc -lpthread
 
 #
 #	Override variables for compilation on Mac OS X (Darwin)
 #
-ifeq ($(shell uname),Darwin)
+ifeq ($(findstring -darwin,$(CHOST)),-darwin)
 CC	= cc
 SO	= .dylib
 SHARED	= -dynamiclib
 CFLAGS += -DOSX -isystem -I/usr/include
-LDFLAGS = -flat_namespace -install_name @executable_path/../src/$(LIBRARY)
+LDFLAGS += -flat_namespace -install_name @executable_path/../src/$(LIBRARY)
 STRIP = test
 endif
