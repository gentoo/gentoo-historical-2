From: Romain Perier <mrpouet@gentoo.org>
Date: Thu, 29 Oct 2009 16:21:56 +0100
Subject: Make gtk support optional

---
 Makefile.am          |   13 +++++++----
 configure.ac         |   17 +++++++++++----
 examples/Makefile.am |   52 +++++++++++++++++++++++++------------------------
 3 files changed, 47 insertions(+), 35 deletions(-)

--- a/Makefile.am
+++ b/Makefile.am
@@ -1,9 +1,12 @@
+SUBDIRS = libindicate
 
-SUBDIRS = \
-	libindicate \
-	libindicate-gtk \
-	examples \
-	tests \
+if HAVE_LIBINDICATEGTK
+SUBDIRS += libindicate-gtk
+endif
+
+SUBDIRS +=		\
+	examples	\
+	tests		\
 	docs
 
 EXTRA_DIST = \
--- a/configure.ac
+++ b/configure.ac
@@ -63,11 +63,18 @@ AC_SUBST(LIBINDICATE_LIBS)
 
 GDK_PIXBUF_REQUIRED_VERSION=2.12
 
-PKG_CHECK_MODULES(LIBINDICATEGTK, glib-2.0 >= $GLIB_REQUIRED_VERSION
-                                  gio-2.0 >= $GIO_REQUIRED_VERSION
-                                  gdk-pixbuf-2.0 >= $GDK_PIXBUF_REQUIRED_VERSION
-                                  gtk+-2.0 >= $GTK_REQUIRED_VERSION
-                                  dbus-glib-1 >= $DBUS_REQUIRED_VERSION)
+AC_ARG_ENABLE([gtk],
+	AC_HELP_STRING([--disable-gtk], [Disable libindicator-gtk library]),
+	[enable_gtk=$enableval], enable_gtk=auto)
+
+if test "x$enable_gtk" != "xno"; then
+   PKG_CHECK_MODULES(LIBINDICATEGTK, glib-2.0 >= $GLIB_REQUIRED_VERSION
+   				     gio-2.0 >= $GIO_REQUIRED_VERSION
+                                     gdk-pixbuf-2.0 >= $GDK_PIXBUF_REQUIRED_VERSION
+                                     gtk+-2.0 >= $GTK_REQUIRED_VERSION
+                                     dbus-glib-1 >= $DBUS_REQUIRED_VERSION)
+fi
+AM_CONDITIONAL([HAVE_LIBINDICATEGTK], [test "x$enable_gtk" != "xno"])
 AC_SUBST(LIBINDICATEGTK_CFLAGS)
 AC_SUBST(LIBINDICATEGTK_LIBS)

--- a/examples/Makefile.am
+++ b/examples/Makefile.am
@@ -2,32 +2,11 @@
 libexec_PROGRAMS = \
 	indicate-and-crash \
 	indicate-alot \
-	listen-and-print \
-	im-client \
 	show-hide-server
-
-indicate_and_crash_SOURCES = \
-	indicate-and-crash.c
-
-indicate_and_crash_CFLAGS = \
-	-I $(srcdir)/.. \
-	$(LIBINDICATE_CFLAGS)
-
-indicate_and_crash_LDADD = \
-	../libindicate/libindicate.la \
-	$(LIBINDICATE_LIBS)
-
-indicate_alot_SOURCES = \
-	indicate-alot.c
-
-indicate_alot_CFLAGS = \
-	-I $(srcdir)/.. \
-	$(LIBINDICATE_CFLAGS)
-
-indicate_alot_LDADD = \
-	../libindicate/libindicate.la \
-	$(LIBINDICATE_LIBS)
-
+if HAVE_LIBINDICATEGTK
+libexec_PROGRAMS +=		\
+	listen-and-print	\
+	im-client
 listen_and_print_SOURCES = \
 	listen-and-print.c
 
@@ -55,6 +34,29 @@ im_client_LDADD = \
 	../libindicate-gtk/libindicate-gtk.la \
 	$(LIBINDICATE_LIBS) \
 	$(LIBINDICATEGTK_LIBS)
+endif
+
+indicate_and_crash_SOURCES = \
+	indicate-and-crash.c
+
+indicate_and_crash_CFLAGS = \
+	-I $(srcdir)/.. \
+	$(LIBINDICATE_CFLAGS)
+
+indicate_and_crash_LDADD = \
+	../libindicate/libindicate.la \
+	$(LIBINDICATE_LIBS)
+
+indicate_alot_SOURCES = \
+	indicate-alot.c
+
+indicate_alot_CFLAGS = \
+	-I $(srcdir)/.. \
+	$(LIBINDICATE_CFLAGS)
+
+indicate_alot_LDADD = \
+	../libindicate/libindicate.la \
+	$(LIBINDICATE_LIBS)
 
 show_hide_server_SOURCES = \
 	show-hide-server.c

