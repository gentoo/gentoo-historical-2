diff -urNp dazuko-2.3.2.org/configure dazuko-2.3.2/configure
--- dazuko-2.3.2.org/configure	2006-10-04 00:48:18.000000000 +0200
+++ dazuko-2.3.2/configure	2006-12-12 13:49:04.000000000 +0200
@@ -590,21 +590,20 @@ do_linux26()
 		then
 			LINUX26_USE_SUSPEND=1
 		fi
+	fi
+
+	SRC_PATH_END="/include/linux/freezer.h"
+	get_src_path
 
-		grep "try_todo_list.*(.*void.*)" "$SRC_PATH" > /dev/null 2>&1
+	if [ -f "$SRC_PATH" ]
+	then
+		grep "try_to_freeze.*(.*void.*)" "$SRC_PATH" > /dev/null 2>&1
 		if [ $? -eq 0 ]
 		then
 			LINUX26_USE_SUSPEND=2
 		fi
 	fi
 
-	if [ $LINUX26_USE_SUSPEND -eq 2 ]
-	then
-		echo "ok (suspend2)"
-	else
-		echo "ok (suspend1)"
-	fi
-
 	if [ $LOCAL_DPATH -eq 2 ]
 	then
 		LOCAL_DPATH=1
@@ -700,12 +699,12 @@ do_linux26()
 		echo "EXTRA_CFLAGS += -DNO_CAPABILITIES" >> Makefile
 	fi
 
-	if [ ${LINUX26_USE_SUSPEND} -eq 1 ]
+	if [ -n "${LINUX26_USE_SUSPEND}" ]
 	then
 		echo "EXTRA_CFLAGS += -DUSE_TRYTOFREEZEVOID" >> Makefile
 	fi
 
-	if [ ${LINUX26_USE_SUSPEND} -eq 2 ]
+	if [ "${LINUX26_USE_SUSPEND}" -eq 2 ]
 	then
 		echo "EXTRA_CFLAGS += -DUSE_SUSPEND2" >> Makefile
 	fi
diff -urNp dazuko-2.3.2.org/dazuko_linux26.c dazuko-2.3.2/dazuko_linux26.c
--- dazuko-2.3.2.org/dazuko_linux26.c	2006-11-15 10:11:20.000000000 +0200
+++ dazuko-2.3.2/dazuko_linux26.c	2006-12-12 13:51:04.000000000 +0200
@@ -37,9 +37,12 @@
 #include <linux/devfs_fs_kernel.h>
 #endif
 #include <linux/device.h>
-#if !defined(USE_TRYTOFREEZEVOID) && !defined(USE_SUSPEND2)
+#if !defined(USE_TRYTOFREEZEVOID)
 #include <linux/suspend.h>
 #endif
+#if USE_SUSPEND2
+#include <linux/freezer.h>
+#endif
 #include <asm/uaccess.h>
 
 
@@ -178,10 +181,7 @@ inline int xp_wait_until_condition(struc
 		{
 			ret = wait_event_interruptible(queue->queue, cfunction(cparam) != 0);
 
-#ifdef USE_SUSPEND2
-			if (try_todo_list() == 0)
-				break;
-#elif defined (USE_TRYTOFREEZEVOID)
+#if defined (USE_TRYTOFREEZEVOID)
 			if (try_to_freeze() == 0)
 				break;
 #else
