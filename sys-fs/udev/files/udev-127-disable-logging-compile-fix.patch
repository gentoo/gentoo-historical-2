From: Kay Sievers <kay.sievers@vrfy.org>
Date: Sat, 30 Aug 2008 21:07:50 +0000 (+0200)
Subject: libudev: fix --disable-log
X-Git-Url: http://git.kernel.org/?p=linux%2Fhotplug%2Fudev.git;a=commitdiff_plain;h=4cf23685101ff9e1a15f47cb0da49a6ec10b8e27

libudev: fix --disable-log
---

diff --git a/udev/lib/libudev-private.h b/udev/lib/libudev-private.h
index 7e7d1c6..6331f99 100644
--- a/udev/lib/libudev-private.h
+++ b/udev/lib/libudev-private.h
@@ -23,16 +23,6 @@
 #include "libudev.h"
 #include "../udev.h"
 
-struct udev_device {
-	int refcount;
-	struct udev *udev;
-	char *devpath;
-	char *devname;
-	char *subsystem;
-	struct list_head link_list;
-	struct list_head env_list;
-};
-
 #ifdef USE_LOG
 #define log_dbg(udev, arg...) \
 	udev_log(udev, LOG_DEBUG, __FILE__, __LINE__, __FUNCTION__, ## arg)
@@ -48,13 +38,21 @@ void udev_log(struct udev *udev,
 	      const char *format, ...)
 	      __attribute__ ((format(printf, 6, 7)));
 #else
-static inline void udev_log(struct udev *udev,
-	      int priority, const char *file, int line, const char *fn,
-	      const char *format, ...)
-	      __attribute__ ((format(printf, 6, 7))) {}
+#define log_dbg(format, arg...) do { } while (0)
+#define log_info(format, arg...) do { } while (0)
+#define log_err(format, arg...) do { } while (0)
 #endif
 
+struct udev_device {
+	int refcount;
+	struct udev *udev;
+	char *devpath;
+	char *devname;
+	char *subsystem;
+	struct list_head link_list;
+	struct list_head env_list;
+};
+
 extern struct udev_device *device_init(struct udev *udev);
 extern ssize_t util_get_sys_subsystem(struct udev *udev, const char *devpath, char *subsystem, size_t size);
-
 #endif
diff --git a/udev/lib/libudev.c b/udev/lib/libudev.c
index a5f33eb..a8a8a5a 100644
--- a/udev/lib/libudev.c
+++ b/udev/lib/libudev.c
@@ -22,6 +22,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <stddef.h>
+#include <stdarg.h>
 #include <unistd.h>
 #include <errno.h>
 #include <string.h>
