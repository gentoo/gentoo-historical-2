diff -ru --ignore-matching-lines=Id --exclude=.svn tags/0.3.9/ChangeLog trunk/ChangeLog
--- tags/0.3.9/ChangeLog	2007-04-23 15:54:12.000000000 +0200
+++ trunk/ChangeLog	2007-04-24 12:59:14.000000000 +0200
@@ -1,5 +1,13 @@
 # ChangeLog for gentoo-vdr-scripts
-# $Id: ChangeLog 446 2007-04-23 13:54:12Z zzam $
+# $Id: ChangeLog 448 2007-04-24 10:59:13Z zzam $
+
+  24 Apr 2007; Matthias Schwarzott <zzam@gentoo.org>
+  usr/share/vdr/bin/vdrshutdown-gate.sh:
+  Added better check for usable pre-shutdown hook.
+
+  24 Apr 2007; Matthias Schwarzott <zzam@gentoo.org>
+  usr/share/vdr/bin/vdrshutdown-gate.sh:
+  Fixed quoting of the queued commands in shutdown-gate.
 
 *gentoo-vdr-scripts-0.3.9 (23 Apr 2007)
 
Nur in tags/0.3.9/: gentoo-vdr-scripts-0.3.9.tar.bz2.
diff -ru --ignore-matching-lines=Id --exclude=.svn tags/0.3.9/usr/share/vdr/bin/vdrshutdown-gate.sh trunk/usr/share/vdr/bin/vdrshutdown-gate.sh
--- tags/0.3.9/usr/share/vdr/bin/vdrshutdown-gate.sh	2007-04-23 15:54:12.000000000 +0200
+++ trunk/usr/share/vdr/bin/vdrshutdown-gate.sh	2007-04-24 13:02:58.000000000 +0200
@@ -53,14 +53,14 @@
 
 queue_add_wait() {
 	: ${qindex:=1}
-	eval svdrpqueue_${qindex}="sleep $1"
+	eval svdrpqueue_${qindex}="\"sleep $1\""
 	qindex=$((qindex+1))
 }
 
 svdrp_add_queue() {
 	: ${qindex:=1}
 	logger "vdrshutdown-gate sending per svdrp: $1"
-	eval svdrpqueue_${qindex}="${SVDRPCMD} $1"
+	eval svdrpqueue_${qindex}="\"${SVDRPCMD} $1\""
 	qindex=$((qindex+1))
 }
 
@@ -136,14 +136,14 @@
 	fi
 }
 
-shutdown_common() {
+shutdown_abort_common() {
 	ABORT_MESSAGE="${1}"
 	SHUTDOWN_ABORT="1"
-	set_try_again "${SHUTDOWN_DEFAULT_RETRY_TIME}"
+	set_retry_time "${SHUTDOWN_DEFAULT_RETRY_TIME}"
 }
 
 shutdown_abort() {
-	shutdown_common "${1}"
+	shutdown_abort_common "${1}"
 	disable_forced_shutdown
 }
 
@@ -153,7 +153,7 @@
 		echo FORCED: ${1}
 		SHUTDOWN_FORCE_COUNT=$((SHUTDOWN_FORCE_COUNT+1))
 	else
-		shutdown_common "${1}"
+		shutdown_abort_common "${1}"
 	fi
 }
 
@@ -222,9 +222,9 @@
 execute_hooks() {
 	local HOOK
 	for HOOK in $HOOKDIR/pre-shutdown-*.sh; do
-		if [ -f "${HOOK}" ]; then
-			. "${HOOK}"
-		fi
+		[ -r "${HOOK}" ] || continue
+		sh -n "${HOOK}" || continue
+		. "${HOOK}"
 	done
 }
 
