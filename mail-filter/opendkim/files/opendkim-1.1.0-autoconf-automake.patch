--- ./opendkim-1.1.0.orig/configure.ac	2009-09-16 08:29:38.000000000 +1000
+++ ./opendkim-1.1.0/configure.ac	2009-10-06 18:21:08.000000000 +1100
@@ -45,6 +45,11 @@
 
 # Checks for library functions.
 AC_CHECK_FUNCS([dup2 endpwent getcwd gethostname gettimeofday isascii memchr memmove memset regcomp select socket strcasecmp strchr strdup strerror strncasecmp strrchr strtol strtoul strtoull strlcpy strlcat])
+# Checks for library functions.
+AC_FUNC_FORK
+AC_FUNC_MALLOC
+AC_FUNC_MKTIME
+AC_FUNC_REALLOC
 
 # Conditional stuff
 AC_ARG_ENABLE(arlib, AS_HELP_STRING(--enable-arlib, enable provided asynchronous resolver library))
--- ./opendkim-1.1.0.orig/opendkim/Makefile.am	2009-09-16 08:29:38.000000000 +1000
+++ ./opendkim-1.1.0/opendkim/Makefile.am	2009-10-06 18:44:47.000000000 +1100
@@ -7,10 +7,11 @@
 # this lists the binaries to produce, the (non-PHONY, binary) targets in
 # the previous manual Makefile
 sbin_PROGRAMS = opendkim-testkey opendkim-testadsp
-sbin_SCRIPTS = opendkim-genkey.sh
+dist_sbin_SCRIPTS = opendkim-genkey.sh
 
-exampledir = $(datarootdir)/doc/@PACKAGE@
-example_DATA = opendkim.conf.sample
+EXTRA_DIST = opendkim.conf.sample
+sampledir = $(docdir)
+sample_DATA = opendkim.conf.sample
 
 if BUILD_FILTER
 sbin_PROGRAMS += opendkim
@@ -98,12 +99,8 @@
 sbin_PROGRAMS += opendkim-stats
 opendkim_stats_SOURCES = opendkim-db.c opendkim-stats.c
 opendkim_stats_CPPFLAGS = -DUSE_DB -I../libopendkim $(LIBCRYPTO_INCDIRS) $(LIBDB_INCDIRS)
-opendkim_stats_LDFLAGS = -L../libopendkim $(LIBCRYPTO_LIBDIRS) $(LIBUNBOUND_LIBDIRS) $(LIBDB_LIBDIRS)
-opendkim_stats_LDADD = ../libopendkim/libopendkim.la $(LIBUNBOUND_LIBS) $(LIBDB_LIBS)
-if USE_ARLIB
-opendkim_stats_LDFLAGS += -L../libar
-opendkim_stats_LDADD += -lar
-endif
+opendkim_stats_LDFLAGS = $(LIBCRYPTO_LIBDIRS) $(LIBUNBOUND_LIBDIRS) $(LIBDB_LIBDIRS)
+opendkim_stats_LDADD = ../libopendkim/libopendkim.la $(LIBDB_LIBS)
 if DEBUG
 opendkim_stats_CFLAGS = -g
 endif
@@ -111,20 +108,11 @@
 
 opendkim_testkey_SOURCES = opendkim-testkey.c
 opendkim_testkey_CPPFLAGS = -I../libopendkim $(LIBCRYPTO_INCDIRS)
-opendkim_testkey_LDFLAGS = -L../libopendkim $(LIBCRYPTO_LIBDIRS)
+opendkim_testkey_LDFLAGS = $(LIBCRYPTO_LIBDIRS)
 opendkim_testkey_LDADD = ../libopendkim/libopendkim.la
 opendkim_testkey_CFLAGS = 
 if USE_ARLIB
-opendkim_testkey_LDFLAGS += -L../libar
-opendkim_testkey_LDADD += -lar
-endif
-if USE_DB_OPENDKIM
-opendkim_testkey_LDFLAGS += $(LIBDB_LIBDIRS)
-opendkim_testkey_LDADD += $(LIBDB_LIBS)
-endif
-if USE_UNBOUND
-opendkim_testkey_LDFLAGS += $(LIBUNBOUND_LIBDIRS)
-opendkim_testkey_LDADD += $(LIBUNBOUND_LIBS)
+opendkim_testkey_LDADD += ../libar/libar.la
 endif
 if DEBUG
 opendkim_testkey_CFLAGS += -g
@@ -132,31 +120,21 @@
 
 opendkim_testadsp_SOURCES = opendkim-testadsp.c
 opendkim_testadsp_CPPFLAGS = -I../libopendkim $(LIBCRYPTO_INCDIRS)
-opendkim_testadsp_LDFLAGS = -L../libopendkim $(LIBCRYPTO_LIBDIRS)
+opendkim_testadsp_LDFLAGS = $(LIBCRYPTO_LIBDIRS)
 opendkim_testadsp_LDADD = ../libopendkim/libopendkim.la
 opendkim_testadsp_CFLAGS = 
 if USE_ARLIB
-opendkim_testadsp_LDFLAGS += -L../libar
-opendkim_testadsp_LDADD += -lar
-endif
-if USE_DB_OPENDKIM
-opendkim_testadsp_LDFLAGS += $(LIBDB_LIBDIRS)
-opendkim_testadsp_LDADD += $(LIBDB_LIBS)
-endif
-if USE_UNBOUND
-opendkim_testadsp_LDFLAGS += $(LIBUNBOUND_LIBDIRS)
-opendkim_testadsp_LDADD += $(LIBUNBOUND_LIBS)
+opendkim_testadsp_LDADD += ../libar/libar.la
 endif
 if DEBUG
 opendkim_testadsp_CFLAGS += -g
 endif
 
-man_MANS = opendkim-genkey.8 opendkim-testadsp.8 opendkim-testkey.8
+dist_man_MANS = opendkim-genkey.8 opendkim-testadsp.8 opendkim-testkey.8
 if BUILD_FILTER
-man_MANS += opendkim.conf.5 opendkim.8
+dist_man_MANS += opendkim.conf.5 opendkim.8
 endif
 if STATS
-man_MANS += opendkim-stats.8
+dist_man_MANS += opendkim-stats.8
 endif
 
-EXTRA_DIST = $(example_DATA) $(man_MANS) opendkim-stats.8 $(sbin_SCRIPTS)
--- ./opendkim-1.1.0.orig/libopendkim/Makefile.am	2009-09-11 08:08:39.000000000 +1000
+++ ./opendkim-1.1.0/libopendkim/Makefile.am	2009-10-06 18:59:33.000000000 +1100
@@ -10,8 +10,8 @@
 endif
 libopendkimincludedir = $(includedir)/opendkim
 libopendkiminclude_HEADERS = dkim.h
-libopendkim_ladir = $(datadir)/opendkim
-libopendkim_la_DATA = docs/dkim.html docs/dkim_alg_t.html docs/dkim_body.html \
+docsdir = $(htmldir)
+docs_DATA = docs/dkim.html docs/dkim_alg_t.html docs/dkim_body.html \
 	docs/dkim_canon_t.html docs/dkim_cbstat.html docs/dkim_chunk.html \
 	docs/dkim_close.html docs/dkim_dnssec.html docs/dkim_eoh.html \
 	docs/dkim_eom.html docs/dkim_flush_cache.html docs/dkim_free.html \
@@ -77,7 +77,7 @@
 
 if USE_ARLIB
 libopendkim_la_CFLAGS += -DUSE_ARLIB -I../libar
-libopendkim_la_LIBADD += ../libar/libar.a
+libopendkim_la_LIBADD += ../libar/libar.la
 endif
 
 if USE_DB_LIBOPENDKIM
--- ./opendkim-1.1.0.orig/libar/Makefile.am	2009-09-02 03:47:06.000000000 +1000
+++ ./opendkim-1.1.0/libar/Makefile.am	2009-10-06 19:21:21.000000000 +1100
@@ -1,8 +1,8 @@
 # $Id: opendkim-1.1.0-autoconf-automake.patch,v 1.1 2009/10/06 09:10:42 dragonheart Exp $
 
-lib_LIBRARIES = libar.a
-libar_a_SOURCES = ar.c ar-strl.c manual.c ar-strl.h
+lib_LTLIBRARIES = libar.la
+libar_la_SOURCES = ar.c ar-strl.c manual.c ar-strl.h
+libar_la_LIBADD = -lresolv
 libarincludedir = $(includedir)/ar
 libarinclude_HEADERS = ar.h manual.h
-man_MANS = ar.3
-EXTRA_DIST = $(man_MANS)
+dist_man_MANS = ar.3
