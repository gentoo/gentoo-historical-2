--- amavisd	2007-01-30 01:13:27.000000000 +0100
+++ amavisd.ticho	2007-01-30 01:13:12.000000000 +0100
@@ -13224,13 +13224,13 @@
         # we'll be calling Net::Cmd::datasend directly for speed
         $smtp_data_fh->flush or die "Error flushing smtp_data_fh: $!";
 
-        while (($nbytes=$msg->read($buff,65536)) > 0) {
+				for ($! = 0; defined($buff=$msg->getline); $! = 0) {
           do_log(-1,"WARN: Unicode string passed to Net::Cmd::datasend")
             if $unicode_aware && Encode::is_utf8($buff);
           $smtp_handle->datasend($buff)
             or die "datasend timed out while sending body";
         }
-        defined $nbytes or die "Error reading: $!";
+				defined $buff || $!==0 or die "Error reading: $!";
       }
       $smtp_data_fh->close or die "Error closing smtp_data_fh: $!";
       $smtp_data_fh = undef;
