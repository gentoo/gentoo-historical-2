--- amavisd	2006-04-07 22:03:15.000000000 +0200
+++ amavisd.ticho	2006-04-07 22:07:00.000000000 +0200
@@ -12914,11 +12914,11 @@
         # we'll be calling Net::Cmd::datasend directly for speed
         $smtp_data_fh->flush or die "Error flushing smtp_data_fh: $!";
 
-        while (($nbytes=$msg->read($buff,16384)) > 0) {
+        for ($! = 0; defined($buff=$msg->getline); $! = 0) {
           $smtp_handle->datasend($buff)
             or die "datasend timed out while sending body";
         }
-        defined $nbytes or die "Error reading: $!";
+        defined $buff || $!==0  or die "Error reading: $!";
       }
       $smtp_data_fh->close or die "Error closing smtp_data_fh: $!";
       $smtp_data_fh = undef;
