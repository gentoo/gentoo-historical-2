https://github.com/zeromq/zeromq2-1/commit/71cb36d04bd74ca82aca3868e665831733995be7
--- src/decoder.cpp.bak	2011-05-04 10:19:21.000000000 +0200
+++ src/decoder.cpp	2011-05-04 10:18:50.000000000 +0200
@@ -109,7 +109,7 @@
 bool zmq::decoder_t::flags_ready ()
 {
     //  Store the flags from the wire into the message structure.
-    in_progress.flags = tmpbuf [0];
+    in_progress.flags = tmpbuf [0] | ~ZMQ_MSG_MASK;
 
     next_step (zmq_msg_data (&in_progress), zmq_msg_size (&in_progress),
         &decoder_t::message_ready);
