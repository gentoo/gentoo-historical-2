Backporting upstream patch to fix build failure with gnutls-3

https://bugs.gentoo.org/show_bug.cgi?id=388897

--- a/inc/encrypt.hpp
+++ b/inc/encrypt.hpp
@@ -34,7 +34,6 @@
 typedef gnutls_anon_server_credentials gnutls_anon_server_credentials_t;
 typedef gnutls_transport_ptr gnutls_transport_ptr_t;
 typedef gnutls_dh_params gnutls_dh_params_t;
-typedef gnutls_connection_end gnutls_connection_end_t;
 
 class dh_params: private net6::non_copyable
 {
--- a/src/encrypt.cpp
+++ b/src/encrypt.cpp
@@ -25,7 +25,7 @@
 {
 	const unsigned int DH_BITS = 1024;
 
-	net6::gnutls_session_t create_session(net6::gnutls_connection_end_t end)
+	net6::gnutls_session_t create_session(gnutls_connection_end_t end)
 	{
 		net6::gnutls_session_t session;
 		gnutls_init(&session, end);
@@ -202,7 +202,9 @@
 	);
 #endif
 
+#if GNUTLS_VERSION_NUMBER < 0x030003
 	gnutls_transport_set_lowat(session, 0);
+#endif
 }
 
 net6::tcp_encrypted_socket_base::~tcp_encrypted_socket_base()
