diff --exclude-from=/home/dang/.diffrc -u -ruN gnome-vfs-2.11.92.orig/config.h.in gnome-vfs-2.11.92/config.h.in
--- gnome-vfs-2.11.92.orig/config.h.in	2005-08-24 03:31:32.000000000 -0400
+++ gnome-vfs-2.11.92/config.h.in	2005-09-02 15:18:36.000000000 -0400
@@ -268,6 +268,9 @@
 /* Defined if flags availible in SMBCCTXT */
 #undef HAVE_SAMBA_FLAGS
 
+/* Defined if close_fn is in SMBCCTXT instead of close */
+#undef HAVE_SAMBA_CLOSE_FN
+
 /* Define to 1 if you have the `setegid' function. */
 #undef HAVE_SETEGID
 
diff --exclude-from=/home/dang/.diffrc -u -ruN gnome-vfs-2.11.92.orig/configure.in gnome-vfs-2.11.92/configure.in
--- gnome-vfs-2.11.92.orig/configure.in	2005-08-24 03:31:14.000000000 -0400
+++ gnome-vfs-2.11.92/configure.in	2005-09-02 14:59:55.000000000 -0400
@@ -517,6 +517,9 @@
 		AC_CHECK_MEMBER(SMBCCTX.flags,
 				[AC_DEFINE(HAVE_SAMBA_FLAGS,, [Defined if flags availible in SMBCCTXT])],,
 				[#include <libsmbclient.h>])
+		AC_CHECK_MEMBER(SMBCCTX.close_fn,
+				[AC_DEFINE(HAVE_SAMBA_CLOSE_FN,, [Defined if close_fn used in SMBCCTXT instead of close])],,
+				[#include <libsmbclient.h>])
 		CPPFLAGS="$CPPFLAGS_save"
 	else
 		SAMBA_CFLAGS=""
diff --exclude-from=/home/dang/.diffrc -u -ruN gnome-vfs-2.11.92.orig/modules/smb-method.c gnome-vfs-2.11.92/modules/smb-method.c
--- gnome-vfs-2.11.92.orig/modules/smb-method.c	2005-05-24 12:41:44.000000000 -0400
+++ gnome-vfs-2.11.92/modules/smb-method.c	2005-09-02 14:59:55.000000000 -0400
@@ -1486,7 +1486,11 @@
 
 		/* Important: perform_authentication leaves and re-enters the lock! */
 		while (perform_authentication (&actx) > 0) {
+#ifndef HAVE_SAMBA_CLOSE_FN
 			r = smb_context->close (smb_context, handle->file);
+#else /* HAVE_SAMBA_CLOSE_FN */
+			r = smb_context->close_fn (smb_context, handle->file);
+#endif /* HAVE_SAMBA_CLOSE_FN */
 			actx.res = (r >= 0) ? GNOME_VFS_OK : gnome_vfs_result_from_errno ();
 		}
 
