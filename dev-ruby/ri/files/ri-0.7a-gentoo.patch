--- install.rb.orig	Thu Jan 31 04:18:34 2002
+++ install.rb	Thu Jan 31 04:20:21 2002
@@ -16,10 +16,11 @@
 # This sets up a standard environment for any sub-installs as well
 
 $version = CONFIG["MAJOR"]+"."+CONFIG["MINOR"]
-$libdir = File.join(CONFIG["libdir"], "ruby", $version)
 
-$bindir =  CONFIG["bindir"]
-$sitedir = CONFIG["sitedir"] || File.join($libdir, "site_ruby")
+$libdir = File.join(ENV["D"], CONFIG["libdir"], "ruby", $version)
+$bindir =  File.join(ENV["D"], CONFIG["bindir"])
+$sitedir = File.join(ENV["D"], CONFIG["sitedir"] || File.join($libdir, "site_ruby"))
+
 $ri_dest = File.join($sitedir, "ri")
 $ri_op = File.join($ri_dest, "op")
 
@@ -112,6 +113,9 @@
 
 
 File::makedirs($ri_dest)
+
+# I don't know why we need to create the bin dir, but we do :(
+File::makedirs($bindir)
 File::chmod(0755, $ri_dest, true)
 
 $stderr.puts "Installing reference material"
@@ -142,7 +146,7 @@
 
 File.open("ri_cmd.rb") do |ip|
   File.open("ri_tmp", "w") do |op|
-    ruby = File.join($bindir, "ruby")
+    ruby = File.join(CONFIG["bindir"], "ruby")
     op.puts "#!#{ruby}"
     op.write ip.read
   end
