--- openafs/src/rx/xdr_array.c	2001/08/08 00:03:57	1.4
+++ openafs/src/rx/xdr_array.c	2002/07/31 23:13:28	1.4.6.3
@@ -29,7 +29,7 @@
 #include <afsconfig.h>
 #include <afs/param.h>
 
-RCSID("$Header: /var/cvsroot/gentoo-x86/net-fs/openafs/files/openafs-1.3.2-sunrpc-overflow.patch,v 1.2 2002/08/02 22:58:23 aliz Exp $");
+RCSID("$Header: /var/cvsroot/gentoo-x86/net-fs/openafs/files/openafs-1.3.2-sunrpc-overflow.patch,v 1.2 2002/08/02 22:58:23 aliz Exp $");
 
 #ifndef	NeXT
 
@@ -57,10 +57,6 @@
 #endif
 #include "xdr.h"
 
-#ifndef osi_alloc
-char *osi_alloc();
-#endif
-
 #define LASTUNSIGNED	((u_int)0-1)
 
 
@@ -71,20 +67,25 @@
  * elsize is the size (in bytes) of each element, and elproc is the
  * xdr procedure to call to handle each element of the array.
  */
-bool_t
-xdr_array(xdrs, addrp, sizep, maxsize, elsize, elproc)
-	register XDR *xdrs;
-	caddr_t *addrp;		/* array pointer */
-	u_int *sizep;		/* number of elements */
-	u_int maxsize;		/* max numberof elements */
-	u_int elsize;		/* size in bytes of each element */
-	xdrproc_t elproc;	/* xdr routine to handle each element */
+/* 
+	caddr_t *addrp;		* array pointer *
+	u_int *sizep;		* number of elements *
+	u_int maxsize;		* max numberof elements *
+	u_int elsize;		* size in bytes of each element *
+	xdrproc_t elproc;	* xdr routine to handle each element *
+*/
+
+bool_t xdr_array(register XDR *xdrs, caddr_t *addrp, u_int *sizep, 
+	u_int maxsize, u_int elsize, xdrproc_t elproc)
 {
 	register u_int i;
 	register caddr_t target = *addrp;
 	register u_int c;  /* the actual element count */
 	register bool_t stat = TRUE;
-	register int nodesize;
+	register u_int nodesize;
+
+        i = ((~0) >> 1) / elsize;
+        if (maxsize > i) maxsize = i;
 
 	/* like strings, arrays are really counted arrays */
 	if (! xdr_u_int(xdrs, sizep)) {

--- openafs/src/rx/Makefile.in	2002/07/13 03:26:23	1.10.2.4
+++ openafs/src/rx/Makefile.in	2002/08/02 02:42:40	1.10.2.5
@@ -14,13 +14,13 @@
 # Generic xdr objects (or, at least, xdr stuff that's not newly defined for rx).
 # Really the xdr stuff should be in its own directory.
 #
-XDROBJS_common = xdr_rx.o xdr_afsuuid.o
+XDROBJS_common = xdr.o xdr_array.o xdr_rx.o xdr_afsuuid.o
 
 XDROBJS = xdr_arrayn.o ${XDROBJS_common}
 
-XDROBJS_djgpp = xdr.o xdr_rec.o xdr_stdio.o \
+XDROBJS_djgpp = xdr_rec.o xdr_stdio.o \
 	xdr_float.o  xdr_refernce.o  xdr_update.o \
-	xdr_array.o xdr_mem.o ${XDROBJS_common}
+	xdr_mem.o ${XDROBJS_common}
 
 RXOBJS_common = rx_clock.o rx_event.o rx_user.o rx_lwp.o rx.o rx_null.o \
 	rx_globals.o rx_getaddr.o rx_misc.o rx_packet.o rx_rdwr.o rx_trace.o \

