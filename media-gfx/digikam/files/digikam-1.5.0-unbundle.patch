diff -r -u -N digikam-1.5.0-1-docs/CMakeLists.txt digikam-1.5.0/CMakeLists.txt
--- digikam-1.5.0-1-docs/CMakeLists.txt	2010-10-12 21:14:36.000000000 +0200
+++ digikam-1.5.0/CMakeLists.txt	2010-10-15 23:07:49.000000000 +0200
@@ -34,6 +34,9 @@
     "${DIGIKAM_VERSION_SHORT}${DIGIKAM_SUFFIX_VERSION}"
    )
 
+# Path to find FindPGF.cmake script.
+SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake/modules")
+
 # ==================================================================================================
 # Debug area codes
 # These codes will be set for every project specific path automatically, so
@@ -133,10 +136,12 @@
 FIND_PACKAGE(JPEG)
 FIND_PACKAGE(PNG)
 FIND_PACKAGE(TIFF)
+FIND_PACKAGE(PGF)
 FIND_PACKAGE(Jasper)
 FIND_PACKAGE(Kdcraw)
 FIND_PACKAGE(Kexiv2)
 FIND_PACKAGE(Kipi)
+FIND_PACKAGE(CLAPACK)
 
 # Extract version of libjpeg so that we can use the appropriate dir
 # See bug #227313, #228483
@@ -273,6 +278,19 @@
 PRINT_LIBRARY_STATUS("libkexiv2" "http://www.digikam.org/sharedlibs" " (version >= 1.1.0)" KEXIV2_FOR_DIGIKAM)
 PRINT_LIBRARY_STATUS("libkdcraw" "http://www.digikam.org/sharedlibs" " (version >= 1.1.0)" KDCRAW_FOR_DIGIKAM)
 
+IF(PGF_FOUND)
+    MESSAGE(STATUS " libpgf library found..................... YES (optional)")
+ELSE(PGF_FOUND)
+    MESSAGE(STATUS " libpgf library found..................... NO  (optional - internal version used instead)")
+ENDIF(PGF_FOUND)
+
+IF(CLAPACK_FOUND)
+    MESSAGE(STATUS " libclapack library found................. YES (optional)")
+ELSE(CLAPACK_FOUND)
+    MESSAGE(STATUS " libclapack library found................. NO  (optional - internal version used instead)")
+ENDIF(CLAPACK_FOUND)
+
+
 # ================================================================
 
 IF(GPHOTO2_FOUND)
@@ -367,13 +385,19 @@
 ENDIF(DOXYGEN_FOUND)
 
 IF(LCMS_FOUND AND JPEG_FOUND AND PNG_FOUND AND TIFF_FOUND AND JASPER_FOUND AND KDCRAW_FOR_DIGIKAM AND KEXIV2_FOR_DIGIKAM AND KIPI_FOUND)
-    MESSAGE(STATUS " digiKam will be compiled................. YES")
+    MESSAGE(STATUS " digiKam can be compiled.................. YES")
     SET(DIGIKAM_CAN_BE_COMPILED true)
 ELSE(LCMS_FOUND AND JPEG_FOUND AND PNG_FOUND AND TIFF_FOUND AND AND JASPER_FOUND AND KDCRAW_FOR_DIGIKAM AND KEXIV2_FOR_DIGIKAM AND KIPI_FOUND)
     MESSAGE(FATAL_ERROR " digiKam will be compiled................. NO  (Look README file for more details about dependencies)")
     SET(DIGIKAM_CAN_BE_COMPILED false)
 ENDIF(LCMS_FOUND AND JPEG_FOUND AND PNG_FOUND AND TIFF_FOUND AND JASPER_FOUND AND KDCRAW_FOR_DIGIKAM AND KEXIV2_FOR_DIGIKAM AND KIPI_FOUND)
 
+IF(DIGIKAM_CAN_BE_COMPILED AND FORCED_UNBUNDLE AND ((NOT PGF_FOUND) OR (NOT CLAPACK_FOUND) OR (NOT LENSFUN_FOUND)))
+    MESSAGE(STATUS "")
+    MESSAGE(FATAL_ERROR " BUNDLED LIBRARIES HAVE BEEN FORCE-DISABLED IN THIS BUILD. Aborting.")
+    SET(DIGIKAM_CAN_BE_COMPILED false)
+ENDIF(DIGIKAM_CAN_BE_COMPILED AND FORCED_UNBUNDLE AND ((NOT PGF_FOUND) OR (NOT CLAPACK_FOUND) OR (NOT LENSFUN_FOUND)))
+
 MESSAGE(STATUS "----------------------------------------------------------------------------------")
 MESSAGE(STATUS "")
 
@@ -585,7 +609,8 @@
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/dimg/loaders/pgfsettings.cpp
        )
 
-    SET(libclapack_SRCS
+    if(NOT CLAPACK_FOUND)
+      SET(libclapack_SRCS
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/clapack/abort_.c
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/clapack/dgesv.c
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/clapack/dlaswp.c
@@ -618,6 +643,7 @@
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/clapack/util.c
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/clapack/xerbla.c
        )
+    endif(NOT CLAPACK_FOUND)
 
     SET(libdimgfilters_SRCS
         ${libclapack_SRCS}
@@ -1076,14 +1102,18 @@
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/threadimageio/pgfutils.cpp
        )
 
-    SET(libpgf_SRCS
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Decoder.cpp
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Encoder.cpp
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/PGFimage.cpp
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Stream.cpp
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Subband.cpp
-        ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/WaveletTransform.cpp
+    IF(PGF_FOUND)
+       INCLUDE_DIRECTORIES(${PGF_INCLUDE_DIRS})
+    ELSE(PGF_FOUND)
+       SET(libpgf_SRCS
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Decoder.cpp
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Encoder.cpp
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/PGFimage.cpp
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Stream.cpp
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/Subband.cpp
+          ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/libpgf/WaveletTransform.cpp
        )
+    ENDIF(PGF_FOUND)
 
     SET(libsqlite2_SRCS
         ${CMAKE_CURRENT_SOURCE_DIR}/libs/3rdparty/sqlite2/attach.c
diff -r -u -N digikam-1.5.0-1-docs/cmake/modules/FindCLAPACK.cmake digikam-1.5.0/cmake/modules/FindCLAPACK.cmake
--- digikam-1.5.0-1-docs/cmake/modules/FindCLAPACK.cmake	1970-01-01 01:00:00.000000000 +0100
+++ digikam-1.5.0/cmake/modules/FindCLAPACK.cmake	2010-10-15 23:06:08.000000000 +0200
@@ -0,0 +1,44 @@
+# - Try to find clapack library
+# Once done this will define
+#
+#  CLAPACK_FOUND - system has CLAPACK library
+#  CLAPACK_INCLUDE_DIR - the CLAPACK include directory
+#  CLAPACK_LIBRARY - the marblewidget library
+#
+#  copyright 2008 by Patrick Spendrin <ps_ml@gmx.de>
+#  copyright 2010 by Andreas K. Huettel <mail@akhuettel.de>
+#  use this file as you like
+#
+
+if(CLAPACK_INCLUDE_DIR AND CLAPACK_LIBRARY)
+
+  # Already in cache
+  set(CLAPACK_FOUND TRUE)
+
+else(CLAPACK_INCLUDE_DIR AND CLAPACK_LIBRARY)
+
+  find_path(CLAPACK_INCLUDE_DIR clapack.h PATHS /usr/include/clapack NO_DEFAULT_PATH)
+  if(CLAPACK_INCLUDE_DIR)
+     message(STATUS "Found clapack includes: ${CLAPACK_INCLUDE_DIR}")
+  else(CLAPACK_INCLUDE_DIR)
+     find_path(CLAPACK_INCLUDE_DIR clapack.h PATHS /usr/include/clapack)
+     if(CLAPACK_INCLUDE_DIR)
+        message(STATUS "Found clapack includes: ${CLAPACK_INCLUDE_DIR}")
+     endif(CLAPACK_INCLUDE_DIR)
+  endif(CLAPACK_INCLUDE_DIR)
+
+  find_library(CLAPACK_LIBRARY clapack)
+  if(CLAPACK_LIBRARY)
+      message(STATUS "Found clapack library: ${CLAPACK_LIBRARY}")
+  endif(CLAPACK_LIBRARY)
+
+  if(CLAPACK_INCLUDE_DIR AND CLAPACK_LIBRARY)
+    set(CLAPACK_FOUND TRUE)
+  endif(CLAPACK_INCLUDE_DIR AND CLAPACK_LIBRARY)
+
+  if(NOT CLAPACK_FOUND)
+      message(STATUS "Could NOT find any working clapack installation")
+  endif(NOT CLAPACK_FOUND)
+
+  mark_as_advanced(CLAPACK_INCLUDE_DIR CLAPACK_LIBRARY)
+endif(CLAPACK_INCLUDE_DIR AND CLAPACK_LIBRARY)
diff -r -u -N digikam-1.5.0-1-docs/cmake/modules/FindPGF.cmake digikam-1.5.0/cmake/modules/FindPGF.cmake
--- digikam-1.5.0-1-docs/cmake/modules/FindPGF.cmake	1970-01-01 01:00:00.000000000 +0100
+++ digikam-1.5.0/cmake/modules/FindPGF.cmake	2010-10-15 23:05:52.000000000 +0200
@@ -0,0 +1,15 @@
+# - Try to find libpgf
+# Once done this will define
+#
+#  PGF_FOUND - system has libgf
+#  PGF_INCLUDE_DIRS - the libpgf include directory
+#  PGF_LIBRARIES - Link these to use libpgf
+
+# PKG-CONFIG is required.
+INCLUDE(FindPkgConfig REQUIRED)
+
+IF(PKG_CONFIG_FOUND)
+	INCLUDE(FindPkgConfig)
+
+	PKG_CHECK_MODULES(PGF libpgf)
+ENDIF(PKG_CONFIG_FOUND)
diff -r -u -N digikam-1.5.0-1-docs/digikam/CMakeLists.txt digikam-1.5.0/digikam/CMakeLists.txt
--- digikam-1.5.0-1-docs/digikam/CMakeLists.txt	2010-10-10 21:37:09.000000000 +0200
+++ digikam-1.5.0/digikam/CMakeLists.txt	2010-10-15 23:06:08.000000000 +0200
@@ -53,8 +53,6 @@
                      # specific libs and utilities
                      ${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/lprof
                      ${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/sqlite2
-                     ${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/libpgf
-                     ${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/clapack
                      ${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/cimg
                      ${CMAKE_CURRENT_SOURCE_DIR}/../libs/themeengine
                      ${CMAKE_CURRENT_SOURCE_DIR}/../utilities/kipiiface
@@ -94,13 +92,29 @@
                      ${TIFF_INCLUDE_DIR}
                    )
 
-# Shared libdigikamcore ################################################################
+IF(PGF_FOUND)
+   INCLUDE_DIRECTORIES(${PGF_INCLUDE_DIRS})
+ELSE(PGF_FOUND)
+   INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/libpgf)
+ENDIF(PGF_FOUND)
+
+IF(CLAPACK_FOUND)
+   INCLUDE_DIRECTORIES(${CLAPACK_INCLUDE_DIR})
+ELSE(CLAPACK_FOUND)
+   INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../libs/3rdparty/clapack)
+ENDIF(CLAPACK_FOUND)
 
-# Disable Clapack C code warnings.
-SET_SOURCE_FILES_PROPERTIES(${libclapack_SRCS} PROPERTIES COMPILE_FLAGS "-w")
+# Shared libdigikamcore ################################################################
 
-# Disable libpgf warnings.
-SET_SOURCE_FILES_PROPERTIES(${libpgf_SRCS} PROPERTIES COMPILE_FLAGS "-w")
+IF(NOT CLAPACK_FOUND)
+   # Disable Clapack C code warnings.
+   SET_SOURCE_FILES_PROPERTIES(${libclapack_SRCS} PROPERTIES COMPILE_FLAGS "-w")
+ENDIF(NOT CLAPACK_FOUND)
+
+IF(NOT PGF_FOUND)
+   # Disable libpgf warnings.
+   SET_SOURCE_FILES_PROPERTIES(${libpgf_SRCS} PROPERTIES COMPILE_FLAGS "-w")
+ENDIF(NOT PGF_FOUND)
 
 # Disable liblqr C code warnings.
 SET_SOURCE_FILES_PROPERTIES(${liblqr_SRCS} PROPERTIES COMPILE_FLAGS "-w")
@@ -187,10 +201,18 @@
                       ${KIPI_LIBRARIES}
               )
 
+IF(PGF_FOUND)
+   TARGET_LINK_LIBRARIES(digikamcore ${PGF_LIBRARIES})
+ENDIF(PGF_FOUND)
+
 IF(MARBLEWIDGET_FOUND)
     TARGET_LINK_LIBRARIES(digikamcore ${LIBMARBLEWIDGET_LIBRARY})
 ENDIF(MARBLEWIDGET_FOUND)
 
+IF(CLAPACK_FOUND)
+   TARGET_LINK_LIBRARIES(digikamcore ${CLAPACK_LIBRARY})
+ENDIF(CLAPACK_FOUND)
+
 IF(Q_WS_X11)
     TARGET_LINK_LIBRARIES(digikamcore ${X11_LIBRARIES})
 ENDIF(Q_WS_X11)
@@ -241,6 +263,10 @@
                       ${QT_QTSQL_LIBRARY}
                      )
 
+IF(PGF_FOUND)
+   TARGET_LINK_LIBRARIES(digikamdatabase ${PGF_LIBRARIES})
+ENDIF(PGF_FOUND)
+
 SET_TARGET_PROPERTIES(digikamdatabase PROPERTIES VERSION 1.0.0 SOVERSION 1 )
 INSTALL(TARGETS digikamdatabase ${INSTALL_TARGETS_DEFAULT_ARGS} )
 
@@ -339,6 +365,10 @@
   TARGET_LINK_LIBRARIES(digikam ${LIBMARBLEWIDGET_LIBRARY})
 ENDIF(MARBLEWIDGET_FOUND)
 
+IF(CLAPACK_FOUND)
+   TARGET_LINK_LIBRARIES(digikam ${CLAPACK_LIBRARY})
+ENDIF(CLAPACK_FOUND)
+
 INSTALL(TARGETS digikam ${INSTALL_TARGETS_DEFAULT_ARGS})
 
 # Others Files to install #######################################################
diff -r -u -N digikam-1.5.0-1-docs/libs/CMakeLists.txt digikam-1.5.0/libs/CMakeLists.txt
--- digikam-1.5.0-1-docs/libs/CMakeLists.txt	2010-10-10 21:36:54.000000000 +0200
+++ digikam-1.5.0/libs/CMakeLists.txt	2010-10-15 23:05:52.000000000 +0200
@@ -21,6 +21,10 @@
                      ${JASPER_INCLUDE_DIR}
                    )
 
+IF(PGF_FOUND)
+   INCLUDE_DIRECTORIES(${PGF_INCLUDE_DIRS})
+ENDIF(PGF_FOUND)
+
 ADD_SUBDIRECTORY( histogram )
 ADD_SUBDIRECTORY( dmetadata )
 ADD_SUBDIRECTORY( dimg )
diff -r -u -N digikam-1.5.0-1-docs/showfoto/CMakeLists.txt digikam-1.5.0/showfoto/CMakeLists.txt
--- digikam-1.5.0-1-docs/showfoto/CMakeLists.txt	2010-10-10 21:37:10.000000000 +0200
+++ digikam-1.5.0/showfoto/CMakeLists.txt	2010-10-15 23:06:09.000000000 +0200
@@ -65,6 +65,10 @@
 
 KDE4_ADD_EXECUTABLE(showfoto ${showfoto_SRCS})
 
+IF(CLAPACK_FOUND)
+   TARGET_LINK_LIBRARIES(showfoto ${CLAPACK_LIBRARY})
+ENDIF(CLAPACK_FOUND)
+
 TARGET_LINK_LIBRARIES(showfoto
                       digikamcore
                       ${KEXIV2_LIBRARIES}
