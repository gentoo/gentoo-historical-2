--- rescue/linux/Makefile.in	2004-08-31 16:05:50.000000000 -0500
+++ rescue/linux-fixed/Makefile.in	2005-06-20 08:07:50.000000000 -0500
@@ -1,12 +1,41 @@
-
-all:
+topdir = @BUILD_DIR@
+thisdir = $(topdir)/rescue/linux
+sysconfdir = @sysconfdir@
+
+MKDIR = $(topdir)/autoconf/mkinstalldirs
+CP = @CP@
+RM = @RM@
+RMF = "$(RM) -f"
+
+all: Makefile
+	(cd $(topdir)/src/filed; \
+	$(MAKE) static-bacula-fd; \
+	cd $(thisdir))
 
 install:
+	$(MKDIR) -m 750 $(DESTDIR)$(sysconfdir)/rescue/cdrom;
+	$(CP) -R $(thisdir)/cdrom/* \
+		$(DESTDIR)$(sysconfdir)/rescue/cdrom/
+	$(MKDIR) -m 750 $(DESTDIR)$(sysconfdir)/rescue/cdrom/bin
+	$(CP) -R $(topdir)/src/filed/static-bacula-fd \
+		$(DESTDIR)$(sysconfdir)/rescue/cdrom/bin/bacula-fd
+	$(MKDIR) $(DESTDIR)$(sysconfdir)/rescue/floppy
+	$(CP) -R $(thisdir)/floppy/* \
+		$(DESTDIR)$(sysconfdir)/rescue/floppy/
+	$(CP) -R $(topdir)/src/filed/static-bacula-fd \
+		$(DESTDIR)$(sysconfdir)/rescue/floppy/bacula-fd
+	chmod 754 $(DESTDIR)$(sysconfdir)/rescue/cdrom/bin/bacula-fd \
+		$(DESTDIR)$(sysconfdir)/rescue/floppy/bacula-fd
 
 uninstall:
+	$(RMF) -r $(DESTDIR)$(sysconfdir)/rescue
 
 clean:
 
 distclean:
 
 depend:
+
+Makefile: Makefile.in
+	cd $(topdir) \
+		&& CONFIG_FILES=$(thisdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
