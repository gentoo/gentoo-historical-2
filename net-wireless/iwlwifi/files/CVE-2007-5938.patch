--- origin/iwl3945-base.c	2007-11-18 19:34:15.000000000 -0800
+++ origin/iwl3945-base.c	2007-11-18 19:37:06.000000000 -0800
@@ -2908,6 +2908,11 @@
 
 	hw = iwl3945_get_hw_mode(priv, priv->phymode);
 
+	if (!hw) {
+		printk(KERN_CRIT DRV_NAME " Failed to set rate: Unable to get hw mode");
+		return;
+	}
+
 	priv->active_rate = 0;
 	priv->active_rate_basic = 0;
 
--- origin/iwl4965-base.c	2007-11-18 19:34:19.000000000 -0800
+++ origin/iwl4965-base.c	2007-11-18 19:38:16.000000000 -0800
@@ -3002,6 +3002,11 @@
 
 	hw = iwl4965_get_hw_mode(priv, priv->phymode);
 
+	if (!hw) {
+		printk(KERN_CRIT DRV_NAME " Failed to set rate: Unable to get hw mode");
+		return;
+	}
+
 	priv->active_rate = 0;
 	priv->active_rate_basic = 0;
 
