diff -urp ipw2100-1.1.0/ipw2100.c ipw2100-1.1.0-suspend2/ipw2100.c
--- ipw2100-1.1.0/ipw2100.c	2005-05-05 21:35:56.000000000 +0200
+++ ipw2100-1.1.0-suspend2/ipw2100.c	2005-05-05 21:41:05.000000000 +0200
@@ -6401,7 +6401,7 @@ static struct net_device *ipw2100_alloc_
 	INIT_STAT(&priv->fw_pend_stat);
 
 
-#ifdef CONFIG_SOFTWARE_SUSPEND2
+#ifdef CONFIG_SOFTWARE_SUSPEND2_BUILTIN
 	priv->workqueue = create_workqueue(DRV_NAME, 0);
 #else
 	priv->workqueue = create_workqueue(DRV_NAME);
diff -urp ipw2100-1.1.0/ipw2100.h ipw2100-1.1.0-suspend2/ipw2100.h
--- ipw2100-1.1.0/ipw2100.h	2005-05-05 21:35:56.000000000 +0200
+++ ipw2100-1.1.0-suspend2/ipw2100.h	2005-05-05 21:40:30.000000000 +0200
@@ -57,6 +57,13 @@ typedef void irqreturn_t;
 #define IW_QUAL_NOISE_INVALID 0x40
 #endif
 
+#if !defined(CONFIG_SOFTWARE_SUSPEND2_BUILTIN) && \
+	(defined(CONFIG_SUSPEND2) || \
+	defined(CONFIG_SOFTWARE_SUSPEND2) ||		\
+	defined(CONFIG_SOFTWARE_SUSPEND2_MODULE))
+#define CONFIG_SOFTWARE_SUSPEND2_BUILTIN
+#endif
+
 #if ( LINUX_VERSION_CODE < KERNEL_VERSION(2,6,5) )
 #define pci_dma_sync_single_for_cpu	pci_dma_sync_single
 #define pci_dma_sync_single_for_device	pci_dma_sync_single
