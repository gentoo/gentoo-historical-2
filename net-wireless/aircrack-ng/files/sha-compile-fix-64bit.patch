Index: src/sha1-sse2.S
===================================================================
--- src/sha1-sse2.S	(revision 1365)
+++ src/sha1-sse2.S	(working copy)
@@ -413,11 +413,16 @@
 		ret
 do_cpuid:
 #endif   	
-		
+
+#ifdef __x86_64__
+		push    %rbx
+		push    %rcx
+		push    %rdx
+#else
 		push	%ebx
 		push	%ecx
 		push	%edx
-		
+#endif		
    		movl	$1, %eax
    		cpuid
    		
@@ -438,9 +443,15 @@
 		movl	$0, %eax
 
 cpuid_exit:
+#ifdef __x86_64__
+		pop		%rdx
+		pop		%rcx
+		pop		%rbx
+#else
 		pop		%edx
 		pop		%ecx
 		pop		%ebx
+#endif
 		ret
 #endif
 
