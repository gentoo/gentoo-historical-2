--- ndiswrapper-1.46/driver/Makefile.org	2007-06-12 13:08:47.000000000 +0200
+++ ndiswrapper-1.46/driver/Makefile	2007-06-12 13:12:20.000000000 +0200
@@ -232,12 +232,12 @@
 
 compat.h: $(KBUILD)/include/linux/version.h
 	@echo "/* this file is automatically generated */" > $@
-	@if ! grep -qw kzalloc $(KBUILD)/include/linux/*.h; then \
+	@if ! grep -qw kzalloc $(KSRC)/include/linux/*.h; then \
 		echo "static inline void *kzalloc(size_t size, unsigned long flags)"; \
 		echo "{ void *ret = kmalloc(size, flags);"; \
 		echo "if (ret) memset(ret, 0, size); return ret;}"; \
 	fi >> $@
-	@if ! grep -qw netif_tx_lock $(KBUILD)/include/linux/netdevice.h; then \
+	@if ! grep -qw netif_tx_lock $(KSRC)/include/linux/netdevice.h; then \
 		echo "static inline void netif_tx_lock(struct net_device *dev)"; \
 		echo "{ spin_lock(&dev->xmit_lock); }"; \
 		echo "static inline void netif_tx_unlock(struct net_device *dev)"; \
@@ -248,14 +248,14 @@
 		echo "{ spin_unlock_bh(&dev->xmit_lock); }"; \
 	fi >> $@
 	@if ! grep -qw pci_set_consistent_dma_mask \
-			   $(KBUILD)/include/linux/pci.h; then \
+			   $(KSRC)/include/linux/pci.h; then \
 		echo "static inline int pci_set_consistent_dma_mask" ; \
 		echo "(struct pci_dev *dev, u64 mask) { return 0; }" ; \
 	fi >> $@
-	@if ! grep -qw create_workqueue $(KBUILD)/include/linux/*.h; then \
+	@if ! grep -qw create_workqueue $(KSRC)/include/linux/*.h; then \
 		echo "#define WRAP_WQ 1"; \
 	fi >> $@
-	@if ! grep -qw create_workqueue $(KBUILD)/include/linux/*.h; then \
+	@if ! grep -qw create_workqueue $(KSRC)/include/linux/*.h; then \
 		echo "#define WRAP_WQ 1"; \
 	fi >> $@
 
