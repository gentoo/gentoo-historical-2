Index: floatws/floatws.c
===================================================================
RCS file: /share/cvsrepos/ion/floatws/floatws.c,v
retrieving revision 1.49
diff -r1.49 floatws.c
56,57d55
< 	XReparentWindow(wglobal.dpy, ws->dummywin, parent->win, geom->x, geom->h);
< 					
59c57,58
< 	region_set_parent((WRegion*)ws, (WRegion*)parent);
---
> 	XReparentWindow(wglobal.dpy, ws->dummywin, parent->win, geom->x, geom->h);
> 	region_attach_parent((WRegion*)ws, (WRegion*)parent);
Index: ioncore/clientwin.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/clientwin.c,v
retrieving revision 1.99
diff -r1.99 clientwin.c
908c908,909
< 	if(np!=NULL)
---
> 	if(np!=NULL){
> 		region_detach_parent((WRegion*)cwin);
909a911,912
> 		region_attach_parent((WRegion*)cwin, (WRegion*)np);
> 	}
951,953d953
< 	region_detach_parent((WRegion*)cwin);
< 	region_set_parent((WRegion*)cwin, (WRegion*)par);
< 	
955d954
< 	
Index: ioncore/genframe.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/genframe.c,v
retrieving revision 1.44
diff -r1.44 genframe.c
339a340
> 		region_detach_parent((WRegion*)genframe);
342a344
> 		region_attach_parent((WRegion*)genframe, (WRegion*)parent);
394,395d395
< 	region_detach_parent((WRegion*)genframe);
< 	region_set_parent((WRegion*)genframe, (WRegion*)parent);
397d396
< 	
Index: ioncore/mplex.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/mplex.c,v
retrieving revision 1.15
diff -r1.15 mplex.c
168a169
> 		region_detach_parent((WRegion*)mplex);
171a173
> 		region_attach_parent((WRegion*)mplex, (WRegion*)parent);
192,193d193
< 	region_detach_parent((WRegion*)mplex);
< 	region_set_parent((WRegion*)mplex, (WRegion*)parent);
195d194
< 	
Index: ioncore/region.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/region.c,v
retrieving revision 1.63
diff -r1.63 region.c
55,63d54
< 	if(parent!=NULL){
< 		reg->rootwin=parent->rootwin;
< 		/*link_child(parent, reg);*/
< 		region_set_parent(reg, parent);
< 	}else{
< 		assert(WOBJ_IS(reg, WRootWin) || WOBJ_IS(reg, WScreen));
< 		reg->rootwin=NULL;
< 	}
< 	
71,73d61
< 	if(!WOBJ_IS(reg, WClientWin))
< 		region_set_name(reg, WOBJ_TYPESTR(reg));
< 
83a72,83
> 	
> 	if(parent!=NULL){
> 		reg->rootwin=parent->rootwin;
> 		/*link_child(parent, reg);*/
> 		region_attach_parent(reg, parent);
> 	}else{
> 		assert(WOBJ_IS(reg, WRootWin) || WOBJ_IS(reg, WScreen));
> 		reg->rootwin=NULL;
> 	}
> 	
> 	if(!WOBJ_IS(reg, WClientWin))
> 		region_set_name(reg, WOBJ_TYPESTR(reg));
652d651
< 	/*link_child(par, reg);*/
654a654,660
> }
> 
> 
> void region_attach_parent(WRegion *reg, WRegion *parent)
> {
> 	region_set_parent(reg, parent);
> 	region_raise(reg);
Index: ioncore/region.h
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/region.h,v
retrieving revision 1.40
diff -r1.40 region.h
151a152
> extern void region_attach_parent(WRegion *reg, WRegion *par);
Index: ioncore/stacking.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/stacking.c,v
retrieving revision 1.6
diff -r1.6 stacking.c
84a85,86
> 	
> 	D(fprintf(stderr, "keep_on_top: %p\n", reg));
169a172,173
> 
> 	D(fprintf(stderr, "raise: %p\n", reg));
178a183
> 			D(fprintf(stderr, "below %p\n", par->keep_on_top_list));
182a188,189
> 	}else{
> 		D(fprintf(stderr, "kept on top\n"));
183a191
> 		
205a214,215
> 
> 	D(fprintf(stderr, "lower: %p\n", reg));
Index: ioncore/window.c
===================================================================
RCS file: /share/cvsrepos/ion/ioncore/window.c,v
retrieving revision 1.24
diff -r1.24 window.c
67,68d66
< 	region_init(&(wwin->region), (WRegion*)parent, geom);
< 	
72a71,72
> 	region_init(&(wwin->region), (WRegion*)parent, geom);
> 	
143c143
< static void reparent_or_fit_window(WWindow *wwin, Window parwin,
---
> static void reparent_or_fit_window(WWindow *wwin, WWindow *parent,
149,150c149,151
< 	if(parwin!=None){
< 		XReparentWindow(wglobal.dpy, wwin->win, parwin, geom->x, geom->y);
---
> 	if(parent!=NULL){
> 		region_detach_parent((WRegion*)wwin);
> 		XReparentWindow(wglobal.dpy, wwin->win, parent->win, geom->x, geom->y);
151a153
> 		region_attach_parent((WRegion*)wwin, (WRegion*)parent);
168,171c170
< 	
< 	region_detach((WRegion*)wwin);
< 	region_set_parent((WRegion*)wwin, (WRegion*)parent);
< 	reparent_or_fit_window(wwin, parent->win, geom);
---
> 	reparent_or_fit_window(wwin, parent, geom);
178c177
< 	reparent_or_fit_window(wwin, None, geom);
---
> 	reparent_or_fit_window(wwin, NULL, geom);
Index: ionws/ionws.c
===================================================================
RCS file: /share/cvsrepos/ion/ionws/ionws.c,v
retrieving revision 1.24
diff -r1.24 ionws.c
62c62
< 	region_set_parent((WRegion*)ws, (WRegion*)parent);
---
> 	region_attach_parent((WRegion*)ws, (WRegion*)parent);
