#!/bin/bash
. /sbin/functions.sh

ROOTDIR="/var/tmp/portage"
EVIDENCE_VER=0.9.3
DATESTAMP="`date +%Y%m%d`"
HEAD="${ROOTDIR}/e17-HEAD-${DATESTAMP}"
SPLIT="${ROOTDIR}/e17-SPLIT-${DATESTAMP}"
MISC="${ROOTDIR}/e17-MISC-${DATESTAMP}"
COMBINE="${ROOTDIR}/e17"

ebegin "Checking ${HEAD}"
if [ ! -e ${HEAD} ] ; then
	mkdir ${HEAD} && cd ${HEAD}
	cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/enlightenment co -rHEAD e17
fi
H="${HEAD}/e17"
eend 0

ebegin "Checking ${SPLIT}"
if [ ! -e ${SPLIT} ] ; then
	mkdir ${SPLIT} && cd ${SPLIT}
	cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/enlightenment co -rSPLIT e17
fi
S="${SPLIT}/e17"
eend 0

ebegin "Checking ${MISC}"
if [ ! -e ${MISC} ] ; then
	mkdir ${MISC} && cd ${MISC}
	pwd && ls
	cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/enlightenment co misc/elogin
	cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/enlightenment co misc/enotes
	cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/evidence co evidence
	mv evidence misc/
fi
M="${MISC}"
eend 0

ebegin "Making ${COMBINE}"
rm -rf ${COMBINE}
mkdir ${COMBINE}/{libs,apps,misc} -p
C=${COMBINE}
eend 0

ebegin "Making ${COMBINE}/libs"
cp -rf ${H}/libs/imlib2		${C}/libs/
cp -rf ${H}/libs/edb		${C}/libs/
cp -rf ${H}/libs/eet		${C}/libs/
cp -rf ${H}/libs/imlib2_loaders	${C}/libs/
cp -rf ${H}/libs/evas		${C}/libs/
cp -rf ${H}/libs/ewd		${C}/libs/ #hax
cp -rf ${H}/libs/ebits		${C}/libs/ #hax
cp -rf ${H}/libs/ecore		${C}/libs/
cp -rf ${H}/libs/estyle		${C}/libs/
cp -rf ${H}/libs/etox		${C}/libs/
cp -rf ${H}/libs/ebg		${C}/libs/
cp -rf ${H}/libs/ewl		${C}/libs/
cp -rf ${H}/libs/eprog		${C}/libs/
eend 0

ebegin "Making ${COMBINE}/apps"
cp -rf ${H}/apps/entice		${C}/apps/
cp -rf ${H}/apps/esmall		${C}/apps/
cp -rf ${S}/apps/ewidgetd	${C}/apps/
cp -rf ${S}/apps/essence	${C}/apps/
cp -rf ${S}/apps/elicit		${C}/apps/
cp -rf ${S}/apps/efileinfo	${C}/apps/
cp -rf ${H}/apps/imlib2_tools	${C}/apps/ #hax
cp -rf ${H}/apps/etcher		${C}/apps/
cp -rf ${H}/apps/ebony		${C}/apps/
cp -rf ${H}/apps/med		${C}/apps/
cp -rf ${H}/apps/efsd		${C}/apps/
cp -rf ${H}/apps/ebindings	${C}/apps/ #hax
cp -rf ${H}/apps/entrance	${C}/apps/
cp -rf ${H}/apps/e		${C}/apps/
eend 0

ebegin "Making ${COMBINE}/misc"
cp -rf ${M}/misc/elogin		${C}/misc/
cp -rf ${M}/misc/enotes		${C}/misc/
cp -rf ${M}/misc/evidence	${C}/misc/
eend 0

ebegin "Packing it all up"
cd ${ROOTDIR}
rm -f enlightenment-cvs-0.17.${DATESTAMP}.tar.bz2
tar -jcf enlightenment-cvs-0.17.${DATESTAMP}.tar.bz2 e17
mv enlightenment-cvs-0.17.${DATESTAMP}.tar.bz2 /usr/portage/distfiles/
eend $?
