diff -ru slmodem-2.9.8.orig/Makefile slmodem-2.9.8/Makefile
--- slmodem-2.9.8.orig/Makefile	2004-02-03 02:13:43.000000000 +0930
+++ slmodem-2.9.8/Makefile	2004-06-20 14:53:10.478602760 +0930
@@ -13,7 +13,9 @@
 #
 ###########################################################################
 
-KERNEL_DIR:=/lib/modules/$(shell uname -r)/build
+KERNEL_VER:=$(shell uname -r)
+KERNEL_DIR:=/lib/modules/$(KERNEL_VER)/build
+DESTDIR = ${D}
 
 # tools
 INSTALL:=install
@@ -25,6 +27,7 @@
 
 install: all install-drivers
 	$(INSTALL) -D -m 755 modem/slmodemd ${DESTDIR}/usr/sbin/slmodemd
+	$(INSTALL) -D -m 755 modem/modem_test ${DESTDIR}/usr/sbin/modem_test
 	$(RM) -rf ${DESTDIR}/var/lib/slmodem
 	$(INSTALL) -d -D -m 755 ${DESTDIR}/var/lib/slmodem
 
diff -ru slmodem-2.9.8.orig/drivers/Makefile slmodem-2.9.8/drivers/Makefile
--- slmodem-2.9.8.orig/drivers/Makefile	2003-12-22 06:45:54.000000000 +0930
+++ slmodem-2.9.8/drivers/Makefile	2004-06-20 14:53:38.799297360 +0930
@@ -15,8 +15,11 @@
 
 #KBUILD_VERBOSE=1
 #export KBUILD_VERBOSE
+DESTDIR = ${D}
 
-KERNEL_DIR:=/lib/modules/$(shell uname -r)/build
+
+KERNEL_VER:=$(shell uname -r)
+KERNEL_DIR:=/lib/modules/$(KERNEL_VER)/build
 
 EXTRA_CFLAGS = -I$(obj) -I$(obj)/../modem
 
@@ -28,18 +31,18 @@
 ifndef KERNELRELEASE
 ifndef KERNEL_VER
 
-all install uninstall: kernel-ver
-	$(MAKE) $@ KERNEL_VER=$(shell ./kernel-ver)
+all install uninstall:
+	$(MAKE) $@ KERNEL_VER=$(shell uname -r)
 
-install: install-devices
-uninstall: remove-devices
+#install: install-devices
+#uninstall: remove-devices
 
-kernel-ver::
-	$(CC) -I$(KERNEL_DIR)/include -o $@ $@.c
+#kernel-ver::
+#	$(CC) -I$(KERNEL_DIR)/include -o $@ $@.c
 
 dep:
 clean:
-	$(RM) kernel-ver $(obj-m) $(obj-m:.o=.ko) *st7554.o amrmo_init.o sysdep_amr.o *.mod.* .*.cmd *~
+	$(RM) $(obj-m) $(obj-m:.o=.ko) *st7554.o amrmo_init.o sysdep_amr.o *.mod.* .*.cmd *~
 
 install-devices:
 	mkdir -p ${DESTDIR}/dev
@@ -60,7 +63,7 @@
 obj:=.
 module-dir:=${DESTDIR}/lib/modules/$(KERNEL_VER)/misc
 
-CFLAGS:= -Wall -pipe -O3 -fomit-frame-pointer -D__KERNEL__ -DMODULE -DEXPORT_SYMTAB -DMODVERSIONS --include $(KERNEL_DIR)/include/linux/modversions.h -I$(KERNEL_DIR)/include
+CFLAGS:= ${CFLAGS} -D__KERNEL__ -DMODULE -DEXPORT_SYMTAB -DMODVERSIONS --include $(KERNEL_DIR)/include/linux/modversions.h -I$(KERNEL_DIR)/include
 
 all: $(obj-m)
 
@@ -72,10 +75,10 @@
 install: uninstall-old
 	install -D -m 644 slamr.o $(module-dir)/slamr.o
 	install -D -m 644 slusb.o $(module-dir)/slusb.o
-	cp /etc/modules.conf /etc/modules.conf.slamr && \
-	    echo 'alias char-major-212 slamr' >> /etc/modules.conf && \
-	    echo 'alias char-major-213 slusb' >> /etc/modules.conf 
-	/sbin/depmod -a
+#	cp /etc/modules.conf /etc/modules.conf.slamr && \
+#	    echo 'alias char-major-212 slamr' >> /etc/modules.conf && \
+#	    echo 'alias char-major-213 slusb' >> /etc/modules.conf 
+#	/sbin/depmod -a
 uninstall:
 	/sbin/modprobe -r slamr slusb
 	cp /etc/modules.conf /etc/modules.conf.slamr && \
@@ -102,7 +105,7 @@
 install:
 	install -D -m 644 slamr.ko $(module-dir)/slamr.ko
 	install -D -m 644 slusb.ko $(module-dir)/slusb.ko
-	/sbin/depmod -a
+#	/sbin/depmod -a
 uninstall:
 	modprobe -r slamr ; echo -n
 	modprobe -r slusb ; echo -n
diff -ru slmodem-2.9.8.orig/modem/Makefile slmodem-2.9.8/modem/Makefile
--- slmodem-2.9.8.orig/modem/Makefile	2003-11-20 22:20:47.000000000 +0930
+++ slmodem-2.9.8/modem/Makefile	2004-06-20 14:51:29.458960080 +0930
@@ -13,10 +13,10 @@
 #
 ###########################################################################
 
-CC:= gcc
+CC:= ${CC}
 RM:= rm -f
 
-CFLAGS:= -Wall -g -O -I. -DCONFIG_DEBUG_MODEM
+CFLAGS:= ${CFLAGS} -I. -DCONFIG_DEBUG_MODEM
 
 
 modem-objs:= \
