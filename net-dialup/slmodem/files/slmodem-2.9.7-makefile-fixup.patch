diff -urN slmodem-2.9.7.old/Makefile slmodem-2.9.7/Makefile
--- slmodem-2.9.7.old/Makefile	2004-02-02 08:43:43.000000000 -0800
+++ slmodem-2.9.7/Makefile	2004-04-21 00:51:55.562017735 -0700
@@ -14,6 +14,7 @@
 ###########################################################################
 
 KERNEL_DIR:=/lib/modules/$(shell uname -r)/build
+DESTDIR = ${D}
 
 # tools
 INSTALL:=install
@@ -25,6 +26,7 @@
 
 install: all install-drivers
 	$(INSTALL) -D -m 755 modem/slmodemd ${DESTDIR}/usr/sbin/slmodemd
+	$(INSTALL) -D -m 755 modem/modem_test ${DESTDIR}/usr/sbin/modem_test
 	$(RM) -rf ${DESTDIR}/var/lib/slmodem
 	$(INSTALL) -d -D -m 755 ${DESTDIR}/var/lib/slmodem
 
diff -urN slmodem-2.9.7.old/drivers/Makefile slmodem-2.9.7/drivers/Makefile
--- slmodem-2.9.7.old/drivers/Makefile	2003-12-21 13:15:54.000000000 -0800
+++ slmodem-2.9.7/drivers/Makefile	2004-04-21 01:00:30.789187581 -0700
@@ -15,6 +15,7 @@
 
 #KBUILD_VERBOSE=1
 #export KBUILD_VERBOSE
+DESTDIR = ${D}
 
 KERNEL_DIR:=/lib/modules/$(shell uname -r)/build
 
@@ -28,18 +29,18 @@
 ifndef KERNELRELEASE
 ifndef KERNEL_VER
 
-all install uninstall: kernel-ver
-	$(MAKE) $@ KERNEL_VER=$(shell ./kernel-ver)
+all install uninstall:
+	$(MAKE) $@ KERNEL_VER=$(shell uname -r)
 
-install: install-devices
-uninstall: remove-devices
+#install: install-devices
+#uninstall: remove-devices
 
-kernel-ver::
-	$(CC) -I$(KERNEL_DIR)/include -o $@ $@.c
+#kernel-ver::
+#	$(CC) -I$(KERNEL_DIR)/include -o $@ $@.c
 
 dep:
 clean:
-	$(RM) kernel-ver $(obj-m) $(obj-m:.o=.ko) *st7554.o amrmo_init.o sysdep_amr.o *.mod.* .*.cmd *~
+	$(RM) $(obj-m) $(obj-m:.o=.ko) *st7554.o amrmo_init.o sysdep_amr.o *.mod.* .*.cmd *~
 
 install-devices:
 	mkdir -p ${DESTDIR}/dev
@@ -60,7 +61,7 @@
 obj:=.
 module-dir:=${DESTDIR}/lib/modules/$(KERNEL_VER)/misc
 
-CFLAGS:= -Wall -pipe -O3 -fomit-frame-pointer -D__KERNEL__ -DMODULE -DEXPORT_SYMTAB -DMODVERSIONS --include $(KERNEL_DIR)/include/linux/modversions.h -I$(KERNEL_DIR)/include
+CFLAGS:= ${CFLAGS} -D__KERNEL__ -DMODULE -DEXPORT_SYMTAB -DMODVERSIONS --include $(KERNEL_DIR)/include/linux/modversions.h -I$(KERNEL_DIR)/include
 
 all: $(obj-m)
 
@@ -72,10 +73,10 @@
 install: uninstall-old
 	install -D -m 644 slamr.o $(module-dir)/slamr.o
 	install -D -m 644 slusb.o $(module-dir)/slusb.o
-	cp /etc/modules.conf /etc/modules.conf.slamr && \
-	    echo 'alias char-major-212 slamr' >> /etc/modules.conf && \
-	    echo 'alias char-major-213 slusb' >> /etc/modules.conf 
-	/sbin/depmod -a
+#	cp /etc/modules.conf /etc/modules.conf.slamr && \
+#	    echo 'alias char-major-212 slamr' >> /etc/modules.conf && \
+#	    echo 'alias char-major-213 slusb' >> /etc/modules.conf 
+#	/sbin/depmod -a
 uninstall:
 	/sbin/modprobe -r slamr slusb
 	cp /etc/modules.conf /etc/modules.conf.slamr && \
@@ -102,7 +103,7 @@
 install:
 	install -D -m 644 slamr.ko $(module-dir)/slamr.ko
 	install -D -m 644 slusb.ko $(module-dir)/slusb.ko
-	/sbin/depmod -a
+#	/sbin/depmod -a
 uninstall:
 	modprobe -r slamr ; echo -n
 	modprobe -r slusb ; echo -n
diff -urN slmodem-2.9.7.old/modem/Makefile slmodem-2.9.7/modem/Makefile
--- slmodem-2.9.7.old/modem/Makefile	2003-11-20 04:50:47.000000000 -0800
+++ slmodem-2.9.7/modem/Makefile	2004-04-21 00:45:34.215271352 -0700
@@ -13,10 +13,10 @@
 #
 ###########################################################################
 
-CC:= gcc
+CC:= ${CC}
 RM:= rm -f
 
-CFLAGS:= -Wall -g -O -I. -DCONFIG_DEBUG_MODEM
+CFLAGS:= ${CFLAGS} -I. -DCONFIG_DEBUG_MODEM
 
 
 modem-objs:= \
