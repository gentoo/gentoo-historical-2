--- configure.ac
+++ configure.ac
@@ -28,8 +28,23 @@
 
 dnl Gaim plugin check
 dnl =================
-AC_GAIM
-
+AC_ARG_ENABLE([gaim],
+	AC_HELP_STRING([--enable-gaim], [build gaim plugin]),,
+	[enable_gaim=no])
+
+if test x$enable_gaim = xyes ; then
+	PKG_CHECK_MODULES(GAIM, [gaim])
+
+	GAIM_LIBDIR=`pkg-config --variable=libdir gaim`
+	GAIM_DATADIR=`pkg-config --variable=datadir gaim`
+	GAIMPLUGIN=gaim-plugin
+
+	AC_SUBST(GAIM_CFLAGS)
+	AC_SUBST(GAIM_LIBS)
+	AC_SUBST(GAIM_LIBDIR)
+	AC_SUBST(GAIM_DATADIR)
+	AC_SUBST(GAIMPLUGIN)
+fi
 
 dnl Check for header files
 dnl ======================
@@ -118,7 +133,7 @@
 echo "    GDB Debugging......$enable_debug_gdb"
 echo "    Dmalloc Debugging..$enable_debug_mem"
 echo ""
-echo "    Gaim plugin........$have_gaim"
+echo "    Gaim plugin........$enable_gaim"
 echo ""
 echo "At the prompt type \"make\" to compile the GGZ gtk client"
 echo ""

--- gaim-plugin/Makefile.am
+++ gaim-plugin/Makefile.am
@@ -1,15 +1,15 @@
 ## Process this file with automake to produce Makefile.in
 #  $Id: ggz-gtk-client-0.0.13-gaim.patch,v 1.1 2006/10/11 15:35:26 nyhm Exp $
 
-plugindir = $(libdir)/gaim
+plugindir = @GAIM_LIBDIR@/gaim
 
 plugin_LTLIBRARIES = ggzgaim.la
 
 ggzgaim_la_SOURCES = simple.c
 ggzgaim_la_LDFLAGS = -module -avoid-version @GTK_CFLAGS@ $(LIBGGZ_LDFLAGS)
-ggzgaim_la_LIBADD = @GTK_LIBS@ $(LIB_GGZ)
+ggzgaim_la_LIBADD = @GTK_LIBS@ @GAIM_LIBS@ $(LIB_GGZ)
 
-AM_CPPFLAGS = @GTK_CFLAGS@ $(LIBGGZ_INCLUDES)
+AM_CPPFLAGS = @GTK_CFLAGS@ @GAIM_CFLAGS@ $(LIBGGZ_INCLUDES)
 
 EXTRA_DIST = ggz.xpm
 
