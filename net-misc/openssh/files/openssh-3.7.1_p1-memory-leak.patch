===================================================================
RCS file: /usr/OpenBSD/cvs/src/usr.bin/ssh/authfile.c,v
retrieving revision 1.54
retrieving revision 1.55
diff -u -r1.54 -r1.55
--- src/usr.bin/ssh/authfile.c	2003/05/24 09:30:39	1.54
+++ src/usr.bin/ssh/authfile.c	2003/09/18 07:56:05	1.55
@@ -143,6 +143,7 @@
 	fd = open(filename, O_WRONLY | O_CREAT | O_TRUNC, 0600);
 	if (fd < 0) {
 		error("open %s failed: %s.", filename, strerror(errno));
+		buffer_free(&encrypted);
 		return 0;
 	}
 	if (write(fd, buffer_ptr(&encrypted), buffer_len(&encrypted)) !=
