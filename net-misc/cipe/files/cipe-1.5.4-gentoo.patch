diff -Naur cipe-1.5.4.orig/cipe.texinfo cipe-1.5.4/cipe.texinfo
--- cipe-1.5.4.orig/cipe.texinfo	2003-08-13 13:32:44.000000000 +0900
+++ cipe-1.5.4/cipe.texinfo	2003-08-13 13:34:05.000000000 +0900
@@ -2,6 +2,9 @@
 @c %**start of header
 @setfilename cipe.info
 @settitle CIPE Manual
+@direntry
+* cipe: (cipe)cipe.        CIPE - encrypted IP over UDP tunneling
+@end direntry
 @footnotestyle end
 @paragraphindent asis
 @iftex
diff -Naur cipe-1.5.4.orig/conf/Makefile-obj.in cipe-1.5.4/conf/Makefile-obj.in
--- cipe-1.5.4.orig/conf/Makefile-obj.in	2000-12-17 03:27:35.000000000 +0900
+++ cipe-1.5.4/conf/Makefile-obj.in	2003-08-13 13:30:14.000000000 +0900
@@ -9,7 +9,9 @@
 
 # $Id: cipe-1.5.4-gentoo.patch,v 1.1 2003/11/28 04:43:23 pfeifer Exp $
 
-BINDIR:=/usr/local/sbin
+DESTDIR:=
+
+BINDIR:=/usr/sbin
 MODDIR:=/lib/modules/@KVERS@/misc
 
 MAKE=	   @MAKE@
@@ -41,10 +43,9 @@
 all::	$(MODULE) $(CIPED)
 
 install:: all
-	-mkdir -p $(MODDIR) $(BINDIR)
-	install -m 644 $(MODULE) $(MODDIR)
-	install -m 755 $(CIPED) $(BINDIR)
-	-depmod -a
+	-mkdir -p $(DESTDIR)$(MODDIR) $(DESTDIR)$(BINDIR)
+	install -m 644 $(MODULE) $(DESTDIR)$(MODDIR)
+	install -m 755 $(CIPED) $(DESTDIR)$(BINDIR)
 
 KOBJS:=	module.o device.o sock.o output.o encaps.o $(CCOBJS)
 OBJS:=	ciped.o options.o ioctl.o
diff -Naur cipe-1.5.4.orig/conf/Makefile-top.in cipe-1.5.4/conf/Makefile-top.in
--- cipe-1.5.4.orig/conf/Makefile-top.in	2002-05-30 20:49:18.000000000 +0900
+++ cipe-1.5.4/conf/Makefile-top.in	2003-08-13 13:30:14.000000000 +0900
@@ -9,7 +9,9 @@
 
 # $Id: cipe-1.5.4-gentoo.patch,v 1.1 2003/11/28 04:43:23 pfeifer Exp $
 
-INFODIR:=/usr/local/info
+DESTDIR:=
+
+INFODIR:=/usr/share/info
 
 SRC:=	cipe
 VERSION:=@VERSION@
@@ -97,8 +99,8 @@
 	(cd $(SRC); tar czf ../bf.tgz $(BF) bf.checksums)
 
 install:: cipe.info
-	-mkdir -p $(INFODIR)
-	install -m 644 cipe.info $(INFODIR)
+	-mkdir -p $(DESTDIR)$(INFODIR)
+	install -m 644 cipe.info $(DESTDIR)$(INFODIR)
 
 TAGS:
 	etags *.[hc] */*.[hc]
diff -Naur cipe-1.5.4.orig/pkcipe/Makefile.in cipe-1.5.4/pkcipe/Makefile.in
--- cipe-1.5.4.orig/pkcipe/Makefile.in	2000-12-17 03:27:35.000000000 +0900
+++ cipe-1.5.4/pkcipe/Makefile.in	2003-08-13 13:30:14.000000000 +0900
@@ -11,6 +11,8 @@
 
 lib:=../lib
 
+DESTDIR :=
+
 WARN	:= -Wno-strict-prototypes
 CC	:= @CC@
 CFLAGS	:= @CFLAGS@ $(WARN)
@@ -37,16 +39,12 @@
 	$(MAKE) -C $(lib) libcipe.a
 
 install: all
-	-mkdir -p $(bindir) $(sbindir)
-	$(INSTALL) -m 755 rsa-keygen $(bindir)
-	$(INSTALL) -m 755 pkcipe $(sbindir)
-	[ -d /etc/cipe/pk ] || mkdir -p /etc/cipe/pk
-	[ -d /var/run/cipe ] || mkdir -p /var/run/cipe
-	chmod 700 /etc/cipe /etc/cipe/pk /var/run/cipe
-	@if [ ! -f /etc/cipe/identity.priv ] ; then \
-		echo "*** Generating new identity (host) key ***" ;\
-		rsa-keygen /etc/cipe/identity ;\
-	fi
+	-mkdir -p $(DESTDIR)$(bindir) $(DESTDIR)$(sbindir)
+	$(INSTALL) -m 755 rsa-keygen $(DESTDIR)$(bindir)
+	$(INSTALL) -m 755 pkcipe $(DESTDIR)$(sbindir)
+	[ -d $(DESTDIR)/etc/cipe/pk ] || mkdir -p $(DESTDIR)/etc/cipe/pk
+	[ -d $(DESTDIR)/var/run/cipe ] || mkdir -p $(DESTDIR)/var/run/cipe
+	chmod 700 $(DESTDIR)/etc/cipe $(DESTDIR)/etc/cipe/pk $(DESTDIR)/var/run/cipe
 
 clean:
 	rm -f *.[oaisd] *.out core pkcipe
diff -Naur cipe-1.5.4.orig/samples/ip-down cipe-1.5.4/samples/ip-down
--- cipe-1.5.4.orig/samples/ip-down	2000-12-17 02:49:10.000000000 +0900
+++ cipe-1.5.4/samples/ip-down	2003-08-13 13:48:40.000000000 +0900
@@ -16,6 +16,12 @@
 # remove the daemon PID file
 rm -f /var/run/cipe/$6.pid /var/run/cipe/$1.pid
 
+# Gentoo ebuild addition. 
+if [ "${PIDFILE}" != "" ]; then
+    rm -f ${PIDFILE}
+fi
+# Gentoo ebuild addition ends.
+
 # If the system runs gated, tell it what has happened
 #gdc interface
 
diff -Naur cipe-1.5.4.orig/samples/ip-up cipe-1.5.4/samples/ip-up
--- cipe-1.5.4.orig/samples/ip-up	2000-12-17 02:49:10.000000000 +0900
+++ cipe-1.5.4/samples/ip-up	2003-08-13 13:48:44.000000000 +0900
@@ -35,6 +35,14 @@
 # Create/update PID file. Note: PKCIPE needs this.
 echo "$3 $1" >/var/run/cipe/${6:-$1}.pid
 
+# Gentoo ebuild addition. Store the pid in the file
+# specified by the start script, so that the stop script
+# knows who to kill 
+if [ "${PIDFILE}" != "" ]; then
+    echo "$3" >> ${PIDFILE}
+fi
+# Gentoo ebuild addition ends.
+
 # Trigger the key exchange procedure, useful when we're using SOCKS
 # This _must_ run delayed and in the background
 #(sleep 10; ping -c5 $5) &
