Index: libupnp-1.2.1a/upnp/src/api/upnpapi.c
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/api/upnpapi.c
+++ libupnp-1.2.1a/upnp/src/api/upnpapi.c
@@ -43,7 +43,7 @@
 #include "ThreadPool.h"
 #include "membuffer.h"
 #include <sys/ioctl.h>
-#include <linux/if.h>
+#include <net/if.h>
 #include <sys/utsname.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
Index: libupnp-1.2.1a/ixml/inc/ixml.h
===================================================================
--- libupnp-1.2.1a.orig/ixml/inc/ixml.h
+++ libupnp-1.2.1a/ixml/inc/ixml.h
@@ -34,7 +34,7 @@
 
 #include <stdio.h>
 #include <string.h>
-#include <malloc.h>
+#include <stdlib.h>
 #include <assert.h>
 
 typedef int BOOL;
Index: libupnp-1.2.1a/threadutil/inc/FreeList.h
===================================================================
--- libupnp-1.2.1a.orig/threadutil/inc/FreeList.h
+++ libupnp-1.2.1a/threadutil/inc/FreeList.h
@@ -36,8 +36,7 @@
 extern "C" {
 #endif
 
-#include <malloc.h>
-
+#include <stdlib.h>
 
 #include "ithread.h"
 #include <errno.h>
Index: libupnp-1.2.1a/threadutil/src/LinkedList.c
===================================================================
--- libupnp-1.2.1a.orig/threadutil/src/LinkedList.c
+++ libupnp-1.2.1a/threadutil/src/LinkedList.c
@@ -30,7 +30,7 @@
 ///////////////////////////////////////////////////////////////////////////
 
 #include "LinkedList.h"
-#include <malloc.h>
+#include <stdlib.h>
 #include <assert.h>
 
 static int
Index: libupnp-1.2.1a/threadutil/src/iasnprintf.c
===================================================================
--- libupnp-1.2.1a.orig/threadutil/src/iasnprintf.c
+++ libupnp-1.2.1a/threadutil/src/iasnprintf.c
@@ -31,7 +31,7 @@
 
 #include <stdarg.h>
 #include <assert.h>
-#include <malloc.h>
+#include <stdlib.h>
 #include <stdio.h>
 #include "iasnprintf.h"
 
Index: libupnp-1.2.1a/upnp/src/genlib/util/upnp_timeout.c
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/genlib/util/upnp_timeout.c
+++ libupnp-1.2.1a/upnp/src/genlib/util/upnp_timeout.c
@@ -35,7 +35,7 @@
 ************************************************************************/
 
 #include "upnp_timeout.h"
-#include <malloc.h>
+#include <stdlib.h>
 
 /************************************************************************
 *	Function :	free_upnp_timeout
Index: libupnp-1.2.1a/upnp/src/inc/client_table.h
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/inc/client_table.h
+++ libupnp-1.2.1a/upnp/src/inc/client_table.h
@@ -39,7 +39,7 @@ extern "C" {
 #include "upnp.h"
 
 #include <stdio.h>
-#include <malloc.h>
+#include <stdlib.h>
 #include <time.h>
 #include "uri.h"
 #include "service_table.h"
Index: libupnp-1.2.1a/upnp/src/inc/http_client.h
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/inc/http_client.h
+++ libupnp-1.2.1a/upnp/src/inc/http_client.h
@@ -40,7 +40,6 @@
 #include <fcntl.h>
 #include <string.h>
 #include <sys/types.h>
-#include <malloc.h>
 #include <time.h>
 #include <errno.h>
 #include <ctype.h>
Index: libupnp-1.2.1a/upnp/src/inc/service_table.h
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/inc/service_table.h
+++ libupnp-1.2.1a/upnp/src/inc/service_table.h
@@ -42,7 +42,7 @@ extern "C" {
 
 #include "upnp.h"
 #include <stdio.h>
-#include <malloc.h>
+#include <stdlib.h>
 #include <time.h>
 
 #define SID_SIZE  41
Index: libupnp-1.2.1a/upnp/src/inc/uri.h
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/inc/uri.h
+++ libupnp-1.2.1a/upnp/src/inc/uri.h
@@ -39,7 +39,6 @@ extern "C" {
 #include <fcntl.h>
 #include <string.h>
 #include <sys/types.h>
-#include <malloc.h>
 #include <time.h>
 #include <errno.h>
 #include <ctype.h>
Index: libupnp-1.2.1a/threadutil/src/ThreadPool.c
===================================================================
--- libupnp-1.2.1a.orig/threadutil/src/ThreadPool.c
+++ libupnp-1.2.1a/threadutil/src/ThreadPool.c
@@ -341,7 +341,11 @@ tp->stats.totalJobsLQ++; tp->stats.total
     struct timeb t;
 
     ftime( &t );
-    srand( ( unsigned int )t.millitm + ithread_get_current_thread_id(  ) );
+    srand( ( unsigned int )t.millitm
+#ifdef __GLIBC__
+        + ithread_get_current_thread_id(  )
+#endif
+        );
     }
 
 /****************************************************************************
Index: libupnp-1.2.1a/upnp/src/genlib/makefile
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/genlib/makefile
+++ libupnp-1.2.1a/upnp/src/genlib/makefile
@@ -29,7 +29,6 @@
 ##
 ###########################################################################
 
-MAKE = make
 SUBDIRS = miniserver service_table util client_table net net/http net/uri
 
 ifeq ($(DEBUG),1)
Index: libupnp-1.2.1a/upnp/src/genlib/net/sock.c
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/genlib/net/sock.c
+++ libupnp-1.2.1a/upnp/src/genlib/net/sock.c
@@ -48,6 +48,10 @@
 #include <unistd.h>
 #include "unixutil.h"
 
+#ifndef MSG_NOSIGNAL
+#define MSG_NOSIGNAL 0
+#endif
+
 /************************************************************************
 *	Function :	sock_init
 *
Index: libupnp-1.2.1a/upnp/src/inc/sysdep.h
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/inc/sysdep.h
+++ libupnp-1.2.1a/upnp/src/inc/sysdep.h
@@ -19,7 +19,6 @@
 
 #include <sys/types.h>
 #include <sys/time.h>
-#include <sys/sysinfo.h>
 #include "ithread.h"
 
 /* change to point to where MD5 .h's live */
Index: libupnp-1.2.1a/upnp/src/makefile
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/makefile
+++ libupnp-1.2.1a/upnp/src/makefile
@@ -29,7 +29,6 @@
 ##
 ###########################################################################
 
-MAKE = make
 ifdef TARGET
 DIR_PATH=$(TARGET)/
 CROSS=$(TARGET)-
Index: libupnp-1.2.1a/upnp/src/uuid/sysdep.c
===================================================================
--- libupnp-1.2.1a.orig/upnp/src/uuid/sysdep.c
+++ libupnp-1.2.1a/upnp/src/uuid/sysdep.c
@@ -144,7 +144,6 @@ get_random_info( char seed[16] )
 {
     MD5_CTX c;
     typedef struct {
-        struct sysinfo s;
         struct timeval t;
         char hostname[257];
     } randomness;
