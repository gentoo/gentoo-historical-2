--- freenx-server/trunk/nxnode	2007/02/04 01:05:52	313
+++ freenx-server/trunk/nxnode	2007/02/25 23:50:49	331
@@ -969,7 +969,7 @@
 	sync=$(getparam sync)
 	samba=$(getparam samba)
 	cups=$(getparam cups)
-	agent_server=$(getparam agent_server)
+	agent_server=$(getparam agent_server | sed 's/%3A/:/g')
 	agent_user=$(getparam agent_user)
 	agent_password=$(getparam agent_password)
 	agent_domain=$(getparam agent_domain)
@@ -991,13 +991,17 @@
 	rootless=0
 	# Its still the clients decision
 	[ "$ENABLE_ROOTLESS_MODE" = "1" ] &&  rootless=$(getparam rootless)
+
+	# Rootless fix from 2x nxserver 1.5.0
+	realtype=$type
+	[ "$type" = "unix-application" -o "$type" = "unix-default" ] && realtype="unix-desktop"
 	
 	# FreeNX specific variables
 	clientproto=$(getparam clientproto)
 	status=$(getparam status)
 	host=$(getparam host)
 
-	fullscreen=""
+	fullscreen=$(getparam fullscreen)
 	[ "$geometry" = "fullscreen" ] && fullscreen="1"
 
 	[ "$EXPORT_USERIP" = "1" ] && export NXUSERIP="$userip"
@@ -1061,7 +1065,7 @@
 	umask 0077
 
 cat << EOF > $USER_FAKE_HOME/.nx/C-$sess_id/options
-${kbtype:+kbtype=$kbtype,}${kbload:+kbload=$kbload,}${keymap:+keymap=$keymap,}${resize:+resize=$resize,}${CACHE}${IMAGES}${PACK}link=$link,nodelay=$nodelay,type=$type,cleanup=0,${ACCEPT}cookie=$proxy_cookie,id=$sess_id,samba=$samba,media=$media${sync:+,sync=$sync}${cups:+,cups=$cups}${keybd:+,keybd=$keybd}${http:+,http=$http}${rdpcolors:+,rdpcolors=$rdpcolors}${rdpcache:+,rdpcache=$rdpcache}${fullscreen:+,fullscreen=1}:$display
+${kbtype:+kbtype=$kbtype,}${kbload:+kbload=$kbload,}${keymap:+keymap=$keymap,}${resize:+resize=$resize,}${CACHE}${IMAGES}${PACK}link=$link,nodelay=$nodelay,type=$realtype,cleanup=0,${ACCEPT}cookie=$proxy_cookie,id=$sess_id,samba=$samba,media=$media${sync:+,sync=$sync}${cups:+,cups=$cups}${keybd:+,keybd=$keybd}${http:+,http=$http}${rdpcolors:+,rdpcolors=$rdpcolors}${rdpcache:+,rdpcache=$rdpcache}${fullscreen:+,fullscreen=1}:$display
 EOF
 	umask $OLD_UMASK
 #samba=$samba,
