--- asterisk-1.4.33.orig/main/channel.c	2010-05-24 20:37:55.000000000 +0100
+++ asterisk-1.4.33/main/channel.c	2010-06-23 15:06:44.949805705 +0100
@@ -1767,6 +1767,8 @@ int ast_activate_generator(struct ast_ch
 			chan->generator->release(chan, chan->generatordata);
 		chan->generatordata = NULL;
 	}
+
+	ast_prod(chan);
 	if (gen->alloc && !(chan->generatordata = gen->alloc(chan, params))) {
 		res = -1;
 	}
@@ -1776,8 +1778,6 @@ int ast_activate_generator(struct ast_ch
 	}
 	ast_channel_unlock(chan);
 
-	ast_prod(chan);
-
 	return res;
 }
 
