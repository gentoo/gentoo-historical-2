--- asterisk-1.4.33.orig/codecs/gsm/Makefile	2010-03-16 20:47:15.000000000 +0000
+++ asterisk-1.4.33/codecs/gsm/Makefile	2010-06-20 18:21:56.576515592 +0100
@@ -37,30 +37,6 @@
 ######### ppro's, etc, as well as the AMD K6 and K7.  The compile will
 ######### probably require gcc. 
 
-ifeq (,$(findstring $(shell uname -s),Darwin SunOS))
-  ifeq (,$(findstring $(PROC),x86_64 amd64 ultrasparc sparc64 arm armv5b armeb hppa2.0 ppc powerpc ppc64 ia64 s390 bfin mipsel mips))
-    ifeq (,$(findstring $(shell uname -m),ppc ppc64 alpha armv4l s390))
-      OPTIMIZE+=-march=$(PROC)
-    endif
-  endif
-else
-  ifneq (,$(findstring $(OSARCH),Darwin))
-    ifeq ($(shell /usr/bin/sw_vers -productVersion | cut -c1-4),10.6)
-      # Snow Leopard reports i386, even though it's really x86_64
-      OPTIMIZE+=-mtune=native
-    endif
-  endif
-endif
-
-#The problem with sparc is the best stuff is in newer versions of gcc (post 3.0) only.
-#This works for even old (2.96) versions of gcc and provides a small boost either way.
-#A ultrasparc cpu is really v9 but the stock debian stable 3.0 gcc doesn't support it.
-#So we go lowest common available by gcc and go a step down, still a step up from
-#the default as we now have a better instruction set to work with. - Belgarath
-ifeq ($(PROC),ultrasparc)
-OPTIMIZE+=-mcpu=v8 -mtune=$(PROC) -O3 
-endif
-
 PG =
 #PG = -g -pg
 ######### Profiling flags.  If you don't know what that means, leave it blank.
@@ -217,10 +193,12 @@
 ifeq ($(OSARCH),linux-gnu)
 ifeq (,$(findstring $(shell uname -m) , x86_64 amd64 ppc ppc64 alpha armv4l sparc64 parisc s390 ))
 ifeq (,$(findstring $(PROC) , arm armv5b armeb powerpc ia64 s390 bfin mipsel mips ))
+ifneq ($(K6OPT),)
 GSM_SOURCES+= $(SRC)/k6opt.s
 endif
 endif
 endif
+endif
 
 TOAST_SOURCES = $(SRC)/toast.c 		\
 		$(SRC)/toast_lin.c	\
@@ -269,10 +247,12 @@
 ifeq ($(OSARCH),linux-gnu)
 ifeq (,$(findstring $(shell uname -m) , x86_64 amd64 ppc ppc64 alpha armv4l sparc64 parisc ))
 ifeq (,$(findstring $(PROC) , arm armv5b armeb powerpc ia64 bfin mipsel mips ))
+ifneq ($(K6OPT),)
 GSM_OBJECTS+= $(SRC)/k6opt.o
 endif
 endif
 endif
+endif
 
 TOAST_OBJECTS =	$(SRC)/toast.o 		\
 		$(SRC)/toast_lin.o	\
