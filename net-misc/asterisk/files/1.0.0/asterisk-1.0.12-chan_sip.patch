Ported from <http://svn.digium.com/view/asterisk?rev=57478&view=rev>.
More information at <http://bugs.gentoo.org/169616>.
--- channels/chan_sip.c.7221	2007-03-06 11:52:32.000000000 -0500
+++ channels/chan_sip.c	2007-03-06 12:18:50.000000000 -0500
@@ -7293,6 +7293,12 @@
 		   increasing */
 		p->icseq = seqno;
 
+	if (!e && (strcasecmp(cmd, "INVITE") == 0 || strcasecmp(cmd, "SUBSCRIBE") == 0 || strcasecmp(cmd, "REGISTER") == 0 || strcasecmp(cmd, "NOTIFY") == 0)) {
+		transmit_response(p, "503 Server error", req);
+		p->needdestroy = 1;
+		return -1;
+	}
+
 	/* Initialize the context if it hasn't been already */
 	if (!strcasecmp(cmd, "OPTIONS")) {
 		res = get_destination(p, req);
