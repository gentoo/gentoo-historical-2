#!/bin/bash

if [ -z "${1}" ]
then
    NTPSERVER=132.163.135.130
else
    NTPSERVER="${1}"
fi

tmpfile=`mktemp`
#display how much your clock is off by
sntpclock $NTPSERVER > ${tmpfile}

if [ "${?}" != "0" ]
then
    echo ">>> Could not contact NTP server: $NTPSERVER" >&2
    exit 1
fi

echo ">>> Current clock sync:"
cat ${tmpfile} | clockview
echo
echo -n ">>> Now setting clock..."
cat ${tmpfile} | clockadd
echo " done."
#wite data to the hardware clock so it survives a reboot
echo -n ">>> Writing time to hardware clock..."
hwclock --systohc
echo " done."
echo
echo ">>> New clock sync:"
sntpclock $NTPSERVER | clockview
rm ${tmpfile}
