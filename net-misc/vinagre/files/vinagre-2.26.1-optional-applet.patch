
 Gnome: http://bugzilla.gnome.org/show_bug.cgi?id=580501
 Gentoo: https://bugs.gentoo.org/267279

 configure.ac    |   18 ++++++++++++++----
 src/Makefile.am |    3 ++-
 2 files changed, 16 insertions(+), 5 deletions(-)

diff --git a/configure.ac b/configure.ac
index 345140b..faa76db 100644
--- a/configure.ac
+++ b/configure.ac
@@ -72,10 +72,19 @@ PKG_CHECK_MODULES(VINAGRE, \
 AC_SUBST(VINAGRE_CFLAGS)
 AC_SUBST(VINAGRE_LIBS)
 
-PKG_CHECK_MODULES(APPLET, \ 
-  libpanelapplet-2.0 >= $PANEL_REQUIRED_VERSION)
+AC_ARG_ENABLE(applet,
+	AC_HELP_STRING([--disable-applet], [Disable vinagre applet @<:@default=yes@:>@]),
+	enable_applet=$enableval,
+	enable_applet=yes)
+
+if test "x$enable_applet" = "xyes";then 
+   PKG_CHECK_MODULES(APPLET, \ 
+   	libpanelapplet-2.0 >= $PANEL_REQUIRED_VERSION)
 AC_SUBST(APPLET_CFLAGS)
 AC_SUBST(APPLET_LIBS)
+fi
+
+AM_CONDITIONAL(APPLET, test "x$enable_applet" = "xyes")
 
 dnl ================================================================
 dnl GConf related settings
@@ -124,5 +133,6 @@ Configure summary:
 	Compiler ...................:  ${CC} 
 	Compiler Flags .............:  ${CFLAGS}
 
-	Avahi enabled ..............:  ${enable_avahi}
+	Avahi  enabled ..............:  ${enable_avahi}
+	Applet enabled ..............:	${enable_applet}
 "
diff --git a/src/Makefile.am b/src/Makefile.am
index 2bcb1ae..749754f 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -74,6 +74,7 @@ $(server_in_files): $(server_in_files:.server.in=.server.in.in)
 # The applet binary
 ##############################
 
+if APPLET
 libexec_PROGRAMS = vinagre-applet
 
 vinagre_applet_CFLAGS =			\
@@ -101,7 +102,7 @@ vinagre_applet_LDADD =			\
 	$(VINAGRE_LIBS)			\
 	$(AVAHI_LIBS)			\
 	$(NULL)
-
+endif
 
 ##############################
 # Autogenerated stuff
