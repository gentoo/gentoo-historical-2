From: Daniel Drake <dsd@gentoo.org>

http://bugzilla.gnome.org/show_bug.cgi?id=346566

Index: blam-1.8.2/configure.in
===================================================================
--- blam-1.8.2.orig/configure.in
+++ blam-1.8.2/configure.in
@@ -70,7 +70,7 @@ AC_MSG_CHECKING([which mozilla to use])
 
 MOZILLA=
 AC_ARG_WITH([mozilla],
-	AC_HELP_STRING([--with-mozilla@<:@=mozilla|firefox|thunderbird@:>@],
+	AC_HELP_STRING([--with-mozilla@<:@=mozilla|seamonkey|firefox|thunderbird@:>@],
 		       [Whether to use mozilla, firefox or thunderbird gtkmozembed (default: mozilla)]),
 	[MOZILLA="$withval"])
 
@@ -78,6 +78,8 @@ dnl try to autodetect: if mozilla exists
 if test "x$MOZILLA" = "x"; then
   if pkg-config --exists mozilla-gtkmozembed; then
     MOZILLA=mozilla
+  elif pkg-config --exists seamonkey-gtkmozembed; then
+    MOZILLA=seamonkey
   elif pkg-config --exists firefox-gtkmozembed; then
     MOZILLA=firefox
   elif pkg-config --exists thunderbird-gtkmozembed; then
@@ -85,7 +87,7 @@ if test "x$MOZILLA" = "x"; then
   else
     AC_MSG_ERROR([no mozilla installation found])
   fi
-elif test "x$with_mozilla" != "xmozilla" -a "x$with_mozilla" != "xfirefox" -a "x$with_mozilla" != "xthunderbird"; then
+elif test "x$with_mozilla" != "xmozilla" -a "x$with_mozilla" != "xfirefox" -a "x$with_mozilla" != "xthunderbird" -a "x$with_mozilla" != "xseamonkey"; then
   AC_MSG_ERROR([unknown mozilla name ($MOZILLA)])
 fi
 
@@ -95,6 +97,7 @@ AC_MSG_RESULT([$MOZILLA])
 
 case "$MOZILLA" in
 mozilla) min_version=1.7 flavour=mozilla ;;
+seamonkey) min_version=1.0 flavour=mozilla ;;
 firefox) min_version=0.10 flavour=toolkit ;;
 thunderbird) min_version=0.8 flavour=toolkit ;;
 esac
@@ -205,6 +208,12 @@ dnl changed from nsIXULChromeRegistry in
 AC_CHECK_FILE([$MOZILLA_INCLUDE_ROOT/chrome/nsIChromeRegistrySea.h],
 	[AC_DEFINE([HAVE_CHROME_NSICHROMEREGISTRYSEA_H], [1], [Define if nsIChromeRegistrySea.h exists])])
 
+
+dnl do_GetService moved here in recent mozilla code
+
+AC_CHECK_FILE([$MOZILLA_INCLUDE_ROOT/xpcom/nsServiceManagerUtils.h],
+		[AC_DEFINE([HAVE_XPCOM_NSSERVICEMANAGERUTILS_H], [1], [Define if nsServiceManagerUtils.h exists])])
+
 MOZILLA_WARN_CXXFLAGS="-Wall -Wconversion -Wpointer-arith -Wcast-align -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor"
 AC_SUBST(MOZILLA_WARN_CXXFLAGS)
 
Index: blam-1.8.2/libblam/blam-gecko-utils.cpp
===================================================================
--- blam-1.8.2.orig/libblam/blam-gecko-utils.cpp
+++ blam-1.8.2/libblam/blam-gecko-utils.cpp
@@ -29,6 +29,11 @@
 #include <nsEmbedString.h>
 #include <nsIPrefService.h>
 #include <nsIServiceManager.h>
+#include <nsCOMPtr.h>
+
+#if defined(HAVE_XPCOM_NSSERVICEMANAGERUTILS_H)
+#include <nsServiceManagerUtils.h>
+#endif
 
 #if defined (HAVE_CHROME_NSICHROMEREGISTRYSEA_H)
 #include <chrome/nsIChromeRegistrySea.h>
