--- CHANGELOG
+++ CHANGELOG
@@ -2,4 +2,5 @@
 ===========================
 
+- Fix issue which cases IMAP disconnection when encrypt() method was used (#1487900)
 - Fix some CSS issues in Settings for Internet Explorer
 - Fixed handling of folder with name "0" in folder selector
--- program/include/rcmail.php
+++ program/include/rcmail.php
@@ -1079,4 +1079,7 @@
         $book->close();
 
+    if (is_object($this->imap))
+      $this->imap->close();
+
     // before closing the database connection, write session data
     if ($_SERVER['REMOTE_ADDR'])
@@ -1194,7 +1197,4 @@
     }
 
-    if (is_object($this->imap))
-      $this->imap->close();
-
     return $base64 ? base64_encode($cipher) : $cipher;
   }
