diff -Naurp squirrelmail-1.5.1.orig/src/compose.php squirrelmail-1.5.1/src/compose.php
--- squirrelmail-1.5.1.orig/src/compose.php	2007-05-21 09:14:13.000000000 -0700
+++ squirrelmail-1.5.1/src/compose.php	2007-05-21 09:20:16.000000000 -0700
@@ -120,6 +120,25 @@ if ( !sqgetGlobalVar('smaction',$action)
     if ( sqgetGlobalVar('smaction_edit_new',$tmp) )   $action = 'edit_as_new';
 }
 
+/**
+ * Here we decode the data passed in from mailto.php.
+ */
+if ( sqgetGlobalVar('mailtodata', $mailtodata, SQ_GET) ) {
+    $trtable = array('to'       => 'send_to',
+                 'cc'           => 'send_to_cc',
+                 'bcc'          => 'send_to_bcc',
+                 'body'         => 'body',
+                 'subject'      => 'subject');
+    $mtdata = unserialize($mailtodata);
+    
+    foreach ($trtable as $f => $t) {
+        if ( !empty($mtdata[$f]) ) {
+            $$t = $mtdata[$f];
+        }
+    }
+    unset($mailtodata,$mtdata, $trtable);
+}
+
 /* Location (For HTTP 1.1 Header("Location: ...") redirects) */
 $location = get_location();
 /* Identities (fetch only once) */
diff -Naurp squirrelmail-1.5.1.orig/src/login.php squirrelmail-1.5.1/src/login.php
--- squirrelmail-1.5.1.orig/src/login.php	2007-05-21 09:14:13.000000000 -0700
+++ squirrelmail-1.5.1/src/login.php	2007-05-21 09:21:42.000000000 -0700
@@ -187,15 +187,15 @@ if (isset($hide_sm_attributions) && !$hi
 $username_form_name = 'login_username';
 $password_form_name = 'secretkey';
 
-if(sqgetGlobalVar('mailto', $mailto)) {
-    $rcptaddress = addHidden('mailto', $mailto);
+if(sqgetGlobalVar('mailtodata', $mailtodata)) {
+    $mailtofield = addHidden('mailtodata', $mailtodata);
 } else {
-    $rcptaddress = '';
+    $mailtofield = '';
 }
 
 $password_field = addPwField($password_form_name).
                   addHidden('js_autodetect_results', SMPREF_JS_OFF).
-                  $rcptaddress .
+                  $mailtofield .
                   addHidden('just_logged_in', '1');
 
 $oTemplate->assign('color', $color);
diff -Naurp squirrelmail-1.5.1.orig/src/mailto.php squirrelmail-1.5.1/src/mailto.php
--- squirrelmail-1.5.1.orig/src/mailto.php	2006-01-23 10:43:28.000000000 -0800
+++ squirrelmail-1.5.1/src/mailto.php	2007-05-21 09:24:07.000000000 -0700
@@ -41,6 +41,8 @@ $trtable = array('cc'           => 'send
                  'subject'      => 'subject');
 $url = '';
 
+$data = array();
+
 if(sqgetGlobalVar('emailaddress', $emailaddress)) {
     $emailaddress = trim($emailaddress);
     if(stristr($emailaddress, 'mailto:')) {
@@ -50,34 +52,33 @@ if(sqgetGlobalVar('emailaddress', $email
         list($emailaddress, $a) = explode('?', $emailaddress, 2);
         if(strlen(trim($a)) > 0) {
             $a = explode('=', $a, 2);
-            $url .= $trtable[strtolower($a[0])] . '=' . urlencode($a[1]) . '&';
+            $data[strtolower($a[0])] = $a[1];
         }
     }
-    $url = 'send_to=' . urlencode($emailaddress) . '&' . $url;
+    $data['to'] = $emailaddress;
 
     /* CC, BCC, etc could be any case, so we'll fix them here */
     foreach($_GET as $k=>$g) {
         $k = strtolower($k);
         if(isset($trtable[$k])) {
             $k = $trtable[$k];
-            $url .= $k . '=' . urlencode($g) . '&';
+            $data[$k] = $g;
         }
     }
-    $url = substr($url, 0, -1);
 }
 sqsession_is_active();
 
 if($force_login == false && sqsession_is_registered('user_is_logged_in')) {
     if($compose_only == true) {
-        $redirect = 'compose.php?' . $url;
+        $redirect = 'compose.php?mailtodata=' . urlencode(serialize($data));
     } else {
-        $redirect = 'webmail.php?right_frame=compose.php?' . urlencode($url);
+        $redirect = 'webmail.php?mailtodata=' . urlencode(serialize($data));
     }
 } else {
-    $redirect = 'login.php?mailto=' . urlencode($url);
+    $redirect = 'login.php?mailtodata=' . urlencode(serialize($data));
 }
 
 session_write_close();
 header('Location: ' . get_location() . '/' . $redirect);
 
-?>
\ No newline at end of file
+?>
diff -Naurp squirrelmail-1.5.1.orig/src/redirect.php squirrelmail-1.5.1/src/redirect.php
--- squirrelmail-1.5.1.orig/src/redirect.php	2007-05-21 09:14:13.000000000 -0700
+++ squirrelmail-1.5.1/src/redirect.php	2007-05-21 09:25:34.000000000 -0700
@@ -50,7 +50,7 @@ sqGetGlobalVar('secretkey', $secretkey);
 if(!sqGetGlobalVar('squirrelmail_language', $squirrelmail_language) || $squirrelmail_language == '') {
     $squirrelmail_language = $squirrelmail_default_language;
 }
-if (!sqgetGlobalVar('mailto', $mailto)) {
+if (!sqgetGlobalVar('mailtodata', $mailtodata)) {
     $mailto = '';
 }
 
@@ -154,9 +154,9 @@ if ( sqgetGlobalVar('session_expired_loc
     }
     unset($session_expired_location);
 }
-if($mailto != '') {
-    $redirect_url  = $location . '/webmail.php?right_frame=compose.php&mailto=';
-    $redirect_url .= urlencode($mailto);
+if($mailtodata != '') {
+    $redirect_url  = $location . '/webmail.php?right_frame=compose.php&mailtodata=';
+    $redirect_url .= urlencode($mailtodata);
 }
 
 /* Write session data and send them off to the appropriate page. */
diff -Naurp squirrelmail-1.5.1.orig/src/webmail.php squirrelmail-1.5.1/src/webmail.php
--- squirrelmail-1.5.1.orig/src/webmail.php	2007-05-21 09:14:13.000000000 -0700
+++ squirrelmail-1.5.1/src/webmail.php	2007-05-21 09:26:37.000000000 -0700
@@ -54,8 +54,10 @@ if (!sqgetGlobalVar('mailbox', $mailbox)
 
 sqgetGlobalVar('right_frame', $right_frame, SQ_GET);
 
-if(!sqgetGlobalVar('mailto', $mailto)) {
-    $mailto = '';
+if(sqgetGlobalVar('mailtodata', $mailtodata)) {
+    $mailtourl = 'mailtodata='.urlencode($mailtodata);
+} else {
+    $mailtourl = '';
 }
 
 is_logged_in();
@@ -166,7 +168,7 @@ switch($right_frame) {
         $right_frame_url = 'folders.php';
         break;
     case 'compose.php':
-        $right_frame_url = 'compose.php?' . $mailto;
+        $right_frame_url = 'compose.php?' . $mailtourl;
         break;
     case '':
         $right_frame_url = 'right_main.php';
