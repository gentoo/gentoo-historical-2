diff -Naur lsat-0.9.2.orig/checkhostsfiles.c lsat-0.9.2/checkhostsfiles.c
--- lsat-0.9.2.orig/checkhostsfiles.c	2004-03-13 10:49:11.000000000 +0900
+++ lsat-0.9.2/checkhostsfiles.c	2005-06-11 08:20:28.000000000 +0900
@@ -274,6 +274,8 @@
 	perror(" Creation of list failed.");
 	return(-1);
     }
+    /* clean up */
+    fclose(fileptr);
 
     } /* end of else, for if hosts.deny exists */
 
@@ -294,8 +296,6 @@
         header = "/etc/hosts.lpd found on this system.\nConsider preventing lpd from listening to the network.\nAt least make sure it contains fully qualified hostnames.";
         dostuff(0, filename, 0, header, html);
     }
-    /* clean up */
-    fclose(fileptr);
 
     if (verbose > 0)
     {
diff -Naur lsat-0.9.2.orig/checkpkgs.c lsat-0.9.2/checkpkgs.c
--- lsat-0.9.2.orig/checkpkgs.c	2004-03-13 10:49:11.000000000 +0900
+++ lsat-0.9.2/checkpkgs.c	2005-05-12 22:54:16.000000000 +0900
@@ -122,7 +122,7 @@
         {
             printf(" Generating list of pkgs on system.\n");
         }
-        shellcode = "/usr/lib/portage/bin/pkglist >>/tmp/lsat1.lsat";
+        shellcode = "/usr/bin/qpkg -I -nc >>/tmp/lsat1.lsat";
         if ((dostuff(tempfile, 0, shellcode, 0, html)) < 0)
         {
             /* rhut-rho...something bad happened */
