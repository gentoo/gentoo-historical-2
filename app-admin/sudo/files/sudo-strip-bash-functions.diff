Index: env.c
===================================================================
RCS file: /home/cvs/courtesan/sudo/env.c,v
retrieving revision 1.42
retrieving revision 1.43
diff -u -r1.42 -r1.43
--- env.c	8 Sep 2004 15:57:49 -0000	1.42
+++ env.c	11 Nov 2004 16:20:59 -0000	1.43
@@ -52,7 +52,7 @@
 #include "sudo.h"
 
 #ifndef lint
-static const char rcsid[] = "$Sudo: env.c,v 1.42 2004/09/08 15:57:49 millert Exp $";
+static const char rcsid[] = "$Sudo: env.c,v 1.43 2004/11/11 16:20:59 millert Exp $";
 #endif /* lint */
 
 /*
@@ -323,6 +323,13 @@
 	/* Pull in vars we want to keep from the old environment. */
 	for (ep = envp; *ep; ep++) {
 	    keepit = 0;
+
+	    /* Skip variables with values beginning with () (bash functions) */
+	    if ((cp = strchr(*ep, '=')) != NULL) {
+		if (strncmp(cp, "=() ", 3) == 0)
+		    continue;
+	    }
+
 	    for (cur = def_env_keep; cur; cur = cur->next) {
 		len = strlen(cur->value);
 		/* Deal with '*' wildcard */
@@ -404,6 +411,12 @@
 	 */
 	for (ep = envp; *ep; ep++) {
 	    okvar = 1;
+
+	    /* Skip variables with values beginning with () (bash functions) */
+	    if ((cp = strchr(*ep, '=')) != NULL) {
+		if (strncmp(cp, "=() ", 3) == 0)
+		    continue;
+	    }
 
 	    /* Skip anything listed in env_delete. */
 	    for (cur = def_env_delete; cur && okvar; cur = cur->next) {
