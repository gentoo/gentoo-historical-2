# Copyright 1999-2004 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/app-doc/kdelibs-apidocs/kdelibs-apidocs-3.1.5.ebuild,v 1.7 2004/08/07 17:57:02 caleb Exp $

inherit kde

IUSE=""
DESCRIPTION="API documentation autogenerated from the kde-base/kdelibs package"
KEYWORDS="x86 ~ppc sparc alpha hppa amd64 ia64"
HOMEPAGE="http//developer.kde.org/"
SLOT="3.1"
LICENSE="GPL-2"
SRC_URI="mirror://kde/stable/$PV/src/kdelibs-${PV}.tar.bz2"
DEPEND="app-doc/doxygen"
RDEPEND=""
S="${WORKDIR}/kdelibs-${PV}"


# get locations without messing with deps
set-qtdir 3
set-kdedir $PV

src_compile() {
	./configure # just give us a tolerable makefile
	make apidox
}

src_install() {
	#make DESTDIR="$D" install-apidox # doesn't install all files

	einfo "Copying files..."
	dodir ${KDEDIR}/share/doc/HTML/en/kdelibs-apidocs
	cp -r ${S}/apidocs/* ${D}/$KDEDIR/share/doc/HTML/en/kdelibs-apidocs

	#cd ${S}/apidocs
	#for x in k*; do
	#    MANDIRS="$MANDIRS:$KDEDIR/share/doc/HTML/en/kdelibs-apidocs/$x/man"
	#done
	#dodir /etc/env.d
	#echo "MANPATH=$MANDIRS" > $D/etc/env.d/80kdelibs-apidocs
}

pkg_postinst() {
	# the link from $KDEDIR/share/doc/HTML/en/kdelibs-apidocs/common
	# points to PORTAGE_TMPDIR, this fixes bug #15102
	rm $KDEDIR/share/doc/HTML/en/kdelibs-apidocs/common
	ln -sf $KDEDIR/share/doc/HTML/en/common \
	$KDEDIR/share/doc/HTML/en/kdelibs-apidocs/common
}
