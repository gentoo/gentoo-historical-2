diff -Nur kchmviewer-0.9.orig/chmlib-0.35/Makefile.am kchmviewer-0.9/chmlib-0.35/Makefile.am
--- kchmviewer-0.9.orig/chmlib-0.35/Makefile.am	2005-05-04 15:42:10.000000000 +0200
+++ kchmviewer-0.9/chmlib-0.35/Makefile.am	2005-06-08 18:22:51.000000000 +0200
@@ -1,4 +1,4 @@
-noinst_LIBRARIES = libchm.a
+noinst_LTLIBRARIES = libchm.la
 noinst_HEADERS = chm_lib.h lzx.h
 
-libchm_a_SOURCES = chm_lib.c lzx.c
+libchm_la_SOURCES = chm_lib.c lzx.c
diff -Nur kchmviewer-0.9.orig/configure.ac kchmviewer-0.9/configure.ac
--- kchmviewer-0.9.orig/configure.ac	2005-06-07 11:11:43.000000000 +0200
+++ kchmviewer-0.9/configure.ac	2005-06-08 18:32:05.000000000 +0200
@@ -31,9 +31,7 @@
 EXTRA_SUBDIRS=""
 CHMLIBDIR="chmlib-0.35"
 CHM_INCLUDES="\$(top_srcdir)/$CHMLIBDIR/"
-CHM_LIBS="\$(top_builddir)/$CHMLIBDIR/libchm.a"
-
-LIBS="$LIBS $CHM_LIBS"
+CHM_LIBS="\$(top_builddir)/$CHMLIBDIR/libchm.la"
 
 AC_ARG_WITH(kde,    AC_HELP_STRING([--with-kde],[enable KDE support]))
 
@@ -45,13 +43,14 @@
 	EXTRA_SUBDIRS="$EXTRA_SUBDIRS kio-msits"
 fi
 
-if test "x$with_kde" = "x"; then
+if test "x$with_kde" != "xyes"; then
 	include_ARTS_FALSE="yes"
 	AC_PREFIX_DEFAULT(${prefix:-/usr/local})
 fi
 
 AC_SUBST(EXTRA_SUBDIRS)
 AC_SUBST(CHM_INCLUDES)
+AC_SUBST(CHM_LIBS)
 
 AC_OUTPUT(src/Makefile Makefile kio-msits/Makefile chmlib-0.35/Makefile)
 
diff -Nur kchmviewer-0.9.orig/kio-msits/Makefile.am kchmviewer-0.9/kio-msits/Makefile.am
--- kchmviewer-0.9.orig/kio-msits/Makefile.am	2005-05-05 09:09:12.000000000 +0200
+++ kchmviewer-0.9/kio-msits/Makefile.am	2005-06-08 18:24:22.000000000 +0200
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kio_msits.la
 
 kio_msits_la_SOURCES = msits.cpp
-kio_msits_la_LIBADD = -lkio
+kio_msits_la_LIBADD = -lkio $(CHM_LIBS)
 kio_msits_la_LDFLAGS = -module -avoid-version $(QT_LIBS) $(KDE_LDFLAGS) $(KDE_LIBS) $(KDE_PLUGIN)
 
 protocol_DATA = msits.protocol
diff -Nur kchmviewer-0.9.orig/src/Makefile.am kchmviewer-0.9/src/Makefile.am
--- kchmviewer-0.9.orig/src/Makefile.am	2005-05-10 18:31:34.000000000 +0200
+++ kchmviewer-0.9/src/Makefile.am	2005-06-08 18:24:26.000000000 +0200
@@ -10,7 +10,8 @@
 INCLUDES = $(QT_INCLUDES) -I$(CHM_INCLUDES) $(KDE_INCLUDES)
 
 # the library search path.
-kchmviewer_LDFLAGS = $(QT_LDFLAGS) $(LIB_QT) $(KDE_LDFLAGS) $(LIB_KDEUI) $(LIB_KHTML)
+kchmviewer_LDADD = $(CHM_LIBS) $(LIB_QT) $(LIB_KDEUI) $(LIB_KHTML)
+kchmviewer_LDFLAGS = $(QT_LDFLAGS) $(KDE_LDFLAGS)
 
 #LIB_KDEPRINT = -lkdeprint
 #LIB_KDEUI = -lkdeui
