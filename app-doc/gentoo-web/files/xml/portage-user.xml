<?xml version='1.0'?>
<guide link="/doc/portage-user.html">
<title>Portage User Guide</title>
<author title="Chief Architect"><mail link="drobbins@gentoo.org">Daniel Robbins</mail></author>
<author title="Editor"><mail link="thomasfl@gentoo.org">Thomas Flavel</mail></author>

<abstract>This guide briefly covers how to keep your packages up to date, and how to maintain
your system.</abstract>

<version>1.1</version>
<date>09 Apr 2001</date>

<chapter>
<title>Package Management</title>

<section>
<title>Getting Started</title>
<body>

<p>After you get Gentoo Linux installed and you play around a bit, you may find some bugs or
quirks in some packages, or maybe you'd like to install the latest Gentoo Linux software 
packages or update your current packages. To do this, you'll need to download our Portage
ports tree. We have provided an anonymous rsync server that you can use to get our latest
Portage tree. Here's how you use it.</p>

<p>First, make a directory called <path>/usr/portage</path>. Then, make sure rsync is installed. If it
isn't, download it from our ibiblio mirror and install it by typing <c>pkgmerge
rsync-x.y.z.tbz2</c>. Then, use the following command to synchronize your Portage
directory:
</p>
<pre>
# <path>rsync -avz rsync://cvs.gentoo.org/gentoo-x86-portage/* /usr/portage</path>
</pre>

<p>Periodically, you'll want to run this next form of the rsync command, which will delete
any old ebuild scripts. </p>

<warn>Please note that it will delete any of your
personal changes or additions to the <path>/usr/portage tree</path>, so use this command with
caution.</warn>

<p>If you are making regular changes to your <path>/usr/portage</path> tree, you may want to
contact Daniel for CVS access so that you can commit some or all of them to our official CVS
tree. With that being said, here's the <c>rsync</c> update command with deletion:</p>

<pre>
# <i>rsync -avz --delete --exclude=distfiles/* --exclude=packages/* \
rsync://cvs.gentoo.org/gentoo-x86-portage/* /usr/portage</i>
</pre>
</body>
</section>

<section>
<title>Updating Portage</title>
<body>
<p>Before using our Portage tree, it's important that you update Portage. To do this, do the 
following:
</p>

<pre>
# <i>cd /usr/portage/sys-apps/portage</i>
# <i>ebuild portage-x.y.z.ebuild merge</i>
</pre>

<p>Now you'll be using the most recent version of portage, and you can start to use our ebuild
system to update your installed software.</p>

</body>
</section>

<section>
<title>Important Commands</title>
<body><p> 
To install a package, enter its directory in <path>/usr/portage</path>, i.e:
</p>

<pre>
# <i>cd /usr/portage/net-irc/xchat</i> 
</pre>

<p>Then, run <c>ebuild merge</c>:</p>

<pre>
# <i>ebuild xchat-1.4.2.ebuild merge</i>
</pre>

<p>The xchat sources will be downloaded (and stored in <path>/usr/portage/distfiles</path>), verified, 
unpacked, compiled and installed to a temporary directory. Then, they will be merged into the
local filesystem and a package database will be created at <path>/var/db/pkg/net-irc/xchat-1.4.2/CONTENTS</path>,
containing the files installed and the md5sums for all files.</p>

</body>
</section>

<section>
<title>Upgrading packages</title>
<body>

<p>The standard way to upgrade packages under Gentoo Linux is to merge the new package,
and then unmerge the old package. This is safe (and fun!) to do. First, merge the new package
as per the above instructions. Then, uninstall the old package by typing something
like:</p>

<pre>
# <i>ebuild /var/db/pkg/net-irc/xchat-1.0.0-r1/xchat-1.0.0-r1.ebuild unmerge</i>
</pre>

<p>It's important to specify the category and exact package version in the above format.  
Then, this particular package will be unmerged. Portage uses what is called a "safe"
unmerge; it's only going to unlink original files. If a file has been overwritten or
modified in some way, it will be left on the filesystem (presumably, you've installed a
newer version of the package). So, if you unmerge an old version of xchat after merging a
newer version, the xchat executable will not be deleted off your filesystem, since it has
a newer timestamp and different md5sum. Safe unmerges are really great because they ensure
that some version of the application is available at all times. If you had to unmerge     
first, then xchat wouldn't be available for a few minutes while the new version was being
merged.</p>

<p>That's all for now - more instructions will follow as I have time. I hope this helps.</p>
</body>
</section>
</chapter>
</guide>
