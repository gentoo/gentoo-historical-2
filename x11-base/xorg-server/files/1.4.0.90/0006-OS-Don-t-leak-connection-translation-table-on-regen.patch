From 38d8cfaaff0ae6273d9e921aae08b2706355f0d2 Mon Sep 17 00:00:00 2001
From: Daniel Stone <daniel@fooishbar.org>
Date: Fri, 28 Dec 2007 15:48:25 +0200
Subject: [PATCH] OS: Don't leak connection translation table on regeneration
 (cherry picked from commit e868e0bc0d2318e62707d3ae68532b0029959154)

---
 os/connection.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/os/connection.c b/os/connection.c
index b944593..d1ba845 100644
--- a/os/connection.c
+++ b/os/connection.c
@@ -353,7 +353,8 @@ InitConnectionLimits(void)
 #endif
 
 #if !defined(WIN32)
-    ConnectionTranslation = (int *)xnfalloc(sizeof(int)*(lastfdesc + 1));
+    if (!ConnectionTranslation)
+        ConnectionTranslation = (int *)xnfalloc(sizeof(int)*(lastfdesc + 1));
 #else
     InitConnectionTranslation();
 #endif
-- 
1.5.5.1

