From a304fc1d4a7062f65161ef8748fd358639ec73de Mon Sep 17 00:00:00 2001
From: Daniel Stone <daniel@fooishbar.org>
Date: Fri, 28 Dec 2007 15:48:57 +0200
Subject: [PATCH] KDrive: Xephyr: Don't leak screen damage structure
 (cherry picked from commit 0b03d97a244540824c922c300adbc3d3ae4855d5)

---
 hw/kdrive/ephyr/ephyr.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/hw/kdrive/ephyr/ephyr.c b/hw/kdrive/ephyr/ephyr.c
index e8001df..27165a5 100644
--- a/hw/kdrive/ephyr/ephyr.c
+++ b/hw/kdrive/ephyr/ephyr.c
@@ -394,6 +394,7 @@ ephyrUnsetInternalDamage (ScreenPtr pScreen)
   
   pPixmap = (*pScreen->GetScreenPixmap) (pScreen);
   DamageUnregister (&pPixmap->drawable, scrpriv->pDamage);
+  DamageDestroy (scrpriv->pDamage);
   
   RemoveBlockAndWakeupHandlers (ephyrInternalDamageBlockHandler,
 				ephyrInternalDamageWakeupHandler,
-- 
1.5.5.1

