--- config/Make.rules.orig	2007-02-27 15:49:03.000000000 -0500
+++ config/Make.rules	2007-02-27 15:51:08.000000000 -0500
@@ -11,13 +11,13 @@
 # Select an installation base directory. The directory will be created
 # if it does not exist.
 #
-prefix			 ?= /opt/Ice-$(VERSION)
+prefix			 ?= $(DESTDIR)/usr
 
 #
 # The "root directory" for runpath embedded in executables. Can be unset
 # to avoid adding a runpath to Ice executables.
 #
-embedded_runpath_prefix  ?= /opt/Ice-$(VERSION_MAJOR).$(VERSION_MINOR)
+#embedded_runpath_prefix  ?= /opt/Ice-$(VERSION_MAJOR).$(VERSION_MINOR)
 
 #
 # Define OPTIMIZE as yes if you want to build with
@@ -125,9 +125,9 @@
 install_bindir		= $(prefix)/bin
 
 install_includedir	= $(prefix)/include
-install_slicedir	= $(prefix)/slice
-install_schemadir	= $(prefix)/schema
-install_docdir		= $(prefix)/doc
+install_slicedir	= $(prefix)/share/Ice/slice
+install_schemadir	= $(prefix)/share/Ice/schema
+install_docdir		= $(prefix)/share/doc/Ice-$(VERSION)
 
 INSTALL			= cp -fp
 INSTALL_PROGRAM		= ${INSTALL}
@@ -184,9 +184,9 @@
    DB_LIBS              = -L$(DB_HOME)/$(libsubdir) -ldb_cxx
    DB_RPATH_LINK        = $(call rpathlink,$(DB_HOME)/$(libsubdir))
 else
-   ifeq ($(shell if [ -d /usr/include/db45 -a -d /usr/$(libsubdir)/db45 ] ; then echo yes; fi), yes)
-      DB_FLAGS          = -I/usr/include/db45
-      DB_LIBS           = -L/usr/$(libsubdir)/db45 -ldb_cxx
+   ifeq ($(shell if [ -d /usr/include/db4.5 -a -d /usr/$(libsubdir) ] ; then echo yes; fi), yes)
+      DB_FLAGS          = -I/usr/include/db4.5
+      DB_LIBS           = -L/usr/$(libsubdir) -ldb_cxx-4.5
    else
       DB_LIBS           = -ldb_cxx
    endif
--- Makefile.orig	2007-02-27 15:53:01.000000000 -0500
+++ Makefile	2007-02-27 15:54:20.000000000 -0500
@@ -11,7 +11,7 @@
 
 include $(top_srcdir)/config/Make.rules
 
-SUBDIRS		= config src include test demo slice doc
+SUBDIRS		= config src include slice doc
 
 INSTALL_SUBDIRS	= $(install_bindir) $(install_libdir) $(install_includedir) $(install_slicedir) $(install_docdir)
 
@@ -19,7 +19,7 @@
 	@if test ! -d $(prefix) ; \
 	then \
 	    echo "Creating $(prefix)..." ; \
-	    $(call mkdir,$(prefix)) ; \
+            mkdir -p $(prefix) ; \
 	fi
 ifneq ($(embedded_runpath_prefix),)
 	@if test -h $(embedded_runpath_prefix) ; \
@@ -55,8 +55,8 @@
 	then \
 	    ( cd doc && $(MAKE) install ) || exit 1 ; \
 	fi
-	$(call installdata,ICE_LICENSE,$(prefix))
-	$(call installdata,LICENSE,$(prefix))
+	$(call installdata,ICE_LICENSE,$(install_docdir))
+	$(call installdata,LICENSE,$(install_docdir))
 
 clean::
 	@if test -d doc ; \
@@ -65,4 +65,5 @@
 	fi
 
 test::
+	@( cd test && $(MAKE) ) || exit 1
 	@python $(top_srcdir)/allTests.py
