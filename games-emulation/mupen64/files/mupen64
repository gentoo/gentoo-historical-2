#!/bin/bash

if [ ! -d ~/.mupen64/save ] ; then
	mkdir -p ~/.mupen64/save
	mkdir -p ~/.mupen64/plugins
	cd ~/.mupen64
	ln -s GENTOO_DIR/mupen64 mupen64
	ln -s GENTOO_DIR/mupen64_nogui mupen64_nogui
	cp GENTOO_DIR/mupen64.ini .
fi

cd ~/.mupen64

cd plugins
cleanlinks
ln -s GENTOO_DIR/plugins/*.{so,ini} .
cd ..

# We must execute ./blah not /foo/bar/blah because mupen64 tries to
# write to files in the directory from which the application is run.
# It segfaults if it can't write to the directory.  Upstream has been
# notified of the problem.
exec ./$(basename $0) "$@"
