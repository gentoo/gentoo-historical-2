--- src/core/mwcollect.cpp.old	2005-12-12 19:38:36.000000000 +0900
+++ src/core/mwcollect.cpp	2005-12-12 19:39:45.000000000 +0900
@@ -286,6 +286,22 @@
 		}
 		
 		{
+			if(bDaemon && (pid = fork()))
+			{
+				FILE * pPidFile = fopen(szPidFile, "wt");
+				
+				if(!pPidFile)
+				{
+					LOG(LT_LEVEL_CRITICAL | LT_STATUS, "Could not open %s for writing (PID)!", szPidFile);
+					return 0;
+				}
+				
+				fprintf(pPidFile, "%u", pid);
+				fclose(pPidFile);
+				
+				return 0;
+			}
+					
 			if(szChuid)
 			{
 				DEBUG("Changing UID to %s (%i) %s setting capabilties.", szChuid, (int) uid, bCaps ? "with" : "without");
@@ -314,22 +330,6 @@
 				}	
 			}
 			
-			if(bDaemon && (pid = fork()))
-			{
-				FILE * pPidFile = fopen(szPidFile, "wt");
-				
-				if(!pPidFile)
-				{
-					LOG(LT_LEVEL_CRITICAL | LT_STATUS, "Could not open %s for writing (PID)!", szPidFile);
-					return 0;
-				}
-				
-				fprintf(pPidFile, "%u", pid);
-				fclose(pPidFile);
-				
-				return 0;
-			}
-					
 			g_pLogManager->log(LT_LEVEL_MEDIUM | LT_STATUS, "mwcollect " MWCD_VERSION " up and running.");
 			
 			if(szTestShellcode)
