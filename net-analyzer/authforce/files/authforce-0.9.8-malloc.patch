--- authforce-0.9.8/src/files.c	2007-02-13 11:35:34.000000000 +1100
+++ ../authforce-0.9.8/src/files.c	2007-04-17 20:38:55.000000000 +1000
@@ -168,15 +168,22 @@
 		if (access(tilde_expand(filename), R_OK) == 0)
 			return(tilde_expand(filename));
 	}
+	fullpath = (char*)malloc_w(sizeof(char)*80);
+	if (fullpath == NULL) {
+		fprintf(stderr, "search_path: out of memory\n");
+		exit(EXIT_FAILURE);
+	}
+	*(fullpath+79)='\0';
+
 	if (*filename == '.' && *(filename+1) == '.') {
 		debug(3, "search_path: attempting to access %s\n", filename);
 		if (access(filename, R_OK) == 0)
-			return(filename);
+			return(strncpy(fullpath,filename,79));
 	}
 	if (*filename == '/') {
 		debug(3, "search_path: attempting to access %s\n", filename);
 		if (access(filename, R_OK) == 0)
-			return(filename);
+			return(strncpy(fullpath,filename,79));
 	}
 
 	if (rindex(filename, '/')) {
@@ -184,7 +191,6 @@
 		filename++;
 	}
 
-	fullpath = (char*)malloc_w(sizeof(char)*80);
 	/* then look for it in the path */
 	while ((curpath = extract_colon_unit(pathlist, &i)) != NULL) {
 		snprintf(fullpath, sizeof(char)*80, "%s/%s", curpath, filename);
