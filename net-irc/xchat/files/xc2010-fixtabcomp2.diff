# Fixes two tab-nick-completion bugs:
# 1. Crash when you type space-tab
# 2. Critical glib warning when completion in a dialog-tab.
--- xchat-2.0.10/src/fe-gtk/fkeys.c	2004-07-02 02:28:43.000000000 +1000
+++ xchat-2.0.10p1/src/fe-gtk/fkeys.c	2004-07-10 01:16:29.000000000 +1000
@@ -1393,8 +1393,6 @@
 		{
 			skip_len++;
 		}
-		else
-			cursor_pos = g_utf8_pointer_to_offset(text, g_utf8_offset_to_pointer(ch, 1));
 	}
 
 	comp = skip_len;
@@ -1599,7 +1597,8 @@
 		gtk_entry_set_text (GTK_ENTRY (t), buf);
 		gtk_editable_set_position (GTK_EDITABLE (t), g_utf8_pointer_to_offset(buf, buf + cursor_pos));
 	}
-	g_completion_free(gcomp);
+	if (gcomp)
+		g_completion_free(gcomp);
 	return 2;
 }
 #undef COMP_BUF
