--- src/common/util.c	28 Feb 2005 10:37:38 -0000	1.36
+++ src/common/util.c	4 Mar 2005 11:27:21 -0000	1.37
@@ -1216,6 +1216,7 @@
 	int pid;
 	char **argv;
 	int argc;
+	int fd;
 
 	if (my_poptParseArgvString (cmd, &argc, &argv) != 0)
 		return -1;
@@ -1226,6 +1227,8 @@
 		return -1;
 	if (pid == 0)
 	{
+		/* Now close all open file descriptors except stdin, stdout and stderr */
+		for (fd = 3; fd < 1024; fd++) close(fd);
 		execvp (argv[0], argv);
 		_exit (0);
 	} else
--- src/common/outbound.c	26 Feb 2005 08:05:33 -0000	1.73
+++ src/common/outbound.c	4 Mar 2005 11:27:21 -0000	1.74
@@ -1342,6 +1342,7 @@
 	int fds[2], pid = 0;
 	struct nbexec *s;
 	int shell = TRUE;
+	int fd;
 
 	if (*cmd)
 	{
@@ -1411,6 +1412,8 @@
 			dup2 (fds[1], 2);
 			/* Also copy it to stdin so we can write to it */
 			dup2 (fds[1], 0);
+			/* Now close all open file descriptors except stdin, stdout and stderr */
+			for (fd = 3; fd < 1024; fd++) close(fd);
 			/* Now we call /bin/sh to run our cmd ; made it more friendly -DC1 */
 			if (shell)
 			{
