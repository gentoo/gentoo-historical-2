--- mkfiles.pl.old	2009-09-11 13:39:57.000000000 +0200
+++ mkfiles.pl	2009-09-11 13:44:40.000000000 +0200
@@ -1110,8 +1110,8 @@
     "\n".
     &splitline("CFLAGS = -O2 -Wall -Werror -ansi -pedantic -g " .
 	       (join " ", map {"-I$dirpfx$_"} @srcdirs) .
-	       " `\$(GTK_CONFIG) --cflags`")."\n".
-    "XLDFLAGS = `\$(GTK_CONFIG) --libs`\n".
+	       " `pkg-config gtk+-2.0 --cflags`")."\n".
+    "XLDLIBS = `pkg-config gtk+-2.0 --libs`\n".
     "ULDFLAGS =#\n".
     "INSTALL=install\n",
     "INSTALL_PROGRAM=\$(INSTALL)\n",
@@ -1130,8 +1130,13 @@
       $objstr = &objects($p, "X.o", undef, undef);
       print &splitline($prog . ": " . $objstr), "\n";
       $libstr = &objects($p, undef, undef, "-lX");
-      print &splitline("\t\$(CC)" . $mw . " \$(${type}LDFLAGS) -o \$@ " .
-                       $objstr . " $libstr", 69), "\n\n";
+      if ($type eq "X") {
+        print &splitline("\t\$(CC)" . $mw . " \$(LDFLAGS) -o \$@ " .
+                         $objstr . " $libstr \$(XLDLIBS)", 69), "\n\n";
+      } else {
+        print &splitline("\t\$(CC)" . $mw . " \$(LDFLAGS) -o \$@ " .
+                         $objstr . " $libstr", 69), "\n\n";
+      }
     }
     foreach $d (&deps("X.o", undef, $dirpfx, "/")) {
       print &splitline(sprintf("%s: %s", $d->{obj}, join " ", @{$d->{deps}})),
