diff -ru usr/src/nv/conftest.sh usr/src/nv.1453708/conftest.sh
--- usr/src/nv/conftest.sh	2006-01-22 15:31:01.121721250 +0100
+++ usr/src/nv.1453708/conftest.sh	2006-01-22 15:28:23.303858250 +0100
@@ -22,8 +22,8 @@
 OUTPUT=$4
 
 CFLAGS="-D__KERNEL__ \
--nostdinc -isystem $ISYSTEM \
--Werror -Wimplicit-function-declaration"
+-DKBUILD_BASENAME=\"#conftest$$\" -DKBUILD_MODNAME=\"#conftest$$\" \
+-nostdinc -isystem $ISYSTEM"
 
 if [ "$OUTPUT" != "$SOURCES" ]; then
     ARCH=`uname -m | sed -e 's/i.86/i386/'`
@@ -40,7 +40,20 @@
         #
 
         echo "#include <linux/mm.h>
-        int nv_remap_page_range(void) {
+        void conftest_remap_page_range(void) {
+           remap_page_range();
+        }" > conftest$$.c
+
+        $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
+        rm -f conftest$$.c
+
+        if [ -f conftest$$.o ]; then
+          rm -f conftest$$.o
+          exit 1
+        fi
+
+        echo "#include <linux/mm.h>
+        int conftest_remap_page_range(void) {
            pgprot_t pgprot = __pgprot(0);
            return remap_page_range(NULL, 0L, 0L, 0L, pgprot);
         }" > conftest$$.c
@@ -55,7 +68,7 @@
         fi
 
         echo "#include <linux/mm.h>
-        int nv_remap_page_range(void) {
+        int conftest_remap_page_range(void) {
            pgprot_t pgprot = __pgprot(0);
            return remap_page_range(0L, 0L, 0L, pgprot);
         }" > conftest$$.c
@@ -330,7 +343,7 @@
                 return 0;
             }" > conftest$$.c
 
-            $HOSTCC $CFLAGS -Wno-error -o conftest$$ conftest$$.c > /dev/null 2>&1
+            $HOSTCC $CFLAGS -o conftest$$ conftest$$.c > /dev/null 2>&1
             rm -f conftest$$.c
 
             if [ -f conftest$$ ]; then
@@ -483,8 +496,8 @@
         #if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 0)
           #include <asm/cacheflush.h>
         #endif
-        int nv_change_page_attr(struct page *pp, int i, pgprot_t prot) {
-            return change_page_attr(pp, i, prot);
+        void conftest_change_page_attr() {
+            change_page_attr();
         }" > conftest$$.c
 
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
@@ -492,9 +505,9 @@
 
         if [ -f conftest$$.o ]; then
             rm -f conftest$$.o
-            echo 1
-        else
             echo 0
+        else
+            echo 1
         fi
     ;;
 
@@ -504,9 +517,8 @@
         #
 
         echo "#include <linux/pci.h>
-        struct pci_dev*
-        nv_pci_get_class(unsigned int class, struct pci_dev *from) {
-            return pci_get_class(class, from);
+        void conftest_pci_get_class(void) {
+            pci_get_class();
         }" > conftest$$.c
 
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
@@ -514,9 +526,9 @@
 
         if [ -f conftest$$.o ]; then
             rm -f conftest$$.o
-            echo 1
-        else
             echo 0
+        else
+            echo 1
         fi
     ;;
 
@@ -526,9 +538,8 @@
         #
 
         echo "#include <linux/mm.h>
-        int nv_remap_pfn_range(void) {
-            pgprot_t pgprot = __pgprot(0);
-            return remap_pfn_range(NULL, 0L, 0L, 0L, pgprot);
+        void conftest_remap_pfn_range(void) {
+            remap_pfn_range();
         }" > conftest$$.c
 
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
@@ -536,9 +547,9 @@
 
         if [ -f conftest$$.o ]; then
             rm -f conftest$$.o
-            echo 1
-        else
             echo 0
+        else
+            echo 1
         fi
     ;;
 
@@ -548,11 +559,11 @@
         #
 
         echo "#include <linux/sched.h>
-        struct rlimit *nv_signal_struct_rlim(void) {
+        struct rlimit *conftest_signal_struct_rlim(void) {
             return current->signal->rlim;
         }" > conftest$$.c
 
-        $CC $CFLAGS -Wno-error -c conftest$$.c > /dev/null 2>&1
+        $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
         rm -f conftest$$.c
 
         if [ -f conftest$$.o ]; then
@@ -572,7 +583,7 @@
         echo "#include <linux/types.h>
         #include <linux/agp_backend.h>
         typedef struct agp_bridge_data agp_bridge_data;
-        agp_bridge_data *nv_agp_backend_acquire(struct pci_dev *dev) {
+        agp_bridge_data *conftest_agp_backend_acquire(struct pci_dev *dev) {
             return agp_backend_acquire(dev);
         }" > conftest$$.c
 
@@ -594,9 +605,23 @@
         #
 
         echo "#include <linux/vmalloc.h>
-        void *nv_vmap(struct page **pg, int cnt) {
+        void conftest_vmap(void) {
+            vmap();
+        }" > conftest$$.c
+
+        $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
+        rm -f conftest$$.c
+
+        if [ -f conftest$$.o ]; then
+            rm -f conftest$$.o
+            exit 1
+        fi
+
+        echo "#include <linux/vmalloc.h>
+        void *conftest_vmap(struct page **pg, int cnt) {
             return vmap(pg, cnt);
         }" > conftest$$.c
+
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
         rm -f conftest$$.c
 
@@ -608,9 +633,10 @@
 
         echo "#include <linux/vmalloc.h>
         #include <linux/mm.h>
-        void *nv_vmap(struct page **pg, int cnt) {
+        void *conftest_vmap(struct page **pg, int cnt) {
             return vmap(pg, cnt, 0, PAGE_KERNEL);
         }" > conftest$$.c
+
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
         rm -f conftest$$.c
 
@@ -618,7 +644,11 @@
             rm -f conftest$$.o
             echo 4
         else
-            exit 1  # there ain't no vmap()
+            #
+            # We couldn't determine the number of arguments expected by the
+            # vmap() function.
+            #
+            exit 1
         fi
     ;;
 
@@ -629,7 +659,7 @@
         #
 
         echo "#include <linux/sched.h>
-        int nv_test_sysctl_max_map_count(void) {
+        int conftest_sysctl_max_map_count(void) {
             return sysctl_max_map_count;
         }" > conftest$$.c
 
@@ -650,11 +680,11 @@
         #
 
         echo "#include <linux/pm.h>
-        void nv_test_pm_message_t(pm_message_t state) {
+        void conftest_pm_message_t(pm_message_t state) {
             pm_message_t *p = &state;
         }" > conftest$$.c
 
-        $CC $CFLAGS -Wno-error -c conftest$$.c > /dev/null 2>&1
+        $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
         rm -f conftest$$.c
 
         if [ -f conftest$$.o ]; then
@@ -671,9 +701,8 @@
         #
 
         echo "#include <linux/pci.h>
-        pci_power_t
-        nv_pci_choose_state(struct pci_dev *dev, pm_message_t state) {
-            return pci_choose_state(dev, state);
+        void conftest_pci_choose_state(void) {
+            pci_choose_state();
         }" > conftest$$.c
 
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
@@ -681,9 +710,9 @@
 
         if [ -f conftest$$.o ]; then
             rm -f conftest$$.o
-            echo 1
-        else
             echo 0
+        else
+            echo 1
         fi
     ;;
 
@@ -693,9 +722,8 @@
         #
 
         echo "#include <linux/mm.h>
-        int nv_vm_insert_page(void) {
-            struct page *page;
-            return vm_insert_page(NULL, 0L, page);
+        void conftest_vm_insert_page(void) {
+            vm_insert_page();
         }" > conftest$$.c
 
         $CC $CFLAGS -c conftest$$.c > /dev/null 2>&1
@@ -703,9 +731,9 @@
 
         if [ -f conftest$$.o ]; then
             rm -f conftest$$.o
-            echo 1
-        else
             echo 0
+        else
+            echo 1
         fi
     ;;
 
