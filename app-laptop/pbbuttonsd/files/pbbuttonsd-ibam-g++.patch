diff -urN pbbuttonsd-0.7.8.orig/configure.in pbbuttonsd-0.7.8/configure.in
--- pbbuttonsd-0.7.8.orig/configure.in	2006-09-06 01:57:19.000000000 +0200
+++ pbbuttonsd-0.7.8/configure.in	2006-09-06 01:58:03.000000000 +0200
@@ -87,6 +87,7 @@
 
 dnl Conditionals
 AM_CONDITIONAL(DEBUG, test "$enable_debug" = yes)
+AM_CONDITIONAL(WITH_IBAM, test "$pbb_with_ibam" = yes)
 
 dnl Checks for header files.
 AC_HEADER_STDC
diff -urN pbbuttonsd-0.7.8.orig/src/Makefile.am pbbuttonsd-0.7.8/src/Makefile.am
--- pbbuttonsd-0.7.8.orig/src/Makefile.am	2006-09-06 01:57:20.000000000 +0200
+++ pbbuttonsd-0.7.8/src/Makefile.am	2006-09-06 02:15:26.000000000 +0200
@@ -4,6 +4,11 @@
 
 bin_PROGRAMS = pbbuttonsd
 
+if WITH_IBAM
+IBAM = ibam_stub.cpp ibam_stub.h ibam.hpp ibam.inl
+IBAM_LIBS = -lstdc++
+endif
+
 pbbuttonsd_SOURCES = \
 	pbbuttonsd.c \
 	init.c init.h systems.h \
@@ -20,10 +25,9 @@
 	module_alsamixer.c module_alsamixer.h \
 	module_peep.c module_peep.h \
 	tcp.c tcp.h gettext_macros.h pbbinput.h \
-	debug.h \
-	ibam_stub.cpp ibam_stub.h ibam.hpp ibam.inl
+	debug.h $(IBAM)
 
-pbbuttonsd_LDADD = -lpbb $(INTLLIBS) $(ALSA_LIBS) @PACKAGE_LIBS@
+pbbuttonsd_LDADD = -lpbb $(INTLLIBS) $(ALSA_LIBS) $(IBAM_LIBS) @PACKAGE_LIBS@
 pbbuttonsd_LDFLAGS = -L$(top_srcdir)/libpbbipc
 ##pbbuttonsd_DEPENDENCIES = $(top_srcdir)/libpbbipc/libpbb.a
 
