#!/bin/bash
# Copyright 1999-2004 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/sys-apps/policycoreutils/files/selinux-init,v 1.3 2004/07/15 00:47:52 agriffis Exp $

mount -n -t proc none /proc

# see if selinuxfs is available
for i in $(cat /proc/filesystems); do
	[ "$i" == "selinuxfs" ] && ENABLED=y
done

umount -n /proc

if [ -n ${ENABLED} ]; then
	# only try to load policy on SELinux kernels

	mount -n -t selinuxfs none /selinux

	# determine the policy version
	[ -f /selinux/policyvers ] && \
		POLICYVER=$(cat /selinux/policyvers) || \
		POLICYVER=15

	# load the policy if it exists
	if [ -f /etc/security/selinux/policy.${POLICYVER} ]; then
		/usr/sbin/load_policy /etc/security/selinux/policy.${POLICYVER}
	else
		echo "Unable to load policy: /etc/security/selinux/policy.${POLICYVER} missing."
	fi
fi

exec /sbin/init
