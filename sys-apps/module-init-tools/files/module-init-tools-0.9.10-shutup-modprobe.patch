--- module-init-tools-0.9.10/generate-modprobe.conf.orig	2003-03-02 20:20:24.000000000 +0200
+++ module-init-tools-0.9.10/generate-modprobe.conf	2003-03-02 20:20:28.000000000 +0200
@@ -155,16 +155,16 @@
     above)
 	# Pull in these modules after me.
 	INSTALL_COMMANDS="$INSTALL_COMMANDS $MODULE"
-	eval post_install_$MODNAME=\"`multi "$REST" 'modprobe' '; '`\; /bin/true\"
+	eval post_install_$MODNAME=\"`multi "$REST" 'modprobe -q' '; '`\; /bin/true\"
 	REMOVE_COMMANDS="$REMOVE_COMMANDS $MODULE"
-	eval pre_remove_$MODNAME=\"`multi "$REST" 'modprobe -r' '; '`\"
+	eval pre_remove_$MODNAME=\"`multi "$REST" 'modprobe -qr' '; '`\"
 	;;
     below)
 	# Pull in these modules before me.
 	INSTALL_COMMANDS="$INSTALL_COMMANDS $MODULE"
-	eval pre_install_$MODNAME=\"`multi "$REST" 'modprobe' '; '`\"
+	eval pre_install_$MODNAME=\"`multi "$REST" 'modprobe -q' '; '`\"
 	REMOVE_COMMANDS="$REMOVE_COMMANDS $MODULE"
-	eval post_remove_$MODNAME=\"`multi "$REST" 'modprobe -r' '; '`\; /bin/true\"
+	eval post_remove_$MODNAME=\"`multi "$REST" 'modprobe -qr' '; '`\; /bin/true\"
 	;;
     probe) 
 	INSTALL_COMMANDS="$INSTALL_COMMANDS $MODULE"
@@ -173,7 +173,7 @@
     probeall)
 	# Not quite correct.  If they all fail, we should fail.
 	INSTALL_COMMANDS="$INSTALL_COMMANDS $MODULE"
-	eval install_$MODNAME=\"`multi "$REST" 'modprobe' '; '`\; /bin/true\"
+	eval install_$MODNAME=\"`multi "$REST" 'modprobe -q' '; '`\; /bin/true\"
 	;;
     post-install)
 	INSTALL_COMMANDS="$INSTALL_COMMANDS $MODULE"
--- module-init-tools-0.9.10/modprobe.c.orig	2003-03-02 22:19:25.000000000 +0200
+++ module-init-tools-0.9.10/modprobe.c	2003-03-02 22:42:08.000000000 +0200
@@ -1081,6 +1081,7 @@
 	int strip_vermagic = 0;
 	int strip_modversion = 0;
 	int fail_if_already = 1;
+	int fail_if_missing = 1;
 	char *type = NULL;
 	const char *config = NULL, *command = NULL;
 	char *dirname, *optstring = NOFAIL(strdup(""));
@@ -1129,7 +1130,9 @@
 			break;
 		case 'q':
 			/* FIXME: should do more than this. */
+			setenv("MODPROBE_QUIET", "1", 1);
 			fail_if_already = 0;
+			fail_if_missing = 0;
 			break;
 		case 's':
 			log = 1;
@@ -1152,6 +1155,13 @@
 		}
 	}
 
+	/* Check MODPROBE_QUIET */
+	if (getenv("MODPROBE_QUIET"))
+		if (0 == strcmp(getenv("MODPROBE_QUIET"), "1")) {
+			fail_if_already = 0;
+			fail_if_missing = 0;
+		}
+
 	/* If stderr not open, go to syslog */
 	if (log || fstat(STDERR_FILENO, &statbuf) != 0) {
 		openlog("modprobe", LOG_CONS, LOG_DAEMON);
@@ -1263,7 +1273,10 @@
 				   remove ? "remove" : "install");
 			goto out;
 		}
-		fatal("Module %s not found.\n", modname);
+		if (fail_if_missing)
+			fatal("Module %s not found.\n", modname);
+		else
+			exit(1);
 	}
 
 	if (remove)
