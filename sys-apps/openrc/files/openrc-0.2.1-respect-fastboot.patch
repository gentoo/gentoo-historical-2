From: Roy Marples <roy@marples.name>
Date: Wed, 9 Apr 2008 00:21:49 +0000 (+0100)
Subject: Respect shutdown's fastboot.
X-Git-Url: http://git.overlays.gentoo.org/gitweb/?p=proj%2Fopenrc.git;a=commitdiff_plain;h=a57e9df2a084350cf18a414b5d92e9fcc8aea6ae

Respect shutdown's fastboot.
---

diff --git a/init.d/fsck.in b/init.d/fsck.in
index 5bf9ba8..f469ce8 100644
--- a/init.d/fsck.in
+++ b/init.d/fsck.in
@@ -29,6 +29,11 @@ start()
 {
 	local reboot_opts= fsck_opts= p=
 
+	if [ -e /fastboot ]; then
+		ewarn "Skipping fsck due to /fastboot"
+		return 0
+	fi
+
 	ebegin "Checking local filesystems"
 	for p in ${fsck_passno}; do
 		local IFS="${_IFS}"
diff --git a/init.d/root.in b/init.d/root.in
index c87b7f1..aba6415 100644
--- a/init.d/root.in
+++ b/init.d/root.in
@@ -13,7 +13,7 @@ depend()
 start()
 {
 	if echo 2>/dev/null >/.test.$$; then
-		rm -f /.test.$$
+		rm -f /.test.$$ /fastboot
 		return 0
 	fi
 
@@ -23,4 +23,5 @@ start()
 		*)	mount -u -o rw /;;
 	esac
 	eend $? "Root filesystem could not be mounted read/write"
+	rm -f /fastboot
 }
