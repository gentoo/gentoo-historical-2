=== modified file 'pym/portage.py'
--- pym/portage.py	
+++ pym/portage.py	
@@ -2312,6 +2312,7 @@
 	if mysplit is None:
 		writemsg("!!! Error: PF is null '%s'; exiting.\n" % mypv)
 		return 1
+	slot = mysettings["SLOT"]
 	if mydo != "depend":
 		# XXX: We're doing a little hack here to curtain the gvisible locking
 		# XXX: that creates a deadlock... Really need to isolate that.
@@ -2319,6 +2320,7 @@
 	mysettings.setcpv(mycpv,use_cache=use_cache)
 
 	mysettings["EBUILD_PHASE"] = mydo
+	mysettings["SLOT"] = slot
 
 	if debug: # Otherwise it overrides emerge's settings.
 		# We have no other way to set debug... debug can't be passed in
@@ -2365,8 +2367,6 @@
 		mysettings["PVR"]=mysplit[1]
 	else:
 		mysettings["PVR"]=mysplit[1]+"-"+mysplit[2]
-
-	mysettings["SLOT"]=""
 
 	if mysettings.has_key("PATH"):
 		mysplit=string.split(mysettings["PATH"],":")
@@ -5797,7 +5797,7 @@
 			myslot = self.settings["SLOT"]
 			for v in otherversions:
 				# only allow versions with same slot to overwrite files
-				if myslot == db[self.myroot]["vartree"].dbapi.aux_get(self.mycpv, ["SLOT"])[0]:
+				if myslot == db[self.myroot]["vartree"].dbapi.aux_get("/".join((self.cat, v)), ["SLOT"])[0]:
 					mypkglist.append(dblink(self.cat,v,destroot,self.settings))
 
 			print green("*")+" checking "+str(len(myfilelist))+" files for package collisions"

