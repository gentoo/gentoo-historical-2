#!/usr/bin/spython

import os
import portage
import string
import sys

#Things that need to be done:
# system profile support

#create db of installed packages at "root"
installed=portage.vartree(portage.root)
current=portage.currenttree(portage.getsetting("CURRENTFILE"))
available=portage.portagetree(portage.getsetting("PORTDIR"))

for mykey in installed.getallnodes():
	installednode=installed.getnode(mykey)
	currentnode=current.getnode(mykey)
	availnode=available.getnode(mykey)
	if not current.hasnode(mykey):
		continue
	if ((len(installednode)==1) and (current.hasnode(mykey))):
		if (len(currentnode)==1):
			if current.exists_specific(installednode[0][0]):
				continue
	print "Package",mykey
	print "Installed version(s):"
	for inspkg in installednode:
		print " ",inspkg[0]
	# print available portage versions, labelling one as the recommended version
	print "Available versions:"
	if available.hasnode(mykey):
		for avpkg in availnode:
			print " ",avpkg[0]
	else:
		print " ","(none)"
	print "Recommended version(s):"
	if len(currentnode)==0:
		print " ","(none)"
	else:
		for curpkg in currentnode:
			print " ",curpkg[0]
		
	print
