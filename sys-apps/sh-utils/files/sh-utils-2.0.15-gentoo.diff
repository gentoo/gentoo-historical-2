--- sh-utils-2.0.15/src/uname.c	Thu Jul 18 15:32:33 2002
+++ sh-utils-2.0.15-linux_uname/src/uname.c	Mon Aug 19 20:05:55 2002
@@ -130,6 +130,91 @@
   exit (status);
 }
 
+/* Carlos E. Gorges <carlos@techlinux.com.br> - return vendor_id from proc cpuinfo */
+
+#ifdef __linux__
+
+char *
+cmpdup (char *cstr, char *cmpstr, char *dstr) {
+	if ( (cstr && cmpstr) && !strcmp(cstr, cmpstr) ) 
+					return strdup(dstr);
+	return NULL;
+}
+
+char * 
+__sysinfo_processor_type (void) 
+{
+	FILE *ffd;
+	char 	*cstr=calloc(1,sizeof(char)*64),
+		*dstr=calloc(1,sizeof(char)*128),
+		*fstr=calloc(1,sizeof(char)*256),
+		*model,*vendor;
+		
+	model=vendor=NULL;
+	
+	if ( ffd=fopen("/proc/cpuinfo", "r") )
+	{
+		while ( fscanf(ffd, "%[^:\t]\t: %[^\n]\n", cstr, dstr) != EOF )
+		{
+			if(!cstr || !dstr) 
+					break;		// ????
+
+			#if defined(__i386__)
+				if(!vendor) 
+					vendor = cmpdup(cstr, "vendor_id", dstr);
+				if(!model) 
+					model = cmpdup(cstr, "model name", dstr);
+			#endif
+			#if defined(__ia64__) || defined(__x86_64__)
+				if(!vendor) 
+					vendor = cmpdup(cstr, "vendor", dstr);
+				if(!model) 
+					model = cmpdup(cstr, "model", dstr);			
+			#endif
+			#if defined(__alpha__)
+				if(!vendor) 
+					vendor = strdup("Alpha");
+				if(!model)
+					 model = cmpdup(cstr, "cpu model", dstr);
+			#endif
+			#if defined(sparc) || defined(__sparc__)
+				if(!vendor) 
+					vendor = cmpdup(cstr, "cpu", dstr);
+				if(!model)
+					model = cmpdup(cstr, "type", dstr);
+			#endif
+			#if defined(__mips__)
+				if(!vendor) 
+					vendor = cmpdup(cstr, "system type", dstr);
+				if(!model) 
+					model = cmpdup(cstr, "cpu model", dstr);
+			#endif
+			#if defined(PPC)
+				if(!vendor) 
+					vendor = cmpdup(cstr, "cpu", dstr);
+				if(!model) 
+					model = cmpdup(cstr, "processor", dstr);
+			#endif
+		}
+
+		fclose(ffd);
+
+		if(vendor || model) {
+			if(vendor) {
+				strcat(fstr,vendor);
+				strcat(fstr," ");
+			}
+			if(model) 
+				strcat(fstr,model);
+			return fstr;
+		}
+	}
+		
+	return NULL;	
+}
+#endif
+
+
 /* Print ELEMENT, preceded by a space if something has already been
    printed.  */
 
@@ -246,7 +331,16 @@
 	if (0 <= sysinfo (SI_ARCHITECTURE, processor, sizeof processor))
 	  element = processor;
       }
+#else
+	#ifdef __linux__
+	{
+	  char *processor;
+	  if( processor=__sysinfo_processor_type() ) 
+				element = processor;
+	}
+	#endif
 #endif
+
 #ifdef UNAME_PROCESSOR
       if (element == unknown)
 	{
@@ -291,3 +385,4 @@
 
   exit (0);
 }
+

