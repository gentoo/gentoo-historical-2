diff -r -U3 procps-2.0.7.orig/Makefile procps-2.0.7/Makefile
--- procps-2.0.7.orig/Makefile	Thu Jul 13 22:22:58 2000
+++ procps-2.0.7/Makefile	Mon Feb 19 16:27:20 2001
@@ -4,7 +4,7 @@
 export PREFIX     =  #proc# prefix for program names
 
 export DESTDIR    = /
-export MANDIR     =  /usr/man
+export MANDIR     =  /usr/share/man
 export MAN1DIR    =  $(DESTDIR)$(MANDIR)/man1
 export MAN5DIR    =  $(DESTDIR)$(MANDIR)/man5
 export MAN8DIR    =  $(DESTDIR)$(MANDIR)/man8
@@ -48,7 +48,7 @@
 
 #BFD_CAPABLE = -DBFD_CAPABLE
 #AOUT_CAPABLE = #-DAOUT_CAPABLE 
-#ELF_CAPABLE = #-DELF_CAPABLE
+ELF_CAPABLE = -DELF_CAPABLE
 
 #LIBBFD = -lbfd -liberty
 LIBCURSES  =  -lncurses# watch is the only thing that needs this
diff -r -U3 procps-2.0.7.orig/proc/readproc.c procps-2.0.7/proc/readproc.c
--- procps-2.0.7.orig/proc/readproc.c	Mon Jul 10 21:55:39 2000
+++ procps-2.0.7/proc/readproc.c	Mon Feb 19 16:27:20 2001
@@ -25,7 +25,7 @@
  */
 PROCTAB* openproc(int flags, ...) {
     va_list ap;
-    PROCTAB* PT = xmalloc(sizeof(PROCTAB));
+    PROCTAB* PT = xcalloc(NULL, sizeof(PROCTAB));
     
     if (Do(PID))
       PT->procfs = NULL;
diff -r -U3 procps-2.0.7.orig/proc/sysinfo.c procps-2.0.7/proc/sysinfo.c
--- procps-2.0.7.orig/proc/sysinfo.c	Mon Jul 10 21:36:13 2000
+++ procps-2.0.7/proc/sysinfo.c	Mon Feb 19 16:27:20 2001
@@ -18,6 +18,10 @@
 #include <fcntl.h>
 #include "proc/version.h"
 
+#ifndef HZ
+#include <netinet/in.h> /* htons */
+#endif
+
 #define BAD_OPEN_MESSAGE					\
 "Error: /proc must be mounted\n"				\
 "  To mount /proc at boot you need an /etc/fstab line like:\n"	\
@@ -139,7 +143,7 @@
 #ifdef HZ
     Hertz = (unsigned long)HZ;    /* <asm/param.h> */
 #else
-    Hertz = (sizeof(long)==sizeof(int)) ? 100UL : 1024UL;
+    Hertz = (sizeof(long)==sizeof(int) || htons(999)==999) ? 100UL : 1024UL;
 #endif
 #if 0 /* This ends up causing more harm than good.  :-( */
     fprintf(stderr, "Unknown HZ value! (%ld) Assume %ld.\n", h, Hertz);
@@ -217,7 +221,7 @@
     	for (i=0; i < MAX_ROW && *p; i++) {                /* loop over rows */
 		while(*p && !isdigit(*p)) p++;          /* skip chars until a digit */
 		for (j=0; j < MAX_COL && *p; j++) {     /* scanf column-by-column */
-		    l = sscanf(p, "%u%n", row[i] + j, &k);
+		    l = sscanf(p, "%llu%n", row[i] + j, &k);
 		    p += k;                             /* step over used buffer */
 		    if (*p == '\n' || l < 1)            /* end of line/buffer */
 			break;
@@ -280,7 +284,7 @@
 
 /**************************************************************************
  * shorthand for read_table("/proc/meminfo")[meminfo_main][meminfo_total] */
-unsigned read_total_main(void) {
+unsigned long long read_total_main(void) {
     unsigned long long** mem;
     return (mem = meminfo()) ? mem[meminfo_main][meminfo_total] : -1;
 }
diff -r -U3 procps-2.0.7.orig/proc/sysinfo.h procps-2.0.7/proc/sysinfo.h
--- procps-2.0.7.orig/proc/sysinfo.h	Tue Nov  2 16:44:58 1999
+++ procps-2.0.7/proc/sysinfo.h	Mon Feb 19 16:27:20 2001
@@ -2,6 +2,7 @@
 #define SYSINFO_H
 
 extern unsigned long Hertz;   /* clock tick frequency */
+extern long smp_num_cpus;
 
 #define JT unsigned long
 extern int four_cpu_numbers(JT *uret, JT *nret, JT *sret, JT *iret);
@@ -18,6 +19,6 @@
 		   meminfo_shared, meminfo_buffers, meminfo_cached
 };
 
-extern unsigned read_total_main(void);
+extern unsigned long long read_total_main(void);
 
 #endif /* SYSINFO_H */
diff -r -U3 procps-2.0.7.orig/ps/global.c procps-2.0.7/ps/global.c
--- procps-2.0.7.orig/ps/global.c	Fri Nov  5 00:56:29 1999
+++ procps-2.0.7/ps/global.c	Mon Feb 19 16:27:20 2001
@@ -109,6 +109,7 @@
     screen_cols = 80;
     screen_rows = 24;
   }
+  if(!isatty(STDOUT_FILENO)) screen_cols = OUTBUF_SIZE;
   columns = getenv("COLUMNS");
   if(columns && *columns){
     long t;
diff -r -U3 procps-2.0.7.orig/ps/output.c procps-2.0.7/ps/output.c
--- procps-2.0.7.orig/ps/output.c	Tue Jul 11 20:37:46 2000
+++ procps-2.0.7/ps/output.c	Mon Feb 19 16:27:20 2001
@@ -876,7 +876,7 @@
 /* temporary hack -- mark new stuff grabbed from Debian ps */
 #define LNx LNX
 
-/* there are about 194 listed */
+/* there are about 195 listed */
 
 /* Many of these are placeholders for unsupported options. */
 static const format_struct format_array[] = {
@@ -886,6 +886,7 @@
 {"acflag",    "ACFLG",   pr_nop,      sr_nop,     5,   0,    XXX, RIGHT}, /*acflg*/
 {"acflg",     "ACFLG",   pr_nop,      sr_nop,     5,   0,    BSD, RIGHT}, /*acflag*/
 {"addr",      "ADDR",    pr_nop,      sr_nop,     4,   0,    XXX, RIGHT},
+{"addr1",     "ADDR",    pr_nop,      sr_nop,     1,   0,    LNX, LEFT},
 {"alarm",     "ALARM",   pr_alarm,    sr_it_real_value, 5, 0, LNX, RIGHT},
 {"argc",      "ARGC",    pr_nop,      sr_nop,     4,   0,    LNX, RIGHT},
 {"args",      "COMMAND", pr_args,     sr_nop,    16,   0,    U98, UNLIMITED}, /*command*/
diff -r -U3 procps-2.0.7.orig/ps/parser.c procps-2.0.7/ps/parser.c
--- procps-2.0.7.orig/ps/parser.c	Fri Nov  5 01:16:13 1999
+++ procps-2.0.7/ps/parser.c	Mon Feb 19 16:27:20 2001
@@ -80,6 +80,7 @@
   if(*endp != '\0')   return pidsyntax;
   if(num>0x7fff)      return pidrange;  /* Linux PID limit */
   if(num<0)           return pidrange;
+  if(num<1)           return pidrange;
   ret->pid = num;
   return 0;
 }
@@ -549,7 +550,7 @@
       trace("a Select all w/tty, including other users\n");
       /* Now the PER_SUN_MUTATE_a flag is handled elsewhere. */
       /* if(personality & PER_SUN_MUTATE_a) simple_select |= SS_U_a;
-      else               */              simple_select |= SS_B_a;
+      simple_select |= SS_B_a;
       break;
     case 'c':
       trace("c true command name\n");
diff -r -U3 procps-2.0.7.orig/ps/select.c procps-2.0.7/ps/select.c
--- procps-2.0.7.orig/ps/select.c	Fri Mar 12 11:34:44 1999
+++ procps-2.0.7/ps/select.c	Mon Feb 19 16:27:20 2001
@@ -29,23 +29,26 @@
 
 /***** prepare select_bits for use */
 const char *select_bits_setup(void){
-  if(!simple_select){  /* don't want a 'g' added to this (or do we?) */
-    select_bits = 0xaa00;
+  int switch_val = 0;
+  if(!simple_select && !prefer_bsd){  /* don't want a 'g' added to this (or do we?) */
+    select_bits = 0xa0a0;
     return NULL;
   }
-  /* For everybody but Sun, the 'g' option is a NOP */
+  /* For everybody but Sun, the 'g' option is a NOP (enabled by default)*/
   if( !(personality & PER_SUN_MUTATE_a) && !(simple_select&(SS_U_a|SS_U_d)) )
-    simple_select |= SS_B_g;
-  switch(simple_select){
-  case SS_U_a | SS_U_d:
-  case          SS_B_x | SS_B_a:
-  case SS_U_d:                    select_bits = 0x3333; break;
+    switch_val = simple_select|SS_B_g;
+  else
+    switch_val = simple_select;
+  switch(switch_val){
+  case SS_U_a | SS_U_d:           select_bits = 0x3f3f; break;
   case SS_U_a:                    select_bits = 0x0303; break;
-  case                   SS_B_a:  select_bits = 0x3300; break;
-  case          SS_B_x         :  select_bits = 0x2222; break;
-  case SS_B_g                  :  select_bits = 0xaa00; break;
-  case SS_B_g |          SS_B_a:  select_bits = 0x0f00; break;
-  case SS_B_g | SS_B_x         :  select_bits = 0xaaaa; break;
+  case SS_U_d:                    select_bits = 0x3333; break;
+  case 0:                         select_bits = 0x0202; break;
+  case SS_B_x:                    select_bits = 0x2222; break;
+  case SS_B_x | SS_B_a:           select_bits = 0x3333; break;
+  case SS_B_g:                    select_bits = 0x0a0a; break;
+  case SS_B_g | SS_B_a:           select_bits = 0x0f0f; break;
+  case SS_B_g | SS_B_x:           select_bits = 0xaaaa; break;
   case SS_B_g | SS_B_x | SS_B_a:
     all_processes = 1;
     simple_select = 0;
@@ -67,39 +70,6 @@
   return (select_bits & (1<<proc_index));
 }
 
-#if 0
-/***** selected by simple option? */
-static int table_accept(proc_t *buf){
-  unsigned proc_index;
-#ifdef ACT_LIKE_SUNOS4
-  static unsigned table[] = {
-    0xfffffff0, 0xfffffff0, 0xccccccc0, 0xccccccc0,  /* process has some other tty */
-    0xfafafaf0, 0xfafafafa, 0xc8c8c8c0, 0xc8c8c8c8,  /* no tty, ps itself has one */
-    0xfffffff0, 0xffffffff, 0xccccccc0, 0xcccccccc,  /* process has same tty as ps */
-    0xfafafaf0, 0xfafafafa, 0xc8c8c8c0, 0xc8c8c8c8   /* nobody has a tty */
-  };
-#else
-  static unsigned table[] = {
-    0xfffffff0, 0xfffffff0, 0xffffccc0, 0xffffccc0,  /* process has some other tty */
-    0xfafafaf0, 0xfafafafa, 0xfafac8c0, 0xfafac8c8,  /* no tty, ps itself has one */
-    0xfffffff0, 0xffffffff, 0xffffccc0, 0xffffcccc,  /* process has same tty as ps */
-    0xfafafaf0, 0xfafafafa, 0xfafac8c0, 0xfafac8c8   /* nobody has a tty */
-  };
-#endif
-  proc_index = (has_our_euid(buf)    <<0)
-             | (session_leader(buf)  <<1)
-             | (without_a_tty(buf)   <<2)
-             | (on_our_tty(buf)      <<3);
-/*
-  printf("0x%08x 0x%08x 0x%08x %-8.8s\n",
-         table[proc_index],
-         (1<<simple_select),
-         table[proc_index] & (1<<simple_select),
-         buf->cmd);
-*/
-  return (table[proc_index] & (1<<simple_select));
-}
-#endif
 
 /***** selected by some kind of list? */
 static int proc_was_listed(proc_t *buf){
diff -r -U3 procps-2.0.7.orig/ps/sortformat.c procps-2.0.7/ps/sortformat.c
--- procps-2.0.7.orig/ps/sortformat.c	Mon Jul 10 23:25:30 2000
+++ procps-2.0.7/ps/sortformat.c	Mon Feb 19 16:27:20 2001
@@ -667,11 +667,9 @@
       format_list=fn;
     }
     PUSH("sz");
-  }
-  if(format_flags & FF_Ul){
     if(format_modifiers & FM_y) PUSH("rss");
     else if(personality & (PER_ZAP_ADDR|PER_IRIX_l)) PUSH("sgi_p");
-    else PUSH("addr");
+    else PUSH("addr_1");
   }
   if(format_modifiers & FM_c){
     PUSH("pri"); PUSH("class");
diff -r -U3 procps-2.0.7.orig/top.c procps-2.0.7/top.c
--- procps-2.0.7.orig/top.c	Thu Jul 13 22:19:21 2000
+++ procps-2.0.7/top.c	Mon Feb 19 16:27:48 2001
@@ -153,7 +153,7 @@
 	    break;
 	  case 'S':
 	    Cumulative = 1;
-	    headers[22][1] = 'C';
+	    headers[22] = TOPHDR_CTIME;
 	    break;
 	  case 's':
 	    Secure = 1;
@@ -795,7 +795,7 @@
 void show_fields(void)
 {
     int i, row, col;
-    char *p;
+    const char *p;
 
     clear_screen();
     PUTP(tgoto(cm, 3, 0));
@@ -1690,9 +1690,9 @@
 	Cumulative = !Cumulative;
 	SHOWMESSAGE(("Cumulative mode %s", Cumulative ? "on" : "off"));
 	if (Cumulative)
-	    headers[22][1] = 'C';
+	    headers[22] = TOPHDR_CTIME;
 	else
-	    headers[22][1] = ' ';
+	    headers[22] = TOPHDR_TIME;
 	Numfields = make_header();
 	break;
       case 's':
diff -r -U3 procps-2.0.7.orig/top.h procps-2.0.7/top.h
--- procps-2.0.7.orig/top.h	Thu Jul 13 22:19:22 2000
+++ procps-2.0.7/top.h	Mon Feb 19 16:27:46 2001
@@ -130,8 +130,12 @@
     P_WCHAN, P_STAT, P_TIME, P_COMMAND,
     P_LCPU, P_FLAGS, P_END
 };
+
+#define TOPHDR_TIME	"  TIME "
+#define TOPHDR_CTIME	" CTIME "
+
 /* corresponding headers */
-char *headers[] =
+const char *headers[] =
 {
     "  PID ", " PPID ", " UID ",
     "USER     ", "%CPU ", "%MEM ",
@@ -140,12 +144,12 @@
     " SIZE ", " TRS ", "SWAP ",
     "SHARE ", "  A ", " WP ",
     "  D ", " RSS ", "WCHAN     ",
-    "STAT ", "  TIME ", "COMMAND",
+    "STAT ", TOPHDR_TIME , "COMMAND",
     "LC ",
     "   FLAGS "
 };
 /* corresponding field desciptions */
-char *headers2[] =
+const char *headers2[] =
 {
     "Process Id", "Parent Process Id", "User Id",
     "User Name", "CPU Usage", "Memory Usage",
diff -r -U3 procps-2.0.7.orig/watch.c procps-2.0.7/watch.c
--- procps-2.0.7.orig/watch.c	Mon Jul 10 22:50:02 2000
+++ procps-2.0.7/watch.c	Mon Feb 19 16:27:20 2001
@@ -15,8 +15,8 @@
 
 #include <ctype.h>
 #include <getopt.h>
-#include <signal.h>
 #include <ncurses.h>
+#include <signal.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
