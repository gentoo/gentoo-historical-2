Index: src/Makefile
===================================================================
--- src/Makefile	(revision 6612)
+++ src/Makefile	(working copy)
@@ -1,21 +1,24 @@
 # Set the C flags to include the GTK+ and Python libraries
 PYTHON ?= python
 PYTHONVER = `$(PYTHON) -c 'import sys; print sys.version[:3]'`
-CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0` -fPIC -I/usr/include/python$(PYTHONVER) -I.
-LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0` -lpython$(PYTHONVER)
+gtk_CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0` -fPIC -I/usr/include/python$(PYTHONVER) -I.
+gtk_LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0` -lpython$(PYTHONVER)
 
 all: trayicon.so gtkspell.so
 
 # Build the shared objects
 trayicon.so: trayicon.o eggtrayicon.o trayiconmodule.o
-	$(CC) $(LDFLAGS) -shared $^ -o $@
+	$(CC) -shared $^ -o $@ $(LDFLAGS) $(gtk_LDFLAGS)
 
 gtkspell.so:
-	$(CC) $(OPTFLAGS) $(CFLAGS) $(LDFLAGS) `pkg-config --libs --cflags gtkspell-2.0` -shared gtkspellmodule.c $^ -o $@
+	$(CC) $(OPTFLAGS) $(CFLAGS) $(LDFLAGS) $(gtk_CFLAGS) $(gtk_LDFLAGS) `pkg-config --libs --cflags gtkspell-2.0` -shared gtkspellmodule.c $^ -o $@
 
 # The path to the GTK+ python types
 DEFS=`pkg-config --variable=defsdir pygtk-2.0`
 
+%.o: %.c
+	$(CC) -o $@ -c $< $(CFLAGS) $(gtk_CFLAGS)
+
 # Generate the C wrapper from the defs and our override file
 trayicon.c: trayicon.defs trayicon.override
 	pygtk-codegen-2.0 --prefix trayicon \
Index: src/common/Makefile
===================================================================
--- src/common/Makefile	(revision 6612)
+++ src/common/Makefile	(working copy)
@@ -6,19 +6,19 @@
 
 ifeq ($(HAVE_XSCRNSAVER),YES)
 # We link with libXScrnsaver from modular X.Org X11
-CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0 xscrnsaver` -fpic -I/usr/include/python$(PYTHONVER) -I.
-LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0 xscrnsaver` -lpython$(PYTHONVER)
+gtk_and_x_CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0 xscrnsaver` -fpic -I/usr/include/python$(PYTHONVER) -I.
+gtk_and_x_LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0 xscrnsaver` -lpython$(PYTHONVER)
 else
 # # We link with libXScrnsaver from monolithic X.Org X11
-CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0` -fpic -I/usr/include/python$(PYTHONVER) -I.
-LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0` -L/usr/X11R6$(LIBDIR) -lX11 \
-	-lXss -lXext -lpython$(PYTHONVER)
+gtk_and_x_CFLAGS = `pkg-config --cflags gtk+-2.0 pygtk-2.0` -fpic -I/usr/include/python$(PYTHONVER) -I.
+gtk_and_x_LDFLAGS = `pkg-config --libs gtk+-2.0 pygtk-2.0` \
+	-L/usr/X11R6$(LIBDIR) -lX11 -lXss -lXext -lpython$(PYTHONVER)
 endif
 
 all: idle.so
 
 idle.so:
-	$(CC) $(OPTFLAGS) $(CFLAGS) $(LDFLAGS) -shared idle.c $^ -o $@
+	$(CC) $(OPTFLAGS) $(CFLAGS) $(LDFLAGS) $(gtk_and_x_CFLAGS) $(gtk_and_x_LDFLAGS) -shared idle.c $^ -o $@
 
 clean:
 	rm -f *.so
