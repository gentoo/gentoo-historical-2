See Gentoo bug #136845 and KDE bug #128997.

diff -Nur kopete-0.12.0.old/kopete/protocols/jabber/jabbercontact.cpp kopete-0.12.0/kopete/protocols/jabber/jabbercontact.cpp
--- kopete-0.12.0.old/kopete/protocols/jabber/jabbercontact.cpp	2006-05-31 09:54:02.000000000 +0930
+++ kopete-0.12.0/kopete/protocols/jabber/jabbercontact.cpp	2006-06-14 08:17:54.000000000 +0930
@@ -64,7 +64,7 @@
  * JabberContact constructor
  */
 JabberContact::JabberContact (const XMPP::RosterItem &rosterItem, Kopete::Account *_account, Kopete::MetaContact * mc, const QString &legacyId)
-	: JabberBaseContact ( rosterItem, _account, mc, legacyId)  , m_syncTimer(0L)
+	: JabberBaseContact ( rosterItem, _account, mc, legacyId)  , mDiscoDone(false), m_syncTimer(0L)
 {
 	kdDebug(JABBER_DEBUG_GLOBAL) << k_funcinfo << contactId() << "  is created  - " << this << endl;
 	// this contact is able to transfer files
@@ -118,7 +118,6 @@
 	mRequestDeliveredEvent = false;
 	mRequestComposingEvent = false;
 	mRequestGoneEvent = false;
-	mDiscoDone = false;
 }
 
 
diff -Nur kopete-0.12.0.old/kopete/protocols/jabber/jabbercontactpool.cpp kopete-0.12.0/kopete/protocols/jabber/jabbercontactpool.cpp
--- kopete-0.12.0.old/kopete/protocols/jabber/jabbercontactpool.cpp	2006-05-31 09:54:02.000000000 +0930
+++ kopete-0.12.0/kopete/protocols/jabber/jabbercontactpool.cpp	2006-06-14 08:18:01.000000000 +0930
@@ -22,6 +22,7 @@
 #include <kdebug.h>
 #include <kmessagebox.h>
 #include <kopeteaccountmanager.h>
+#include <kopetecontactlist.h>
 #include "kopeteuiglobal.h"
 #include "jabberprotocol.h"
 #include "jabberbasecontact.h"
@@ -118,14 +119,34 @@
 	JabberContactPoolItem *mContactItem = findPoolItem ( mContact );
 	if ( mContactItem)
 	{
-		kdDebug(JABBER_DEBUG_GLOBAL) << k_funcinfo << "Updating existing contact " << mContact.jid().full() << endl;
-
-		// It exists, update it.
-		mContactItem->contact()->updateContact ( mContact );
-		mContactItem->setDirty ( dirty );
+		if(mContactItem->contact()->inherits(roomContact ?
+				 (const char*)("JabberGroupContact") : (const char*)("JabberGroupMemberContact") ) )
+		{
+			
+			kdDebug(JABBER_DEBUG_GLOBAL) << k_funcinfo << "Updating existing contact " << mContact.jid().full() << endl;
+			
+			// It exists, update it.
+			mContactItem->contact()->updateContact ( mContact );
+			mContactItem->setDirty ( dirty );
+	
+			//we must tell to the originating function that no new contact has been added
+			return 0L;//mContactItem->contact ();
+		}
+		else
+		{
+			//this happen if we receive a MUC invitaiton:  when the invitaiton is received, it's from the muc itself
+			//and then kopete will create a temporary contact for it. but it will not be a good contact.
+			kdDebug(JABBER_DEBUG_GLOBAL) << k_funcinfo << "Bad contact will be removed and re-added " << mContact.jid().full() << endl;
+			Kopete::MetaContact *old_mc=mContactItem->contact()->metaContact();
+			delete mContactItem->contact();
+			mContactItem = 0L;
+			if(old_mc->contacts().isEmpty() && old_mc!=metaContact)
+			{
+				Kopete::ContactList::self()->removeMetaContact( old_mc );
+			}
+			
+		}
 
-		//we must tell to the originating function that no new contact has been added
-		return 0L;//mContactItem->contact ();
 	}
 
 	kdDebug(JABBER_DEBUG_GLOBAL) << k_funcinfo << "Adding new contact " << mContact.jid().full() << endl;
