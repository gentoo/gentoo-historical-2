#!/sbin/runscript
# Copyright 1999-2011 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/net-dns/pdnsd/files/pdnsd.online.1,v 1.1 2011/03/27 17:31:44 flameeyes Exp $

depend() {
	need pdnsd
}

wait_for_socket() {
	local i pdnsd_socket="/var/cache/pdnsd/pdnsd.status"
	while [ ! -S "${pdnsd_socket}" -a $i -lt 10 ]; do
		sleep 1s
		: $((i++))
	done

	if [ ! -S "${pdnsd_socket}" ]; then
    	eerror "${pdnsd_socket} socket is missing."
    	return 1
	fi

	return 0
}

start() {
	wait_for_socket || return 1
	ebegin "Starting pdnsd-online"
	/usr/sbin/pdnsd-ctl -q server all up
	eend $?
}

stop() {
	ebegin "Stopping pdnsd-online"
	/usr/sbin/pdnsd-ctl -q server all down
	eend $?
}
