--- pdns/recursor_cache.cc
+++ pdns/recursor_cache.cc
@@ -11,7 +11,10 @@
 #include "config.h"
 
 #ifdef GCC_SKIP_LOCKING
-#include <bits/atomicity.h>
+#if (__GNUC__ > 4) || ((__GNUC__ == 4) && (__GNUC_MINOR__ >= 2))
+# include <ext/atomicity.h>
+#else
+# include <bits/atomicity.h>
 // This code is ugly but does speedup the recursor tremendously on multi-processor systems, and even has a large effect (20, 30%) on uniprocessor 
 namespace __gnu_cxx
 {
@@ -32,6 +35,7 @@
   }
 }
 #endif
+#endif
 
 string simpleCompress(const string& label)
 {
