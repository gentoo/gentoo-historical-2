--- pdf.c	2005-08-02 17:43:36.000000000 +0200
+++ pdf.c	2005-08-02 17:45:33.000000000 +0200
@@ -17,12 +17,12 @@
    +----------------------------------------------------------------------+
 */
 
-/* $Id: pdf.c,v 1.143 2004/11/30 11:42:13 rjs Exp $ */
+/* $Id: pdf.c,v 1.144 2005/03/08 12:02:19 rjs Exp $ */
 
 /* {{{ Comments about the module */
 
 /* derived from:
-   $Id: pdf.c,v 1.143 2004/11/30 11:42:13 rjs Exp $
+   $Id: pdf.c,v 1.144 2005/03/08 12:02:19 rjs Exp $
    synced with pdflib.h 1.237 */
 
 /* PDFlib 2.02 ... 4.0.x is subject to the ALADDIN FREE PUBLIC LICENSE.
@@ -63,8 +63,12 @@
 
 /* Bootstrap of PDFlib Feature setup */
 #define PDF_FEATURE_INTERNAL
+#define   PDFLIB_PECL_VERSIONSTRING "2.0.4-r1"
 
-#define   PDFLIB_PECL_VERSIONSTRING "2.0.3"
+/* set this define if you want to include GD support
+ * this adds the (unofficial) function pdf_open_memory_image()
+#define PDFLIB_WITH_GD_SUPPORT
+*/
 
 /* }}} */
 
@@ -87,6 +91,7 @@
 # include "Zend/zend_exceptions.h"
 #endif /* PHP_MAJOR_VERSION >= 5 */
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 # include "ext/gd/php_gd.h"
 # if HAVE_GD_BUNDLED
@@ -96,6 +101,7 @@
 # endif /* HAVE_GD_BUNDLED */
  static int le_gd;
 #endif /* HAVE_LIBGD13 */
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 #ifdef HAVE_UNISTD_H
 # include <unistd.h>
@@ -299,10 +305,12 @@
 
 	/* End of the official PDFLIB API */
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 	/* not supported by PDFlib GmbH */
 	PHP_FE(pdf_open_memory_image, NULL)
 #endif /* HAVE_LIBGD13 */
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 	{NULL, NULL, NULL}
 };
@@ -491,10 +499,12 @@
 
 	/* End of the official PDFLIB API */
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 	/* not supported by PDFlib GmbH */
 	/* PHP_ME_MAPPING(open_memory_image, pdf_open_memory_image, NULL) */
 #endif /* HAVE_LIBGD13 */
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 	{NULL, NULL, NULL}
 };
@@ -768,7 +778,7 @@
 	php_info_print_table_row(2, "PDF Support", "enabled" );
 	php_info_print_table_row(2, "PDFlib GmbH Version", PDFLIB_VERSIONSTRING );
 	php_info_print_table_row(2, "PECL Version", PDFLIB_PECL_VERSIONSTRING);
-	php_info_print_table_row(2, "Revision", "$Revision: 1.143 $" );
+	php_info_print_table_row(2, "Revision", "$Revision: 1.144 $" );
 	php_info_print_table_end();
 
 }
@@ -7197,6 +7207,7 @@
 
 
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 /* {{{ proto int pdf_open_memory_image(resource p, int image)
    Takes an GD image and returns an image for placement in a PDF document */
@@ -7276,6 +7287,7 @@
 }
 /* }}} */
 #endif /* HAVE_LIBGD13 */
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 #else /* PDFLIB_MAJORVERSION < 5 */
 /* use the old wrapper for PDFlib 4 and earlier */
--- pdf4.c	2005-08-02 17:43:43.000000000 +0200
+++ pdf4.c	2005-08-02 17:47:52.000000000 +0200
@@ -17,7 +17,7 @@
    +----------------------------------------------------------------------+
 */
 
-/* $Id: pdf4.c,v 1.2 2004/11/30 11:42:13 rjs Exp $ */
+/* $Id: pdf4.c,v 1.4 2005/07/08 06:22:03 steinm Exp $ */
 
 /* pdflib 2.02 ... 3.0x is subject to the ALADDIN FREE PUBLIC LICENSE.
    Copyright (C) 1997-1999 Thomas Merz. 2000-2001 PDFlib GmbH */
@@ -40,6 +40,7 @@
 #include "ext/standard/file.h"
 #include "php_streams.h"
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 #include "ext/gd/php_gd.h"
 #if HAVE_GD_BUNDLED
@@ -49,6 +50,7 @@
 #endif
 static int le_gd;
 #endif
+#endif / * PDFLIB_WITH_GD_SUPPORT * /
 
 #ifdef HAVE_UNISTD_H
 # include <unistd.h>
@@ -187,9 +189,11 @@
 
 	/* some more stuff for compatibility */
 	PHP_FE(pdf_add_annotation, NULL)
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 	PHP_FE(pdf_open_memory_image, NULL)
 #endif
+#endif
 	/* depreciatet after V4.0 of PDFlib */
 	PHP_FE(pdf_setgray_fill, NULL)
 	PHP_FE(pdf_setgray_stroke, NULL)
@@ -334,7 +338,7 @@
 #else
 	php_info_print_table_row(2, "PDFlib GmbH Version", tmp );
 #endif
-	php_info_print_table_row(2, "Revision", "$Revision: 1.2 $" );
+	php_info_print_table_row(2, "Revision", "$Revision: 1.4 $" );
 	php_info_print_table_end();
 
 }
@@ -1949,6 +1953,7 @@
 }
 /* }}} */
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 /* {{{ proto int pdf_open_memory_image(int pdf, int image)
    Takes an GD image and returns an image for placement in a PDF document */
@@ -2015,6 +2020,7 @@
 }
 /* }}} */
 #endif /* HAVE_LIBGD13 */
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 /* {{{ proto void pdf_close_image(int pdf, int pdfimage)
    Closes the PDF image */
--- php_pdf.h	2005-08-02 17:44:20.000000000 +0200
+++ php_pdf.h	2005-08-02 17:49:15.000000000 +0200
@@ -16,7 +16,7 @@
    +----------------------------------------------------------------------+
 */
 
-/* $Id: php_pdf.h,v 1.30 2004/11/30 11:42:13 rjs Exp $ */
+/* $Id: php_pdf.h,v 1.31 2005/03/08 12:02:19 rjs Exp $ */
 /* Derived from:
     Id: php_pdf.h,v 1.22 2001/11/30 04:46:35 sniper Exp */
 
@@ -201,10 +201,12 @@
 #endif /* PDFlib >= 6.0.0 */
 
 
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 /* not supported by PDFlib GmbH */
 PHP_FUNCTION(pdf_open_memory_image);
 #endif
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 #ifdef ZTS
 #define PDFG(v) TSRMG(pdf_globals_id, php_pdf_globals *, v)
--- php_pdf4.h	2005-08-02 17:44:26.000000000 +0200
+++ php_pdf4.h	2005-08-02 17:50:39.000000000 +0200
@@ -16,7 +16,7 @@
    +----------------------------------------------------------------------+
 */
 
-/* $Id: php_pdf4.h,v 1.2 2004/11/30 11:42:13 rjs Exp $ */
+/* $Id: php_pdf4.h,v 1.3 2005/03/08 12:02:20 rjs Exp $ */
 
 #ifndef PHP_PDF_H
 #define PHP_PDF_H
@@ -140,9 +140,11 @@
 
 /* some more stuff for compatibility */
 PHP_FUNCTION(pdf_add_annotation);
+#if PDFLIB_WITH_GD_SUPPORT
 #if HAVE_LIBGD13
 PHP_FUNCTION(pdf_open_memory_image);
 #endif
+#endif /* PDFLIB_WITH_GD_SUPPORT */
 
 #if (PDFLIB_MAJORVERSION >= 4)
 /* support for new functions in PDFlib V4.0 */
