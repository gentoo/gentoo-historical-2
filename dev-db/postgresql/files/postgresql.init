#!/sbin/runscript
# Copyright 1999-2004 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/dev-db/postgresql/files/postgresql.init,v 1.2 2004/02/13 19:26:31 vapier Exp $

depend() {
	need net
}

checkconfig() {
	if [ ! -d $PGDATA ]; then
		eerror "directory not found: $PGDATA"
		eerror "You should create PGDATA directory first."
		return 1
	fi
}

start() {
	checkconfig || return 1

	ebegin "Starting postgres"
	if [ -f $PGDATA/postmaster.pid ]; then
		rm $PGDATA/postmaster.pid
	fi
	su - $PGUSER -c "/usr/bin/pg_ctl start -D '$PGDATA' -s -l '$PGLOG' -o '$PGOPTS'"
	eend $?
}

stop() {
	ebegin "Stopping postgres"
	su - $PGUSER -c "/usr/bin/pg_ctl stop -D '$PGDATA' -s -m fast"
	eend $?
}

svc_restart() {
	ebegin "Restarting postgres"
	su - $PGUSER -c "/usr/bin/pg_ctl restart -D '$PGDATA' -s -m fast -l '$PGLOG' -o '$PGOPTS'"
	eend $?
}
