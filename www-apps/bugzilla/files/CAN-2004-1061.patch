Index: template/en/default/global/code-error.html.tmpl
===================================================================
RCS file: /cvsroot/mozilla/webtools/bugzilla/template/en/default/global/code-error.html.tmpl,v
retrieving revision 1.41
diff -5 -p -u -r1.41 code-error.html.tmpl
--- template/en/default/global/code-error.html.tmpl	9 Dec 2004 09:22:20 -0000	1.41
+++ template/en/default/global/code-error.html.tmpl	15 Dec 2004 23:50:52 -0000
@@ -254,11 +254,14 @@
     [% terms.Bugzilla %] has suffered an internal error. Please save this page and send
     it to [% Param("maintainer") %] with details of what you were doing at
     the time this message appeared.
   </p>
   <script type="text/javascript"> <!--
-    document.write("<p>URL: " + document.location + "</p>");
+    document.write("<p>URL: " + 
+                    document.location.href.replace(/&/g,"&amp;")
+                                          .replace(/</g,"&lt;")
+                                          .replace(/>/g,"&gt;") + "</p>");
   // -->
   </script>
 </tt>
 
 <table cellpadding="20">
Index: Bugzilla/Error.pm
===================================================================
RCS file: /cvsroot/mozilla/webtools/bugzilla/Bugzilla/Error.pm,v
retrieving revision 1.8
diff -5 -p -u -r1.8 Error.pm
--- Bugzilla/Error.pm	8 Nov 2004 02:25:59 -0000	1.8
+++ Bugzilla/Error.pm	15 Dec 2004 23:50:52 -0000
@@ -116,11 +116,14 @@ sub ThrowTemplateError {
             Bugzilla has suffered an internal error. Please save this page and 
             send it to $maintainer with details of what you were doing at the 
             time this message appeared.
           </p>
           <script type="text/javascript"> <!--
-            document.write("<p>URL: " + document.location + "</p>");
+          document.write("<p>URL: " + 
+                          document.location.href.replace(/&/g,"&amp;")
+                                                .replace(/</g,"&lt;")
+                                                .replace(/>/g,"&gt;") + "</p>");
           // -->
           </script>
           <p>Template->process() failed twice.<br>
           First error: $error<br>
           Second error: $error2</p>
