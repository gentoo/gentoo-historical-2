Index: Register.pm
===================================================================
--- lib/TWiki/UI/Register.pm	(revision 10544)
+++ lib/TWiki/UI/Register.pm	(working copy)
@@ -418,7 +418,7 @@
       $data->{WikiName}.'.'.TWiki::User::randomPassword();
     _putRegDetailsByCode( $data, $tmpDir );
 
-    $session->writeLog( 'regstart', $data->{webName}.'.'.$data->{WikiName},
+    $session->writeLog( 'regstart', $TWiki::cfg{UsersWebName}.'.'.$data->{WikiName},
                         $data->{Email}, $data->{WikiName} );
 
     my $err = _sendEmail( $session, 'registerconfirm', $data );
@@ -788,13 +788,13 @@
 
     # write log entry
     if ($TWiki::cfg{Log}{register}) {
-        $session->writeLog( 'register', $data->{webName}.'.'.$data->{WikiName},
+        $session->writeLog( 'register', $TWiki::cfg{UsersWebName}.'.'.$data->{WikiName},
                             $data->{Email}, $data->{WikiName} );
     }
 
     # and finally display thank you page
     throw TWiki::OopsException( 'attention',
-                                web => $data->{webName},
+                                web => $TWiki::cfg{UsersWebName},
                                 topic => $data->{WikiName},
                                 def => 'thanks',
                                 params => $data->{Email} );
@@ -809,7 +809,7 @@
 sub _newUserFromTemplate {
     my ($session, $template, $row) = @_;
     my ( $meta, $text ) = TWiki::UI::readTemplateTopic($session, $template);
-    my $log = $b.' Writing topic '.$row->{webName}.'.'.$row->{WikiName}."\n".
+    my $log = $b.' Writing topic '.$TWiki::cfg{UsersWebName}.'.'.$row->{WikiName}."\n".
       $b2.' RegistrationHandler: ';
     my $regLog = $text;
     _purgeKeys( $row );
@@ -859,7 +859,7 @@
     my $agent = $session->{users}->findUser( $twikiRegistrationAgent,
                                              $twikiRegistrationAgent);
 
-    $session->{store}->saveTopic($agent, $data->{webName},
+    $session->{store}->saveTopic($agent, $TWiki::cfg{UsersWebName},
                                  $data->{WikiName}, $text, $meta );
     return $log;
 }
@@ -993,7 +993,7 @@
     }
     $templateText = $before.$after;
     $templateText = $session->handleCommonTags
-      ( $templateText, $data->{webName}, $data->{WikiName} );
+      ( $templateText, $TWiki::cfg{UsersWebName}, $data->{WikiName} );
     $templateText =~ s/( ?) *<\/?(nop|noautolink)\/?>\n?/$1/gois;
     # remove <nop> and <noautolink> tags
 
@@ -1014,7 +1014,7 @@
                                     params => '' );
     }
 
-    if($session->{store}->topicExists( $data->{webName}, $data->{WikiName} )) {
+    if($session->{store}->topicExists( $TWiki::cfg{UsersWebName}, $data->{WikiName} )) {
         throw TWiki::OopsException( 'attention',
                                     web => $data->{webName},
                                     topic => $topic,
@@ -1127,7 +1127,7 @@
     $text =~ s/%INTRODUCTION%/$p->{Introduction}/go;
     $text =~ s/%VERIFICATIONCODE%/$p->{VerificationCode}/go;
     $text =~ s/%PASSWORD%/$p->{PasswordA}/go;
-    $text = $session->handleCommonTags( $text, $p->{webName}, $p->{WikiName} );
+    $text = $session->handleCommonTags( $text, $TWiki::cfg{UsersWebName}, $p->{WikiName} );
     return $session->{net}->sendEmail($text);
 }
 
