#!/bin/bash

die() {
    echo "###"
    echo $1
    echo "###"
    exit 1
}

if [[ $1 = "install" ]]; then
    if [[ "${VHOST_SERVER}" = "apache" ]]; then
        sed -e "s|/var/www/html/data|${MY_INSTALLDIR}/data|g" \
            -e "s|/var/www/html|${VHOST_ROOT}/${PN}|g" \
            -i ${MY_SERVERCONFIGIR}/mythweb.conf || \
            die "apache sed failed"
    elif [[ "${VHOST_SERVER}" = "lighttpd" ]]; then
        sed -e "s|/var/www/html/data|${MY_INSTALLDIR}/data|g" \
            -e "s|/var/www/html|${VHOST_ROOT}/${PN}|g" \
            -i ${MY_SERVERCONFIGIR}/mythweb.conf || \
            die "lighttpd sed failed"
    elif [[ "${VHOST_SERVER}" = "nginx" ]]; then
        sed -e "s|/var/www/localhost/htdocs|${MY_INSTALLDIR}/htdocs|g" \
            -i ${MY_SERVERCONFIGIR}/mythweb.include || \
            die "nginx sed failed"
    fi

    # Ownership fixes
    chown ${VHOST_SERVER_UID}:${VHOST_SERVER_GID} "${MY_INSTALLDIR}"/data || \
        die "chown failed"

elif [[ $1 = "clean" ]]; then
    echo $1
fi

exit 0
