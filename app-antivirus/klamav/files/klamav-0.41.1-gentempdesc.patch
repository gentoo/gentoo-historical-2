--- klamav-0.41.1/src/klamd/scanner.c.orig	2007-12-19 10:38:11.000000000 +0100
+++ klamav-0.41.1/src/klamd/scanner.c	2007-12-19 10:43:12.000000000 +0100
@@ -396,7 +396,7 @@
 
     logg("*Accepted connection on port %d, fd %d\n", port, acceptd);
 
-    if ((tmpname = cli_gentempdesc(NULL, &tmpd)) == NULL) {
+    if (cli_gentempfd(NULL, &tmpname, &tmpd) != CL_SUCCESS) {
 	shutdown(sockfd, 2);
 	close(sockfd);
 	close(acceptd);
