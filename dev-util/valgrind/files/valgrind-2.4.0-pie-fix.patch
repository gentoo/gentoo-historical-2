diff -ruN valgrind-2.4.0/corecheck/tests/Makefile.in valgrind-2.4.0-fixed/corecheck/tests/Makefile.in
--- valgrind-2.4.0/corecheck/tests/Makefile.in	2005-03-24 03:30:27.000000000 +0100
+++ valgrind-2.4.0-fixed/corecheck/tests/Makefile.in	2005-04-12 18:53:56.686049352 +0200
@@ -202,7 +202,7 @@
 CCAS = @CCAS@
 CCASFLAGS = @CCASFLAGS@
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+CFLAGS = @CFLAGS@ -fno-pie
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
 CXX = @CXX@
diff -ruN valgrind-2.4.0/coregrind/x86-linux/syscalls.c valgrind-2.4.0-fixed/coregrind/x86-linux/syscalls.c
--- valgrind-2.4.0/coregrind/x86-linux/syscalls.c	2005-03-23 11:22:03.000000000 +0100
+++ valgrind-2.4.0-fixed/coregrind/x86-linux/syscalls.c	2005-04-12 18:50:01.373822248 +0200
@@ -259,10 +259,13 @@
       We need to make sure we don't touch the stack between marking it
       Empty and exiting.  Hence the assembler. */
    asm volatile (
+      "pushl    %%ebx\n"        /* save original ebx value */
       "movl	%1, %0\n"	/* set tst->status = VgTs_Empty */
+      "movl     %2, %%ebx\n"    /* set ebx = tst->os_state.exitcode */
       "int	$0x80\n"	/* exit(tst->os_state.exitcode) */
+      "popl     %%ebx\n"        /* restore original ebx value */
       : "=m" (tst->status)
-      : "n" (VgTs_Empty), "a" (__NR_exit), "b" (tst->os_state.exitcode));
+      : "n" (VgTs_Empty), "a" (__NR_exit), "m" (tst->os_state.exitcode));
 
    VG_(core_panic)("Thread exit failed?\n");
 }
diff -ruN valgrind-2.4.0/none/tests/Makefile.in valgrind-2.4.0-fixed/none/tests/Makefile.in
--- valgrind-2.4.0/none/tests/Makefile.in	2005-03-24 03:30:45.000000000 +0100
+++ valgrind-2.4.0-fixed/none/tests/Makefile.in	2005-04-12 18:54:42.311113288 +0200
@@ -322,7 +322,7 @@
 CCAS = @CCAS@
 CCASFLAGS = @CCASFLAGS@
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+CFLAGS = @CFLAGS@ -fno-pie
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
 CXX = @CXX@
diff -ruN valgrind-2.4.0/none/tests/x86/Makefile.in valgrind-2.4.0-fixed/none/tests/x86/Makefile.in
--- valgrind-2.4.0/none/tests/x86/Makefile.in	2005-03-24 03:30:45.000000000 +0100
+++ valgrind-2.4.0-fixed/none/tests/x86/Makefile.in	2005-04-12 18:55:25.859492928 +0200
@@ -156,7 +156,7 @@
 CCAS = @CCAS@
 CCASFLAGS = @CCASFLAGS@
 CCDEPMODE = @CCDEPMODE@
-CFLAGS = @CFLAGS@
+CFLAGS = @CFLAGS@ -fno-pie
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
 CXX = @CXX@
