diff -urwpN smalltalk-2.1.10/Makefile.am smalltalk-2.1.10.changed/Makefile.am
--- smalltalk-2.1.10/Makefile.am	2005-02-03 04:43:38.000000000 -0400
+++ smalltalk-2.1.10.changed/Makefile.am	2005-03-28 20:28:41.000000000 -0400
@@ -59,9 +59,7 @@ gsticon.o: gsticon.ico
 	echo ProgramIcon ICON `cygpath -w $(srcdir)/gsticon.ico` | windres -o gsticon.o
 
 gst.im: $(bin_PROGRAMS) kernel/stamp-classes
-	SMALLTALK_KERNEL="`cd $(srcdir)/kernel; pwd`" \
-	SMALLTALK_IMAGE="`pwd`" \
-	  ./gst -iQ dummy_file
+	SMALLTALK_KERNEL="${D}/usr/share/smalltalk/gst -iQ dummy_file"
 
 gst-mode.el: gst-mode.el.in
 	sed "s,@\(bindir\)@,$(bindir)," $(srcdir)/gst-mode.el.in > gst-mode.el
diff -urwpN smalltalk-2.1.10/Makefile.in smalltalk-2.1.10.changed/Makefile.in
--- smalltalk-2.1.10/Makefile.in	2005-02-03 04:43:53.000000000 -0400
+++ smalltalk-2.1.10.changed/Makefile.in	2005-03-28 20:28:13.000000000 -0400
@@ -962,9 +962,7 @@ gsticon.o: gsticon.ico
 	echo ProgramIcon ICON `cygpath -w $(srcdir)/gsticon.ico` | windres -o gsticon.o
 
 gst.im: $(bin_PROGRAMS) kernel/stamp-classes
-	SMALLTALK_KERNEL="`cd $(srcdir)/kernel; pwd`" \
-	SMALLTALK_IMAGE="`pwd`" \
-	  ./gst -iQ dummy_file
+	SMALLTALK_KERNEL="${D}/usr/share/smalltalk/gst -iQ dummy_file"
 
 gst-mode.el: gst-mode.el.in
 	sed "s,@\(bindir\)@,$(bindir)," $(srcdir)/gst-mode.el.in > gst-mode.el
diff -urwpN smalltalk-2.1.10/gst-package.in smalltalk-2.1.10.changed/gst-package.in
--- smalltalk-2.1.10/gst-package.in	2004-11-25 10:19:17.000000000 -0400
+++ smalltalk-2.1.10.changed/gst-package.in	2005-03-28 19:22:51.000000000 -0400
@@ -138,8 +138,13 @@ fi
 
 echo "Merging $files and $IMAGE_PATH/packages.xml..."
 $dry_run || {
-  sed -e '$i\' -e '</packages>' -e '/<.packages>/,/<packages>/d' $files > $IMAGE_PATH/packages.tmp
-  mv $IMAGE_PATH/packages.tmp $IMAGE_PATH/packages.xml
+       tmpfile=$(mktemp)
+       sed -e '$i\' -e '</packages>' -e '/<.packages>/,/<packages>/d' $files > $tmpfile
+       if [ -n ${EBUILD_PHASE} ]; then
+               mv $tmpfile ${D}/usr/share/smalltalk/packages.xml
+       else
+               mv $tmpfile $IMAGE_PATH/packages.xml
+       fi
 }
