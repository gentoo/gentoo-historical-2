--- qp7.2.orig/Makefile.in	2006-02-20 16:22:53.000000000 +1300
+++ qp7.2/Makefile.in	2006-03-24 23:22:43.000000000 +1200
@@ -14,6 +14,7 @@
 # objects.
 #
 
+export QPHOME	= @prefix@/lib/qu-prolog
 export QPBIN	= @QPHOME@/bin
 
 
@@ -34,7 +35,6 @@
 objects:
 	@$(MAKE) -C @QPHOME@/bin	$(PARALLEL) all 
 	@$(MAKE) -C @QPHOME@/src	$(PARALLEL) all
-	@$(MAKE) -C @QPHOME@/src	$(PARALLEL) install
 	@$(MAKE) -C @QPHOME@/prolog	$(PARALLEL) all
 
 
--- qp7.2.orig/bin/qc.in	2003-02-07 10:21:21.000000000 +1300
+++ qp7.2/bin/qc.in	2006-03-25 13:56:42.000000000 +1200
@@ -52,24 +52,25 @@
 #
 # location of Qu-Prolog project
 #
-PATH=@QPHOME@/bin:$PATH
+QPHOME=@prefix@/lib/qu-prolog
+PATH=$QPHOME/bin:$PATH
 
 #
 # names of Qu-Prolog binaries
 #
-preprocess=@QPHOME@/bin/qppp
+preprocess=qppp
 expand=qg
 compile=qc1
 compversion=qup
 assemble=qa
 link=ql
-execute=@QPHOME@/bin/qem
+execute=qem
 
 #
 # Use the line below when dynamic search for libraries is implemented.
 #
 # libqofiles=""
-libqofiles="@QPHOME@/prolog/compiler/*.qo @QPHOME@/prolog/library/*.qo"
+libqofiles="$QPHOME/compiler/*.qo $QPHOME/library/*.qo"
 
 qlfiles=""
 qlefiles=""
@@ -332,18 +333,7 @@
 	absexecfile=$execfile
 	;;
 *)
-	currdir=`pwd`
-	case $currdir in
-	/u*)
-		abspath=`echo $currdir | sed "s,/u./$HOSTNAME/,/homes/,"`
-		;;
-	/tmp_mnt/*)
-		abspath=`echo $currdir | sed 's,/tmp_mnt/homes/[^/]*/,/homes/,'`
-		;;
-	*)
-		abspath=$currdir
-		;;
-	esac
+	abspath=`pwd`
 	absexecfile=$abspath/$execfile
 	;;
 esac
@@ -359,5 +349,8 @@
 
 # make executable file
 
-echo "exec $execute $Eoptions $lflag -Q '$savefile' \$* $*" >$execfile
+echo "QPPATH=@prefix@/bin:$QPHOME/bin" >$execfile
+echo "QPLIBPATH=$QPHOME/compiler:$QPHOME/library" >>$execfile
+echo "export QPPATH QPLIBPATH" >>$execfile
+echo "exec $execute $Eoptions $lflag -Q '$savefile' \$* $*" >>$execfile
 chmod a+x $execfile
--- qp7.2.orig/prolog/compiler/Makefile.in	2006-02-20 16:22:58.000000000 +1300
+++ qp7.2/prolog/compiler/Makefile.in	2006-03-24 22:54:57.000000000 +1200
@@ -29,5 +29,5 @@
 
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
 
--- qp7.2.orig/prolog/library/Makefile.in	2006-02-20 16:22:58.000000000 +1300
+++ qp7.2/prolog/library/Makefile.in	2006-03-24 23:00:08.000000000 +1200
@@ -100,4 +100,4 @@
 
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
--- qp7.4.orig/prolog/qc1/Makefile.in	2006-07-27 16:27:35.000000000 +1200
+++ qp7.4/prolog/qc1/Makefile.in	2006-08-07 21:11:56.000000000 +1200
@@ -3,6 +3,7 @@
 #
 PROGRAM		= @QPHOME@/bin/qc1.qup
 
+SAVEFILE	= qc1.qx
 SOURCES		= qc1.ql
 
 BASES		= $(basename $(SOURCES))
@@ -13,8 +14,12 @@
 all: $(PROGRAM)
 
 $(PROGRAM): $(OBJECTS)
-	$(COMPILE.qc) -L -o $(PROGRAM) $(OBJECTS)
+	@QPHOME@/src/ql -o $(SAVEFILE) @QPHOME@/prolog/compiler/*.qo @QPHOME@/prolog/library/*.qo $(OBJECTS)
+	@echo "QPPATH=@prefix@/bin:$(QPHOME)/bin" >$(PROGRAM)
+	@echo "QPLIBPATH=$(QPHOME)/compiler:$(QPHOME)/library" >>$(PROGRAM)
+	@echo "export QPPATH QPLIBPATH" >>$(PROGRAM)
+	@echo -e "exec qem -L -Q $(QPHOME)/bin/$(SAVEFILE) \044\052" >>$(PROGRAM)
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
 
--- qp7.2.orig/prolog/qecat/Makefile.in	2006-02-20 16:22:58.000000000 +1300
+++ qp7.2/prolog/qecat/Makefile.in	2006-03-25 10:49:45.000000000 +1200
@@ -3,7 +3,7 @@
 #
 
 PROGRAM		= $(QPBIN)/qecat
-
+SAVEFILE	= qecat.qx
 SOURCES		= qecat.ql
 
 BASES		= $(basename $(SOURCES))
@@ -14,9 +14,13 @@
 all: $(PROGRAM)
 
 $(PROGRAM): $(OBJECTS)
-	$(COMPILE.qc) -L -o $(PROGRAM) $(OBJECTS)
+	@QPHOME@/src/ql -o $(SAVEFILE) @QPHOME@/prolog/compiler/*.qo @QPHOME@/prolog/library/*.qo $(OBJECTS)
+	@echo "QPPATH=@prefix@/bin:$(QPHOME)/bin" >$(PROGRAM)
+	@echo "QPLIBPATH=$(QPHOME)/compiler:$(QPHOME)/library" >>$(PROGRAM)
+	@echo "export QPPATH QPLIBPATH" >>$(PROGRAM)
+	@echo -e "exec qem -L -Q $(QPHOME)/bin/$(SAVEFILE) \044\052" >>$(PROGRAM)
 
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
 
--- qp7.2.orig/prolog/qg/Makefile.in	2006-02-20 16:22:58.000000000 +1300
+++ qp7.2/prolog/qg/Makefile.in	2006-03-25 10:43:32.000000000 +1200
@@ -3,7 +3,7 @@
 #
 
 PROGRAM		= @QPHOME@/bin/qg
-
+SAVEFILE	= qg.qx
 SOURCES		= qg.ql
 
 BASES		= $(basename $(SOURCES))
@@ -14,9 +14,13 @@
 all: $(PROGRAM)
 
 $(PROGRAM): $(OBJECTS)
-	$(COMPILE.qc) -L -o $(PROGRAM) $(OBJECTS)
+	@QPHOME@/src/ql -o $(SAVEFILE) @QPHOME@/prolog/compiler/*.qo @QPHOME@/prolog/library/*.qo $(OBJECTS)
+	@echo "QPPATH=@prefix@/bin:$(QPHOME)/bin" >$(PROGRAM)
+	@echo "QPLIBPATH=$(QPHOME)/compiler:$(QPHOME)/library" >>$(PROGRAM)
+	@echo "export QPPATH QPLIBPATH" >>$(PROGRAM)
+	@echo -e "exec qem -L -Q $(QPHOME)/bin/$(SAVEFILE) \044\052" >>$(PROGRAM)
 
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
 
--- qp7.2.orig/prolog/qp/Makefile.in	2006-02-20 16:22:58.000000000 +1300
+++ qp7.2/prolog/qp/Makefile.in	2006-03-25 10:47:17.000000000 +1200
@@ -2,7 +2,7 @@
 # Makefile for "qp"
 #
 PROGRAM		= @QPHOME@/bin/qp
-
+SAVEFILE	= qp.qx
 SOURCES		= qp.ql
 
 BASES		= $(basename $(SOURCES))
@@ -13,9 +13,13 @@
 all: $(PROGRAM)
 
 $(PROGRAM): $(OBJECTS)
-	$(COMPILE.qc) -o $(PROGRAM) $(OBJECTS)
+	@QPHOME@/src/ql -o $(SAVEFILE) @QPHOME@/prolog/compiler/*.qo @QPHOME@/prolog/library/*.qo $(OBJECTS)
+	@echo "QPPATH=@prefix@/bin:$(QPHOME)/bin" >$(PROGRAM)
+	@echo "QPLIBPATH=$(QPHOME)/compiler:$(QPHOME)/library" >>$(PROGRAM)
+	@echo "export QPPATH QPLIBPATH" >>$(PROGRAM)
+	@echo -e "exec qem -Q $(QPHOME)/bin/$(SAVEFILE) \044\052" >>$(PROGRAM)
 
 
 %.qo: %.qs
-	$(COMPILE.qc) -c -o $@ $<
+	@QPHOME@/src/qa -i $< -o $@
 
--- qp7.2.orig/src/Makefile.in	2006-04-06 14:14:37.000000000 +1200
+++ qp7.2/src/Makefile.in	2006-05-27 09:00:47.000000000 +1200
@@ -40,7 +40,7 @@
 
 #export DEBUGGING=
 
-export CXXFLAGS = @GCC_ALIAS_FLAG@ -Wall -D_GNU_SOURCE=1 $(OPTIMISATION) @DEBUGGING@ -I@ICMHOME@/include @GCCINCLUDES@ -Wno-uninitialized
+#export CXXFLAGS = @GCC_ALIAS_FLAG@ -Wall -D_GNU_SOURCE=1 $(OPTIMISATION) @DEBUGGING@ -I@ICMHOME@/include @GCCINCLUDES@ -Wno-uninitialized
 export QACXXFLAGS = -Wall -D_GNU_SOURCE=1 @DEBUGGING@ -I@ICMHOME@/include @GCCINCLUDES@ -Wno-uninitialized
 
 .PHONY: all
@@ -80,6 +80,9 @@
 
 # Targets
 
+.cc.o:
+	$(CXX) $(CXXFLAGS) @GCC_ALIAS_FLAG@ -Wall -D_GNU_SOURCE=1 @DEBUGGING@ -I@ICMHOME@/include @GCCINCLUDES@ -Wno-uninitialized -c $<
+
 .PHONY: commands
 commands: $(GENERATED) $(LIBRARIES) $(BIG_LIBRARY)
 	@$(MAKE) $(ALL_COMMANDS)
