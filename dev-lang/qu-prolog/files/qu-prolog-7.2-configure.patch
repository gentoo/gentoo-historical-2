--- qp7.2.orig/configure.in	2006-04-06 14:14:33.000000000 +1200
+++ qp7.2/configure.in	2006-05-27 19:41:18.000000000 +1200
@@ -25,7 +25,7 @@
 #
 DEBUGGING=" -DNDEBUG "
 AC_ARG_ENABLE(debug, [ --enable-debug        Turn on debugging],
-[ DEBUGGING=])
+[ DEBUGGING="-DDEBUG_BLOCK -DDEBUG_IO -DDEBUG_MT -DDEBUG_RETRY -DDEBUG_SCHED -DDEBUG_TIMEOUT"])
 AC_SUBST(DEBUGGING)
 
 # Single versus multiple thread configuraation.
@@ -34,8 +34,6 @@
 if test "$enable_multiple_threads" != no; then
 	# Multiple threads is the default.
 	AC_DEFINE(MULTIPLE_THREADS)
-else
-	AC_MSG_WARN(Configuring for single Prolog thread per process)
 fi
 
 AC_LANG_CPLUSPLUS
@@ -115,17 +113,13 @@
 	AC_SUBST(QPPP_TRADITIONAL)
 fi
 
-AC_PATH_PROG(PERL, perl, NO_PERL,\
-	$PATH:/bin:/usr/bin:/usr/local/bin:/usr/local/perl/bin)
-
-if test "$PERL" = NO_PERL; then
-	AC_MSG_ERROR(perl is required to compile QP)
-fi
+AC_ARG_ENABLE(icm, [ --enable-icm     Enable ICM peer-to-peer communication], enable_icm=$enableval, enable_icm=no)
 
+if test "x$enable_icm" = "xyes"; then
 AC_PATH_PROG(ICM, icm, NO_ICM,\
 	$PATH:/opt/icm/bin:/opt/local/bin:/bin:/usr/bin:/usr/local/bin:/usr/local/perl/bin)
 if test "$ICM" = NO_ICM; then
-	AC_MSG_WARN(ICM communication not supported)
+	AC_MSG_ERROR(ICM communication not supported)
         TK_ICM=
         ICM_LIB=
         AC_SUBST(TK_ICM)
@@ -140,11 +134,17 @@
         ICM_LIB="-licm -lpthread"
         AC_SUBST(ICM_LIB)
 fi
+else
+	ICM="NO_ICM"
+fi
+
+AC_ARG_ENABLE(elvin, [ --enable-elvin     Enable Elvin subscription/notification communication], enable_elvin=$enableval, enable_elvin=no)
 
+if test "x$enable_elvin" = "xyes"; then
 AC_PATH_PROG(ELVINCONFIG, elvin-config, NO_ELVINCONFIG,\
 	$PATH:/opt/icm/bin:/opt/local/bin:/bin:/usr/bin:/usr/local/bin:/usr/local/perl/bin)
 if test "$ELVINCONFIG" = NO_ELVINCONFIG; then
-	AC_MSG_WARN(Elvin communication not supported)
+	AC_MSG_ERROR(Elvin communication not supported)
         ELVIN_LIB=
         ELVIN_CFLAGS=
         AC_SUBST(ELVIN_LIB)
@@ -160,6 +160,7 @@
         AC_SUBST(ELVIN_LIB)
         AC_SUBST(ELVIN_CFLAGS)
 fi
+fi
 
 GCCINCLUDES=
 AC_ARG_WITH(gcclib,
@@ -232,12 +233,12 @@
       then
 	    TKDIR=NONE
       else
-        tkfile=`cat $libtktmp | head -1`
+        tkfile=`cat $libtktmp | head -n 1`
         TKDIR=`dirname $tkfile` 
         TKL=`basename $tkfile .a | sed -e "s/lib//"`
     fi
   else 
-   tkfile=`grep libtk\.a $libtktmp | head -1`
+   tkfile=`grep libtk\.a $libtktmp | head -n 1`
    TKDIR=`dirname $tkfile`
    TKL=`basename $tkfile .a | sed -e "s/lib//"`
   fi
@@ -269,12 +270,12 @@
           then
 	      TKDIR=NONE
         else
-          tclfile=`cat $libtcltmp | head -1`
+          tclfile=`cat $libtcltmp | head -n 1`
           TCLDIR=`dirname $tclfile`
           TCLL=`basename $tclfile .a | sed -e "s/lib//"`
         fi
     else 
-     tclfile=`grep libtclstub\.a $libtcltmp | head -1`
+     tclfile=`grep libtclstub\.a $libtcltmp | head -n 1`
      TCLDIR=`dirname $tclfile`
      TCLL=`basename $tclfile .a | sed -e "s/lib//"`
     fi
@@ -304,7 +305,7 @@
       then 
 	  TKDIR=NONE
     else 
-     tkf=`cat $tktmp | head -1`
+     tkf=`cat $tktmp | head -n 1`
      TKHDIR=`dirname $tkf`
     fi
     rm $tktmp
@@ -360,12 +361,12 @@
       then
 		TKDIR=NONE
       else
-        tkfile=`cat $libtktmp | head -1`
+        tkfile=`cat $libtktmp | head -n 1`
         TKDIR=`dirname $tkfile` 
         TKL=`basename $tkfile .so | sed -e "s/lib//"`
     fi
   else 
-     tkfile=`grep libtk\.so $libtktmp | head -1`
+     tkfile=`grep libtk\.so $libtktmp | head -n 1`
      TKDIR=`dirname $tkfile`
      TKL=`basename $tkfile .so | sed -e "s/lib//"`
 fi
@@ -397,12 +398,12 @@
       then
 		TKDIR=NONE
       else
-        tclfile=`cat $libtcltmp | head -1`
+        tclfile=`cat $libtcltmp | head -n 1`
         TCLDIR=`dirname $tclfile`
         TCLL=`basename $tclfile .so | sed -e "s/lib//"`
     fi
   else 
-     tclfile=`grep libtcl\.so $libtcltmp | head -1`
+     tclfile=`grep libtcl\.so $libtcltmp | head -n 1`
      TCLDIR=`dirname $tclfile`
      TCLL=`basename $tclfile .so | sed -e "s/lib//"`
 fi
@@ -432,7 +433,7 @@
   then 
 	TKDIR=NONE
   else 
-     tkf=`cat $tktmp | head -1`
+     tkf=`cat $tktmp | head -n 1`
      TKHDIR=`dirname $tkf`
 fi
 rm $tktmp
@@ -529,7 +530,7 @@
 #----------------------------------------------------------------------------
 dnl Check for CPP version
 AC_MSG_CHECKING([for GCC version])
-qp_cpp_ver=[`gcc --version 2>/dev/null | head -1 | sed -e 's/^[^[:digit:]]*\([[:digit:]][^[:space:]]*\).*$/\1/'`]
+qp_cpp_ver=[`gcc --version 2>/dev/null | head -n 1 | sed -e 's/^[^[:digit:]]*\([[:digit:]][^[:space:]]*\).*$/\1/'`]
 if test -n "$qp_cpp_ver"; then
     AC_MSG_RESULT($qp_cpp_ver)
     case "$qp_cpp_ver" in
