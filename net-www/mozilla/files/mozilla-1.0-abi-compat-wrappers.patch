Index: xpfe/bootstrap/nsAppRunner.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpfe/bootstrap/nsAppRunner.cpp,v
retrieving revision 1.353
diff -u -r1.353 nsAppRunner.cpp
--- xpfe/bootstrap/nsAppRunner.cpp	16 May 2002 01:02:12 -0000	1.353
+++ xpfe/bootstrap/nsAppRunner.cpp	3 Jul 2002 22:46:49 -0000
@@ -134,6 +134,57 @@
 #include "jprof.h"
 #endif
 
+// on x86 linux, the current builds of some popular plugins (notably
+// flashplayer and real) expect a few builtin symbols from libgcc
+// which were available in some older versions of gcc.  However,
+// they're _NOT_ available in newer versions of gcc (eg 3.1), so if
+// we want those plugin to work with a gcc-3.1 built binary, we need
+// to provide these symbols.  MOZ_ENABLE_OLD_ABI_COMPAT_WRAPPERS defaults
+// to true on x86 linux, and false everywhere else.
+//
+// The fact that the new and free operators are mismatched 
+// mirrors the way the original functions in egcs 1.1.2 worked.
+
+extern "C" {
+
+# ifndef HAVE___builtin_vec_new
+  void *__builtin_vec_new(size_t aSize, const std::nothrow_t &aNoThrow) throw()
+  {
+    return ::operator new(aSize, aNoThrow);
+  }
+# endif
+
+# ifndef HAVE___builtin_vec_delete
+  void __builtin_vec_delete(void *aPtr, const std::nothrow_t &) throw ()
+  {
+    if (aPtr) {
+      free(aPtr);
+    }
+  }
+# endif
+
+# ifndef HAVE__builtin_new
+	void *__builtin_new(int aSize)
+  {
+    return malloc(aSize);
+  }
+# endif
+
+# ifndef HAVE__builtin_delete
+	void __builtin_delete(void *aPtr)
+  {
+    free(aPtr);
+  }
+# endif
+
+# ifndef HAVE__pure_virtual
+  void __pure_virtual(void) {
+    extern void __cxa_pure_virtual(void);
+
+    __cxa_pure_virtual();
+  }
+# endif
+}
 
 #ifdef _BUILD_STATIC_BIN
 #include "nsStaticComponent.h"
