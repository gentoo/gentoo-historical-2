--- includes/bbcode.php.org	2003-09-24 00:15:41.000000000 +0000
+++ includes/bbcode.php	2003-09-24 00:22:05.000000000 +0000
@@ -105,7 +105,7 @@
 	$bbcode_tpl['url3'] = str_replace('{DESCRIPTION}', '\\2', $bbcode_tpl['url3']);
 
 	$bbcode_tpl['url4'] = str_replace('{URL}', 'http://\\1', $bbcode_tpl['url']);
-	$bbcode_tpl['url4'] = str_replace('{DESCRIPTION}', '\\5', $bbcode_tpl['url4']);
+	$bbcode_tpl['url4'] = str_replace('{DESCRIPTION}', '\\3', $bbcode_tpl['url4']);
 
 	$bbcode_tpl['email'] = str_replace('{EMAIL}', '\\1', $bbcode_tpl['email']);
 
@@ -197,21 +197,21 @@
 	$patterns[] = "#\[img:$uid\](.*?)\[/img:$uid\]#si";
 	$replacements[] = $bbcode_tpl['img'];
 
-	// matches a [url]xxxx://www.phpbb.com[/url] code..
-	$patterns[] = "#\[url\]([\w]+?://.*?[^ \"\n\r\t<]*?)\[/url\]#is";
-	$replacements[] = $bbcode_tpl['url1'];
-
-	// [url]www.phpbb.com[/url] code.. (no xxxx:// prefix).
-	$patterns[] = "#\[url\]((www|ftp)\.([\w\-]+\.)*?[\w\-]+\.[a-z]{2,4}(:?[0-9]*?/[^ \"\n\r\t<]*)?)\[/url\]#is";
-	$replacements[] = $bbcode_tpl['url2'];
-
-	// [url=xxxx://www.phpbb.com]phpBB[/url] code..
-	$patterns[] = "#\[url=([\w]+?://.*?[^ \"\n\r\t<]*?)\](.*?)\[/url\]#is";
-	$replacements[] = $bbcode_tpl['url3'];
-
-	// [url=www.phpbb.com]phpBB[/url] code.. (no xxxx:// prefix).
-	$patterns[] = "#\[url=((www|ftp)\.([\w\-]+\.)*?[\w\-]+\.[a-z]{2,4}(:?[0-9]*?/[^ \"\n\r\t<]*)?)\](.*?)\[/url\]#is";
-	$replacements[] = $bbcode_tpl['url4'];
+	// matches a [url]xxxx://www.phpbb.com[/url] code.. 
+	$patterns[] = "#\[url\]([\w]+?://[^ \"\n\r\t<]*?)\[/url\]#is"; 
+	$replacements[] = $bbcode_tpl['url1']; 
+
+	// [url]www.phpbb.com[/url] code.. (no xxxx:// prefix). 
+	$patterns[] = "#\[url\]((www|ftp)\.[^ \"\n\r\t<]*?)\[/url\]#is"; 
+	$replacements[] = $bbcode_tpl['url2']; 
+
+	// [url=xxxx://www.phpbb.com]phpBB[/url] code.. 
+	$patterns[] = "#\[url=([\w]+?://[^ \"\n\r\t<]*?)\](.*?)\[/url\]#is"; 
+	$replacements[] = $bbcode_tpl['url3']; 
+
+	// [url=www.phpbb.com]phpBB[/url] code.. (no xxxx:// prefix). 
+	$patterns[] = "#\[url=((www|ftp)\.[^ \"\n\r\t<]*?)\](.*?)\[/url\]#is"; 
+	$replacements[] = $bbcode_tpl['url4']; 
 
 	// [email]user@domain.tld[/email] code..
 	$patterns[] = "#\[email\]([a-z0-9&\-_.]+?@[\w\-]+\.([\w\-\.]+\.)?[\w]+)\[/email\]#si";
@@ -618,16 +618,16 @@
 	// pad it with a space so we can match things at the start of the 1st line.
 	$ret = ' ' . $text;
 
-	// matches an "xxxx://yyyy" URL at the start of a line, or after a space.
-	// xxxx can only be alpha characters.
-	// yyyy is anything up to the first space, newline, comma, double quote or <
-	$ret = preg_replace("#(^|[\n ])([\w]+?://.*?[^ \"\n\r\t<]*)#is", "\\1<a href=\"\\2\" target=\"_blank\">\\2</a>", $ret);
+	//matches an "xxxx://yyyy" URL at the start of a line, or after a space. 
+	// xxxx can only be alpha characters. 
+	// yyyy is anything up to the first space, newline, comma, double quote or < 
+	$ret = preg_replace("#(^|[\n ])([\w]+?://[^ \"\n\r\t<]*)#is", "\\1<a href=\"\\2\" target=\"_blank\">\\2</a>", $ret); 
 
-	// matches a "www|ftp.xxxx.yyyy[/zzzz]" kinda lazy URL thing
-	// Must contain at least 2 dots. xxxx contains either alphanum, or "-"
+	// matches a "www|ftp.xxxx.yyyy[/zzzz]" kinda lazy URL thing 
+	// Must contain at least 2 dots. xxxx contains either alphanum, or "-" 
 	// zzzz is optional.. will contain everything up to the first space, newline, 
-	// comma, double quote or <.
-	$ret = preg_replace("#(^|[\n ])((www|ftp)\.[\w\-]+\.[\w\-.\~]+(?:/[^ \"\t\n\r<]*)?)#is", "\\1<a href=\"http://\\2\" target=\"_blank\">\\2</a>", $ret);
+	// comma, double quote or <. 
+	$ret = preg_replace("#(^|[\n ])((www|ftp)\.[^ \"\t\n\r<]*)#is", "\\1<a href=\"http://\\2\" target=\"_blank\">\\2</a>", $ret);
 
 	// matches an email@domain type address at the start of a line, or after a space.
 	// Note: Only the followed chars are valid; alphanums, "-", "_" and or ".".
@@ -782,4 +782,4 @@
 	return ( strlen($a['code']) > strlen($b['code']) ) ? -1 : 1;
 }
 
-?>
\ No newline at end of file
+?>
