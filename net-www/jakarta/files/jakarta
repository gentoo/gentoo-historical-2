#!/bin/sh
#RCUPDATE:3 4:75:
# $Id: jakarta,v 1.1 2000/08/10 01:53:39 achim Exp $

. /etc/rc.d/config/functions

# Shell script to start and stop the server
opts="start stop restart"

# There are other, simpler commands to startup the runner. The two
# commented commands good replacements. The first works well with
# Java Platform 1.1 based runtimes. The second works well with
# Java2 Platform based runtimes.

JAVA_HOME=/opt/java
TOMCAT_HOME=/opt/jakarta/tomcat

if [ "$TOMCAT_OPTS" = "" ] ; then
  TOMCAT_OPTS=""
fi

if [ "$ANT_OPTS" = "" ] ; then
  ANT_OPTS=""
fi

if [ "$JSPC_OPTS" = "" ] ; then
  JSPC_OPTS=""
fi

if [ -z "$JAVA_HOME" ] ;  then
  JAVA=`which java`
  if [ -z "$JAVA" ] ; then
    echo "Cannot find JAVA. Please set your PATH."
    exit 1
  fi
  JAVA_BINDIR=`dirname $JAVA`
  JAVA_HOME=$JAVA_BINDIR/..
fi

if [ "$JAVACMD" = "" ] ; then
   # it may be defined in env - including flags!!
   JAVACMD=$JAVA_HOME/bin/java
fi


oldCP=$CLASSPATH

CLASSPATH=.


for i in ${TOMCAT_HOME}/lib/* ; do
  CLASSPATH=${CLASSPATH}:$i
done

if [ -f /opt/java/lib/tomcat.jar ]; then
    CLASSPATH=/opt/java/lib/tomcat.jar:${CLASSPATH}
fi

# Add support for Cocoon if available

if [ -d /opt/jakarta/tomcat/conf/cocoon.properties ]; then
    CLASSPATH=/opt/java/lib/cocoon.jar:${CLASSPATH}
    CLASSPATH=/opt/java/lib/fop_0_12_1.jar:${CLASSPATH}
    CLASSPATH=/opt/java/lib/xalan_0_19_4.jar:${CLASSPATH}
    CLASSPATH=/opt/java/lib/xerces_1_0_1.jar:${CLASSPATH}
    CLASSPATH=${CLASSPATH}:/opt/java/jndi.jar
fi

#if [ "$oldCP" != "" ]; then
#    CLASSPATH=${CLASSPATH}:${oldCP}
#fi
for i in /opt/java/lib/*.jar ; do
  CLASSPATH=${CLASSPATH}:$i
done

CLASSPATH=${CLASSPATH}:/opt/java/src.jar:/opt/java/lib

export CLASSPATH

# We start the server up in the background for a couple of reasons:
#   1) It frees up your command window
#   2) You should use `stop` option instead of ^C to bring down the server
OP="$TOMCAT_OPTS -Dtomcat.home=${TOMCAT_HOME} org.apache.tomcat.startup.Tomcat"
start () {
   ebegin "Starting Jakarta Servlet Engine..."
   $JAVACMD $OP &
   eend $? "Error starting Jakarta Servler Engine!"
}
stop () {
   ebegin "Stopping Jakarta Servlet Engine..."
   $JAVACMD $OP -stop
   eend $? "Error stopping Jakarta Servler Engine!"
}
restart () {
	stop
	start
}

doservice ${@}


