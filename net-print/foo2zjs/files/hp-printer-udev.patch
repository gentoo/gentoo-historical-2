--- foo2zjs/hplj1000.org	2004-04-11 02:35:04.000000000 +0200
+++ foo2zjs/hplj1000		2004-09-28 14:18:46.511318136 +0200
@@ -133,6 +133,24 @@
     #
     # Sniff around for printers that need a firmware download
     #
+    if [ -e /dev/.udev ]; then
+	log "Udev detected, waiting for udev to create device nodes"
+
+	HPDEV="/dev/usb/lp0"
+	COUNT=0
+	while [ ! -c ${HPDEV} -a ${COUNT} -lt 20 ];
+	do
+		sleep 1
+		COUNT=`expr ${COUNT} + 1`
+  	done
+	
+	if [ ! -c ${HPDEV} ];
+	then
+		log "Udev failed to initialise device ${HPDEV}"
+	else
+		log "Udev created ${HPDEV} node after ${COUNT} seconds"
+	fi
+    fi
     usblps=`find /dev/usb -name lp*`" "`find /dev -name usblp*`
     for dev in $usblps; do
 	status=`$USBID $dev 2>/dev/null | grep "hp LaserJet $MODEL"`
