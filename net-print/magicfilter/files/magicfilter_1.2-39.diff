--- magicfilter-1.2.orig/debian/changelog
+++ magicfilter-1.2/debian/changelog
@@ -0,0 +1,433 @@
+magicfilter (1.2-39) frozen unstable; urgency=low
+
+  * moved `gs' and `enscript' from `Suggests:' to `Recommends:' in order to
+    accomodate users, who are installing trough GUI-tools which do not
+    honor the `Suggests:'-line (e.g. apt) (fixes Bug#61025)
+  * updated bj6?0-filter to print through enscript.
+  * fixed copy/paste bug in bj800 filter (filter instead of pipe)
+
+ -- David Frey <dfrey@debian.org>  Mon,  1 May 2000 22:05:31 +0200
+
+magicfilter (1.2-38) frozen unstable; urgency=medium
+
+  * Fixed postrm script to not remove the filters twice (closes Bug#59883:
+    Purging fails).
+  * changed default line in the stylus800-filter according to other
+    Stylus*-filters (closes Bug#59882: stylus800-filter: No entry for
+    default.)
+  * Removed "HANDLE_TEXT" for native PostScript printers in order to use
+    enscript(1).
+  * uses now pdf2ps for native PostScript printers.
+  * added HP Laserjet 4050 filter. (copied and adapted ljet4m filter)
+    (closes Bug#57378: lj4050 support?)
+  * added HP 690C filter (thanks to Christian Marillat
+    <marillat@alpes-net.fr> for the filter)  
+  * included bzip patch. (thanks to Frodo Looijaard <frodol@dds.nl> for
+    the patch)
+
+ -- David Frey <dfrey@debian.org>  Tue, 14 Mar 2000 00:01:18 +0100
+
+magicfilter (1.2-37) unstable; urgency=low
+
+  * changing `lp=/dev/null' to `lp=' for remote printers (fixes Bug
+    #54230)  
+  * fixed wrong StylusColor-800@360dpi-Filter (fixes Bug #55150)
+  * fixed typo in 720dpi for Stylus-Color (fixes Bug #54063) 
+
+ -- David Frey <dfrey@debian.org>  Sat, 15 Jan 2000 16:47:31 +0100
+
+magicfilter (1.2-36) unstable; urgency=low
+
+  * added -a option for tiff2ps (fixes Bug #52260)
+  * replaced ibmpc with cp437 to fix printing problem
+    with "sz" and possible others. Thank to Dirk for
+    pointing this one out.
+
+ -- David Frey <dfrey@debian.org>  Sun,  2 Jan 2000 20:13:59 +0100
+
+magicfilter (1.2-35) unstable; urgency=high
+
+  * fixed wrong prerm script.
+
+ -- David Frey <dfrey@debian.org>  Tue, 16 Nov 1999 23:18:28 +0100
+
+magicfilter (1.2-34) unstable; urgency=low
+
+  * added updated Epson-Stylus drivers from Dirk Ritter.
+    Many thanks to Dirk for his work!
+  * added PNG support (fixes Bug#49171: magicfilter: Could use pngtopnm to
+    print png files)
+
+ -- David Frey <dfrey@debian.org>  Sat, 13 Nov 1999 15:13:43 +0100
+
+magicfilter (1.2-33) unstable; urgency=low
+
+  * fixed compiler warnings about possibly unitialized variables.
+  * added `lpr_bounce'-option into generated printcap if magicfilter is
+    used in conjunction with lprng (Bug#47899, 47243)
+  * use enscript on BJC-2000 and on PS-printers which are not able to
+    print text natively (Bug#46200).
+  * use pdf2ps for PS-printers to handle PDF.
+  
+ -- David Frey <dfrey@debian.org>  Tue,  2 Nov 1999 00:07:22 +0100
+
+magicfilter (1.2-32) unstable; urgency=low
+
+  * update for FHS compliance: 
+    - mention new location of the GPL,
+    - move manpage to /usr/share/man/man1/
+    - moved documentation to /usr/share/doc/magicfilter/
+  * updated JPEG magic to match file 3.27-4.
+  * do not reject PDFs in the ljet4m-filter (closes Bug#43631)
+  * fixed `Bug#45457: magicfilterconfig perl script uses unitialized
+    variable' (closes Bug#45457, #47079)
+
+ -- David Frey <dfrey@debian.org>  Sun, 19 Sep 1999 16:06:42 +0200
+
+magicfilter (1.2-31) unstable; urgency=low
+
+  * Change default for second printer to `done' for better installation
+    closes Bug#37890)
+  * Added support for printing PDF-files on PS printers by adding PDF-rule
+    on PS printers too (closes Bug#38105)
+  * removed versioned suggests on gs to allow use of virtual package gs
+    (closes Bug#30368, Bug#35378)
+  * Added another JPEG-magic entry to fix Bug#40599: jpeg file not recognized
+
+ -- David Frey <dfrey@debian.org>  Sun, 15 Aug 1999 23:26:04 +0200
+
+magicfilter (1.2-30) unstable; urgency=low
+
+  * Moved gs from recommends to suggests (closes bug #37325)
+  * switched to unified printer parameter-files, where applicable.
+  * added BJC610.
+
+ -- David Frey <dfrey@debian.org>  Sun, 16 May 1999 00:05:57 +0200
+
+magicfilter (1.2-29) unstable; urgency=low
+
+  * Removed gs-aladin recommends;
+  * Added suggests for enscript;
+  * Added suggests for psptools (suggestion from Jake Hamby, thanks for 
+    pointing out that psptools exist).
+  * Added suggests for recode (Bug#34884),    
+  * added -c quit for gs in the PDF-filter as a GhostScript-workaround
+    (Bug#35443)
+
+ -- David Frey <dfrey@debian.org>  Sun,  4 Apr 1999 22:46:29 +0200
+
+magicfilter (1.2-28) frozen unstable; urgency=low
+
+  * fixed dj550c-filter for Umlaut-printing (fixes Bug#30745: magicfilter:
+    DJ 550C does not print German umlauts)  
+  * Promoted gs from Suggests to Recommends (for PDF printing, fixes
+    Bug#30673: magicfilter: Magicfilter should depend on gs)  
+  * changed "press a key to continue" to the correct
+    "Press <ENTER> to continue." (fixes Bug#29491: magicfilter: bad prompt
+    in /usr/sbin/magicfilterconfig)  
+  * added explanatory text as suggested by Carl R. Witty for the
+    filter-selection (fixes Bug#29834: magicfilter should describe the input
+    filters)
+
+ -- David Frey <dfrey@debian.org>  Fri,  1 Jan 1999 20:28:36 +0100
+
+magicfilter (1.2-27) frozen unstable; urgency=low
+
+  * Reverted filter scripts to 1.2-25; undoes Bug#27773, since the bug
+    report was bogus.
+
+ -- David Frey <dfrey@debian.org>  Sat,  7 Nov 1998 20:29:06 +0100
+
+magicfilter (1.2-26) unstable; urgency=low
+
+  * fixes 'Re: Bug#27285: magicfilter should not ask before creating spool
+    dir'.
+  * Set default filter back to HANDLE_TEXT in order not to break samba
+    networking (Bug #27773).
+    This means, that the people out there who print directly, i.e. most of
+    us, and who had some filters (djscript, recode etc) in use have to
+    edit their magicfilter files.
+  * added remote printing support (closes Bug #16011)
+  * added dj600
+  * magicfilterconfig uses now the paperconf program.
+  * experimental serial printer (e.g. plotter) support.
+
+ -- David Frey <dfrey@debian.org>  Sun, 25 Oct 1998 21:33:16 +0100
+
+magicfilter (1.2-25) unstable; urgency=low
+
+  * removed '1>&3' indirections (fixes Bugs #28352 et. al.)
+  * remove "." as a troff magic, as a leading dot is also used in other
+    file formats (e.g. BLIF = berkeley logic interchange format).
+    (fixes Bug #19681)
+
+ -- David Frey <dfrey@debian.org>  Sat, 19 Sep 1998 23:03:32 +0200
+
+magicfilter (1.2-24) frozen unstable; urgency=low
+
+  * fixes bug #23579 (should suggest libjpeg-progs | libjpeg-gif, gs |
+    gs-aladdin)  
+
+ -- David Frey <dfrey@debian.org>  Wed,  8 Jul 1998 21:59:29 +0200
+
+magicfilter (1.2-23) frozen unstable; urgency=low
+
+  * added recode dependendy: fixes 'Bug#23524: magicfilter: depends on recode'
+  * corrected gargabe Samba magic, fixes 'Bug #22866: magicfilter:
+    Incorrect magic for Win95/Samba print jobs'
+  * implemented LPUSERNAME-idea (fixes Bug#24052: magicfilter could
+    provide gecos entry of print job owner).
+
+ -- David Frey <dfrey@debian.org>  Tue, 30 Jun 1998 20:24:22 +0200
+
+magicfilter (1.2-22) unstable; urgency=low
+
+  * fixed typo in magicfilterconfig (it's instead of its) (Bug#22021)
+  * fixed Bug#22913: magicfilter: bug in postrm
+
+ -- David Frey <dfrey@debian.org>  Sun,  7 Jun 1998 23:13:56 +0200
+
+magicfilter (1.2-21) frozen unstable; urgency=medium
+
+  * Fix /tmp-exploits bug reported by Thomas Rössler (Bug#21251:
+    magicfilter: magicfilter-1.2 contains a tmpnam() race condition).
+    He also donated the patch (thanks!).
+  * Added bj600[_draft]-filters (donated by Paul J Thompson)
+  * Changed text printing rules for Stylus (part of Bug#20905)
+
+ -- David Frey <dfrey@debian.org>  Tue, 21 Apr 1998 21:54:00 +0200
+
+magicfilter (1.2-20) unstable; urgency=low
+
+  * fixes typo in stylus_color_360_dpi-filter and pjxl-filter.x
+    (closes Bug#19093)
+
+ -- David Frey <dfrey@debian.org>  Sat,  7 Mar 1998 20:12:39 +0100
+
+magicfilter (1.2-19) unstable; urgency=low
+
+  * fixed nuisance that the README-files had the x-bits set.
+  * fixed Bug#18796: magicfilter: source extraction requires interaction
+
+ -- David Frey <dfrey@debian.org>  Tue,  3 Mar 1998 21:59:34 +0100
+
+magicfilter (1.2-18) unstable; urgency=low
+
+  * made all the magicfilter scripts conffiles (Fixes Bug #4834, but
+    wastes space)
+  * changed maintainer address to working debian.org address.
+  * fixed bugs found by lintian: old FSF address and non-relative md5sum's
+    paths.
+  * added suggestion from Christian <root@lathspell.westend.com>, to warn
+    DJ-* users to install the djtools or to change the default line to text.
+
+ -- David Frey <david@eos.lugs.ch>  Mon, 16 Feb 1998 21:47:21 +0100
+
+magicfilter (1.2-17) unstable; urgency=low
+
+  * added Michael Meskes djscript filter and suggested djtools.
+  * added Marco Pistore's trick of redirecting stdout in order to avoid
+    stderr's messages on the printer output.
+  * encorporated tiff2ps changes (fixes Bug#15189)
+
+ -- David Frey <david@eos.lugs.ch>  Sun, 18 Jan 1998 14:17:42 +0100
+
+magicfilter (1.2-16) unstable; urgency=low
+
+  * changed maintainer address back to <David.Frey@eos.lugs.ch>
+  * updated to Standard 2.3.0.1
+
+ -- David Frey <david@eos.lugs.ch>  Sun, 21 Dec 1997 23:16:54 +0100
+
+magicfilter (1.2-15) unstable; urgency=low
+
+  * Changed PDF processing: uses now standard ghostscript;
+    using xpdf for PDF processing would make magicfilter
+    go into contrib, which we definitely want to avoid.
+
+ -- David Frey <david@eos.lugs.ch>  Sun, 16 Nov 1997 23:04:20 +0100
+
+magicfilter (1.2-14) unstable; urgency=low
+
+  * added binary-arch to enable dpkg-buildpackage -B to succeed.
+    (fixes Bug #14310)
+
+  * added PDF entry (Bug #9766). magicfilter depends now on xpdf,
+    since it uses pdftops for the processing.
+
+  * Add Samba-degarbaging script (Bug #9928); untested.
+
+ -- David Frey <david@eos.lugs.ch>  Mon,  3 Nov 1997 23:14:03 +0100
+
+magicfilter (1.2-13) unstable; urgency=low
+
+  * added libjpeg-progs in the Suggests: line (fixes Bug #13901)
+
+ -- David Frey <david@eos.lugs.ch>  Wed, 22 Oct 1997 22:03:19 +0200
+
+magicfilter (1.2-12) unstable; urgency=low
+
+  * recompiled for libc6
+
+  * moved examples directory from /usr/doc/examples/magicfilter to
+    /usr/doc/magicfilter/examples (Bug #9724)
+
+  * fixed unitialized variable in magicfilterconfig (Bug #10109, Bug #11329)
+
+  * added manpage (fixes Bug #)
+
+  * magicfilterconfig calls /etc/init.d/lpr stop, /etc/init.d/lpr start resp.
+    /etc/init.d/lprng stop, /etc/init.d/lprng start to let the lpd resp.
+    lprngd reload the /etc/printcap file (needed for lprng) (fixes Bug #11259)
+
+  * Added 'Press return to continue' when $DISPLAY is set (Bug #10428).
+
+  * added ...|lprng in the Recommends: line
+
+  * added md5sum'ming
+
+ -- David Frey <david@eos.lugs.ch>  Sat, 13 Sep 1997 17:28:58 +0200
+
+magicfilter (1.2-11) unstable; urgency=low
+
+  * Added color stylus scripts, donated from 
+    Dirk Ritter <Dirk_Ritter@s5.maus.de> _and_ changed filters/Makefile.in
+    to really ship them.
+
+ -- David Frey <david@eos.lugs.ch>  Thu, 1 May 1997 22:33:14 +0200
+
+magicfilter (1.2-10) frozen unstable; urgency=low
+
+  * Fixed bug #8735: wrong checksum, typo in dependency
+
+ -- David Frey <david@eos.lugs.ch>  Sat, 19 Apr 1997 17:25:55 +0159
+
+magicfilter (1.2-9) frozen unstable; urgency=low
+
+  * magicfilter recommends now lpr; it doesn't depend on it anymore
+    (closes Bug #8216)
+
+  * added ftp site where to find magicfilter (Bug #7452)
+
+ -- David Frey <david@eos.lugs.ch>  Sat, 29 Mar 1997 17:24:32 +0100
+
+magicfilter (1.2-8) unstable; urgency=low
+
+  * made all the filters conffiles.
+  * gzipped manpage
+  * strenghtened magicfilterconfig by putting a "strict" into it.
+
+ -- David Frey <david@eos.lugs.ch>  Sat, 1 Feb 1997 15:27:14 +0100
+
+magicfilter (1.2-7) unstable; urgency=low
+
+  * Updated to new distribution format.
+  * Fixed Bug #4733: link from /usr/bin/X11 to /usr/bin/X11R6 removed
+    and recompiled
+
+ -- David Frey <david@eos.lugs.ch>  Sun, 13 Oct 1996 22:59:22 +0200
+
+Tue Aug 13 23:13:16 1996  David Frey  <david@eos.lugs.ch>
+
+	* Bug #4063: 
+	  - Fixed path to executable magicfilter: should read /usr/sbin/...
+	  - magicfilterconfig checks /etc/papersize or asks for it and 
+	    adjust the :pl#: entry accordingly.
+	  - Suggests netpbm in addition to pbmplus.
+	  - deletes the extracted filters upon removal.
+
+Wed Jul  3 20:30:31 1996  David Frey  <david@eos.lugs.ch>
+
+	* Changed ``Recommends:' into ``Suggests:'' (fixes Bug #3254)
+
+	* the postinst scripts runs now magicfilterconfig,
+	  instead only to tell the user to do so (fixes Bug #3452)
+
+Tue Jun  4 23:19:59 1996  David Frey  <david@eos.lugs.ch>
+
+	* added Architecture and Section field.
+
+	* The path for the pbmplus binaries is now /usr/bin/pbmplus
+	  (to remain backward compability with the old setup).
+
+Wed May  8 22:53:20 1996  David Frey  <david@eos.lugs.ch>
+
+	* magicfilter uses now dpkg-name to determine its package name
+
+	* Added "Press ENTER to continue" in debian.postinst.
+
+Wed May  1 15:53:58 1996  David Frey  <david@eos.lugs.ch>
+
+	* Changed architecture field.
+
+Sun Apr 14 23:28:19 1996  David Frey  <david@eos.lugs.ch>
+
+	* Chgrps spool directory to lp group (the lp group is fetched
+	  from /etc/passwd).
+	* magicfilterconfig: Filters in /usr/sbin/ are called *-filter,
+ 	  not just filter
+	* magicfilterconfig: --force-switch added.
+
+Tue Mar 26 22:42:49 1996  David Frey  <david@eos.lugs.ch>
+
+	* added various suggestions from Rob (osiris@cs.utexas.edu),
+	  e.g af and lp entries.
+
+	* Corrected me that the spool directory is under /var/spool/lpd.
+
+Sun Mar 24 21:48:37 1996  David Frey  <david@eos.lugs.ch>
+
+	* Bug#2558: HP-4m handling not robust enough for shared
+	    environment
+ 	  (from Raul Miller <rdm@tad.micro.umn.edu>)
+
+	  Can't change this bug in Magicfilter 1.2 due to the
+	  inclusion mechanism in the filter subdirectory.
+
+------------------------------------------------------------- Magicfilter 1.1b
+
+Mon Mar 18 20:01:13 1996  David Frey  <david@eos.lugs.ch>
+
+	* Bug#2558: HP-4m handling not robust enough for shared
+	    environment
+ 	  (from Raul Miller <rdm@tad.micro.umn.edu>)
+
+	  I've changed the HP Laserjet 4 entries according to his
+	  suggestion (don't have the ESC codes for the others).
+
+	* Bug#????: A lot of suggestions from Erick Branderhorst 
+	  <branderhorst@fgg.EUR.NL> implemented:
+	    - debian.postinst renamed to magicfilterconfig
+	    - take example values as default
+	    - filter in /usr/doc/magicfilter/filters/* tarred and gzipped.
+	    - added comment that /etc/printcap is autoconfigurated.
+	    - 'Depends: lpr' added.
+	    - ...
+
+Sat Mar 16 17:45:40 1996  David Frey  <david@eos.lugs.ch>
+
+	* recompiled for ELF.
+
+	* moved example filters into /usr/doc/exaples/magicfilter/...
+
+Wed Jan 24 22:53:53 1996  David Frey  <david@eos.lugs.ch>
+
+	* magicfilter's path changed from /usr/bin/magicfilter to
+	  /usr/sbin/magicfilter (in the filters)
+
+	* gzip'ing the README, QuickInst and the filters
+	  (from Erick Branderhorst <branderhorst@fgg.EUR.NL)>
+	
+	* Recommending gs instead of gs_x
+	  (from Erick Branderhorst <branderhorst@fgg.EUR.NL>)
+
+Mon Jan 22 23:24:54 1996  David Frey  <david@eos.lugs.ch>
+
+	* Filters have now pbmplus support compiled in.
+
+	* Fixed an very stupid backquoting bug.
+
+Local variables:
+mode: debian-changelog
+add-log-mailing-address: "dfrey@debian.org"
+End:
--- magicfilter-1.2.orig/debian/control
+++ magicfilter-1.2/debian/control
@@ -0,0 +1,16 @@
+Source: magicfilter
+Section: text
+Priority: optional
+Maintainer: David Frey <dfrey@debian.org>
+Standards-Version: 3.0.1
+
+Package: magicfilter
+Architecture: any
+Depends: ${shlibs:Depends}
+Suggests: dvips, pbmplus|netpbm, pnmtopng, libjpeg-progs|libjpeg-gif, libtiff-tools, psptools, recode, djtools, bzip2
+Recommends: lpr|lprng, gs, enscript
+Conflicts: apsfilter
+Description: automatic printer filter.
+ Magicfilter is a customizable, extensible automatic printer filter.
+ It uses its own magic database (à la file(1)) to decide how to print
+ out an given print job.
--- magicfilter-1.2.orig/debian/copyright
+++ magicfilter-1.2/debian/copyright
@@ -0,0 +1,31 @@
+This is Debian/GNU Linux's prepackaged version of magicfilter,
+a customizable, extensible automatic printer filter.
+It was written by H. Peter Anvin <Peter.Anvin@linux.org>.
+
+I got it from a sunsite mirror (sunsite.cnlab-switch.ch) from the
+directory /mirror/linux/sunsite/system/printing/magicfilter-1.2.tar.gz
+
+Packaged by David Frey <dfrey@debian.org>
+
+Changes:
+ * added Debian GNU/Linux package maintenance system files
+ * Stylus Epson 800 filters added.
+ * Stylus Epson Color filters contributed by 
+   Dirk Ritter <Dirk_Ritter@s5.maus.de> added.
+
+  This program is free software; you can redistribute it and/or modify
+  it under the terms of the GNU General Public License as published by
+  the Free Software Foundation; either version 2, or (at your option)
+  any later version.
+
+  This program is distributed in the hope that it will be useful, but
+  WITHOUT ANY WARRANTY; without even the implied warranty of
+  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+  General Public License for more details.
+
+  You should have received a copy of the GNU General Public License
+  along with this program; if not, write to the Free Software Foundation,
+  Inc., 59 Temple Place Suite 330, Boston, MA 02111-1307 USA.
+
+On Debian GNU/Linux systems, the complete text of the GNU General
+Public License can be found in `/usr/share/common-licenses/GPL'.
--- magicfilter-1.2.orig/debian/postinst
+++ magicfilter-1.2/debian/postinst
@@ -0,0 +1,21 @@
+#!/bin/sh -e
+# -*- shell-script -*-
+
+if [ -r /etc/printcap ]; then 
+  echo "You already have an /etc/printcap file installed."
+  echo "I assume that it is already correctly configured."
+  echo "(run /usr/sbin/magicfilterconfig --force if you want to overwrite it)"
+else
+  /usr/sbin/magicfilterconfig
+  echo "Please move the freshly generated printcap-file to /etc."
+fi
+
+if [ "$1" = "configure" ]; then
+  if [ -d /usr/doc -a ! -e /usr/doc/magicfilter -a -d /usr/share/doc/magicfilter ]; then
+    ln -sf ../share/doc/magicfilter /usr/doc/magicfilter
+  fi
+fi
+
+if test -x /usr/bin/update-menus; then
+  update-menus
+fi
--- magicfilter-1.2.orig/debian/postrm
+++ magicfilter-1.2/debian/postrm
@@ -0,0 +1,25 @@
+#!/bin/sh -e
+# -*- shell-script -*-
+
+if [ "$1" = "purge" -a -r /etc/printcap ]; then
+  FILTERS=`awk -F[:=] '/:if=.*/ { print $3 }' /etc/printcap`
+
+  if [ -n "$FILTERS" ]; then
+    cat <<-EOI
+	The following input filters are installed at the moment:
+EOI
+    echo $FILTERS|tr ' ' '\n'
+    cat <<-EOI
+
+	If any of these filters were input filters from the magicfilter
+	package, you have now inoperable input filters and cannot print
+	on some or all printer queues.
+EOI
+  fi
+fi
+
+if test -x /usr/bin/update-menus; then
+  update-menus
+fi
+
+exit 0
--- magicfilter-1.2.orig/debian/rules
+++ magicfilter-1.2/debian/rules
@@ -0,0 +1,65 @@
+#!/usr/bin/make -f
+# -*- makefile -*-
+
+# The name of the package
+package	:= $(shell sed -n -e 's/Package: *\([a-z]\)/\1/p' debian/control)
+doc	:= usr/share/doc/$(package)
+man	:= usr/share/man/man8
+menu	:= usr/lib/menu
+tmp	:= debian/tmp
+
+build:
+	./configure --prefix=/usr --infodir=/usr/share/info \
+                    --mandir=/usr/share/man --bindir=/usr/sbin &&\
+	make CFLAGS="-g -O2 -Wall" LDFLAGS="" bindir=/usr/sbin && \
+	touch build
+
+clean:
+	-rm -f build
+	-$(MAKE) -i distclean || $(MAKE) -f Makefile.in distclean
+	-rm -rf *~ filters/*~ $(tmp) debian/*~ debian/files*
+
+binary-indep: build
+# There are no architecture-independent files to be uploaded
+# generated by this package.  If there were any they would be
+# made here.
+
+binary-arch: build
+	-rm -rf $(tmp)
+	install -d $(tmp)
+	cd $(tmp) &&\
+	  install -d usr/sbin $(doc) $(man) $(menu) etc/magicfilter
+	$(MAKE) install prefix=$(tmp)/usr\
+	  bindir=$(tmp)/usr/sbin infodir=$(tmp)/$(info) mandir=$(tmp)/$(man)
+	strip $(tmp)/usr/sbin/magicfilter
+	install magicfilterconfig $(tmp)/usr/sbin/magicfilterconfig
+	install -m 644 filters/README* $(tmp)/$(doc)/
+	install -m 644 debian/menu $(tmp)/$(menu)/$(package)
+	cd filters && cp -p *-filter ../$(tmp)/etc/magicfilter
+	cp debian/changelog $(tmp)/$(doc)/changelog.Debian
+	cd $(tmp)/$(doc) && gzip -9f changelog.Debian README*
+	cp debian/copyright $(tmp)/$(doc)
+	cp magicfilterconfig.8 $(tmp)/$(man)
+	gzip -9f $(tmp)/$(man)/*
+	dpkg-shlibdeps $(tmp)/usr/sbin/$(package)
+	install -d $(tmp)/DEBIAN
+	cd $(tmp) &&\
+	  md5sum `find * -name DEBIAN -prune -o -type f -print`\
+	   > DEBIAN/md5sums
+	dpkg-gencontrol
+	install -m 755 debian/prerm debian/postrm debian/postinst $(tmp)/DEBIAN
+	cd filters && ls -1 *-filter|sed -e 's,^,/etc/magicfilter/,'\
+	  > ../$(tmp)/DEBIAN/conffiles
+	chmod 644 $(tmp)/DEBIAN/conffiles
+	chown -R root.root $(tmp)
+	chmod -R g-ws $(tmp)
+	dpkg --build $(tmp) ..
+
+# Below here is fairly generic really
+
+binary:         binary-indep binary-arch
+
+source diff:
+	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false
+
+.PHONY: binary binary-arch binary-indep clean
--- magicfilter-1.2.orig/debian/substvars
+++ magicfilter-1.2/debian/substvars
@@ -0,0 +1 @@
+shlibs:Depends=libc6 (>= 2.1.2)
--- magicfilter-1.2.orig/debian/prerm
+++ magicfilter-1.2/debian/prerm
@@ -0,0 +1,7 @@
+#!/bin/sh
+
+set -e
+
+if [ \( "$1" = "upgrade" -o "$1" = "remove" \) -a -L /usr/doc/magicfilter ]; then
+  rm -f /usr/doc/magicfilter
+fi
--- magicfilter-1.2.orig/debian/menu
+++ magicfilter-1.2/debian/menu
@@ -0,0 +1,7 @@
+?package(magicfilter):needs="text" section="Apps/System/Admin" \
+   title="Magicfilter-config" \
+   longtitle="Configure automatic printer filter (magicfilter)"\
+   description="Configure Magicfilter, a customizable, extensible\
+ automatic printer filter. It uses its own magic database \
+ (a la file(1)) to decide how to print out an given entry."\
+   command="/usr/sbin/su-to-root -p root -c /usr/sbin/magicfilterconfig"
--- magicfilter-1.2.orig/filters/bj10e-filter.x
+++ magicfilter-1.2/filters/bj10e-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj10e -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj10e -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj10e -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/Makefile.in
+++ magicfilter-1.2/filters/Makefile.in
@@ -32,7 +32,27 @@
 		la75-filter        ln03-filter \
 		psonly300-filter   psonly400-filter   psonly600-filter \
 		cps300-filter	   cps400-filter      cps600-filter \
-		cpsonly300-filter  cpsonly400-filter  cpsonly600-filter
+		cpsonly300-filter  cpsonly400-filter  cpsonly600-filter \
+		bj600-filter       bj600_draft-filter bj610-filter \
+		bj800-filter       bj800_draft-filter \
+		dj690c-filter	   dj690c-best-filter dj690c-low-filter \
+		stylus800-filter \
+		ljet4050-filter \
+		StylusColor@360dpi-filter \
+		StylusColor@720dpi-filter \
+		StylusColor-II-IIs@360dpi-filter \
+		StylusColor-II@720dpi-filter \
+		StylusColor-IIs@720dpi-filter \
+		StylusColor-500@360dpi-filter \
+		StylusColor-500@720dpi-filter \
+		StylusColor-600@360dpi-filter \
+		StylusColor-600@720dpi-filter \
+		StylusColor-600@1440dpi-filter \
+		StylusColor-800@360dpi-filter \
+		StylusColor-800@720dpi-filter \
+		StylusColor-800@1440dpi-filter \
+		StylusColor-1520@1440dpi-filter \
+		StylusColor-generic-filter
 
 .SUFFIXES:
 .SUFFIXES:	.x .xc .h .xh .mh .xt
@@ -96,6 +116,11 @@
 # DEPENDENCIES -- do not delete this line --
 bj10e-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 bj200-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+bj600-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+bj600_draft-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+bj610-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+bj800-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+bj800_draft-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 cps300-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 cps400-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 cps600-filter.xc: genericps.mh stdconv.mh stdrejects.mh
@@ -106,6 +131,9 @@
 dj500-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 dj500c-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 dj550c-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+dj690c-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+dj690c-best-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+dj690c-low-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 epson9-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 epson9c-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 epsonlq-filter.xc: genericps.mh stdconv.mh stdrejects.mh
@@ -125,6 +153,7 @@
 ljet4l-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 ljet4m-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 ljet4ml-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+ljet4050-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 ljetplus-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 ljetpluslo-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 ln03-filter.xc: genericps.mh stdconv.mh stdrejects.mh
@@ -143,3 +172,19 @@
 r4081-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 tek4693-filter.xc: genericps.mh stdconv.mh stdrejects.mh
 tek4696-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+stylus800-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor@360dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-II-IIs@360dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-II@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-IIs@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-500@360dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-500@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-600@360dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-600@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-600@1440dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-800@360dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-800@720dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-800@1440dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-1520@1440dpi-filter.xc: genericps.mh stdconv.mh stdrejects.mh
+StylusColor-generic-filter.xc: genericps.mh stdconv.mh stdrejects.mh
--- magicfilter-1.2.orig/filters/bj600_draft-filter.x
+++ magicfilter-1.2/filters/bj600_draft-filter.x
@@ -0,0 +1,40 @@
+%include <filters.h>
+#
+# Magic filter setup file for Canon BubbleJet 600
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc600 -sPrintQuality=Draft -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc600 -sPrintQuality=Draft -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	pipe PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
+
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default                 HANDLE_TEXT
--- magicfilter-1.2.orig/filters/bj200-filter.x
+++ magicfilter-1.2/filters/bj200-filter.x
@@ -19,8 +19,10 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj200 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj200 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bj200 -sOutputFile=- $FILE -c quit
 %endif
+
 /*
  * Text
  */
--- magicfilter-1.2.orig/filters/bj600-filter.x
+++ magicfilter-1.2/filters/bj600-filter.x
@@ -0,0 +1,40 @@
+%include <filters.h>
+#
+# Magic filter setup file for Canon BubbleJet 600
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc600 -dMonochromePrint=true -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc600 -dMonochromePrint=true -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	pipe PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
+
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default                 HANDLE_TEXT
--- magicfilter-1.2.orig/filters/bj610-filter.x
+++ magicfilter-1.2/filters/bj610-filter.x
@@ -0,0 +1,40 @@
+%include <filters.h>
+#
+# Magic filter setup file for Canon BubbleJet 600
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @bjc610a0.upp -q -dSAFER -dNOPAUSE -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @bjc610a0.upp -q -dSAFER -dNOPAUSE -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	pipe PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
+
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default                 HANDLE_TEXT
--- magicfilter-1.2.orig/filters/filters2.h.in
+++ magicfilter-1.2/filters/filters2.h.in
@@ -1,4 +1,6 @@
 /* filters2.h.in: This file was automatically generated by mkfilterhin */
+#undef	HAVE_RECODE
+#undef	PATH_RECODE
 #undef	HAVE_GHOSTSCRIPT
 #undef	PATH_GHOSTSCRIPT
 #undef	HAVE_GROG
@@ -15,6 +17,8 @@
 #undef	PATH_GROTTY
 #undef	HAVE_GROLJ4
 #undef	PATH_GROLJ4
+#undef	HAVE_BZIP2
+#undef	PATH_BZIP2
 #undef	HAVE_GZIP
 #undef	PATH_GZIP
 #undef	HAVE_ZCAT
@@ -25,6 +29,8 @@
 #undef	PATH_DVIPS
 #undef	HAVE_PNMTOPS
 #undef	PATH_PNMTOPS
+#undef	HAVE_PNGTOPNM
+#undef	PATH_PNGTOPNM
 #undef	HAVE_GIFTOPPM
 #undef	PATH_GIFTOPPM
 #undef	HAVE_DJPEG
@@ -35,6 +41,8 @@
 #undef	PATH_TOPS
 #undef	HAVE_SGITOPS
 #undef	PATH_SGITOPS
+#undef	HAVE_TIFFTOPS
+#undef	PATH_TIFFTOPS
 #undef	HAVE_TIFFTOPNM
 #undef	PATH_TIFFTOPNM
 #undef	HAVE_BMPTOPPM
--- magicfilter-1.2.orig/filters/deskjet-filter.x
+++ magicfilter-1.2/filters/deskjet-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=deskjet -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=deskjet -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=deskjet -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/dj500-filter.x
+++ magicfilter-1.2/filters/dj500-filter.x
@@ -17,7 +17,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=djet500 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=djet500 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=djet500 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
@@ -35,4 +36,7 @@
 0	\033		HANDLE_PCL
 
 # Default entry -- for normal (text) files.  MUST BE LAST.
-default			HANDLE_TEXT
+# If you do not have djscript use the other default line or, better, install
+# it. MM
+#
+default			filter 	/usr/bin/djscript -q 
--- magicfilter-1.2.orig/filters/dj500c-filter.x
+++ magicfilter-1.2/filters/dj500c-filter.x
@@ -18,7 +18,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=cdj500 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=cdj500 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=cdj500 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
@@ -36,4 +37,7 @@
 0	\033		HANDLE_PCL
 
 # Default entry -- for normal (text) files.  MUST BE LAST.
-default			HANDLE_TEXT
+# If you do not have djscript use the other default line or, better, install
+# it. MM
+#
+default			filter 	/usr/bin/djscript -q 
--- magicfilter-1.2.orig/filters/dj550c-filter.x
+++ magicfilter-1.2/filters/dj550c-filter.x
@@ -18,7 +18,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=cdj550 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @cdj550.upp -q -dSAFER -dNOPAUSE -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT @cdj550.upp -q -dSAFER -dNOPAUSE -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/epson9-filter.x
+++ magicfilter-1.2/filters/epson9-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epson -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epson -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epson -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/epson9c-filter.x
+++ magicfilter-1.2/filters/epson9c-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epsonc -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epsonc -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=epsonc -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/epsonlq-filter.x
+++ magicfilter-1.2/filters/epsonlq-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epson -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epson -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epson -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/epsonlqc-filter.x
+++ magicfilter-1.2/filters/epsonlqc-filter.x
@@ -20,7 +20,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epsonc -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epsonc -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=epsonc -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/stdconv.xh
+++ magicfilter-1.2/filters/stdconv.xh
@@ -18,6 +18,18 @@
 %endif
 0	%!		HANDLE_PS
 0	\004%!		HANDLE_PS
+
+# PDF
+/* PDF */
+%ifndef HANDLE_PDF
+%ifdef  NATIVE_PS
+%define HANDLE_PDF	ffilter pdf2ps $FILE -
+%else
+%define HANDLE_PDF	reject	Cannot print PDF on this printer.
+%endif
+%endif
+0	%PDF		HANDLE_PDF
+
 /* Check out a couple of common data types; if we can't handle them, see
    if we can find something that can; also define _OK entries and appropriate
    rejects. */
@@ -118,6 +130,10 @@
 %define HANDLE_TROFF	reject	Cannot print troff files on this printer.
 %endif
 
+%ifdef HAVE_BZIP2
+%define BZCAT PATH_BZIP2 -cdq
+%endif
+
 # TeX DVI
 0	\367\002	HANDLE_DVI
 
@@ -141,6 +157,12 @@
 0	\037\240	reject	Cannot print SCO LZH files on this printer.
 %endif
 
+%ifdef BZCAT
+0	BZh		pipe	BZCAT
+%else
+0	BZh		reject	Cannot print bzip files on this printer.
+%endif
+
 # troff documents
 0	.\?\?\040	HANDLE_TROFF
 0	.\\\"		HANDLE_TROFF
@@ -190,6 +212,13 @@
 0	P5\n		HANDLE_PNM
 0	P6\n		HANDLE_PNM
 
+# PNG - Portable network graphics
+%if defined(HAVE_PNGTOPNM) && defined(PNM_OK)
+0	\x89PNG		pipe	PATH_PNGTOPNM
+%else
+0	\x89PNG		reject	Cannot print PNG images on this printer.
+%endif
+
 # HP Printer Control Language (PCL) -- assume start with reset code
 0	\033E\033	HANDLE_PCL
 
@@ -212,14 +241,22 @@
 # JFIF (JPEG) files
 %if defined(HAVE_DJPEG) && defined(PNM_OK)
 0	\377\330\377\340\?\?JFIF\0	pipe	PATH_DJPEG -pnm
+# Bug 40599
+0	\377\330\377\341\?\?Exif\0	pipe	PATH_DJPEG -pnm
 %else
 0	\377\330\377\340\?\?JFIF\0	reject	Cannot print JPEG images \
 	on this printer.
+0	\377\330\377\341\?\?Exif\0	reject	Cannot print JPEG images \
+	on this printer.
 %endif
 
 # TIFF files (the last two bytes of the "magic" is really a version number;
 # but the magic is really lame and as far as I have understood the version
 # number has never changed and never will, so we include it.)
+%if defined(HAVE_TIFFTOPS)
+0	MM\0\x2a	fpipe   PATH_TIFFTOPS -a $FILE
+0	II\x2a\0	fpipe   PATH_TIFFTOPS -a $FILE 
+%else
 %if defined(HAVE_TIFFTOPNM) && defined(PNM_OK)
 0	MM\0\x2a	pipe	PATH_TIFFTOPNM 2>/dev/null
 0	II\x2a\0	pipe	PATH_TIFFTOPNM 2>/dev/null
@@ -227,6 +264,7 @@
 0	MM\0\x2a	pipe	Cannot print TIFF images on this printer.
 0	II\x2a\0	pipe	Cannot print TIFF images on this printer.
 %endif
+%endif
 
 # BMP files (even lousier magic -- Microsoft strikes again!)
 %if defined(HAVE_BMPTOPPM) && defined(PNM_OK)
@@ -245,6 +283,13 @@
 	Cannot print BMP files on this printer.
 %endif
 
+# Garbage delivered from Windows via Samba
+# (donated by Andree Leidenfrost <leidenfrost@dkrz.de>)
+# 300     \033\052\157    cat
+# later changed to 
+# (Bug report #22866: magicfilter: Incorrect magic for Win95/Samba print jobs)
+0       \000\000\000\000\000   cat
+
 # Sun rasterfiles
 %if defined(HAVE_RASTTOPNM) && defined(PNM_OK)
 0	\x59\xa6\x6a\x95 pipe	PATH_RASTTOPNM 2>/dev/null
@@ -282,8 +327,10 @@
 %include <stdrejects.mh>
 
 %ifdef TROFF_OK
+%if 0
 # optimistic troff magic
 0	.		HANDLE_TROFF
+%endif
 # wacko troff magic
 0	'''		HANDLE_TROFF
 %endif
--- magicfilter-1.2.orig/filters/genericps.xh
+++ magicfilter-1.2/filters/genericps.xh
@@ -24,6 +24,8 @@
  */
 %ifdef NATIVE_TEXT
 %define HANDLE_TEXT	text
+%else
+%define HANDLE_TEXT	filter PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
 %endif
 
 %include <stdconv.mh>
--- magicfilter-1.2.orig/filters/ibmpro-filter.x
+++ magicfilter-1.2/filters/ibmpro-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=ibmpro -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=ibmpro -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120x72 -sDEVICE=ibmpro -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/jetp3852-filter.x
+++ magicfilter-1.2/filters/jetp3852-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r84 -sDEVICE=jetp3852 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r84 -sDEVICE=jetp3852 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r84 -sDEVICE=jetp3852 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/la50-filter.x
+++ magicfilter-1.2/filters/la50-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la50 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la50 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la50 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/la75-filter.x
+++ magicfilter-1.2/filters/la75-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la75 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la75 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144x72 -sDEVICE=la75 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/laserjet-filter.x
+++ magicfilter-1.2/filters/laserjet-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=laserjet -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=laserjet -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=laserjet -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/laserjetlo-filter.x
+++ magicfilter-1.2/filters/laserjetlo-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=laserjet -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=laserjet -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=laserjet -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/lbp8-filter.x
+++ magicfilter-1.2/filters/lbp8-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=lbp8 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=lbp8 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=lbp8 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/lj250-filter.x
+++ magicfilter-1.2/filters/lj250-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=lj250 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=lj250 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=lj250 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/ljet2p-filter.x
+++ magicfilter-1.2/filters/ljet2p-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet2p -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet2p -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet2p -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljet2plo-filter.x
+++ magicfilter-1.2/filters/ljet2plo-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljet2p -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljet2p -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljet2p -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljet3-filter.x
+++ magicfilter-1.2/filters/ljet3-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet3 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet3 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet3 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljet4-filter.x
+++ magicfilter-1.2/filters/ljet4-filter.x
@@ -17,7 +17,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r600 -sDEVICE=ljet4 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r600 -sDEVICE=ljet4 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r600 -sDEVICE=ljet4 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljet4l-filter.x
+++ magicfilter-1.2/filters/ljet4l-filter.x
@@ -17,7 +17,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet4 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet4 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljet4 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljet4m-filter.x
+++ magicfilter-1.2/filters/ljet4m-filter.x
@@ -14,22 +14,15 @@
  * PostScript
  */
 %define NATIVE_PS 1
-/*
- * PCL, PJL
- */
-%define HANDLE_PCL5E	cat
-%define HANDLE_PCL	cat
-%define HANDLE_PJL	cat
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe 	pdf2ps $FILE -
+%endif
 /*
  * Text
  */
-%define HANDLE_TEXT	cat	\eE\e&k2G\e(0N	\eE
 %define LATIN1_OK
 
 %include <stdconv.mh>
-
-# wild guess: PCL control codes start with <ESC>
-0	\033		HANDLE_PCL
 
 # Default entry -- for normal (text) files.  MUST BE LAST.
 default			HANDLE_TEXT
--- magicfilter-1.2.orig/filters/ljet4ml-filter.x
+++ magicfilter-1.2/filters/ljet4ml-filter.x
@@ -13,22 +13,15 @@
  * PostScript
  */
 %define NATIVE_PS 1
-/*
- * PCL, PJL
- */
-%define HANDLE_PCL5E	cat
-%define HANDLE_PCL	cat
-%define HANDLE_PJL	cat
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe 	pdf2ps $FILE -
+%endif
 /*
  * Text
  */
-%define HANDLE_TEXT	cat	\eE\e&k2G\e(0N	\eE
 %define LATIN1_OK
 
 %include <stdconv.mh>
-
-# wild guess: PCL control codes start with <ESC>
-0	\033		HANDLE_PCL
 
 # Default entry -- for normal (text) files.  MUST BE LAST.
 default			HANDLE_TEXT
--- magicfilter-1.2.orig/filters/ljetplus-filter.x
+++ magicfilter-1.2/filters/ljetplus-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljetplus -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljetplus -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ljetplus -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ljetpluslo-filter.x
+++ magicfilter-1.2/filters/ljetpluslo-filter.x
@@ -16,7 +16,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljetplus -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljetplus -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r150 -sDEVICE=ljetplus -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ln03-filter.x
+++ magicfilter-1.2/filters/ln03-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ln03 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ln03 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=ln03 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/m8510-filter.x
+++ magicfilter-1.2/filters/m8510-filter.x
@@ -22,7 +22,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r160x144 -sDEVICE=epson -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r160x144 -sDEVICE=epson -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r160x144 -sDEVICE=epson -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/necp6-filter.x
+++ magicfilter-1.2/filters/necp6-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=necp6 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @necp2x.upp -q -dSAFER -dNOPAUSE -sOutputFile=- -c quit - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT @necp2x.upp -q -dSAFER -dNOPAUSE -sOutputFile=- -c quit $FILE
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/oki182-filter.x
+++ magicfilter-1.2/filters/oki182-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144 -sDEVICE=oki182 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144 -sDEVICE=oki182 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r144 -sDEVICE=oki182 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/pj-filter.x
+++ magicfilter-1.2/filters/pj-filter.x
@@ -18,7 +18,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pj -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pj -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pj -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/pjxl-filter.x
+++ magicfilter-1.2/filters/pjxl-filter.x
@@ -18,7 +18,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pjxl -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pjxl -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r180 -sDEVICE=pjxl -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/pjxl300-filter.x
+++ magicfilter-1.2/filters/pjxl300-filter.x
@@ -18,7 +18,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=pjxl300 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=pjxl300 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=pjxl300 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * PCL, PJL
--- magicfilter-1.2.orig/filters/ps300-filter.x
+++ magicfilter-1.2/filters/ps300-filter.x
@@ -1,3 +1,4 @@
 %define DPI 300
 %define NATIVE_TEXT 1
+%define HANDLE_PDF fpipe PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=pswrite -sOutputFile=- $FILE -c quit
 %include <genericps.mh>
--- magicfilter-1.2.orig/filters/ps400-filter.x
+++ magicfilter-1.2/filters/ps400-filter.x
@@ -1,3 +1,4 @@
 %define DPI 400
 %define NATIVE_TEXT 1
+%define HANDLE_PDF fpipe PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r400 -sDEVICE=pswrite -sOutputFile=- $FILE -c quit
 %include <genericps.mh>
--- magicfilter-1.2.orig/filters/ps600-filter.x
+++ magicfilter-1.2/filters/ps600-filter.x
@@ -1,3 +1,4 @@
 %define DPI 600
 %define NATIVE_TEXT 1
+%define HANDLE_PDF fpipe PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r600 -sDEVICE=pswrite -sOutputFile=- $FILE -c quit
 %include <genericps.mh>
--- magicfilter-1.2.orig/filters/r4081-filter.x
+++ magicfilter-1.2/filters/r4081-filter.x
@@ -19,7 +19,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=r4081 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=r4081 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=r4081 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/stylus800-filter.x
+++ magicfilter-1.2/filters/stylus800-filter.x
@@ -0,0 +1,44 @@
+%include <filters.h>
+#
+# Magic filter setup file for Epson Stylus series printers
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=st800 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=st800 -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	text
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/ljet4050-filter.x
+++ magicfilter-1.2/filters/ljet4050-filter.x
@@ -0,0 +1,26 @@
+%include <filters.h>
+#
+# Magic filter setup file for 1200 DPI LaserJet 4050  series with PostScript
+#
+# This file has been automatically adapted to your system.
+#
+/*
+ * Printer resolution
+ */
+%define DPI 1200
+/*
+ * PostScript
+ */
+%define NATIVE_PS 1
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe 	pdf2ps $FILE -
+%endif
+/*
+ * Text
+ */
+%define LATIN1_OK
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default			HANDLE_TEXT
--- magicfilter-1.2.orig/filters/tek4693-filter.x
+++ magicfilter-1.2/filters/tek4693-filter.x
@@ -20,7 +20,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r100 -sDEVICE=t4693d8 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r100 -sDEVICE=t4693d8 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r100 -sDEVICE=t4693d8 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/tek4696-filter.x
+++ magicfilter-1.2/filters/tek4696-filter.x
@@ -20,7 +20,8 @@
  * PostScript
  */
 %ifdef HAVE_GHOSTSCRIPT
-%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120 -sDEVICE=t4696 -sOutputFile=- -
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120 -sDEVICE=t4696 -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r120 -sDEVICE=t4696 -sOutputFile=- $FILE -c quit
 %endif
 /*
  * Text
--- magicfilter-1.2.orig/filters/bj800-filter.x
+++ magicfilter-1.2/filters/bj800-filter.x
@@ -0,0 +1,40 @@
+%include <filters.h>
+#
+# Magic filter setup file for Canon BubbleJet 600
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc800 -dMonochromePrint=true -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc800 -dMonochromePrint=true -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	pipe PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
+
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default                 HANDLE_TEXT
--- magicfilter-1.2.orig/filters/bj800_draft-filter.x
+++ magicfilter-1.2/filters/bj800_draft-filter.x
@@ -0,0 +1,40 @@
+%include <filters.h>
+#
+# Magic filter setup file for Canon BubbleJet 600
+# THIS FILE IS UNTESTED!
+#
+# This file is in the public domain.
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 360
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc800 -sPrintQuality=Draft -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r360 -sDEVICE=bjc800 -sPrintQuality=Draft -sOutputFile=- $FILE -c quit
+%endif
+
+/*
+ * Text
+ */
+%define HANDLE_TEXT	pipe PATH_NENSCRIPT -q -e -E -Z -G -U2 -p - -t "$LPJOB"
+
+/*
+ * Native here to override PCL magic
+ */
+# wild guess: native control codes start with <ESC>
+0       \033            cat
+
+%include <stdconv.mh>
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+default                 HANDLE_TEXT
--- magicfilter-1.2.orig/filters/README-StylusColor
+++ magicfilter-1.2/filters/README-StylusColor
@@ -0,0 +1,120 @@
+This file describes the filters for the EPSON Stylus Color family of printers.
+They are all initially based on `epsonlqc-filter.x'. Most of this is completely
+untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+Stylus Color, so there is no warranty for anything whatsoever!
+
+
+Choosing the right printer model
+--------------------------------
+These days there are a whole lot of EPSON Stylus Color printers out there:
+
+	+----------------------------------------------------+
+	|  Stylus Color   | Filter name(s)                   |
+	+====================================================+
+	|original + 'PRO' | StylusColor@360dpi-filter        | 
+	|                 | StylusColor@720dpi-filter        |
+	+----------------------------------------------------+
+	|      II         | StylusColor-II-IIs@360dpi-filter |
+	|                 | StylusColor-II@720dpi-filter     |
+	+----------------------------------------------------+
+	|      1500       |*StylusColor-II-IIs@360dpi-filter |
+	|                 |*StylusColor-II@720dpi-filter     |
+	+----------------------------------------------------+
+	|      IIs        | StylusColor-II-IIs@360dpi-filter |
+	|                 | StylusColor-IIs@720dpi-filter    |
+	+----------------------------------------------------+
+	|      500        | StylusColor-500@360dpi-filter    |
+	|                 | StylusColor-500@720dpi-filter    |
+	+----------------------------------------------------+
+	|                 | StylusColor-600@360dpi-filter    |
+	|      600        | StylusColor-600@720dpi-filter    |
+	|                 | StylusColor-600@1440dpi-filter   |
+	+----------------------------------------------------+
+	|                 | StylusColor-800@360dpi-filter    |
+	|      800        | StylusColor-800@720dpi-filter    |
+	|                 | StylusColor-800@1440dpi-filter   |
+	+----------------------------------------------------+
+	|                 |*StylusColor-800@360dpi-filter    |
+	|      1520       |*StylusColor-800@720dpi-filter    |
+	|                 | StylusColor-1520@1440dpi-filter  |
+	+----------------------------------------------------+
+
+* Filters marked with a star in front of them may or may not be applicable, so
+  please do not try them out carelessly.  At least - please do not complain
+  too loud about a wrecked printer if you do.
+
+You may wonder if it is worth trying the original model or the 'II' model if
+you have a Stylus Color 400.  The short answer is 'no'.  There is no support
+for hardware that uses proprietary interfaces among developers of free software
+and there would be no interest to support hardware that is as expensive - after
+all - you got a printer that has next to no internal data processing abilities
+but you paid nearly as much as you would have paid for a 'smart' printer who
+does have this important feature.  Enough said.  Buy a real printer.
+
+If you have a Stylus Color Photo series printer you may be aware of the fact
+that it uses more colors.  This does not (yet) seem to be supported by Gunther
+Hess's driver `uniprint' so you are out of luck.  However, you may still hope
+for support to emerge in later versions of `uniprint' since the printers seem
+to support ESC/P2.
+
+If you have some other new model that supports ESC/P2 you may try the simple
+filter `StylusColor-generic-filter'.  It supports color with 360 dpi but
+offers no thrills.  You may at your own risk try to choose an older model that
+has similar capabilities, but please consult your printer documentation and the
+documentation that ships with GhostScript first - especially `Devices.htm' is
+heartily recommended for reading.
+
+Last but not least - `magicfilterconfig' as shipped with Debian let's you
+choose the printer and it is recommended that you install all filters that
+match your printer.  Just give different names to them such as `360', `720'
+and `1440', but always choose the same device, eg. `/dev/lp0'.
+You would then issue the command `lpr -P 1440 Letter.ps' if you wanted to
+print out some important letter on ink jet paper with special coating and
+`lpr -P 360 shopping_list.ps' if you just wanted to get your shopping list
+on some piece of cheap recycling paper.
+
+
+Tweaking GhostScript for fun and profit
+---------------------------------------
+Originally I tried to keep track of ever changing GhostScript driver options.
+If you have the first Stylus Color printer, a Stylus Color Pro, or a
+Stylus Color 500 then you may still prefer the good old `stcolor' driver.
+However, as Gunther Hess <ghess@elmos.de> ditched the thing in favor of his
+`uniprint' driver I use that as well.  Since I expect further option changes
+I also took the chance and did weasel out of the option tweaking business.
+Surely one could just pass any options to GhostScript like before, but I
+consider the `*.upp'-files to be a good thing just because further changes of
+options may not break the filters I cooked.  So - feel free to either tweak
+the filters or tweak your Unified Printer Parameter files, but do not try
+tweaking both at once.
+Support for the Portable Document Format is included, but you will need a
+recent Aladdin GhostScript version in order to actually get this right.
+For the time beeing I would just recommend against it.
+
+
+Tweaking Magicfilter for fun and profit
+---------------------------------------
+There is not much you can do here since it already offers ultimate flexibility.
+However, if you want new conversion rules like some standard character set
+conversion with recode for normal text you definitely should go to the trouble
+and do it properly.  Hard-coded paths are surely out of question - edit the
+file `./configure.in' instead, run autoconf and make conditional use of the
+variables configure spits out.  (Besides - don't forget to update the file
+`./filters/filters2.h.in' by running `./filters/mkfilterhin' - otherwise the
+newly introduced variables simply would not find their way into the build
+environment.)
+
+Character set conversion
+------------------------
+The Debian folks introduced the feature to preprocess regular text with GNU
+recode in order to get extended characters right.  Currently this leads to
+the expectation that you feed Latin-1 (ISO-8859-1) encoded text to a printer
+configured for an IBM code-page 437 (IBM-PC).  You can easily tweak this to
+your little heart's content if you change recode's options at the bottom of
+the filters or in the middle of the source files.
+
+
+Thank you for listening.
+
+/bye
+Dirk
--- magicfilter-1.2.orig/filters/StylusColor-1520@1440dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-1520@1440dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 1520 printer operating
+# at 1440 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 1440	/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc1520.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc1520.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-500@360dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-500@360dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 500 printer operating
+# at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc500p.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc500p.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-500@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-500@720dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 500 printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc500ph.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc500ph.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-600@1440dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-600@1440dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 600 printer operating
+# at 1440 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 1440	/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc600ih.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc600ih.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-600@360dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-600@360dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 600 printer operating
+# at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc600pl.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc600pl.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-600@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-600@720dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 600 printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc600p.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc600p.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/dj690c-best-filter.x
+++ magicfilter-1.2/filters/dj690c-best-filter.x
@@ -0,0 +1,49 @@
+%include <filters.h>
+#
+# Magic filter setup file for HP DeskJet 690 C color printer.
+#
+# Initially based on dj500-filter
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright 2000 Christian Marillat <marillat@alpes-net.fr>
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 300
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=best -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=best -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * PCL, PJL
+ */
+%define HANDLE_PCL	cat
+/*
+ * Text
+ */
+%define HANDLE_TEXT	cat	\eE\e&k2G\e(0N	\eE
+%define LATIN1_OK 1
+
+%include <stdconv.mh>
+
+# wild guess: PCL control codes start with <ESC>
+0	\033		HANDLE_PCL
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+# If you do not have djscript use the other default line or, better, install
+# it. MM
+#
+default			filter 	/usr/bin/djscript -q 
--- magicfilter-1.2.orig/filters/StylusColor-800@1440dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-800@1440dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 800 printer operating
+# at 1440 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 1440	/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc800ih.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc800ih.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-800@360dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-800@360dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 800 printer operating
+# at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc800pl.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc800pl.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-800@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-800@720dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color 800 printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc800p.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc800p.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-II-IIs@360dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-II-IIs@360dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color II and IIs printers
+# operating at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc2.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc2.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-II@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-II@720dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color II printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc2_h.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc2_h.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033		cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-IIs@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor-IIs@720dpi-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for the EPSON Stylus Color IIs printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and completely
+# untested since I (Dirk Ritter <dirk@gnumatic.de>) only have the original
+# Stylus Color.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc2s_h.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc2s_h.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor-generic-filter.x
+++ magicfilter-1.2/filters/StylusColor-generic-filter.x
@@ -0,0 +1,74 @@
+%include <filters.h>
+#
+# Magic filter setup file for generic EPSON printers supporting ESC/P2
+# at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and partially
+# tested together with the original Stylus Color, GhostScript versions 3.33,
+# 4.03 and 5.10 by Dirk Ritter <dirk@gnumatic.de>.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stcany.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stcany.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor@360dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor@360dpi-filter.x
@@ -0,0 +1,83 @@
+%include <filters.h>
+#
+# Magic filter setup file for the original EPSON Stylus Color printer operating
+# at 360 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and partially
+# tested together with the original Stylus Color, GhostScript versions 3.33,
+# 4.03 and 5.10 by Dirk Ritter <dirk@gnumatic.de>.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 360		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 3.33 options, driver 'stcolor' (version < 1.16):
+# -----------------------------------------------------------------------
+# -sDEVICE=stcolor -r360 -q -dSAFER -dNOPAUSE -dSpotSize='{2.6 2.4 2.6 2}' \
+# -sOutputFile=- -
+#
+# GhostScript version >= 3.50 options, driver 'stcolor' (version > 1.16):
+# -----------------------------------------------------------------------
+# -sDEVICE=stcolor -r360 -q -dSAFER -dNOPAUSE -sOutputFile=- stcolor.ps -
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/StylusColor@720dpi-filter.x
+++ magicfilter-1.2/filters/StylusColor@720dpi-filter.x
@@ -0,0 +1,83 @@
+%include <filters.h>
+#
+# Magic filter setup file for the original EPSON Stylus Color printer operating
+# at 720 dpi, late 20th century edition.
+#
+# Initially based on `epsonlqc-filter.x'.  Heavily modified and partially
+# tested together with the original Stylus Color, GhostScript versions 3.33,
+# 4.03 and 5.10 by Dirk Ritter <dirk@gnumatic.de>.
+#
+# There is no warranty for anything whatsoever!
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright © 1999 Dirk Ritter
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you did not have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+%define DPI 720		/* printer resolution */
+%define IS_COLOR 1	/* color capability   */
+/*
+ * PostScript:
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT @stc_h.upp -q -sOutputFile=- - -c quit
+%endif
+/*
+ * Portable Document Format (input needs to be seekable):
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PDF	fpipe	PATH_GHOSTSCRIPT @stc_h.upp -q -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * Text:
+ */
+%ifdef HAVE_RECODE
+%define HANDLE_TEXT	filter	PATH_RECODE --silent latin1:ibmpc
+%endif
+%ifndef HAVE_RECODE
+%define HANDLE_TEXT	text
+%endif
+
+/*
+ * Native control codes are used here to override PCL magic:
+ */
+# Native printer control codes start with <ESC>, so we pass everything that
+# starts with `\033' directly to the printer, cross our fingers and hope for
+# the best:
+0	\033	cat
+
+%ifdef HAVE_GHOSTSCRIPT
+# See `Devices.htm' for a description of the GhostScript options. They are
+# needed and are not documented in the GhostScript manual page since they are
+# specific to the GhostScript device drivers.
+#
+# GhostScript version >= 3.33 options, driver 'stcolor' (version < 1.16):
+# -----------------------------------------------------------------------
+# -sDEVICE=stcolor -r720 -q -dSAFER -dNOPAUSE -dSpotSize='{2.6 2.4 2.6 2}' \
+# -sOutputFile=- -
+#
+# GhostScript version >= 3.50 options, driver 'stcolor' (version > 1.16):
+# -----------------------------------------------------------------------
+# -sDEVICE=stcolor -r720 -q -dSAFER -dNOPAUSE -sOutputFile=- stcolor.ps -
+#
+# GhostScript version >= 5.00 options, driver 'uniprint':
+# -------------------------------------------------------
+# The options currently used should work with GhostScript version >= 5.00
+# if the uniprint driver got included during compilation:
+%endif
+%include <stdconv.mh>
+
+# Default entry for normal (text) files.  This must be the last entry!
+# =====================================================================
+%ifdef HAVE_RECODE
+# Please adjust recode's codepage conversion manually according to your
+# local needs. We apologize for the inconveniences...
+#
+%endif
+default HANDLE_TEXT
--- magicfilter-1.2.orig/filters/dj690c-filter.x
+++ magicfilter-1.2/filters/dj690c-filter.x
@@ -0,0 +1,49 @@
+%include <filters.h>
+#
+# Magic filter setup file for HP DeskJet 690 C color printer.
+#
+# Initially based on dj500-filter
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright 2000 Christian Marillat <marillat@alpes-net.fr>
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 300
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=normal -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=normal -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * PCL, PJL
+ */
+%define HANDLE_PCL	cat
+/*
+ * Text
+ */
+%define HANDLE_TEXT	cat	\eE\e&k2G\e(0N	\eE
+%define LATIN1_OK 1
+
+%include <stdconv.mh>
+
+# wild guess: PCL control codes start with <ESC>
+0	\033		HANDLE_PCL
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+# If you do not have djscript use the other default line or, better, install
+# it. MM
+#
+default			filter 	/usr/bin/djscript -q 
--- magicfilter-1.2.orig/filters/dj690c-low-filter.x
+++ magicfilter-1.2/filters/dj690c-low-filter.x
@@ -0,0 +1,49 @@
+%include <filters.h>
+#
+# Magic filter setup file for HP DeskJet 690 C color printer.
+#
+# Initially based on dj500-filter
+#
+# This file is covered by the GNU General Public License as published by the
+# Free Software Foundation; either version 2, or (at your option) any later
+# version.
+#
+# Copyright 2000 Christian Marillat <marillat@alpes-net.fr>
+#
+# This file has been automatically adapted to your system.
+%ifndef HAVE_GHOSTSCRIPT
+# However, since you didn't have GhostScript installed, most entries
+# are going to be rejects.
+%endif
+#
+/*
+ * Printer resolution
+ */
+%define DPI 300
+/*
+ * PostScript
+ */
+%ifdef HAVE_GHOSTSCRIPT
+%define HANDLE_PS	filter	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=draft -sOutputFile=- - -c quit
+%define HANDLE_PDF	fpipe 	PATH_GHOSTSCRIPT -q -dSAFER -dNOPAUSE -r300 -sDEVICE=hpdj -sModel=unspec -sColourMode=CMYK -sPrintQuality=draft -sOutputFile=- $FILE -c quit
+%endif
+/*
+ * PCL, PJL
+ */
+%define HANDLE_PCL	cat
+/*
+ * Text
+ */
+%define HANDLE_TEXT	cat	\eE\e&k2G\e(0N	\eE
+%define LATIN1_OK 1
+
+%include <stdconv.mh>
+
+# wild guess: PCL control codes start with <ESC>
+0	\033		HANDLE_PCL
+
+# Default entry -- for normal (text) files.  MUST BE LAST.
+# If you do not have djscript use the other default line or, better, install
+# it. MM
+#
+default			filter 	/usr/bin/djscript -q 
--- magicfilter-1.2.orig/magicfilter.c
+++ magicfilter-1.2/magicfilter.c
@@ -8,6 +8,8 @@
  *
  */
 
+/* LPUSERNAME-support copyright 1998 David Frey */
+
 #include "magicfilter.h"
 #include <errno.h>
 #include <stdlib.h>
@@ -20,9 +22,11 @@
 #endif
 #include <sys/fcntl.h>
 #include <sys/types.h>
+#include <sys/stat.h>
 #ifdef HAVE_SYS_WAIT_H
 #include <sys/wait.h>
 #endif
+#include <pwd.h>
 
 char *inblock;			/* Block read */
 int inblock_size;		/* Bytes reserved for the inblock */
@@ -59,10 +63,10 @@
 /* Header of mail message */
 #ifndef NOMAIL
 const char *mailheader =	/* Header of complaint message */
-"To: %s\n\
-Subject: Rejected print job\n\
-
-Your print job was automatically rejected as an invalid data type.\n\n";
+"To: %s\n"
+"Subject: Rejected print job\n"
+"\n"
+"Your print job was automatically rejected as an invalid data type.\n\n";
 #endif
 
 /* ------------------------------------------------------------------------- *
@@ -97,6 +101,7 @@
 
 #endif
 
+#if 0
 #ifdef HAVE_TMPNAM
 /* If we don't have L_tmpnam, we can't use the provided tmpnam */
 #ifndef L_tmpnam
@@ -124,6 +129,9 @@
 }
 #endif
 
+#endif
+
+
 /* ------------------------------------------------------------------------- *
  *  run(command)
  *
@@ -511,16 +519,19 @@
 
 void act_ffilter(char *command)
 {
-  static char tmpbuf[L_tmpnam+6] = "FILE=";
+  static char tmpbuf[] = "FILE=/tmp/mfilter.NNNNNNN.XXXXXX";
   FILE *out;			/* Output file pointer */
   int outfd;			/* Output file descriptor */
   pid_t pid;			/* Child process ID */
   int status;
-
+  int fd;
+  
   if ( debug_flag )
     fprintf(stderr, "ffilter %s\n", command);
 
-  if ( !tmpnam(tmpbuf+5) || !(out = fopen(tmpbuf+5, "wb")) )
+  sprintf(tmpbuf, "FILE=/tmp/mfilter.%d.XXXXXX", (int) getpid());
+  
+  if ( (fd = mkstemp(tmpbuf+5)) == -1 || !(out = fdopen(fd, "wb")) )
     {
       perror(ERR_NAME);
       exit(1);
@@ -574,7 +585,7 @@
   int inpipefd[2];		/* File descriptors for input pipe */
   int outpipefd[2];		/* File descriptors for output pipe */
   FILE *out;			/* Output file pointer */
-  pid_t pid, xpid, wpid;
+  pid_t pid, xpid;
   int null;			/* /dev/null */
   int status;			/* Process exit status */
 
@@ -630,6 +641,8 @@
 	   
 	   /* If status > 0 we should probably do something, but it is
 	      difficult to know what we can do at this stage */
+	   if (status > 0)
+             exit(255);
 	   
 	   exit(0);
 	 }
@@ -671,18 +684,21 @@
 
 void act_fpipe(char *command)
 {
-  static char tmpbuf[L_tmpnam+6] = "FILE=";
+  static char tmpbuf[] = "FILE=/tmp/mfilter.NNNNNNN.XXXXXX";
   int outpipefd[2];		/* File descriptors for output pipe */
   FILE *out;			/* Output file pointer */
   int outfd;			/* Output file descriptor */
-  pid_t pid, xpid, wpid;
+  pid_t pid, xpid;
   int null;			/* /dev/null */
   int status;			/* Exit status */
-
+  int fd;
+  
   if ( debug_flag )
     fprintf(stderr, "fpipe %s\n", command);
 
-  if ( !tmpnam(tmpbuf+5) || !(out = fopen(tmpbuf+5,"w+b")) || pipe(outpipefd) )
+  sprintf(tmpbuf, "FILE=/tmp/mfilter.%d.XXXXXX", (int) getpid());
+  
+  if ((fd = mkstemp(tmpbuf+5)) == -1 || !(out = fdopen(fd, "w+b")) || pipe(outpipefd))
     {
 #if DEBUG > 2
       fprintf(stderr, "TMPBUF: %s\n", tmpbuf);
@@ -835,16 +851,16 @@
  * Analyze the input data and choose an appropriate way to handle it.
  * ------------------------------------------------------------------------- */
 
-main(int argc, char *argv[])
+int main(int argc, char *argv[])
 {
-  int do_cat = 0;		/* True if -c option */
+  int do_cat = 0;			/* True if -c option */
   int i;
-  const struct datatype *dtab;	/* Data type table */
-  const struct datatype *dt;	/* Data type searched */
-  char *user = "unknown";	/* User name */
-  char *host = "unknown";	/* Host name */
+  const struct datatype *dtab=NULL;	/* Data type table */
+  const struct datatype *dt=NULL;	/* Data type searched */
+  char *user = "unknown";		/* User name */
+  char *host = "unknown";		/* Host name */
 
-  program = argv[0];		/* Make available for error messages */
+  program = argv[0];			/* Make available for error messages */
 
   if ( argc < 2 )
     {
@@ -857,6 +873,7 @@
 
 #ifdef HAVE_UNSETENV
   unsetenv("LPUSER");
+  unsetenv("LPUSERNAME");
   unsetenv("LPHOST");
   unsetenv("LPJOB");
   unsetenv("FILE");
@@ -870,6 +887,7 @@
   unsetenv("BANNERNAME");
 #else
   putenv("LPUSER=");
+  putenv("LPUSERNAME=");
   putenv("LPHOST=");
   putenv("LPJOB=");
   putenv("FILE=");
@@ -892,8 +910,29 @@
 	    do_cat = 1;
 	  else if ( strncmp(argv[i],"-n",2) == 0 )
 	    {
+	      struct passwd *pwptr;
+
 	      user = (argv[i][2] || i == argc-1) ? argv[i]+2 : argv[++i];
 	      envset("LPUSER", user);
+
+	      pwptr = getpwnam(user);
+	      if (pwptr != NULL)
+		{
+		  char *realname;
+
+		  /* we have found a GCOS entry, split it up. */
+		  realname = strtok(pwptr->pw_gecos,",[");
+
+		  if (realname != NULL) 
+		    {
+		      size_t l;
+      
+		      l = strlen(realname)-1;
+		      while (realname[l] == ' ') { realname[l] = '\0'; l--; }
+
+		      envset("LPUSERNAME", realname);
+		    }
+		}
 	    }
 	  else if ( strncmp(argv[i],"-h",2) == 0 )
 	    {
--- magicfilter-1.2.orig/TODO
+++ magicfilter-1.2/TODO
@@ -0,0 +1 @@
+- Integration of Dirk Ritter's Stylus color magic filter scripts.
--- magicfilter-1.2.orig/configure
+++ magicfilter-1.2/configure
@@ -1,8 +1,8 @@
 #! /bin/sh
 
 # Guess values for system-dependent variables and create Makefiles.
-# Generated automatically using autoconf version 2.7 
-# Copyright (C) 1992, 1993, 1994 Free Software Foundation, Inc.
+# Generated automatically using autoconf version 2.13 
+# Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.
 #
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
@@ -49,6 +49,9 @@
 # Initialize some other variables.
 subdirs=
 MFLAGS= MAKEFLAGS=
+SHELL=${CONFIG_SHELL-/bin/sh}
+# Maximum number of lines to put in a shell here document.
+ac_max_here_lines=12
 
 ac_prev=
 for ac_option
@@ -330,7 +333,7 @@
     verbose=yes ;;
 
   -version | --version | --versio | --versi | --vers)
-    echo "configure generated by autoconf version 2.7"
+    echo "configure generated by autoconf version 2.13"
     exit 0 ;;
 
   -with-* | --with-*)
@@ -432,11 +435,14 @@
 done
 
 # NLS nuisances.
-# Only set LANG and LC_ALL to C if already set.
-# These must not be set unconditionally because not all systems understand
-# e.g. LANG=C (notably SCO).
-if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
+# Only set these to C if already set.  These must not be set unconditionally
+# because not all systems understand e.g. LANG=C (notably SCO).
+# Fixing LC_MESSAGES prevents Solaris sh from translating var values in `set'!
+# Non-C LC_CTYPE values break the ctype check.
 if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
+if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
+if test "${LC_MESSAGES+set}" = set; then LC_MESSAGES=C; export LC_MESSAGES; fi
+if test "${LC_CTYPE+set}"    = set; then LC_CTYPE=C;    export LC_CTYPE;    fi
 
 # confdefs.h avoids OS command line length limits that DEFS can exceed.
 rm -rf conftest* confdefs.h
@@ -495,13 +501,13 @@
 
 ac_ext=c
 # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
-ac_cpp='echo $CPP $CPPFLAGS 1>&5;
-$CPP $CPPFLAGS'
-ac_compile='echo ${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5;
-${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5 2>&5'
-ac_link='echo ${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5;
-${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5 2>&5'
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
 
+ac_exeext=
+ac_objext=o
 if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
   # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
   if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
@@ -521,14 +527,16 @@
 # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:531: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_prog_CC="gcc"
@@ -536,7 +544,6 @@
     fi
   done
   IFS="$ac_save_ifs"
-  test -z "$ac_cv_prog_CC" && ac_cv_prog_CC="cc"
 fi
 fi
 CC="$ac_cv_prog_CC"
@@ -546,8 +553,141 @@
   echo "$ac_t""no" 1>&6
 fi
 
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:561: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_prog_rejected=no
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
+        ac_prog_rejected=yes
+	continue
+      fi
+      ac_cv_prog_CC="cc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# -gt 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    set dummy "$ac_dir/$ac_word" "$@"
+    shift
+    ac_cv_prog_CC="$@"
+  fi
+fi
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+  if test -z "$CC"; then
+    case "`uname -s`" in
+    *win32* | *WIN32*)
+      # Extract the first word of "cl", so it can be a program name with args.
+set dummy cl; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:612: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_CC="cl"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+ ;;
+    esac
+  fi
+  test -z "$CC" && { echo "configure: error: no acceptable cc found in \$PATH" 1>&2; exit 1; }
+fi
+
+echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
+echo "configure:644: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
+
+cat > conftest.$ac_ext << EOF
+
+#line 655 "configure"
+#include "confdefs.h"
+
+main(){return(0);}
+EOF
+if { (eval echo configure:660: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  ac_cv_prog_cc_works=yes
+  # If we can't run a trivial program, we are probably using a cross compiler.
+  if (./conftest; exit) 2>/dev/null; then
+    ac_cv_prog_cc_cross=no
+  else
+    ac_cv_prog_cc_cross=yes
+  fi
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_cv_prog_cc_works=no
+fi
+rm -fr conftest*
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+cross_compiling=$ac_cv_prog_cc_cross
+
+echo "$ac_t""$ac_cv_prog_cc_works" 1>&6
+if test $ac_cv_prog_cc_works = no; then
+  { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; exit 1; }
+fi
+echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
+echo "configure:686: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
+cross_compiling=$ac_cv_prog_cc_cross
 
 echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
+echo "configure:691: checking whether we are using GNU C" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -556,7 +696,7 @@
   yes;
 #endif
 EOF
-if ${CC-cc} -E conftest.c 2>&5 | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:700: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gcc=yes
 else
   ac_cv_prog_gcc=no
@@ -564,36 +704,50 @@
 fi
 
 echo "$ac_t""$ac_cv_prog_gcc" 1>&6
+
 if test $ac_cv_prog_gcc = yes; then
   GCC=yes
-  if test "${CFLAGS+set}" != set; then
-    echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
-if eval "test \"`echo '$''{'ac_cv_prog_gcc_g'+set}'`\" = set"; then
+else
+  GCC=
+fi
+
+ac_test_CFLAGS="${CFLAGS+set}"
+ac_save_CFLAGS="$CFLAGS"
+CFLAGS=
+echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
+echo "configure:719: checking whether ${CC-cc} accepts -g" >&5
+if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo 'void f(){}' > conftest.c
 if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
-  ac_cv_prog_gcc_g=yes
+  ac_cv_prog_cc_g=yes
 else
-  ac_cv_prog_gcc_g=no
+  ac_cv_prog_cc_g=no
 fi
 rm -f conftest*
 
 fi
 
-echo "$ac_t""$ac_cv_prog_gcc_g" 1>&6
-    if test $ac_cv_prog_gcc_g = yes; then
-      CFLAGS="-g -O"
-    else
-      CFLAGS="-O"
-    fi
+echo "$ac_t""$ac_cv_prog_cc_g" 1>&6
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS="$ac_save_CFLAGS"
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
   fi
 else
-  GCC=
-  test "${CFLAGS+set}" = set || CFLAGS="-g"
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
 fi
 
 echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
+echo "configure:751: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -608,37 +762,62 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 612 "configure"
+#line 766 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:772: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 626 "configure"
+#line 783 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:789: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -nologo -E"
+  cat > conftest.$ac_ext <<EOF
+#line 800 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:806: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   CPP=/lib/cpp
 fi
 rm -f conftest*
 fi
 rm -f conftest*
+fi
+rm -f conftest*
   ac_cv_prog_CPP="$CPP"
 fi
   CPP="$ac_cv_prog_CPP"
@@ -647,23 +826,27 @@
 fi
 echo "$ac_t""$CPP" 1>&6
 
-ac_safe=`echo "minix/config.h" | tr './\055' '___'`
+ac_safe=`echo "minix/config.h" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for minix/config.h""... $ac_c" 1>&6
+echo "configure:832: checking for minix/config.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 657 "configure"
+#line 837 "configure"
 #include "confdefs.h"
 #include <minix/config.h>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:842: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=no"
 fi
@@ -693,8 +876,9 @@
 fi
 
 echo $ac_n "checking for AIX""... $ac_c" 1>&6
+echo "configure:880: checking for AIX" >&5
 cat > conftest.$ac_ext <<EOF
-#line 698 "configure"
+#line 882 "configure"
 #include "confdefs.h"
 #ifdef _AIX
   yes
@@ -716,6 +900,7 @@
 
 
 echo $ac_n "checking for POSIXized ISC""... $ac_c" 1>&6
+echo "configure:904: checking for POSIXized ISC" >&5
 if test -d /etc/conf/kconfig.d &&
   grep _POSIX_VERSION /usr/include/sys/unistd.h >/dev/null 2>&1
 then
@@ -762,27 +947,30 @@
 # SunOS /usr/etc/install
 # IRIX /sbin/install
 # AIX /bin/install
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
 # AFS /usr/afsws/bin/install, which mishandles nonexistent args
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
 # ./install, which can be erroneously created by make from ./install.sh.
 echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
+echo "configure:956: checking for a BSD compatible install" >&5
 if test -z "$INSTALL"; then
 if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
-    IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+    IFS="${IFS= 	}"; ac_save_IFS="$IFS"; IFS=":"
   for ac_dir in $PATH; do
     # Account for people who put trailing slashes in PATH elements.
     case "$ac_dir/" in
     /|./|.//|/etc/*|/usr/sbin/*|/usr/etc/*|/sbin/*|/usr/afsws/bin/*|/usr/ucb/*) ;;
     *)
       # OSF1 and SCO ODT 3.0 have their own names for install.
-      for ac_prog in ginstall installbsd scoinst install; do
+      # Don't use installbsd from OSF since it installs stuff as root
+      # by default.
+      for ac_prog in ginstall scoinst install; do
         if test -f $ac_dir/$ac_prog; then
 	  if test $ac_prog = install &&
             grep dspmsg $ac_dir/$ac_prog >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
-	    # OSF/1 installbsd also uses dspmsg, but is usable.
 	    :
 	  else
 	    ac_cv_path_install="$ac_dir/$ac_prog -c"
@@ -793,7 +981,7 @@
       ;;
     esac
   done
-  IFS="$ac_save_ifs"
+  IFS="$ac_save_IFS"
 
 fi
   if test "${ac_cv_path_install+set}" = set; then
@@ -812,9 +1000,12 @@
 # It thinks the first close brace ends the variable substitution.
 test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
 
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'
+
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
 echo $ac_n "checking whether ln -s works""... $ac_c" 1>&6
+echo "configure:1009: checking whether ln -s works" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_LN_S'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -835,6 +1026,7 @@
 fi
 
 echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
+echo "configure:1030: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -849,37 +1041,62 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 853 "configure"
+#line 1045 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1051: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 867 "configure"
+#line 1062 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1068: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -nologo -E"
+  cat > conftest.$ac_ext <<EOF
+#line 1079 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1085: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   CPP=/lib/cpp
 fi
 rm -f conftest*
 fi
 rm -f conftest*
+fi
+rm -f conftest*
   ac_cv_prog_CPP="$CPP"
 fi
   CPP="$ac_cv_prog_CPP"
@@ -889,11 +1106,62 @@
 echo "$ac_t""$CPP" 1>&6
 
 
+for ac_prog in recode
+do
+# Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1115: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_RECODE'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$RECODE" in
+  /*)
+  ac_cv_path_RECODE="$RECODE" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_RECODE="$RECODE" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_RECODE="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  ;;
+esac
+fi
+RECODE="$ac_cv_path_RECODE"
+if test -n "$RECODE"; then
+  echo "$ac_t""$RECODE" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+test -n "$RECODE" && break
+done
+
+if test -n "$RECODE"; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_RECODE 1
+EOF
+
+  cat >> confdefs.h <<EOF
+#define PATH_RECODE $RECODE
+EOF
+
+fi
 for ac_prog in gs
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1165: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GHOSTSCRIPT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -901,9 +1169,13 @@
   /*)
   ac_cv_path_GHOSTSCRIPT="$GHOSTSCRIPT" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GHOSTSCRIPT="$GHOSTSCRIPT" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GHOSTSCRIPT="$ac_dir/$ac_word"
@@ -939,6 +1211,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1215: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GROG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -946,9 +1219,13 @@
   /*)
   ac_cv_path_GROG="$GROG" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GROG="$GROG" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GROG="$ac_dir/$ac_word"
@@ -984,6 +1261,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1265: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GROFF'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -991,9 +1269,13 @@
   /*)
   ac_cv_path_GROFF="$GROFF" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GROFF="$GROFF" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GROFF="$ac_dir/$ac_word"
@@ -1029,6 +1311,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1315: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_DITROFF'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1036,9 +1319,13 @@
   /*)
   ac_cv_path_DITROFF="$DITROFF" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_DITROFF="$DITROFF" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_DITROFF="$ac_dir/$ac_word"
@@ -1074,6 +1361,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1365: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GROPS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1081,9 +1369,13 @@
   /*)
   ac_cv_path_GROPS="$GROPS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GROPS="$GROPS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GROPS="$ac_dir/$ac_word"
@@ -1119,6 +1411,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1415: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GRODVI'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1126,9 +1419,13 @@
   /*)
   ac_cv_path_GRODVI="$GRODVI" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GRODVI="$GRODVI" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GRODVI="$ac_dir/$ac_word"
@@ -1164,6 +1461,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1465: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GROTTY'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1171,9 +1469,13 @@
   /*)
   ac_cv_path_GROTTY="$GROTTY" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GROTTY="$GROTTY" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GROTTY="$ac_dir/$ac_word"
@@ -1209,6 +1511,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1515: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GROLJ4'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1216,9 +1519,13 @@
   /*)
   ac_cv_path_GROLJ4="$GROLJ4" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GROLJ4="$GROLJ4" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GROLJ4="$ac_dir/$ac_word"
@@ -1249,11 +1556,62 @@
 EOF
 
 fi
+for ac_prog in bzip2 bunzip2 bzcat
+do
+# Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1565: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_BZIP2'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$BZIP2" in
+  /*)
+  ac_cv_path_BZIP2="$BZIP2" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_BZIP2="$BZIP2" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_BZIP2="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  ;;
+esac
+fi
+BZIP2="$ac_cv_path_BZIP2"
+if test -n "$BZIP2"; then
+  echo "$ac_t""$BZIP2" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+test -n "$BZIP2" && break
+done
+
+if test -n "$BZIP2"; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_BZIP2 1
+EOF
+
+  cat >> confdefs.h <<EOF
+#define PATH_BZIP2 $BZIP2
+EOF
+
+fi
 for ac_prog in gzip gunzip gzcat
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1615: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GZIP'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1261,9 +1619,13 @@
   /*)
   ac_cv_path_GZIP="$GZIP" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GZIP="$GZIP" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GZIP="$ac_dir/$ac_word"
@@ -1299,6 +1661,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1665: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_ZCAT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1306,9 +1669,13 @@
   /*)
   ac_cv_path_ZCAT="$ZCAT" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_ZCAT="$ZCAT" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_ZCAT="$ac_dir/$ac_word"
@@ -1344,6 +1711,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1715: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_UNCOMPRESS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1351,9 +1719,13 @@
   /*)
   ac_cv_path_UNCOMPRESS="$UNCOMPRESS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_UNCOMPRESS="$UNCOMPRESS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_UNCOMPRESS="$ac_dir/$ac_word"
@@ -1389,6 +1761,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1765: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_DVIPS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1396,9 +1769,13 @@
   /*)
   ac_cv_path_DVIPS="$DVIPS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_DVIPS="$DVIPS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_DVIPS="$ac_dir/$ac_word"
@@ -1434,6 +1811,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1815: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_PNMTOPS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1441,9 +1819,13 @@
   /*)
   ac_cv_path_PNMTOPS="$PNMTOPS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_PNMTOPS="$PNMTOPS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_PNMTOPS="$ac_dir/$ac_word"
@@ -1474,11 +1856,62 @@
 EOF
 
 fi
+for ac_prog in pngtopnm
+do
+# Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1865: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_PNGTOPNM'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$PNGTOPNM" in
+  /*)
+  ac_cv_path_PNGTOPNM="$PNGTOPNM" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_PNGTOPNM="$PNGTOPNM" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_PNGTOPNM="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  ;;
+esac
+fi
+PNGTOPNM="$ac_cv_path_PNGTOPNM"
+if test -n "$PNGTOPNM"; then
+  echo "$ac_t""$PNGTOPNM" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+test -n "$PNGTOPNM" && break
+done
+
+if test -n "$PNGTOPNM"; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_PNGTOPNM 1
+EOF
+
+  cat >> confdefs.h <<EOF
+#define PATH_PNGTOPNM $PNGTOPNM
+EOF
+
+fi
 for ac_prog in giftopnm giftoppm
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1915: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_GIFTOPPM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1486,9 +1919,13 @@
   /*)
   ac_cv_path_GIFTOPPM="$GIFTOPPM" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_GIFTOPPM="$GIFTOPPM" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_GIFTOPPM="$ac_dir/$ac_word"
@@ -1524,6 +1961,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:1965: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_DJPEG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1531,9 +1969,13 @@
   /*)
   ac_cv_path_DJPEG="$DJPEG" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_DJPEG="$DJPEG" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_DJPEG="$ac_dir/$ac_word"
@@ -1569,6 +2011,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2015: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_SGITOPNM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1576,9 +2019,13 @@
   /*)
   ac_cv_path_SGITOPNM="$SGITOPNM" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_SGITOPNM="$SGITOPNM" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_SGITOPNM="$ac_dir/$ac_word"
@@ -1614,6 +2061,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2065: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_TOPS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1621,9 +2069,13 @@
   /*)
   ac_cv_path_TOPS="$TOPS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_TOPS="$TOPS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_TOPS="$ac_dir/$ac_word"
@@ -1659,6 +2111,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2115: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_SGITOPS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1666,9 +2119,13 @@
   /*)
   ac_cv_path_SGITOPS="$SGITOPS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_SGITOPS="$SGITOPS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_SGITOPS="$ac_dir/$ac_word"
@@ -1699,11 +2156,62 @@
 EOF
 
 fi
+for ac_prog in tiff2ps
+do
+# Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2165: checking for $ac_word" >&5
+if eval "test \"`echo '$''{'ac_cv_path_TIFFTOPS'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  case "$TIFFTOPS" in
+  /*)
+  ac_cv_path_TIFFTOPS="$TIFFTOPS" # Let the user override the test with a path.
+  ;;
+  ?:/*)			 
+  ac_cv_path_TIFFTOPS="$TIFFTOPS" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_path_TIFFTOPS="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  ;;
+esac
+fi
+TIFFTOPS="$ac_cv_path_TIFFTOPS"
+if test -n "$TIFFTOPS"; then
+  echo "$ac_t""$TIFFTOPS" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+test -n "$TIFFTOPS" && break
+done
+
+if test -n "$TIFFTOPS"; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_TIFFTOPS 1
+EOF
+
+  cat >> confdefs.h <<EOF
+#define PATH_TIFFTOPS $TIFFTOPS
+EOF
+
+fi
 for ac_prog in tifftopnm
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2215: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_TIFFTOPNM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1711,9 +2219,13 @@
   /*)
   ac_cv_path_TIFFTOPNM="$TIFFTOPNM" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_TIFFTOPNM="$TIFFTOPNM" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_TIFFTOPNM="$ac_dir/$ac_word"
@@ -1749,6 +2261,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2265: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_BMPTOPPM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1756,9 +2269,13 @@
   /*)
   ac_cv_path_BMPTOPPM="$BMPTOPPM" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_BMPTOPPM="$BMPTOPPM" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_BMPTOPPM="$ac_dir/$ac_word"
@@ -1794,6 +2311,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2315: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_RASTTOPNM'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1801,9 +2319,13 @@
   /*)
   ac_cv_path_RASTTOPNM="$RASTTOPNM" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_RASTTOPNM="$RASTTOPNM" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_RASTTOPNM="$ac_dir/$ac_word"
@@ -1839,6 +2361,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2365: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_NENSCRIPT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1846,9 +2369,13 @@
   /*)
   ac_cv_path_NENSCRIPT="$NENSCRIPT" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_NENSCRIPT="$NENSCRIPT" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_NENSCRIPT="$ac_dir/$ac_word"
@@ -1884,6 +2411,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2415: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_A2X'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1891,9 +2419,13 @@
   /*)
   ac_cv_path_A2X="$A2X" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_A2X="$A2X" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_A2X="$ac_dir/$ac_word"
@@ -1929,6 +2461,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2465: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_A2PS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1936,9 +2469,13 @@
   /*)
   ac_cv_path_A2PS="$A2PS" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_A2PS="$A2PS" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_A2PS="$ac_dir/$ac_word"
@@ -1974,6 +2511,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2515: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_FIG2DEV'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1981,9 +2519,13 @@
   /*)
   ac_cv_path_FIG2DEV="$FIG2DEV" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_FIG2DEV="$FIG2DEV" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_FIG2DEV="$ac_dir/$ac_word"
@@ -2016,6 +2558,7 @@
 fi
 
 echo $ac_n "checking whether zcat is really gzip""... $ac_c" 1>&6
+echo "configure:2562: checking whether zcat is really gzip" >&5
 
 if eval "test \"`echo '$''{'ac_cv_prog_gnu_zcat'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2041,6 +2584,7 @@
 
 
 echo $ac_n "checking whether ditroff works""... $ac_c" 1>&6
+echo "configure:2588: checking whether ditroff works" >&5
 
 if eval "test \"`echo '$''{'ac_cv_prog_ditroff'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -2079,6 +2623,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+echo "configure:2627: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_SENDMAIL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2086,9 +2631,13 @@
   /*)
   ac_cv_path_SENDMAIL="$SENDMAIL" # Let the user override the test with a path.
   ;;
+  ?:/*)			 
+  ac_cv_path_SENDMAIL="$SENDMAIL" # Let the user override the test with a dos path.
+  ;;
   *)
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
-  for ac_dir in $PATH; do
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$PATH"
+  for ac_dir in $ac_dummy; do 
     test -z "$ac_dir" && ac_dir=.
     if test -f $ac_dir/$ac_word; then
       ac_cv_path_SENDMAIL="$ac_dir/$ac_word"
@@ -2123,23 +2672,27 @@
 
 for ac_hdr in memory.h
 do
-ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2678: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2133 "configure"
+#line 2683 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2688: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=no"
 fi
@@ -2147,7 +2700,7 @@
 fi
 if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_hdr 1
 EOF
@@ -2159,23 +2712,27 @@
 
 for ac_hdr in paths.h
 do
-ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2718: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2169 "configure"
+#line 2723 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2728: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=no"
 fi
@@ -2183,7 +2740,7 @@
 fi
 if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_hdr 1
 EOF
@@ -2195,23 +2752,27 @@
 
 for ac_hdr in stdlib.h
 do
-ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2758: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2205 "configure"
+#line 2763 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2768: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=no"
 fi
@@ -2219,7 +2780,7 @@
 fi
 if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_hdr 1
 EOF
@@ -2231,23 +2792,27 @@
 
 for ac_hdr in unistd.h
 do
-ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+echo "configure:2798: checking for $ac_hdr" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2241 "configure"
+#line 2803 "configure"
 #include "confdefs.h"
 #include <$ac_hdr>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2808: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=no"
 fi
@@ -2255,7 +2820,7 @@
 fi
 if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
   echo "$ac_t""yes" 1>&6
-    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`
   cat >> confdefs.h <<EOF
 #define $ac_tr_hdr 1
 EOF
@@ -2266,11 +2831,12 @@
 done
 
 echo $ac_n "checking for sys/wait.h that is POSIX.1 compatible""... $ac_c" 1>&6
+echo "configure:2835: checking for sys/wait.h that is POSIX.1 compatible" >&5
 if eval "test \"`echo '$''{'ac_cv_header_sys_wait_h'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2274 "configure"
+#line 2840 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/wait.h>
@@ -2280,22 +2846,22 @@
 #ifndef WIFEXITED
 #define WIFEXITED(stat_val) (((stat_val) & 255) == 0)
 #endif
-int main() { return 0; }
-int t() {
+int main() {
 int s;
 wait (&s);
 s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
 ; return 0; }
 EOF
-if eval $ac_compile; then
+if { (eval echo configure:2856: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_header_sys_wait_h=yes
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   ac_cv_header_sys_wait_h=no
 fi
 rm -f conftest*
-
 fi
 
 echo "$ac_t""$ac_cv_header_sys_wait_h" 1>&6
@@ -2308,15 +2874,15 @@
 
 
 echo $ac_n "checking for working const""... $ac_c" 1>&6
+echo "configure:2878: checking for working const" >&5
 if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2316 "configure"
+#line 2883 "configure"
 #include "confdefs.h"
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* Ultrix mips cc rejects this.  */
 typedef int charset[2]; const charset x;
@@ -2362,15 +2928,16 @@
 
 ; return 0; }
 EOF
-if eval $ac_compile; then
+if { (eval echo configure:2932: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_const=yes
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   ac_cv_c_const=no
 fi
 rm -f conftest*
-
 fi
 
 echo "$ac_t""$ac_cv_c_const" 1>&6
@@ -2381,51 +2948,29 @@
 
 fi
 
-# If we cannot run a trivial program, we must be cross compiling.
-echo $ac_n "checking whether cross-compiling""... $ac_c" 1>&6
-if eval "test \"`echo '$''{'ac_cv_c_cross'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  if test "$cross_compiling" = yes; then
-  ac_cv_c_cross=yes
-else
-cat > conftest.$ac_ext <<EOF
-#line 2394 "configure"
-#include "confdefs.h"
-main(){return(0);}
-EOF
-eval $ac_link
-if test -s conftest && (./conftest; exit) 2>/dev/null; then
-  ac_cv_c_cross=no
-else
-  ac_cv_c_cross=yes
-fi
-fi
-rm -fr conftest*
-fi
-
-echo "$ac_t""$ac_cv_c_cross" 1>&6
-cross_compiling=$ac_cv_c_cross
-
 echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
+echo "configure:2953: checking for ANSI C header files" >&5
 if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2416 "configure"
+#line 2958 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
 #include <string.h>
 #include <float.h>
 EOF
-eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-ac_err=`grep -v '^ *+' conftest.out`
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:2966: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
   ac_cv_header_stdc=yes
 else
   echo "$ac_err" >&5
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   ac_cv_header_stdc=no
 fi
@@ -2434,7 +2979,7 @@
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 2438 "configure"
+#line 2983 "configure"
 #include "confdefs.h"
 #include <string.h>
 EOF
@@ -2452,7 +2997,7 @@
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
 cat > conftest.$ac_ext <<EOF
-#line 2456 "configure"
+#line 3001 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 EOF
@@ -2472,8 +3017,8 @@
 if test "$cross_compiling" = yes; then
   :
 else
-cat > conftest.$ac_ext <<EOF
-#line 2477 "configure"
+  cat > conftest.$ac_ext <<EOF
+#line 3022 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
@@ -2484,15 +3029,19 @@
 exit (0); }
 
 EOF
-eval $ac_link
-if test -s conftest && (./conftest; exit) 2>/dev/null; then
+if { (eval echo configure:3033: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+then
   :
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -fr conftest*
   ac_cv_header_stdc=no
 fi
-fi
 rm -fr conftest*
 fi
+
+fi
 fi
 
 echo "$ac_t""$ac_cv_header_stdc" 1>&6
@@ -2504,19 +3053,21 @@
 fi
 
 echo $ac_n "checking for pid_t""... $ac_c" 1>&6
+echo "configure:3057: checking for pid_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_pid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2512 "configure"
+#line 3062 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
 #include <stdlib.h>
+#include <stddef.h>
 #endif
 EOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  egrep "pid_t" >/dev/null 2>&1; then
+  egrep "(^|[^a-zA-Z_0-9])pid_t[^a-zA-Z_0-9]" >/dev/null 2>&1; then
   rm -rf conftest*
   ac_cv_type_pid_t=yes
 else
@@ -2537,20 +3088,22 @@
 for ac_func in dup2
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3092: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2545 "configure"
+#line 3097 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
 char $ac_func();
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
@@ -2563,16 +3116,73 @@
 
 ; return 0; }
 EOF
-if eval $ac_link; then
+if { (eval echo configure:3120: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
+fi
 
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_func 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
 fi
+done
+
+for ac_func in mktemp
+do
+echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3147: checking for $ac_func" >&5
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 3152 "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
+char $ac_func();
+
+int main() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
+EOF
+if { (eval echo configure:3175: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
+fi
+rm -f conftest*
+fi
+
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
     ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
@@ -2588,20 +3198,22 @@
 for ac_func in tmpnam
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3202: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2596 "configure"
+#line 3207 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
 char $ac_func();
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
@@ -2614,16 +3226,18 @@
 
 ; return 0; }
 EOF
-if eval $ac_link; then
+if { (eval echo configure:3230: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
-
 fi
+
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
     ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
@@ -2639,20 +3253,22 @@
 for ac_func in waitpid
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3257: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2647 "configure"
+#line 3262 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
 char $ac_func();
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
@@ -2665,16 +3281,18 @@
 
 ; return 0; }
 EOF
-if eval $ac_link; then
+if { (eval echo configure:3285: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
-
 fi
+
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
     ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
@@ -2690,20 +3308,22 @@
 for ac_func in wait4
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3312: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2698 "configure"
+#line 3317 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
 char $ac_func();
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
@@ -2716,16 +3336,18 @@
 
 ; return 0; }
 EOF
-if eval $ac_link; then
+if { (eval echo configure:3340: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
-
 fi
+
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
     ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
@@ -2741,20 +3363,22 @@
 for ac_func in unsetenv
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+echo "configure:3367: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2749 "configure"
+#line 3372 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func(); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
+/* We use char because int might match the return type of a gcc2
+    builtin and then its argument prototype would still apply.  */
 char $ac_func();
 
-int main() { return 0; }
-int t() {
+int main() {
 
 /* The GNU C library defines this for functions which it implements
     to always fail with ENOSYS.  Some functions are actually named
@@ -2767,16 +3391,18 @@
 
 ; return 0; }
 EOF
-if eval $ac_link; then
+if { (eval echo configure:3395: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=no"
 fi
 rm -f conftest*
-
 fi
+
 if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
   echo "$ac_t""yes" 1>&6
     ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`
@@ -2807,11 +3433,25 @@
 # --recheck option to rerun configure.
 #
 EOF
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, don't put newlines in cache variables' values.
 # Ultrix sh set writes to stderr and can't be redirected directly,
 # and sets the high bit in the cache file unless we assign to the vars.
 (set) 2>&1 |
-  sed -n "s/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=\${\1='\2'}/p" \
-  >> confcache
+  case `(ac_space=' '; set | grep ac_space) 2>&1` in
+  *ac_space=\ *)
+    # `set' does not quote correctly, so add quotes (double-quote substitution
+    # turns \\\\ into \\, and sed turns \\ into \).
+    sed -n \
+      -e "s/'/'\\\\''/g" \
+      -e "s/^\\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\\)=\\(.*\\)/\\1=\${\\1='\\2'}/p"
+    ;;
+  *)
+    # `set' quotes correctly as required by POSIX, so do not add quotes.
+    sed -n -e 's/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=${\1=\2}/p'
+    ;;
+  esac >> confcache
 if cmp -s $cache_file confcache; then
   :
 else
@@ -2866,7 +3506,7 @@
     echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
     exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
   -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
-    echo "$CONFIG_STATUS generated by autoconf version 2.7"
+    echo "$CONFIG_STATUS generated by autoconf version 2.13"
     exit 0 ;;
   -help | --help | --hel | --he | --h)
     echo "\$ac_cs_usage"; exit 0 ;;
@@ -2886,9 +3526,11 @@
  s/@@/%@/; s/@@/@%/; s/@g\$/%g/' > conftest.subs <<\\CEOF
 $ac_vpsub
 $extrasub
+s%@SHELL@%$SHELL%g
 s%@CFLAGS@%$CFLAGS%g
 s%@CPPFLAGS@%$CPPFLAGS%g
 s%@CXXFLAGS@%$CXXFLAGS%g
+s%@FFLAGS@%$FFLAGS%g
 s%@DEFS@%$DEFS%g
 s%@LDFLAGS@%$LDFLAGS%g
 s%@LIBS@%$LIBS%g
@@ -2910,8 +3552,10 @@
 s%@CC@%$CC%g
 s%@CPP@%$CPP%g
 s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g
+s%@INSTALL_SCRIPT@%$INSTALL_SCRIPT%g
 s%@INSTALL_DATA@%$INSTALL_DATA%g
 s%@LN_S@%$LN_S%g
+s%@RECODE@%$RECODE%g
 s%@GHOSTSCRIPT@%$GHOSTSCRIPT%g
 s%@GROG@%$GROG%g
 s%@GROFF@%$GROFF%g
@@ -2920,16 +3564,19 @@
 s%@GRODVI@%$GRODVI%g
 s%@GROTTY@%$GROTTY%g
 s%@GROLJ4@%$GROLJ4%g
+s%@BZIP2@%$BZIP2%g
 s%@GZIP@%$GZIP%g
 s%@ZCAT@%$ZCAT%g
 s%@UNCOMPRESS@%$UNCOMPRESS%g
 s%@DVIPS@%$DVIPS%g
 s%@PNMTOPS@%$PNMTOPS%g
+s%@PNGTOPNM@%$PNGTOPNM%g
 s%@GIFTOPPM@%$GIFTOPPM%g
 s%@DJPEG@%$DJPEG%g
 s%@SGITOPNM@%$SGITOPNM%g
 s%@TOPS@%$TOPS%g
 s%@SGITOPS@%$SGITOPS%g
+s%@TIFFTOPS@%$TIFFTOPS%g
 s%@TIFFTOPNM@%$TIFFTOPNM%g
 s%@BMPTOPPM@%$BMPTOPPM%g
 s%@RASTTOPNM@%$RASTTOPNM%g
@@ -2941,20 +3588,56 @@
 
 CEOF
 EOF
+
+cat >> $CONFIG_STATUS <<\EOF
+
+# Split the substitutions into bite-sized pieces for seds with
+# small command number limits, like on Digital OSF/1 and HP-UX.
+ac_max_sed_cmds=90 # Maximum number of lines to put in a sed script.
+ac_file=1 # Number of current file.
+ac_beg=1 # First line for current file.
+ac_end=$ac_max_sed_cmds # Line after last line for current file.
+ac_more_lines=:
+ac_sed_cmds=""
+while $ac_more_lines; do
+  if test $ac_beg -gt 1; then
+    sed "1,${ac_beg}d; ${ac_end}q" conftest.subs > conftest.s$ac_file
+  else
+    sed "${ac_end}q" conftest.subs > conftest.s$ac_file
+  fi
+  if test ! -s conftest.s$ac_file; then
+    ac_more_lines=false
+    rm -f conftest.s$ac_file
+  else
+    if test -z "$ac_sed_cmds"; then
+      ac_sed_cmds="sed -f conftest.s$ac_file"
+    else
+      ac_sed_cmds="$ac_sed_cmds | sed -f conftest.s$ac_file"
+    fi
+    ac_file=`expr $ac_file + 1`
+    ac_beg=$ac_end
+    ac_end=`expr $ac_end + $ac_max_sed_cmds`
+  fi
+done
+if test -z "$ac_sed_cmds"; then
+  ac_sed_cmds=cat
+fi
+EOF
+
 cat >> $CONFIG_STATUS <<EOF
 
 CONFIG_FILES=\${CONFIG_FILES-"Makefile filters/Makefile"}
 EOF
 cat >> $CONFIG_STATUS <<\EOF
 for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
-  # Support "outfile[:infile]", defaulting infile="outfile.in".
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
   case "$ac_file" in
-  *:*) ac_file_in=`echo "$ac_file"|sed 's%.*:%%'`
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
        ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
   *) ac_file_in="${ac_file}.in" ;;
   esac
 
-  # Adjust relative srcdir, etc. for subdirectories.
+  # Adjust a relative srcdir, top_srcdir, and INSTALL for subdirectories.
 
   # Remove last slash and all that follows it.  Not all systems have dirname.
   ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
@@ -2982,6 +3665,7 @@
   [/$]*) INSTALL="$ac_given_INSTALL" ;;
   *) INSTALL="$ac_dots$ac_given_INSTALL" ;;
   esac
+
   echo creating "$ac_file"
   rm -f "$ac_file"
   configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
@@ -2990,14 +3674,16 @@
 # $configure_input" ;;
   *) ac_comsub= ;;
   esac
+
+  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
   sed -e "$ac_comsub
 s%@configure_input@%$configure_input%g
 s%@srcdir@%$srcdir%g
 s%@top_srcdir@%$top_srcdir%g
 s%@INSTALL@%$INSTALL%g
-" -f conftest.subs $ac_given_srcdir/$ac_file_in > $ac_file
+" $ac_file_inputs | (eval "$ac_sed_cmds") > $ac_file
 fi; done
-rm -f conftest.subs
+rm -f conftest.s*
 
 # These sed commands are passed to sed as "A NAME B NAME C VALUE D", where
 # NAME is the cpp macro being defined and VALUE is the value it is being given.
@@ -3018,11 +3704,17 @@
 ac_eC=' '
 ac_eD='%g'
 
-CONFIG_HEADERS=${CONFIG_HEADERS-"config.h filters/filters.h filters/filters2.h"}
+if test "${CONFIG_HEADERS+set}" != set; then
+EOF
+cat >> $CONFIG_STATUS <<EOF
+  CONFIG_HEADERS="config.h filters/filters.h filters/filters2.h"
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+fi
 for ac_file in .. $CONFIG_HEADERS; do if test "x$ac_file" != x..; then
-  # Support "outfile[:infile]", defaulting infile="outfile.in".
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
   case "$ac_file" in
-  *:*) ac_file_in=`echo "$ac_file"|sed 's%.*:%%'`
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
        ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
   *) ac_file_in="${ac_file}.in" ;;
   esac
@@ -3030,7 +3722,8 @@
   echo creating $ac_file
 
   rm -f conftest.frag conftest.in conftest.out
-  cp $ac_given_srcdir/$ac_file_in conftest.in
+  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
+  cat $ac_file_inputs > conftest.in
 
 EOF
 
@@ -3042,7 +3735,7 @@
 cat > conftest.hdr <<\EOF
 s/[\\&%]/\\&/g
 s%[\\$`]%\\&%g
-s%#define \([A-Za-z_][A-Za-z0-9_]*\) \(.*\)%${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD}%gp
+s%#define \([A-Za-z_][A-Za-z0-9_]*\) *\(.*\)%${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD}%gp
 s%ac_d%ac_u%gp
 s%ac_u%ac_e%gp
 EOF
@@ -3058,8 +3751,6 @@
 
 # Break up conftest.vals because some shells have a limit on
 # the size of here documents, and old seds have small limits too.
-# Maximum number of lines to put in a single here document.
-ac_max_here_lines=12
 
 rm -f conftest.tail
 while :
@@ -3090,12 +3781,22 @@
     echo "$ac_file is unchanged"
     rm -f conftest.h
   else
+    # Remove last slash and all that follows it.  Not all systems have dirname.
+      ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
+      if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
+      # The file is in a subdirectory.
+      test ! -d "$ac_dir" && mkdir "$ac_dir"
+    fi
     rm -f $ac_file
     mv conftest.h $ac_file
   fi
 fi; done
 
+EOF
+cat >> $CONFIG_STATUS <<EOF
 
+EOF
+cat >> $CONFIG_STATUS <<\EOF
 
 exit 0
 EOF
--- magicfilter-1.2.orig/configure.in
+++ magicfilter-1.2/configure.in
@@ -15,6 +15,7 @@
 AC_PROG_CPP
 
 dnl Check for programs used in filters
+AC_PATH_INCLUDE(RECODE, recode)
 AC_PATH_INCLUDE(GHOSTSCRIPT, gs)
 AC_PATH_INCLUDE(GROG, grog)
 AC_PATH_INCLUDE(GROFF, groff)
@@ -23,16 +24,19 @@
 AC_PATH_INCLUDE(GRODVI, grodvi)
 AC_PATH_INCLUDE(GROTTY, grotty)
 AC_PATH_INCLUDE(GROLJ4, grolj4)
+AC_PATH_INCLUDE(BZIP2, bzip2 bunzip2 bzcat)
 AC_PATH_INCLUDE(GZIP, gzip gunzip gzcat)
 AC_PATH_INCLUDE(ZCAT, zcat)
 AC_PATH_INCLUDE(UNCOMPRESS, uncompress)
 AC_PATH_INCLUDE(DVIPS, dvips)
 AC_PATH_INCLUDE(PNMTOPS, pnmtops)
+AC_PATH_INCLUDE(PNGTOPNM, pngtopnm)
 AC_PATH_INCLUDE(GIFTOPPM, giftopnm giftoppm)
 AC_PATH_INCLUDE(DJPEG, djpeg)
 AC_PATH_INCLUDE(SGITOPNM, sgitopnm)
 AC_PATH_INCLUDE(TOPS, tops)
 AC_PATH_INCLUDE(SGITOPS, sgitops)
+AC_PATH_INCLUDE(TIFFTOPS, tiff2ps)
 AC_PATH_INCLUDE(TIFFTOPNM, tifftopnm)
 AC_PATH_INCLUDE(BMPTOPPM, bmptopnm bmptoppm)
 AC_PATH_INCLUDE(RASTTOPNM, rasttopnm)
@@ -64,6 +68,7 @@
 AC_C_CONST
 AC_TYPE_PID_T
 AC_CHECK_FUNCS(dup2)
+AC_CHECK_FUNCS(mktemp)
 AC_CHECK_FUNCS(tmpnam)
 AC_CHECK_FUNCS(waitpid)
 AC_CHECK_FUNCS(wait4)
--- magicfilter-1.2.orig/loadconfig.c
+++ magicfilter-1.2/loadconfig.c
@@ -106,7 +106,6 @@
   struct datatype *new;
   char *line, *p;
   int lineno = 0;
-  int max_line = 0;
   int bytes_needed = 0;
   int offset;
   int i;
--- magicfilter-1.2.orig/magicfilter.man.in
+++ magicfilter-1.2/magicfilter.man.in
@@ -47,6 +47,8 @@
 The login name of the user who submitted the job.  Available to
 subfilters as
 .BR $LPUSER .
+If the user has an associated GECOS entry it will be available as
+.BR $LPUSERNAME .
 .TP
 .I "\-hhost, \-h host"
 The host on which the job was submitted.  Available to subfilters as
--- magicfilter-1.2.orig/magicfilterconfig
+++ magicfilter-1.2/magicfilterconfig
@@ -0,0 +1,298 @@
+#!/usr/bin/perl -w
+
+use strict; 
+no strict "vars";
+
+my $printcap="/etc/printcap";
+my $filterdir="/etc/magicfilter";
+my $force=0;
+my $m=0;
+
+if ($#ARGV >= 0) { 
+  $force=($ARGV[0] eq "--force"); if ($force) { $m++; }
+}
+
+if ($m <= $#ARGV) { $printcap=$ARGV[$m]; }
+
+sub input
+{
+  my($message)=$_[0];
+  my($defanswer)=$_[1];
+  my($reply);
+
+  printf "%-45s [%-15s]: ",$message,$defanswer; 
+  $reply=<STDIN>; chop($reply); if ($reply eq "") { $reply=$defanswer; }
+ 
+  return $reply;
+}
+
+sub yninput
+{
+  my($message)=$_[0];
+  my($defanswer)=$_[1];
+  my($reply);
+
+  printf "%s? (y/n) [%s]: ",$message,$defanswer; 
+  $reply=<STDIN>; chop($reply); if ($reply eq "") { $reply=$defanswer; }
+ 
+  return $reply;
+}
+
+sub readfilters
+{
+  my($i);
+
+  if ( ! -e $filterdir ) {
+  print<<EOT;
+
+The magicfilter package is wrongly installed; can\'t find $filterdir.
+
+EOT
+
+    die "'$filterdir' missing, stopped";
+  }
+  
+  open(FILTERS, "ls $filterdir/*-filter|sort|") || die "Can't find $filters.";
+  $i=0;
+  while (<FILTERS>) {
+    chop;
+    s/$filterdir\/(.*)-filter/$1/g;
+    $filters[$i]=$_; $i++;
+  }
+  close(FILTERS);
+
+  foreach $entry (@filters) { $entry =~ s/-filter//g; }
+  return sort(@filters);
+}
+
+if ( -e $printcap && !$force) {
+  print<<EOT;
+
+You already have an $printcap file installed.
+I assume that it is already correctly configured and won\'t overwrite it.
+(if $printcap is not correctly configured, delete the file and re-run 
+ $0 or run '$0 --force').
+
+EOT
+  exit 0;
+} 
+
+@filters=&readfilters;
+
+$ok="no"; $m=-1; $d=0;
+while ($ok !~ /y(es)?/) {
+  print<<EOT;
+  
+You will have to supply the following items for each printer to be installed
+(example values in parentheses):
+
+ - its short name and its full name            (hpjlet4, HP LaserJet 4)
+ - the device where the printer is attached    (/dev/lp1)
+ - and the input filter you want to use        (ljet4l)
+
+EOT
+
+  $p=-1;
+  do
+  {
+    $p++; $m++; $full[$m+1]='done';
+
+    if ($p == 0) { $full[$p]='HP Laserjet 4L'; } 
+    else         { $full[$p]='done'; }
+
+    $short[$p]='hplj4l';
+    $dev[$p]=sprintf("/dev/lp%d",$p+1); $ifilter[$p]='ljet4l';
+    $remflags[$p]=""; $serflags[$p]="";
+
+    printf "Printer #%d:\n", $p+1;
+    printf "------------\n";
+
+       $full[$p]=&input("Full name, `done' when done", $full[$p]);
+ 
+    if ($full[$p] !~ /done\s*/) { 
+      $short[$p]=&input("Short name, name of the spool directory",$short[$p]);
+      $dev[$p]  =&input("Full device path (or remote machine name)",
+			$dev[$p]);
+
+      if ($#filters == 0) {
+        print "There aren't any filters."; $full[$p]='done';
+      } else {
+	print<<EOT;
+
+The following filters are available in /etc/magicfilter.
+
+You can read the comments at the top of each file to help decide which
+filter would best suit your needs.
+
+The filters concentrate on the printer language. If you know, that your
+printer uses a given printer language (e.g. ESC/P2 or PCL5) and your
+printer is not listed below, you can use another filter which uses same
+language.
+
+Read the file `devices.txt.gz' from the GhostScript package and have your
+printer manual handy if you want to change a filter.
+
+EOT
+	$l=0;
+	foreach $filter (@filters) {
+	  $l += (length($filter)+1);
+	  if ($l > 72-length($filter)) { print "\n"; $l=0; }
+	  print "$filter ";
+	}
+        print "\n\n";
+
+        $ifilter[$p]=&input("The input filter to be used", $ifilter[$p]);
+
+        if ($dev[$p] !~ /\/dev\//) { 
+	  $remflags[$p]=":rm=$dev[$p]:rp=$short[$p]:lpr_bounce"; $dev[$p]="";
+	} elsif ($dev[$p] =~ /\/dev\/ttyS/) { 
+	  $serflags[$p]=":bf=2400:fc=0:fs=1";
+	}
+
+        $spooldir[$p]="/var/spool/lpd/$short[$p]";
+
+        print "\n";
+      }
+    }
+  }
+  while ($full[$p] !~ /done\s*/);
+
+  if ($p > 0) {
+    if ($p == 1) { $d=0; }
+    do {
+      format top=
+
+                       Printer configuration
+
+Default printer (alias \`lp\') is marked with an asterisk.
+
+Printer name  Short name Spool dir            Device     Input filter
+-------------------------------------------------------------------------------
+.
+
+    format STDOUT=
+@<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<<<<<<<<@<<
+$full,        $short,    $spooldir,           $dev,      $ifilter,          $a
+.
+
+      for($i=0;$i<$p;$i++) {
+        $full=$full[$i]; $short=$short[$i];
+        $spooldir=$spooldir[$i]; $dev=$dev[$i]; $ifilter=$ifilter[$i];
+	$a= ($remflags[$i] ne "") ? "R" : "";
+        $a= $a . (($i == $d) ? "*" : "");
+
+        write;
+      }
+      $ans="n"; $-=0;
+
+      print "\n";
+      if ($p > 1) {
+        $ans=&yninput("Do you want to change the default printer","n");
+        if ($ans =~ /y(es)?/) {
+          $def=&input("New default printer (type its short name)","");
+          $d=0;
+          while (($d < $p) && ($short[$d] !~ /$def/)) { $d++; }
+          if ($d == $p) { $d = 0; }
+	  $short[$d]=$def;
+        }
+      }
+    }
+    while ($ans =~ /y(es)?/);
+    $ok=&yninput("Is this ok","y");
+  } else {
+    $ok="yes";
+  } 
+}
+
+print "\n";
+if ($p > 0) {
+  if ( -x "/usr/bin/paperconf" ) {
+    open(PAPERSIZE, "/usr/bin/paperconf -N|");
+    $papersize=<PAPERSIZE>; chop($papersize);
+    close(PAPERSIZE);
+  }
+
+  $pagelength=66;
+  if ($papersize =~ /A4/) { $pagelength=72; }
+  print "Paper size is $papersize, page length is $pagelength lines.\n";
+
+  # Stop running daemons:
+  if ($> == 0) {
+    if ( -x "/etc/init.d/lpd" )   { system("/etc/init.d/lpd stop");  }
+    if ( -x "/etc/init.d/lprng" ) { system("/etc/init.d/lprng stop"); }
+  }
+
+  open(PRINTCAP,">$printcap") || die "Can't write $printcap: $!";
+  print PRINTCAP <<EOH;
+#
+# Copyright (c) 1983 Regents of the University of California.
+# All rights reserved.
+#
+# Redistribution and use in source and binary forms are permitted
+# provided that this notice is preserved and that due credit is given
+# to the University of California at Berkeley. The name of the University
+# may not be used to endorse or promote products derived from this
+# software without specific prior written permission. This software
+# is provided ``as is'' without express or implied warranty.
+#
+#	@(#)etc.printcap	5.2 (Berkeley) 5/5/88
+#
+# This file was generated by $0.
+#
+EOH
+
+    $short[$d]="lp|" . $short[$d];
+  for($i=0;$i<$p;$i++) {
+    print PRINTCAP <<"EOE";
+$short[$i]|$full[$i]:\\
+\t:lp=$dev[$i]:sd=$spooldir[$i]$remflags[$i]$serflags[$i]:\\
+\t:sh:pw\#80:pl\#${pagelength}:px\#1440:mx\#0:\\
+\t:if=$filterdir/$ifilter[$i]-filter:\\
+\t:af=/var/log/lp-acct:lf=/var/log/lp-errs:
+EOE
+  }
+  close(PRINTCAP);
+
+  for($i=0;$i<$p;$i++) {
+    $lpgrp=(getpwnam("lp"))[2];
+    if ( ! -e $spooldir[$i] ) {
+        umask 002; mkdir($spooldir[$i],02775); chown(0,$lpgrp,$spooldir[$i]);
+    }
+  }
+
+  print<<EOT;
+$printcap generated.
+
+You\'ll probably want to finetune your newly created $printcap file.
+Read the printcap(5), lpr(1), lpq(1), lprm(1) and lpc(1) manual pages
+and the PRINTING-HOWTO before doing this.
+
+EOT
+    if (grep(/Stylus/, @ifilter)) {
+      print<<EOT;
+The file README-StylusColor explains the fine points about the Epson
+Stylii Color family of printers.
+
+EOT
+    }
+    if ($> == 0) {
+      if ( -x "/etc/init.d/lpd"   ) { system("/etc/init.d/lpd start"); }
+      if ( -x "/etc/init.d/lprng" ) { system("/etc/init.d/lprng start"); }
+    }
+} else {
+  print<<EOT;
+
+Nothing to install.
+You\'re going to write your $printcap file yourself.
+
+EOT
+}
+
+my $display=$ENV{"DISPLAY"} || "";
+
+if ( $display ne "" ) {
+  $dummy="";
+  print "Press <ENTER> to continue."; $dummy=<STDIN>;
+}
+
+exit 0;
--- magicfilter-1.2.orig/magicfilterconfig.8
+++ magicfilter-1.2/magicfilterconfig.8
@@ -0,0 +1,33 @@
+.\" Taken from deb-make and expanded with Winfried Truemper's ideas.
+.\" David Frey <David.Frey@eos.lugs.ch>, July 1997
+.\"
+.TH MAGICFILTERCONFIG 8 "September 1997" "Debian" \" -*- nroff -*-
+.SH NAME
+magicfilterconfig \- writes interactively a printcap file.
+.SH SYNOPSIS
+.B magicfilterconfig
+.I "[--force]"
+.I " [printcap]"
+.SH DESCRIPTION
+.B magicfilterconfig
+interactively writes a printcap file; either the one given as argument or 
+.I /etc/printcap
+otherwise.
+.PP
+.B magicfilterconfig
+does not overwrite an existing printcap file, unless the
+.I --force
+switch was given (it assumes that the existing file was handcrafted
+and is therefore correct).
+.SH OPTIONS
+.TP
+.B \-\-force
+overwrite an existing /etc/printcap.
+.SH FILES
+/etc/printcap, /etc/papersize
+.SH "SEE ALSO"
+.BR printcap "(5), " lpd "(8), " lpc "(8), " 
+.IR "Printing-HOWTO" .
+.SH AUTHOR
+This manual page was written by David Frey <dFrey@debian.org>,
+for the Debian GNU/Linux system.
--- magicfilter-1.2.orig/parseconfig.c
+++ magicfilter-1.2/parseconfig.c
@@ -146,6 +146,8 @@
 	    {
 	      state = st_done;
 	    }
+	case st_done:
+	  break;
 	}
     }
 
@@ -177,7 +179,7 @@
 {
   int count = 0;		/* Count of bytes */
   int quote = 0;		/* Quoted? */
-  int ch;
+  int ch='\0';
   int wildcards = 1;		/* Wildcards allowed by default */
   enum { st_def, st_backsl, st_oct, st_hex, st_done } state = st_def;
 
@@ -346,6 +348,8 @@
 	      count++;
 	      state = st_def;	/* Do not advance p */
 	    }
+	  break;
+	case st_done:
 	  break;
 	}
     }
