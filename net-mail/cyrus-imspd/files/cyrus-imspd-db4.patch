diff -urN cyrus-sasl-2.1.14/cmulocal/berkdb.m4 cyrus-sasl-2.1.14-modified/cmulocal/berkdb.m4
--- cyrus-sasl-2.1.14/cmulocal/berkdb.m4	2003-04-15 17:25:41.000000000 -0500
+++ cyrus-sasl-2.1.14-modified/cmulocal/berkdb.m4	2003-07-09 03:17:48.000000000 -0500
@@ -211,12 +211,20 @@
 	    BDB_LIBADD=""
 	fi
 
-        for dbname in db-4.1 db4.1 db41 db-4.0 db4.0 db-4 db40 db4 db-3.3 db3.3 db33 db-3.2 db3.2 db32 db-3.1 db3.1 db31 db-3 db30 db3 db
+        for dbname in db-4.1 db4.1 db41 db-4.0 db4.0 db-4 db40 db4 db
           do
-            AC_CHECK_LIB($dbname, db_create, BDB_LIBADD="$BDB_LIBADD -l$dbname";
-              dblib="berkeley"; break, dblib="no")
+            AC_CHECK_LIB($dbname, db_create_4000, BDB_LIBADD="$BDB_LIBADD -l$dbname";
+              dblib="berkeley"; break, AC_CHECK_LIB($dbname, db_create_4001, BDB_LIBADD="$BDB_LIBADD -l$dbname";
+               dblib="berkeley"; break, dblib="no"))
           done
         if test "$dblib" = "no"; then
+          for dbname in db-4.1 db4.1 db41 db-4.0 db4.0 db-4 db40 db4 db-3.3 db3.3 db-3.2 db3.2 db-3.1 db3.1 db-3 db3 db
+            do
+              AC_CHECK_LIB($dbname, db_create, BDB_LIBADD="$BDB_LIBADD -l$dbname";
+                dblib="berkeley"; break, dblib="no")
+            done
+       fi
+        if test "$dblib" = "no"; then
           AC_CHECK_LIB(db, db_open, BDB_LIBADD="$BDB_LIBADD -ldb";
             dblib="berkeley"; dbname=db,
             dblib="no")
diff -urN cyrus-sasl-2.1.14/cmulocal/sasl2.m4 cyrus-sasl-2.1.14-modified/cmulocal/sasl2.m4
--- cyrus-sasl-2.1.14/cmulocal/sasl2.m4	2003-05-14 13:36:41.000000000 -0500
+++ cyrus-sasl-2.1.14-modified/cmulocal/sasl2.m4	2003-07-09 03:18:31.000000000 -0500
@@ -25,8 +25,9 @@
   dnl
   dnl The choice is reflected in GSSAPIBASE_LIBS
   dnl we might need libdb
-  AC_CHECK_LIB(db, db_open)
-
+  AC_CHECK_LIB(db, db_open,,
+       AC_CHECK_LIB(db, db_open_4001,,
+       AC_CHECK_LIB(db, db_open_4000)))
   gss_impl="no";
   AC_CHECK_LIB(resolv,res_search)
   if test -d ${gssapi}; then 
--- cyrus-sasl-2.1.14/configure.in	2003-04-15 17:25:41.000000000 -0500
+++ cyrus-sasl-2.1.14-modified/configure.in	2003-07-09 03:17:48.000000000 -0500
@@ -55,28 +55,34 @@
 CPPFLAGS="-I/usr/local/include ${CPPFLAGS}"
 CMU_ADD_LIBPATH("/usr/local/lib")
 
-dnl
-dnl  Get ready to use DB
-dnl
+dnl Berkeley DB Detection
+
+dnl support old-style
+AC_ARG_WITH(dbdir,
+        [  --with-dbdir=DIR        Berkeley DB files are in prefix DIR],
+        with_bdb_lib="$withval/lib"; with_bdb_inc="$withval/include",
+        with_bdb_lib=none; with_bdb_inc=none)
+
+CYRUS_BERKELEY_DB_CHK()
+
+if test "$dblib" = "no"; then
+  AC_ERROR([this version requires Berkeley DB 3.x or later.
+(Get it from http://www.sleepycat.com/).  You may need to suppply the
+--with-bdb-libdir or --with-bdb-incdir configure options.])
+fi
 
-AC_CHECK_FUNC(dbopen, [AC_DEFINE(HAVE_LIBDB)
-                       use_db=1], 
-  AC_CHECK_LIB(db,dbopen,[AC_DEFINE(HAVE_LIBDB)
-                          LIBS=" -ldb ${LIBS}"
-                          use_db=1]))
-dnl if db_185.h is present, we're using db2 or 3 and should include db_185.h
-dnl instead of db.h; otherwise, include db.h.  this is handled in the code
-dnl itself.
-AC_CHECK_HEADER(db_185.h, [AC_DEFINE(HAVE_DB_185_H)
-                           AC_DEFINE(HAVE_LIBDB)
-                           LIBS="-ldb ${LIBS}"
-                           use_db=1])
-
-if test -z "use_db"; then
-  AC_CHECK_LIB(ndbm, dbm_open)
-  AC_CHECK_LIB(dbm, dbm_open)
+if test "$with_bdb_lib" != "none"; then
+  CMU_ADD_LIBPATH($with_bdb_lib)
 fi
 
+BDB_INC=${BDB_INCADD}
+BDB_LIB=${BDB_LIBADD}
+AC_SUBST(BDB_INC)
+AC_SUBST(BDB_LIB)
+
+LIBS="${LIBS} ${BDB_LIBADD}"
+CPPFLAGS="${BDB_INCADD} ${CPPFLAGS}"
+
 dnl
 dnl  Random other libraries
 dnl
