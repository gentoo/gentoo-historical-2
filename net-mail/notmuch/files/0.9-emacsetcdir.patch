From 38375cefb708081eab7e7c928dcb85a1d68da6f1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Amadeusz=20=C5=BBo=C5=82nowski?= <aidecoe@aidecoe.name>
Date: Mon, 24 Oct 2011 20:26:27 +0200
Subject: [PATCH] Separate Emacs miscellaneous files directory from Emacs code
 directory.

--emacsetcdir was added, but it's set default to the same value as
--emacslispdir for backward compatibility.
---
 configure            |   14 ++++++++++++++
 emacs/Makefile.local |    3 ++-
 2 files changed, 16 insertions(+), 1 deletions(-)

diff --git a/configure b/configure
index 3999ce8..37c0283 100755
--- a/configure
+++ b/configure
@@ -97,6 +97,7 @@ Fine tuning of some installation directories is available:
 	--mandir=DIR		Install man pages to DIR [PREFIX/share/man]
 	--sysconfdir=DIR	Read-only single-machine data [PREFIX/etc]
 	--emacslispdir=DIR	Emacs code [PREFIX/share/emacs/site-lisp]
+	--emacsetcdir=DIR	Emacs miscellaneous files [PREFIX/share/emacs/site-lisp]
 	--bashcompletiondir=DIR Bash completions files [SYSCONFDIR/bash_completion.d]
 	--zshcompletiondir=DIR	Zsh completions files [PREFIX/share/zsh/functions/Completion/Unix]
 
@@ -139,6 +140,8 @@ for option; do
 	SYSCONFDIR="${option#*=}"
     elif [ "${option%%=*}" = '--emacslispdir' ] ; then
 	EMACSLISPDIR="${option#*=}"
+    elif [ "${option%%=*}" = '--emacsetcdir' ] ; then
+	EMACSETCDIR="${option#*=}"
     elif [ "${option%%=*}" = '--bashcompletiondir' ] ; then
 	BASHCOMPLETIONDIR="${option#*=}"
     elif [ "${option%%=*}" = '--zshcompletiondir' ] ; then
@@ -330,6 +333,14 @@ if [ -z "${EMACSLISPDIR}" ]; then
     fi
 fi
 
+if [ -z "${EMACSETCDIR}" ]; then
+    if pkg-config --exists emacs; then
+	EMACSETCDIR=$(pkg-config emacs --variable sitepkglispdir)
+    else
+	EMACSETCDIR='$(prefix)/share/emacs/site-lisp'
+    fi
+fi
+
 printf "Checking if emacs is available... "
 if emacs --quick --batch > /dev/null 2>&1; then
     printf "Yes.\n"
@@ -614,6 +625,9 @@ sysconfdir = ${SYSCONFDIR:=\$(prefix)/etc}
 # The directory to which emacs lisp files should be installed
 emacslispdir=${EMACSLISPDIR}
 
+# The directory to which emacs lisp files should be installed
+emacsetcdir=${EMACSETCDIR}
+
 # Whether there's an emacs binary available for byte-compiling
 HAVE_EMACS = ${have_emacs}
 
diff --git a/emacs/Makefile.local b/emacs/Makefile.local
index ce0c3f0..0c58b82 100644
--- a/emacs/Makefile.local
+++ b/emacs/Makefile.local
@@ -38,6 +38,7 @@ install-emacs:
 ifeq ($(HAVE_EMACS),1)
 	install -m0644 $(emacs_bytecode) "$(DESTDIR)$(emacslispdir)"
 endif
-	install -m0644 $(emacs_images) "$(DESTDIR)$(emacslispdir)"
+	mkdir -p "$(DESTDIR)$(emacsetcdir)"
+	install -m0644 $(emacs_images) "$(DESTDIR)$(emacsetcdir)"
 
 CLEAN := $(CLEAN) $(emacs_bytecode)
-- 
1.7.7.1

