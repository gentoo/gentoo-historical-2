diff -urN libselinux-1.0.orig/Makefile libselinux-1.0/Makefile
--- libselinux-1.0.orig/Makefile	2003-06-09 14:22:55.000000000 -0500
+++ libselinux-1.0/Makefile	2003-08-03 20:01:16.000000000 -0500
@@ -1,6 +1,6 @@
 all: 
-	$(MAKE) -C src 
-	$(MAKE) -C utils
+	$(MAKE) -C src EXTRA_CFLAGS="$(EXTRA_CFLAGS)"
+	$(MAKE) -C utils EXTRA_CFLAGS="$(EXTRA_CFLAGS)"
 
 install: 
 	$(MAKE) -C include install
diff -urN libselinux-1.0.orig/src/Makefile libselinux-1.0/src/Makefile
--- libselinux-1.0.orig/src/Makefile	2003-07-07 07:53:40.000000000 -0500
+++ libselinux-1.0/src/Makefile	2003-08-03 20:01:35.000000000 -0500
@@ -9,7 +9,7 @@
 TARGET=libselinux.so
 LIBSO=$(TARGET).$(LIBVERSION)
 OBJS= $(patsubst %.c,%.o,$(wildcard *.c))
-CFLAGS = -Wall
+CFLAGS = -Wall $(EXTRA_CFLAGS)
 override CFLAGS += -fPIC -I../include 
 
 all: $(LIBA) $(LIBSO)
diff -urN libselinux-1.0.orig/utils/Makefile libselinux-1.0/utils/Makefile
--- libselinux-1.0.orig/utils/Makefile	2003-07-07 07:53:42.000000000 -0500
+++ libselinux-1.0/utils/Makefile	2003-08-03 20:01:58.000000000 -0500
@@ -2,7 +2,7 @@
 PREFIX ?= $(DESTDIR)/usr
 BINDIR ?= $(PREFIX)/bin
 
-CFLAGS = -Wall
+CFLAGS = -Wall $(EXTRA_CFLAGS)
 override CFLAGS += -I../include
 LDLIBS += -L../src -lselinux -lattr
 
Index: libselinux/src/compute_av.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/compute_av.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 compute_av.c
--- libselinux/src/compute_av.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/compute_av.c	17 Jul 2003 14:49:01 -0000
@@ -37,7 +37,7 @@
 		goto out2;
 
 	memset(buf, 0, len);
-	ret = read(fd, buf, len);
+	ret = read(fd, buf, len-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/compute_create.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/compute_create.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 compute_create.c
--- libselinux/src/compute_create.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/compute_create.c	17 Jul 2003 14:49:01 -0000
@@ -35,7 +35,7 @@
 		goto out2;
 
 	memset(buf, 0, size);
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/compute_relabel.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/compute_relabel.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 compute_relabel.c
--- libselinux/src/compute_relabel.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/compute_relabel.c	17 Jul 2003 14:49:01 -0000
@@ -35,7 +35,7 @@
 		goto out2;
 
 	memset(buf, 0, size);
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/compute_user.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/compute_user.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 compute_user.c
--- libselinux/src/compute_user.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/compute_user.c	17 Jul 2003 14:49:01 -0000
@@ -36,7 +36,7 @@
 		goto out2;
 
 	memset(buf, 0, size);
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/fgetfilecon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/fgetfilecon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 fgetfilecon.c
--- libselinux/src/fgetfilecon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/fgetfilecon.c	17 Jul 2003 14:49:01 -0000
@@ -13,13 +13,13 @@
 	size_t size;
 	ssize_t ret;
 
-	size = INITCONTEXTLEN;
+	size = INITCONTEXTLEN+1;
 	buf = malloc(size);
 	if (!buf) 
 		return -1;
 	memset(buf, 0, size);
 
-	ret = fgetxattr(fd, XATTR_NAME_SELINUX, buf, size);
+	ret = fgetxattr(fd, XATTR_NAME_SELINUX, buf, size-1);
 	if (ret < 0 && errno == ERANGE) {
 		char *newbuf;
 
@@ -27,13 +27,14 @@
 		if (size < 0)
 			goto out;
 
+		size++;
 		newbuf = realloc(buf, size);
 		if (!newbuf)
 			goto out;
 
 		buf = newbuf;
 		memset(buf, 0, size);
-		ret = fgetxattr(fd, XATTR_NAME_SELINUX, buf, size); 
+		ret = fgetxattr(fd, XATTR_NAME_SELINUX, buf, size-1); 
 	}
 out:			
 	if (ret < 0)
Index: libselinux/src/getcon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getcon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getcon.c
--- libselinux/src/getcon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getcon.c	17 Jul 2003 14:49:01 -0000
@@ -26,7 +26,7 @@
 	}
 	memset(buf, 0, size);
 
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/getexeccon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getexeccon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getexeccon.c
--- libselinux/src/getexeccon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getexeccon.c	17 Jul 2003 14:49:01 -0000
@@ -26,7 +26,7 @@
 	}
 	memset(buf, 0, size);
 
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/getfilecon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getfilecon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getfilecon.c
--- libselinux/src/getfilecon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getfilecon.c	17 Jul 2003 14:49:01 -0000
@@ -13,13 +13,13 @@
 	size_t size;
 	ssize_t ret;
 
-	size = INITCONTEXTLEN;
+	size = INITCONTEXTLEN+1;
 	buf = malloc(size);
 	if (!buf) 
 		return -1;
 	memset(buf, 0, size);
 
-	ret = getxattr(path, XATTR_NAME_SELINUX, buf, size);
+	ret = getxattr(path, XATTR_NAME_SELINUX, buf, size-1);
 	if (ret < 0 && errno == ERANGE) {
 		char *newbuf;
 
@@ -27,13 +27,14 @@
 		if (size < 0)
 			goto out;
 
+		size++;
 		newbuf = realloc(buf, size);
 		if (!newbuf)
 			goto out;
 
 		buf = newbuf;
 		memset(buf, 0, size);
-		ret = getxattr(path, XATTR_NAME_SELINUX, buf, size); 
+		ret = getxattr(path, XATTR_NAME_SELINUX, buf, size-1); 
 	}
 out:			
 	if (ret < 0)
Index: libselinux/src/getfscreatecon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getfscreatecon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getfscreatecon.c
--- libselinux/src/getfscreatecon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getfscreatecon.c	17 Jul 2003 14:49:01 -0000
@@ -26,7 +26,7 @@
 	}
 	memset(buf, 0, size);
 
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/getpidcon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getpidcon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getpidcon.c
--- libselinux/src/getpidcon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getpidcon.c	17 Jul 2003 14:49:01 -0000
@@ -30,7 +30,7 @@
 	}
 	memset(buf, 0, size);
 
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/getprevcon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/getprevcon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 getprevcon.c
--- libselinux/src/getprevcon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/getprevcon.c	17 Jul 2003 14:49:01 -0000
@@ -26,7 +26,7 @@
 	}
 	memset(buf, 0, size);
 
-	ret = read(fd, buf, size);
+	ret = read(fd, buf, size-1);
 	if (ret < 0)
 		goto out2;
 
Index: libselinux/src/lgetfilecon.c
===================================================================
RCS file: /cvsroot/selinux/nsa/selinux-2.5/libselinux/src/lgetfilecon.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 lgetfilecon.c
--- libselinux/src/lgetfilecon.c	14 Jul 2003 17:11:31 -0000	1.1.1.1
+++ libselinux/src/lgetfilecon.c	17 Jul 2003 14:49:01 -0000
@@ -13,13 +13,13 @@
 	size_t size;
 	ssize_t ret;
 
-	size = INITCONTEXTLEN;
+	size = INITCONTEXTLEN+1;
 	buf = malloc(size);
 	if (!buf) 
 		return -1;
 	memset(buf, 0, size);
 
-	ret = lgetxattr(path, XATTR_NAME_SELINUX, buf, size);
+	ret = lgetxattr(path, XATTR_NAME_SELINUX, buf, size-1);
 	if (ret < 0 && errno == ERANGE) {
 		char *newbuf;
 
@@ -27,13 +27,14 @@
 		if (size < 0)
 			goto out;
 
+		size++;
 		newbuf = realloc(buf, size);
 		if (!newbuf)
 			goto out;
 
 		buf = newbuf;
 		memset(buf, 0, size);
-		ret = lgetxattr(path, XATTR_NAME_SELINUX, buf, size); 
+		ret = lgetxattr(path, XATTR_NAME_SELINUX, buf, size-1); 
 	}
 out:			
 	if (ret < 0)
