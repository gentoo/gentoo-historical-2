#!/bin/sh
#
# /opt/bin/realone -- Wrapper for RealOne player

PLAY_URI=${1}
FAKE_URI=""
RP="/opt/RealPlayer9"
RN="realnetworks"

# Workaround for filename-with-spaces bug 
if [ "${PLAY_URI}" ]; then
	for i in `basename "${PLAY_URI}"`
	do
		FAKE_URI=${FAKE_URI}${i}
	done
	if ! [[ ${FAKE_URI} == `basename "${PLAY_URI}"` ]]; then
		if [[ `dirname "${PLAY_URI}"` == . ]]; then
			ln -s "${PWD}/`basename "${PLAY_URI}"`" \
				/tmp/${USER}.${FAKE_URI}
		else 
			ln -s "${PLAY_URI}" /tmp/${USER}.${FAKE_URI} 
		fi
		chmod 600 /tmp/${USER}.${FAKE_URI}
		PLAY_URI="/tmp/${USER}.${FAKE_URI}"
	fi
fi

# If needed create dir, copy files
if ! [ -d ${HOME}/.${RN} ]; then
	mkdir ${HOME}/.${RN}
fi
for i in `ls ${RP}/${RN}`
do
	if ! [ -r ${HOME}/.${RN}/${i} ]; then
		cp ${RP}/${RN}/${i} ${HOME}/.${RN}/
	fi
done

# Run
${RP}/realplay ${PLAY_URI}

# Cleanup
if [ -f /tmp/${USER}.${FAKE_URI} ]; then
	rm /tmp/${USER}.${FAKE_URI}
fi
