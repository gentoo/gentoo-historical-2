diff --exclude=Makefile.in -ru transcode-1.0.3.original/filter/Makefile.am transcode-1.0.3/filter/Makefile.am
--- transcode-1.0.3.original/filter/Makefile.am	2007-06-07 20:40:53.000000000 +0200
+++ transcode-1.0.3/filter/Makefile.am	2007-06-07 20:43:32.000000000 +0200
@@ -40,20 +40,14 @@
 if HAVE_GCC2
 F_TOMSMOCOMP = 
 else
-if HAVE_GCC4
-F_TOMSMOCOMP =
-else
 if ARCH_X86
 if HAVE_MMX
 if HAVE_SSE
-if HAVE_3DNOW
 F_TOMSMOCOMP = tomsmocomp
 endif
 endif
 endif
 endif
-endif
-endif
 
 AM_CFLAGS = $(ALTIVEC)
 
diff --exclude=Makefile.in -ru transcode-1.0.3.original/filter/tomsmocomp/Makefile.am transcode-1.0.3/filter/tomsmocomp/Makefile.am
--- transcode-1.0.3.original/filter/tomsmocomp/Makefile.am	2007-06-07 20:40:53.000000000 +0200
+++ transcode-1.0.3/filter/tomsmocomp/Makefile.am	2007-06-07 21:33:11.000000000 +0200
@@ -8,6 +8,20 @@
 
 AM_CFLAGS = -fno-omit-frame-pointer
 
+#####################################################################
+# gcc-4.x only allows mmx inline assembly keywords when
+# -mmmx is specified.
+# (http://osdir.com/ml/video.transcode.devel/2005-07/msg00004.html)
+#
+# A dirty workaround would be to compile the problematic file
+# (tomsmocompfilter_mmx.c) as a pseudo-library so that we're able to
+# specify CFLAGS for it although it's okay in this case to add
+# -mmmx to the CFLAGS for the whole library because it won't be built
+# without an MMX capable CPU anyway, as specified in ../Makefile.am.
+#
+filter_tomsmocomp_la_CFLAGS = -mmmx
+#####################################################################
+
 pkgdir = $(MOD_PATH)
 
 pkg_LTLIBRARIES = filter_tomsmocomp.la 
