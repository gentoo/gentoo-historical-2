--- modules/adv717x.c	2008-11-03 01:21:31.000000000 +0100
+++ modules/adv717x.c	2009-06-12 10:51:09.000000000 +0200
@@ -44,7 +44,9 @@
 
 #include <linux/i2c.h>
 #include <linux/i2c-algo-bit.h>
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,30)
 #include <linux/video_encoder.h>
+#endif
 
 #include "em8300_compat24.h"
 #include "em8300_reg.h"
--- modules/bt865.c	2008-11-03 01:21:31.000000000 +0100
+++ modules/bt865.c	2009-06-12 10:51:03.000000000 +0200
@@ -48,7 +48,9 @@
 
 #include <linux/i2c.h>
 #include <linux/i2c-algo-bit.h>
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,30)
 #include <linux/video_encoder.h>
+#endif
 
 #include "em8300_compat24.h"
 #include "bt865.h"
--- modules/em8300_procfs.c	2008-11-03 01:21:31.000000000 +0100
+++ modules/em8300_procfs.c	2009-06-12 11:00:08.000000000 +0200
@@ -154,7 +154,9 @@
 		if (proc) {
 			proc->data = (void *) em;
 			proc->read_proc = em8300_proc_read;
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,30)
 			proc->owner = THIS_MODULE;
+#endif			
 		}
 	}
 }
@@ -180,11 +182,17 @@
 	em8300_proc = create_proc_entry(EM8300_PROCFS_DIR,
 					S_IFDIR | S_IRUGO | S_IXUGO,
 					NULL);
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,30)
+	if (!em8300_proc) {
+		printk(KERN_ERR "em8300: unable to register proc entry!\n");
+	}
+#else	
 	if (em8300_proc) {
 		em8300_proc->owner = THIS_MODULE;
 	} else {
 		printk(KERN_ERR "em8300: unable to register proc entry!\n");
 	}
+#endif	
 }
 
 struct em8300_registrar_s em8300_procfs_registrar =
--- modules/em8300_ucode.c	2008-11-03 01:21:31.000000000 +0100
+++ modules/em8300_ucode.c	2009-06-12 10:56:18.000000000 +0200
@@ -199,7 +199,11 @@
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2,5,0)
 		if (request_firmware(&fw_entry, "em8300.bin", &em->dev->dev) != 0) {
 			printk(KERN_ALERT "%s: firmware %s is missing, cannot start.\n",
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,30)			
+			       dev_name(em->dev), "em8300.bin");
+#else
 			       em->dev->dev.bus_id, "em8300.bin");
+#endif			       
 			return;
 		}
 #else
--- modules/em8300_compat24.h	2009-06-12 11:14:52.000000000 +0200
+++ modules/em8300_compat24.h	2009-06-12 11:14:26.000000000 +0200
@@ -27,8 +27,10 @@
 #ifndef IRQ_NONE
 #define IRQ_NONE
 #define IRQ_HANDLED
+#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,30)
 typedef void irqreturn_t;
 #endif
+#endif
 
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,18)
 #ifndef IRQF_DISABLED
