--- vcr-1.09/src/main.cc	Mon Nov 12 01:38:36 2001
+++ vcr-1.10a/src/main.cc	Thu Jun 27 22:16:47 2002
@@ -266,7 +266,7 @@
 		v4l,
 		filename,
 		-1,
-		codecID,
+		video_codecs[codecID].fourcc,
 		quality * 100,
 		keyframes,
 		soundfreq,
@@ -539,19 +539,15 @@
 }
 
 void
-list_attributes(int fourcc)
+list_attributes(int codec_idx)
 {
 	int defval;
 	char def_str[256];
 
-	int idx = get_codec_index(fourcc);
-	if (idx < 0)
-		return;
-
 #ifdef OLDAVIFILE
-	vector<AttributeInfo> encinfo = video_codecs[idx].encoder_info;
+	vector<AttributeInfo> encinfo = video_codecs[codec_idx].encoder_info;
 #else
-	avm::vector<AttributeInfo> encinfo = video_codecs[idx].encoder_info;
+	avm::vector<AttributeInfo> encinfo = video_codecs[codec_idx].encoder_info;
 #endif
 
 	fprintf(stderr, "These attributes are supported for this codec:\n\n");
@@ -569,18 +565,18 @@
 		{
 		case AttributeInfo::Integer:
 #ifdef OLDAVIFILE
-			IVideoEncoder::GetExtendedAttr(fourcc, it->name.c_str(), defval);
+			IVideoEncoder::GetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), defval);
 #else
-			GetCodecAttr(video_codecs[idx], it->GetName(), defval);
+			GetCodecAttr(video_codecs[codec_idx], it->GetName(), defval);
 #endif
 			fprintf(stderr, "\tType: integer (default value: %d)\n", defval);
 			break;
 		case AttributeInfo::Select:
 		{
 #ifdef OLDAVIFILE
-			IVideoEncoder::GetExtendedAttr(fourcc, it->name.c_str(), defval);
+			IVideoEncoder::GetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), defval);
 #else
-			GetCodecAttr(video_codecs[idx], it->GetName(), defval);
+			GetCodecAttr(video_codecs[codec_idx], it->GetName(), defval);
 #endif
 			fprintf(stderr, "\tType: select (default value: %s)\n",
 				it->options[defval].c_str());
@@ -599,9 +595,9 @@
 		}
 		case AttributeInfo::String:
 #ifdef OLDAVIFILE
-			IVideoEncoder::GetExtendedAttr(fourcc, it->name.c_str(), def_str, 256);
+			IVideoEncoder::GetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), def_str, 256);
 #else
-			GetCodecAttr(video_codecs[idx], it->GetName(), def_str, 256);
+			GetCodecAttr(video_codecs[codec_idx], it->GetName(), def_str, 256);
 #endif
 			fprintf(stderr, "\tType: string (default value: %s)\n", def_str);
 			break;
@@ -794,7 +790,7 @@
 }
 
 /* returns -1 if codec does not exist.
- * Otherwise, the codec's unique ID
+ * Otherwise, the codec's index in video_codec[]
  */
 int
 is_valid_codec(const char *cname)
@@ -802,15 +798,19 @@
 	if (!cname)
 		return -1;
 
-	int
-		found_codec = -1;
+	int found_codec = -1;
+        int idx = 0;
 
 	vector<CodecInfo>::iterator it;
 
 	for (it = video_codecs.begin(); it != video_codecs.end(); it++)
 	{
-		if ( it->kind == CodecInfo::DShow_Dec)
+		if ( it->kind == CodecInfo::DShow_Dec) 
+	        {
+		        idx++;
 			continue;
+		}
+	   
 
 #ifdef OLDAVIFILE
 		if (!strcasecmp(cname, it->name.c_str()))
@@ -818,10 +818,11 @@
 		if (!strcasecmp(cname, it->GetName()))
 #endif
 		{
-			found_codec = it->fourcc;
+			found_codec = idx;
 			encoder_info = it->encoder_info;
 			break;
 		}
+	        idx++;
 	}
 
 	return found_codec;
@@ -1018,20 +1019,17 @@
 
 //TODO: It ignores fourcc currently..
 short
-set_attribute(int fourcc, const char *attr, const char *val)
+set_attribute(int codec_idx, const char *attr, const char *val)
 {
 	int setval = 0;
 	int retval = 0;
 
 	vector<AttributeInfo>::const_iterator it;
-	int idx = get_codec_index(fourcc);
-	if (idx < 0)
-		return 0;
 
 #ifdef OLDAVIFILE
-	vector<AttributeInfo> encinfo = video_codecs[idx].encoder_info;
+	vector<AttributeInfo> encinfo = video_codecs[codec_idx].encoder_info;
 #else
-	avm::vector<AttributeInfo> encinfo = video_codecs[idx].encoder_info;
+	avm::vector<AttributeInfo> encinfo = video_codecs[codec_idx].encoder_info;
 #endif
 
 	for (it = encinfo.begin(); it != encinfo.end(); it++)
@@ -1047,23 +1045,23 @@
 		{
 		case AttributeInfo::Integer:
 #ifdef OLDAVIFILE
-			IVideoEncoder::SetExtendedAttr(fourcc, it->name.c_str(), atoi(val));
+			IVideoEncoder::SetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), atoi(val));
 #else
-			SetCodecAttr(video_codecs[idx], it->GetName(), atoi(val));
+			SetCodecAttr(video_codecs[codec_idx], it->GetName(), atoi(val));
 #endif
 			break;
 		case AttributeInfo::String:
 #ifdef OLDAVIFILE
-			IVideoEncoder::SetExtendedAttr(fourcc, it->name.c_str(), val);
+			IVideoEncoder::SetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), val);
 #else
-			SetCodecAttr(video_codecs[idx], it->GetName(), val);
+			SetCodecAttr(video_codecs[codec_idx], it->GetName(), val);
 #endif
 			break;
 		case AttributeInfo::Select:
 #ifdef OLDAVIFILE
-			IVideoEncoder::SetExtendedAttr(fourcc, it->name.c_str(), val);
+			IVideoEncoder::SetExtendedAttr(video_codecs[codec_idx].fourcc, it->name.c_str(), val);
 #else
-			SetCodecAttr(video_codecs[idx], it->GetName(), val);
+			SetCodecAttr(video_codecs[codec_idx], it->GetName(), val);
 #endif
 			break;
 		}
@@ -1074,14 +1072,14 @@
 }
 
 short
-set_attributes(int fourcc)
+set_attributes(int codec_idx)
 {
 	const char *cname = NULL;
 	int i;
 
 	for (i = 0; i < attr_count; i++)
 	{
-		if (!set_attribute(fourcc, attributes[i].name, attributes[i].val))
+		if (!set_attribute(codec_idx, attributes[i].name, attributes[i].val))
 			return 0;
 	}
 
