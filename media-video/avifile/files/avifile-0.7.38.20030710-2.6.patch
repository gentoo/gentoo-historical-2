diff -ur avifile-0.7-0.7.38/ffmpeg/libavformat/grab.c avifile-0.7-0.7.38.plasmaroo/ffmpeg/libavformat/grab.c
--- avifile-0.7-0.7.38/ffmpeg/libavformat/grab.c	2003-06-26 20:14:31.000000000 +0100
+++ avifile-0.7-0.7.38.plasmaroo/ffmpeg/libavformat/grab.c	2003-12-26 21:41:48.000000000 +0000
@@ -16,14 +16,24 @@
  * License along with this library; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
+
 #include "avformat.h"
+
+#if defined(__linux__) 
+	#include <linux/version.h>
+	#if LINUX_VERSION_CODE < KERNEL_VERSION(2,6,0) 
+		#include <sys/time.h>
+	#endif
+#else
+	#include <sys/time.h>
+#endif
+#include <time.h>
+
 #include <linux/videodev.h>
 #include <unistd.h>
 #include <fcntl.h>
 #include <sys/ioctl.h>
 #include <sys/mman.h>
-#include <sys/time.h>
-#include <time.h>
 
 typedef struct {
     int fd;
diff -ur avifile-0.7-0.7.38/samples/qtvidcap/main.cpp avifile-0.7-0.7.38.plasmaroo/samples/qtvidcap/main.cpp
--- avifile-0.7-0.7.38/plugins/libwin32/loader/ldt_keeper.c	2002-08-08 10:05:51.000000000 +0100
+++ avifile-0.7-0.7.38.plasmaroo/plugins/libwin32/loader/ldt_keeper.c	2004-01-02 16:17:06.000000000 +0000
@@ -24,6 +24,10 @@
 #ifdef __linux__
 #include <asm/unistd.h>
 #include <asm/ldt.h>
+#include <linux/version.h>
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,5,47)
+	#define modify_ldt_ldt_s user_desc
+#endif
 /* prototype it here, so we won't depend on kernel headers */
 #ifdef  __cplusplus
 extern "C" {
--- avifile-0.7-0.7.38/samples/qtvidcap/main.cpp	2003-06-08 18:26:04.000000000 +0100
+++ avifile-0.7-0.7.38.plasmaroo/samples/qtvidcap/main.cpp	2003-12-26 19:21:20.000000000 +0000
@@ -1,9 +1,6 @@
-
-#include "v4lwindow.h"
 #include "vidconf.h"
 
 #include <aviplay.h>
-#include "v4lxif.h"
 #include <avm_except.h>
 #include <avm_cpuinfo.h>
 #include <videoencoder.h>
@@ -27,6 +24,8 @@
 #include <stdlib.h>
 #include <stdio.h>
 
+#include "v4lwindow.h"
+#include "v4lxif.h"
 
 unsigned int m_iMemory;
 const char* g_pcProgramName = "AviCap";
